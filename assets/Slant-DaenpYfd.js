import{j as e,a as n,r}from"./vendor_react-De-BR_RD.js";import{B as t,l as o,g as s,d as l,G as i,u as a,C as c,b as u,m as d,T as f,n as p,L as g,o as h,e as y,c as m,a as x,h as b,f as S,i as v,j as A,k as w}from"./useBaseGame-nL3ohBdL.js";import{T as C}from"./PageLayout-CMfwCce1.js";import{d as I,T as k,B as j}from"./vendor_mui_core-hUAqgBQf.js";import{c as N,D as E,d as M,e as O,P as T,f as R,N as P,g as z,h as D,T as L,i as $,j as B}from"./vendor_mui_icons-CZLxzKXb.js";import{C as H,L as _,A as W,S as G,F as Y,t as q,P as U}from"./index-DS_qwRzF.js";import{u as K,E as V}from"./lazyNamed-B8LsRnMY.js";import{E as F}from"./ErrorState-DyrLLHCx.js";function J({onCopy:n,onClear:r,onClose:t,onApply:o}){return e.jsxs(I,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:_.zIndex.base+5,paddingBottom:2},children:[e.jsx(C,{title:"Copy Board",Icon:N,onClick:n,sx:{backgroundColor:H.interactive.selected,color:H.primary.main,"&:hover":{backgroundColor:H.interactive.focus}}}),e.jsx(C,{title:"Clear Analysis",Icon:E,onClick:r,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:H.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(C,{title:"Apply to Game",Icon:M,onClick:o,sx:{backgroundColor:"rgba(76, 175, 80, 0.1)",color:H.data.green,"&:hover":{backgroundColor:"rgba(76, 175, 80, 0.2)"}}}),e.jsx(C,{title:"Close Analysis",Icon:O,onClick:t,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:H.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const X=.4,Q=100,Z=1e3,ee=100,ne=.8,re={...o("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},te=0,oe=8,se=5,le={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:t.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:"\n            @keyframes slant-pop-in {\n                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }\n                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }\n                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }\n            }\n        ",POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},ie=1,ae=2,ce=n.memo(function({value:n,color:r,size:t}){const o=`${String(Math.max(2,t))}px`;return e.jsxs(I,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===ie&&e.jsx(I,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:G.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:le.SHADOWS.LINE,transition:W.transition,animation:le.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),n===ae&&e.jsx(I,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:G.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:le.SHADOWS.LINE,transition:W.transition,animation:le.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),ue=n.memo(function({value:n,hasConflict:r,isSatisfied:t,numberSize:o}){return e.jsx(I,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:r?le.COLORS.WHITE:t?H.interactive.disabledText:le.ANALYSIS.HINT_TEXT,boxShadow:t&&!r?"none":le.SHADOWS.HINT,opacity:t?.6:1,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)"},children:n??""})});class de{constructor(e){this.parent=Array.from({length:e},(e,n)=>n)}find(e){const n=this.parent[e];if(void 0===n)throw new Error(`DSU: Index ${String(e)} out of bounds`);n!==e&&(this.parent[e]=this.find(n));const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return r}union(e,n){const r=this.find(e),t=this.find(n);return r!==t&&(this.parent[r]=t,!0)}connected(e,n){return this.find(e)===this.find(n)}}function fe(e,n,r){return e*(r+1)+n}function pe(e,n,r){const t=new Map,o=new Set;for(let s=0;s<n;s++)for(let n=0;n<r;n++){const o=e[s]?.[n];if(!o||0===o)continue;const l=fe(s,o===ie?n+1:n,r),i=fe(s+1,o===ie?n:n+1,r);t.has(l)||t.set(l,[]),t.has(i)||t.set(i,[]),t.get(l)?.push({node:i,r:s,c:n}),t.get(i)?.push({node:l,r:s,c:n})}const l=new Set,i=new Set,a=[],c=(e,n)=>{l.add(e),i.add(e);const r=t.get(e)??[];for(const{node:t,r:u,c:d}of r)if(t!==n)if(i.has(t)){o.add(s(u,d));for(let e=a.length-1;e>=0;e--){const n=a[e];if(!n)break;if(o.add(s(n.r,n.c)),n.u===t||n.v===t)break}}else l.has(t)||(a.push({r:u,c:d,u:e,v:t}),c(t,e),a.pop());i.delete(e)};for(const s of t.keys())l.has(s)||c(s,-1);return o}function ge({rows:e,cols:n,numbers:t,userMoves:o}){const[l,i]=r.useState(new Map),[a,c]=r.useState([]),[u,d]=r.useState(new Set),f=r.useRef(null),[p,g]=r.useState("probing");return r.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=n;const r=setTimeout(()=>{e||(g("broken"),f.current=null,n.terminate())},2e3);return n.onmessage=n=>{if(e)return;const t=n.data;"RESULT"===t.type&&g(e=>{if("probing"===e)return clearTimeout(r),"healthy";const{gridState:n,conflicts:o,cycleCells:s}=t.payload;return i(n),c(o),d(s),e})},n.onerror=()=>{clearTimeout(r),g("broken"),f.current=null,n.terminate()},n.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(r),n.terminate()}},[]),r.useEffect(()=>{if("healthy"===p&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:n,numbers:t,userMoves:o}});else if("broken"===p){const r=function(e,n,r,t){const o=new Map,l=[],i=[];t.forEach((e,n)=>{o.set(n,{state:e,source:"user"});const[r,t]=n.split(",").map(Number);void 0!==r&&void 0!==t&&l.push({r:r,c:t})});const a=(r,t)=>{if(r<0||r>=e||t<0||t>=n)return 0;const l=s(r,t);return o.get(l)?.state??0},c=(e,n,r,t)=>{const a=s(e,n),c=o.get(a);c?c.state!==r&&i.push({type:"cell",r:e,c:n}):(o.set(a,{state:r,source:t}),l.push({r:e,c:n}))},u=(r,t)=>[{r:r-1,c:t-1,required:ae},{r:r-1,c:t,required:ie},{r:r,c:t-1,required:ie},{r:r,c:t,required:ae}].filter(r=>r.r>=0&&r.r<e&&r.c>=0&&r.c<n);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:n,c:t}=e,f=[{r:n,c:t},{r:n,c:t+1},{r:n+1,c:t},{r:n+1,c:t+1}];for(const l of f){const e=r[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const p=[];for(const n of d){const e=a(n.r,n.c);0===e?p.push(n):e===n.required&&f++}if(f>e)i.push({type:"node",r:l.r,c:l.c});else if(f+p.length<e)i.push({type:"node",r:l.r,c:l.c});else if("user"===o.get(s(n,t))?.source)if(f===e&&p.length>0)for(const n of p){const e=n.required===ie?ae:ie;c(n.r,n.c,e,"propagated")}else if(f+p.length===e&&p.length>0)for(const n of p)c(n.r,n.c,n.required,"propagated")}}const f=Array.from({length:e},()=>new Array(n).fill(0));for(const[s,g]of o.entries()){const[e,n]=s.split(",").map(Number);void 0!==e&&void 0!==n&&f[e]&&(f[e][n]=g.state)}const p=pe(f,e,n);return{gridState:o,conflicts:i,cycleCells:p}}(e,n,t,o);i(r.gridState),c(r.conflicts),d(r.cycleCells)}},[o,t,e,n,p]),{gridState:l,conflicts:a,cycleCells:u}}function he({rows:n,cols:o,numbers:u,size:d,initialMoves:f,onMove:p,onCopy:g,onClear:h,onClose:y,onApply:m}){const x=K("sm"),b=f,{getDragProps:S}=l({onToggle:(e,n,r,t,o)=>{const l=s(e,n);if(!o)return void p(l,t);const i=b.get(l);let a;return a=r?i===ie?ae:i===ae?void 0:ie:i===ae?ie:i===ie?void 0:ae,p(l,a),a},touchTimeout:i.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:v}=a({rows:n,cols:o}),A=r.useCallback(e=>{const n=S(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),v(e)}}},[S,v]),{gridState:w,conflicts:C,cycleCells:k}=ge({rows:n,cols:o,numbers:u,userMoves:b}),j=d*X,N=d-j+.125,E=r.useMemo(()=>new Set(C.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[C]),M=r.useMemo(()=>new Set(C.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[C]),O=r.useCallback((n,r)=>function({r:n,c:r,gridState:t,conflictSet:o,cycleCells:l,getDragProps:i,size:a}){const c=s(n,r),u=t.get(c),d=u?.state??0,f=u?.source,p=o.has(c),g=l.has(c),h=i(c);let y=H.text.primary;return p?y=H.data.red:g?y="user"===f?H.data.red:H.data.orange:"user"===f?y=H.primary.main:"propagated"===f&&(y=H.data.green),{...h,"data-pos":c,"data-type":"cell",sx:{...h.sx,cursor:"pointer",outline:"none",border:`2px solid ${H.border.subtle}`,position:"relative",backgroundColor:le.ANALYSIS.BG_SUBTLE,"&:hover":{backgroundColor:le.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${H.primary.main}`,outlineOffset:"-3px",backgroundColor:le.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${H.interactive.focus}`}},children:e.jsx(ce,{value:d,color:y,size:a})}}({r:n,c:r,gridState:w,conflictSet:E,cycleCells:k,getDragProps:A,size:d}),[w,E,k,A,d]),T=r.useCallback(()=>{if(!m)return;const e=new Map;w.forEach((n,r)=>{0!==n.state&&e.set(r,n.state)}),m(e)},[m,w]),R=r.useCallback((r,t)=>function({r:n,c:r,numbers:t,gridState:o,rows:l,cols:i,nodeConflictSet:a,numberSize:c}){const u=t[n]?.[r],d=a.has(s(n,r));let f=0,p=0;const g=[{r:n-1,c:r-1,required:ae},{r:n-1,c:r,required:ie},{r:n,c:r-1,required:ie},{r:n,c:r,required:ae}];for(const e of g)if(e.r>=0&&e.r<l&&e.c>=0&&e.c<i){const n=o.get(s(e.r,e.c));n&&0!==n.state&&(p++,n.state===e.required&&f++)}const h=null!=u&&f===u&&p>0;return{"data-pos":s(n,r),"data-type":"hint",children:e.jsx(ue,{value:u??null,hasConflict:d,isSatisfied:h,numberSize:c}),sx:{borderRadius:"50%",backgroundColor:d?H.data.red:le.ANALYSIS.HINT_BG,border:null==u?"none":`2px solid ${d?H.data.red:h?"transparent":le.ANALYSIS.HINT_BORDER}`,zIndex:5,opacity:null==u?0:1,position:"relative",pointerEvents:"none",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)"}}}({r:r,c:t,numbers:u,gridState:w,rows:n,cols:o,nodeConflictSet:M,numberSize:j}),[u,w,n,o,M,j]);return e.jsxs(I,{sx:{position:"relative",userSelect:"none"},onContextMenu:e=>{e.preventDefault()},children:[e.jsx("style",{children:le.ANIMATIONS.POP_IN}),e.jsxs(I,{sx:{position:"relative",padding:x?t.PADDING.MOBILE:t.PADDING.DESKTOP,border:`2px dashed ${le.ANALYSIS.DASHED_BORDER}`,borderRadius:t.BORDER_RADIUS},children:[e.jsx(I,{sx:{position:"relative",zIndex:_.zIndex.base+1},children:e.jsx(c,{size:d,rows:n,cols:o,cellProps:O,space:.125,sx:{width:"fit-content"}})}),e.jsx(I,{sx:{position:"absolute",top:x?t.PADDING.MOBILE:t.PADDING.DESKTOP,left:x?t.PADDING.MOBILE:t.PADDING.DESKTOP,transform:`translate(calc(-${String(j/2)}rem - 0.0625rem), calc(-${String(j/2)}rem - 0.0625rem))`,zIndex:_.zIndex.base+2,pointerEvents:"none"},children:e.jsx(c,{size:j,rows:n+1,cols:o+1,cellProps:R,space:N,sx:{width:"fit-content"}})})]}),e.jsx(J,{onCopy:g,onClear:h,onClose:y,onApply:T})]})}function ye({size:n,rows:t,cols:o}){const s=r.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),l=r.useCallback(()=>({}),[]);return e.jsx(I,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:e.jsx(u,{size:n,rows:t+1,cols:o+1,cellRows:t,cellCols:o,overlayProps:l,cellProps:s,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}function me({isAnalysisMode:n,generating:r,dimensionsMismatch:t,rows:o,cols:s,state:l,size:i,analysisMoves:a,onAnalysisMove:c,onAnalysisCopy:f,onAnalysisClear:p,onAnalysisClose:g,onAnalysisApply:h,cellProps:y,overlayProps:m}){return n?e.jsx(V,{fallback:e.jsx(F,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:e.jsx(he,{rows:o,cols:s,numbers:l.numbers,size:i,initialMoves:a,onMove:c,onCopy:f,onClear:p,onClose:g,onApply:h})}):r||t?e.jsx(ye,{size:i,rows:o,cols:s}):e.jsxs(V,{FallbackComponent:Y,fallbackProps:{title:d.errors.boardTitle,resetLabel:d.errors.boardReset},children:[e.jsx("style",{children:le.ANIMATIONS.POP_IN}),e.jsx(u,{size:i,rows:o+1,cols:s+1,cellRows:o,cellCols:s,space:.125,overlayProps:m,cellProps:y,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})]})}const xe=[{title:"Corner 0",description:'A "0" in a corner forces the line to point away from that corner.',rows:3,cols:3,numbers:[[0,null,null],[null,null,null],[null,null,null]],grid:[[ie,0],[0,0]]},{title:"Corner 1",description:'A "1" in a corner forces the line to connect directly to that corner.',rows:3,cols:3,numbers:[[1,null,null],[null,null,null],[null,null,null]],grid:[[ae,0],[0,0]]},{title:"Edge 0",description:'A "0" on the edge forces all surrounding lines to point away from it.',rows:3,cols:3,numbers:[[null,0,null],[null,null,null],[null,null,null]],grid:[[ae,ie],[0,0]]},{title:"Edge 1",description:'A "1" on the edge forces the two surrounding lines into the same orientation.',rows:3,cols:3,numbers:[[null,1,null],[null,null,null],[null,null,null]],grid:[[ie,ie],[0,0]]},{title:"Edge 2",description:'A "2" on the edge forces both surrounding lines to connect to it.',rows:3,cols:3,numbers:[[null,2,null],[null,null,null],[null,null,null]],grid:[[ie,ae],[0,0]]},{title:"Middle 4",description:'A "4" must catch lines from all four surrounding cells.',rows:3,cols:3,numbers:[[null,null,null],[null,4,null],[null,null,null]],grid:[[ae,ie],[ie,ae]]}],be={display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4,width:"100%",py:2,pr:4},Se={display:"flex",flexDirection:"row",alignItems:"center",gap:0,width:"100%"},ve={width:"180px",display:"flex",justifyContent:"center",flexShrink:0},Ae={display:"flex",flexDirection:"column",gap:1,flex:1,minWidth:0};function we(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:H.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:le.SHADOWS.LINE,pointerEvents:"none"}}function Ce(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{border:`2px solid ${H.border.subtle}`,position:"relative",backgroundColor:le.ANALYSIS.BG_SUBTLE},children:e.jsxs(I,{sx:{width:"100%",height:"100%",position:"relative"},children:[s===ie&&e.jsx(I,{sx:we("-45deg",r)}),s===ae&&e.jsx(I,{sx:we("45deg",r)})]})}}}function Ie(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{pointerEvents:"none"},children:e.jsx(I,{sx:{borderRadius:"50%",backgroundColor:H.surface.background,border:null==s?"none":`2px solid ${H.border.subtle}`,fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:H.text.primary,boxShadow:null==s?"none":le.SHADOWS.HINT,zIndex:5,opacity:null==s?0:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0.05rem",lineHeight:1,width:`${String(r)}rem`,height:`${String(r)}rem`},children:s??""})}}}const ke={display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.5em",height:"1.5em",borderRadius:"50%",backgroundColor:H.surface.background,border:`1px solid ${H.border.subtle}`,fontSize:"0.85em",fontWeight:"bold",mx:.4,verticalAlign:"middle",lineHeight:1,pt:"0.05em",boxShadow:le.SHADOWS.HINT,position:"relative",top:"-0.1em"};function je({text:n}){const r=n.split(/"(\d+)"/g);return e.jsx(k,{variant:"body2",sx:{color:H.text.secondary},children:r.map((n,r)=>r%2==1?e.jsx(I,{component:"span",sx:ke,children:n},`${String(r)}-${n}`):n)})}function Ne(){return e.jsx(I,{sx:be,children:xe.map(n=>e.jsxs(I,{sx:Se,children:[e.jsx(I,{sx:ve,children:e.jsx(u,{size:3,rows:n.rows,cols:n.cols,cellRows:n.rows-1,cellCols:n.cols-1,space:.125,overlayProps:Ie(n.numbers,1.2000000000000002),cellProps:Ce(n.grid,3),overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})}),e.jsxs(I,{sx:Ae,children:[e.jsx(k,{variant:"subtitle1",sx:{fontWeight:"bold",color:H.text.primary},children:n.title}),e.jsx(je,{text:n.description})]})]},n.title))})}const Ee={display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"center",alignItems:"center",gap:{xs:2,sm:4},width:"100%",flex:1},Me={display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"1fr"},gap:1.5,justifyContent:"center",justifyItems:"center",alignItems:"center",mt:{xs:2,sm:0},width:{xs:"100%",sm:"auto"},maxWidth:{xs:"320px",sm:"none"}},Oe={borderColor:H.border.subtle,color:H.text.secondary,width:{xs:"140px",sm:"180px"},px:1,"& .MuiButton-startIcon":{mr:{xs:.5,sm:1}}},Te=[[ae,ie,ae],[ie,ie,ae],[ae,ie,ae]],Re=[[1,0,2,null],[null,null,null,1],[2,null,null,null],[null,2,0,1]],Pe=[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[2,0],[1,0],[1,1]];function ze(e,n,r){const t=Array.from({length:n+1},()=>new Array(r+1).fill(0));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const r=n[e];if(r===ie){const n=t[o];if(n){const r=n[e+1];void 0!==r&&(n[e+1]=r+1)}const r=t[o+1];if(r){const n=r[e];void 0!==n&&(r[e]=n+1)}}else if(r===ae){const n=t[o];if(n){const r=n[e];void 0!==r&&(n[e]=r+1)}const r=t[o+1];if(r){const n=r[e+1];void 0!==n&&(r[e+1]=n+1)}}}}return t}function De(e,n,r,t){const o=new Set,l=ze(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;if((l[i]?.[a]??0)===c){let n=!1;const l=[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}];for(const{gr:o,gc:s}of l)if(o>=0&&o<r&&s>=0&&s<t&&0!==e[o]?.[s]){n=!0;break}n&&o.add(s(i,a))}}return o}function Le(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:H.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:le.SHADOWS.LINE,transition:W.transition,animation:le.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}function $e({size:n,handleOpenAnalysis:t}){const o=r.useMemo(()=>function(){const e=[],n=Array.from({length:3},()=>new Array(3).fill(0));e.push(n);let r=n.map(e=>[...e]);for(const[t,o]of Pe){r=r.map(e=>[...e]);const n=Te[t]?.[o];if(void 0!==n){const e=r[t];e&&(e[o]=n)}e.push(r)}return e}(),[]),[l,i]=r.useState(0),[a,c]=r.useState(!0);r.useEffect(()=>{if(!a)return;const e=setInterval(()=>{i(e=>(e+1)%o.length)},1500);return()=>{clearInterval(e)}},[o.length,a]);const d=r.useMemo(()=>o[l]??o[0]??[],[o,l]),p=l>0&&l<=Pe.length?(()=>{const e=Pe[l-1];return e?s(e[0],e[1]):null})():null,g=r.useMemo(()=>De(d,Re,3,3),[d]),h=n*X,y=l>=Pe.length&&d.every(e=>e.every(e=>0!==e)),m=r.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l)===t;return{sx:{border:`2px solid ${H.border.subtle}`,position:"relative",transition:W.transition,backgroundColor:le.ANALYSIS.BG_SUBTLE,...a?{backgroundColor:H.interactive.hover}:{}},children:e.jsxs(I,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===ie&&e.jsx(I,{sx:Le("-45deg",r)}),i===ae&&e.jsx(I,{sx:Le("45deg",r)})]})}}}(d,n,p),[d,n,p]),x=r.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l),c=r.has(a);return{sx:{pointerEvents:"none"},children:e.jsx(I,{sx:{borderRadius:"50%",backgroundColor:H.surface.background,border:null==i?"none":`2px solid ${c?"transparent":H.border.subtle}`,fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:c?H.interactive.disabledText:H.text.primary,boxShadow:c?"none":le.SHADOWS.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:c?"scale(0.95)":"scale(1)",paddingTop:"0.05rem",lineHeight:1,width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}}}(Re,g,h),[g,h]);return e.jsxs(I,{sx:Ee,children:[e.jsxs(I,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx("style",{children:le.ANIMATIONS.POP_IN}),e.jsx(u,{size:n,rows:4,cols:4,cellRows:3,cellCols:3,space:.125,overlayProps:x,cellProps:m,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0}),e.jsx(f,{show:y&&a,size:n,iconSizeRatio:1,primaryColor:H.primary.main,showLabel:!1})]}),e.jsxs(I,{sx:Me,children:[e.jsx(j,{variant:"outlined",startIcon:a?e.jsx(T,{}):e.jsx(R,{}),onClick:()=>{c(e=>!e)},sx:Oe,children:a?"Pause":"Play"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(P,{}),onClick:()=>{c(!1),i(e=>(e-1+o.length)%o.length)},sx:Oe,children:"Step Back"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(z,{}),onClick:()=>{c(!1),i(e=>(e+1)%o.length)},sx:Oe,children:"Step Next"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(D,{}),onClick:t,sx:Oe,children:"Analysis"})]})]})}const Be={display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"primary.main",fontSize:"1em",borderRadius:1,px:.6,lineHeight:1,verticalAlign:"baseline"},He=["Slant Rules","Example","Common Patterns"],_e=[{Icon:L,title:"Fill with Slashes",text:e.jsxs(e.Fragment,{children:["Place a forward"," ",e.jsx(I,{component:"span",sx:Be,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"9",x2:"9",y2:"1"})})})," ","or backward"," ",e.jsx(I,{component:"span",sx:Be,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"1",x2:"9",y2:"9"})})})," ","slash in every cell of the grid."]})},{Icon:$,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:B,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],We={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},Ge=e=>[...q(p()),e<2?{overflowY:"hidden"}:{}];function Ye(e){return{storageKey:"slant",grid:{defaultSize:se,maxSize:oe,gridPadding:{x:e?48:80,y:120},widthLimit:Z,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:Q}),...e?{boardSizeFactor:.92}:{},maxCellSize:ee,rowOffset:1,colOffset:1}}}function qe({open:n,toggleOpen:r,handleOpenAnalysis:t}){const o=K("sm");return e.jsx(g,{open:n,toggleOpen:r,titles:He,instructions:_e,exampleContent:e.jsx($e,{size:o?4:4.5,handleOpenAnalysis:t}),cardSx:We,contentSxOverride:Ge,persistenceKey:"slant_info_step",extraSteps:[e.jsx(Ne,{},"patterns")]})}function Ue(e,n){return`${re.STATE}-${String(e)}x${String(n)}`}function Ke(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function Ve({rows:e,cols:n,isAnalysisMode:t,requestGeneration:o,cancelGeneration:s}){const l=r.useRef(`${String(e)},${String(n)}`);r.useEffect(()=>{const r=`${String(e)},${String(n)}`;r!==l.current&&(l.current=r,t||!function(e,n){const r=Ue(e,n),t=localStorage.getItem(r);if(!t)return!1;try{const e=JSON.parse(t);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,n)?o(e,n):s())},[e,n,o,s,t])}function Fe(e,n,r,t){return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:e,cols:n,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Je({getInitialState:e,dispatchRef:n,dimsRef:t,onStaleResult:o}){const[s,l]=r.useState(!1),i=r.useRef(null),a=r.useRef("probing"),c=r.useRef(0),u=r.useRef(0),d=r.useRef(null),f=r.useRef(0),p=r.useRef(o);p.current=o;const g=r.useRef(!1),h=r.useRef(null),y=r.useRef(!1),m=r.useCallback(()=>{if(h.current){const e=h.current;p.current?.(e,e.rows,e.cols)}g.current=!1,h.current=null,y.current=!1},[]),x=r.useCallback((r,t)=>{n.current?.({type:"hydrate",state:e(r,t)}),l(!1)},[n,e]),b=r.useCallback((e,n)=>{m(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const r=++c.current;"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:n}})):u.current=requestAnimationFrame(()=>{c.current===r&&x(e,n)})},250)},[x,m]),S=r.useCallback((n,r)=>{g.current||(g.current=!0,h.current=null,y.current=!1,"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:n,cols:r}})):requestAnimationFrame(()=>{g.current&&(h.current=e(n,r))}))},[e]),v=r.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),m(),l(!1)},[m]),A=r.useCallback(()=>{if(h.current){const e=h.current;return h.current=null,n.current?.({type:"hydrate",state:e}),m(),void l(!1)}if(g.current)return y.current=!0,void l(!0);b(t.current.rows,t.current.cols)},[b,t,n,m]);return r.useEffect(()=>{let e=!1;const r=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});i.current=r;const o=setTimeout(()=>{e||"probing"!==a.current||(a.current="broken",f.current=0,i.current=null,r.terminate())},2e3);return r.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(o),a.current="broken",f.current=0,i.current=null,void r.terminate();if("RESULT"===s.data.type){if("probing"===a.current)return clearTimeout(o),void(a.current="healthy");f.current--;const{rows:e,cols:r,numbers:i,solution:c}=s.data.payload,u=t.current;if(e!==u.rows||r!==u.cols)return p.current?.(Fe(e,r,i,c),e,r),void(f.current<=0&&l(!1));if(f.current>0)return;const d=Fe(e,r,i,c);if(g.current)return h.current=d,void(y.current&&(n.current?.({type:"hydrate",state:d}),g.current=!1,h.current=null,y.current=!1,l(!1)));n.current?.({type:"hydrate",state:d}),l(!1)}}},r.onerror=()=>{clearTimeout(o),a.current="broken",f.current=0,i.current=null,r.terminate()},r.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(o),null!==d.current&&clearTimeout(d.current),r.terminate()}},[n,t]),{generating:s,requestGeneration:b,handleNextAsync:A,prefetch:S,cancelGeneration:v}}function Xe(e,n,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:r?H.data.red:H.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:le.SHADOWS.LINE,transition:W.transition,animation:le.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const Qe={border:`2px solid ${H.border.subtle}`,position:"relative",backgroundColor:le.ANALYSIS.BG_SUBTLE},Ze={width:"100%",height:"100%",position:"relative"},en={pointerEvents:"none"},nn={cursor:"pointer",outline:"none","&:hover":{backgroundColor:H.interactive.hover},"&:focus-visible":{outline:`3px solid ${H.primary.main}`,outlineOffset:"-3px",backgroundColor:H.interactive.hover,boxShadow:`inset 0 0 15px ${H.interactive.focus}`}};function rn(e){const{numberSize:n,hasError:r,isSatisfied:t,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:r?H.data.red:H.surface.background,border:o?`2px solid ${r?H.data.red:t?"transparent":H.border.subtle}`:"none",fontSize:`${String(.5*n)}rem`,fontWeight:"800",color:r?le.COLORS.WHITE:t?H.interactive.disabledText:H.text.primary,boxShadow:t&&!r?"none":le.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)",width:`${String(n)}rem`,height:`${String(n)}rem`}}const tn=(n,r,t)=>{const o=function(n,r){return(t,o)=>{const l=n.grid[t]?.[o],i=s(t,o),a=n.cycleCells.has(i),c=[{v:n.numbers[t]?.[o],p:s(t,o)},{v:n.numbers[t]?.[o+1],p:s(t,o+1)},{v:n.numbers[t+1]?.[o],p:s(t+1,o)},{v:n.numbers[t+1]?.[o+1],p:s(t+1,o+1)}].map(({v:e,p:r})=>{if(null==e)return"-";const t=n.errorNodes.has(r)?"Error":n.satisfiedNodes.has(r)?"Ok":"Pending";return`${String(e)} (${t})`});return{"aria-label":`Cell ${String(t+1)}, ${String(o+1)}. Clues: ${c.join(", ")}. ${0===l?"Empty":l===ie?"Forward Slash":"Backward Slash"}${a?", Loop Error":""}`,sx:Qe,children:e.jsxs(I,{sx:Ze,children:[l===ie&&e.jsx(I,{sx:Xe("-45deg",r,a)}),l===ae&&e.jsx(I,{sx:Xe("45deg",r,a)})]})}}}(r,t);return(e,r)=>{const t=o(e,r),l=s(e,r),i=n(l);return{...i,...t,sx:{...i.sx,...t.sx,...nn}}}};function on({game:{state:n,rows:t,cols:o,size:l,mobile:i,isAnalysisMode:a,generating:c,handleNextAsync:u},analysis:{analysisMoves:d,handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:g,handleAnalysisClose:h,handleAnalysisApply:m,handleBoxClick:x,handleOpenAnalysis:b,boardSx:S},info:{infoOpen:v,toggleInfo:A},controls:w,getDragProps:C}){const k=l*X,j=y(tn,C,[n,l]),N=r.useMemo(()=>((n,r)=>(t,o)=>{const l=n.numbers[t]?.[o],i=s(t,o),a=n.errorNodes.has(i),c=n.satisfiedNodes.has(i);return{sx:en,children:e.jsx(I,{sx:rn({numberSize:r,hasError:a,isSatisfied:c,isVisible:null!=l}),children:l??""})}})(n,k),[n,k]),E=r.useMemo(()=>(e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"}))(i),[i]);return{boardProps:{isAnalysisMode:a,generating:c,dimensionsMismatch:t!==n.rows||o!==n.cols,rows:t,cols:o,state:n,size:l,analysisMoves:d,onAnalysisMove:f,onAnalysisCopy:p,onAnalysisClear:g,onAnalysisClose:h,onAnalysisApply:m,cellProps:j,overlayProps:N},controlsProps:{...w,onRefresh:u,disabled:c,onOpenInfo:A,hidden:a},layoutProps:{boardSx:S,contentSx:E,iconSizeRatio:ne},infoProps:{open:v,toggleOpen:A,handleOpenAnalysis:b,handleBoxClick:x},trophyProps:{show:!a&&n.solved,onReset:u,size:l,iconSizeRatio:ne}}}function sn(e,n,r,t,o,s){const l=e[r];if(!l)return!1;l[t]=o;const i=fe(r,o===ie?t+1:t,s),a=fe(r+1,o===ie?t:t+1,s);return!n.connected(i,a)&&(n.union(i,a),!0)}function ln(e,n,r){const t=Array.from({length:n},()=>new Array(r).fill(0)),o=new de((n+1)*(r+1)),s=function(e,n,r,t,o){let s=!0;for(;s;){s=!1;for(let l=0;l<=r;l++)for(let i=0;i<=t;i++){const a=n[l]?.[i];if(null==a)continue;const c=[{gr:l-1,gc:i-1,pt:ae},{gr:l-1,gc:i,pt:ie},{gr:l,gc:i-1,pt:ie},{gr:l,gc:i,pt:ae}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let u=0;const d=[];for(const n of c){const r=e[n.gr]?.[n.gc];0===r?d.push(n):r===n.pt&&u++}if(u>a)return"contradiction";if(u+d.length<a)return"contradiction";if(u===a&&d.length>0){for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!sn(e,o,n,r,l===ie?ae:ie,t))return"contradiction";s=!0}}else if(u+d.length===a&&d.length>0)for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!sn(e,o,n,r,l,t))return"contradiction";s=!0}}if(!s){for(let n=0;n<r;n++)for(let r=0;r<t;r++){const l=e[n];if(0!==l?.[r])continue;const i=fe(n,r+1,t),a=fe(n+1,r,t),c=o.connected(i,a),u=fe(n,r,t),d=fe(n+1,r+1,t),f=o.connected(u,d);if(c&&f)return"contradiction";c?(l[r]=ae,s=!0,o.union(u,d)):f&&(l[r]=ie,s=!0,o.union(i,a))}if(!s)for(let l=0;l<r;l++)for(let i=0;i<t;i++){const a=e[l];if(0!==a?.[i])continue;let c=!1,u=!1;const d=[{nr:l,nc:i,touchedBy:ae},{nr:l,nc:i+1,touchedBy:ie},{nr:l+1,nc:i,touchedBy:ie},{nr:l+1,nc:i+1,touchedBy:ae}];for(const{nr:o,nc:s,touchedBy:l}of d){const i=n[o]?.[s];if(null==i)continue;const a=[{gr:o-1,gc:s-1,pt:ae},{gr:o-1,gc:s,pt:ie},{gr:o,gc:s-1,pt:ie},{gr:o,gc:s,pt:ae}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let d=0,f=0;for(const n of a){const r=e[n.gr]?.[n.gc];0===r?f++:r===n.pt&&d++}l===ie?(d+1>i&&(c=!0),d+(f-1)<i&&(u=!0)):(d+1>i&&(u=!0),d+(f-1)<i&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!sn(e,o,l,i,ae,t))return"contradiction";s=!0}else if(u){if(!sn(e,o,l,i,ie,t))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(t,e,n,r,o);return"contradiction"!==s&&("solved"===s&&function(e,n,r,t){const o=ze(e,r,t);for(let s=0;s<=r;s++)for(let e=0;e<=t;e++){const r=n[s]?.[e];if(null!=r&&o[s]?.[e]!==r)return!1}return!0}(t,e,n,r))}function an(e,n){let r=[],t=!1;for(let s=0;s<50&&!t;s++){r=Array.from({length:e},()=>new Array(n).fill(0));const o=new de((e+1)*(n+1)),s=[];for(let r=0;r<e;r++)for(let e=0;e<n;e++)s.push({r:r,c:e});for(let e=s.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1)),r=s[e],t=s[n];r&&t&&(s[e]=t,s[n]=r)}let l=!1;for(const{r:e,c:t}of s){const s=fe(e,t+1,n),i=fe(e+1,t,n),a=o.connected(s,i),c=fe(e,t,n),u=fe(e+1,t+1,n),d=o.connected(c,u);if(a&&d){l=!0;break}const f=r[e];f&&(a?(f[t]=ae,o.union(c,u)):d||Math.random()<.5?(f[t]=ie,o.union(s,i)):(f[t]=ae,o.union(c,u)))}l||(t=!0)}t||(r=Array.from({length:e},(e,r)=>new Array(n).fill(r%2==0?ie:ae)));const o=function(e,n,r,t){const o=e.map(e=>[...e]),s=[];for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)s.push({r:a,c:e});for(let a=s.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1)),n=s[a],r=s[e];n&&r&&(s[a]=r,s[e]=n)}const l=Math.floor((n+1)*(r+1)*t);let i=0;for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)null!==o[a]?.[e]&&i++;for(const{r:a,c:c}of s){if(i<=l)break;const e=o[a];if(!e)continue;const t=e[c];null!=t&&(e[c]=null,ln(o,n,r)?i--:e[c]=t)}return o}(ze(r,e,n).map(e=>e.map(e=>e)),e,n,te);return{numbers:o,solution:r}}const cn=m({getInitialState:dn,customHandler:(e,n)=>{if("reset"===n.type)return{...e,grid:Array.from({length:e.rows},()=>new Array(e.cols).fill(0)),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set};if("applyAnalysis"===n.type){if(!n.moves)return e;const r=Array.from({length:e.rows},()=>new Array(e.cols).fill(0));return n.moves.forEach((e,n)=>{const[t,o]=n.split(",").map(Number);if(void 0!==t&&void 0!==o){const n=r[t];void 0!==n&&(n[o]=e)}}),{...e,...un(r,e.numbers,e.rows,e.cols),grid:r}}if("toggle"!==n.type)return null;if(e.solved)return e;const{row:r,col:t}=n;if(void 0===r||void 0===t)return e;const o=e.grid.map(e=>[...e]),s=o[r];if(!s)return e;const l=s[t];return void 0===l?e:(n.reverse?s[t]=0===l?ie:l===ie?ae:0:s[t]=0===l?ae:l===ae?ie:0,{...e,...un(o,e.numbers,e.rows,e.cols),grid:o})}});function un(e,n,r,t){let o=!1;if(e.every(e=>e.every(e=>0!==e))){const s=ze(e,r,t);n.every((e,n)=>e.every((e,r)=>null==e||e===s[n]?.[r]))&&!function(e,n,r){const t=new de((n+1)*(r+1));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const s=n[e];if(void 0===s||0===s)continue;const l=fe(o,s===ie?e+1:e,r),i=fe(o+1,s===ie?e:e+1,r);if(!t.union(l,i))return!0}}return!1}(e,r,t)&&(o=!0)}const l=function(e,n,r,t){const o=new Set,l=ze(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;const u=l[i]?.[a]??0;u>c?o.add(s(i,a)):u+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:n,gc:o})=>n>=0&&n<r&&o>=0&&o<t&&0===e[n]?.[o]).length<c&&o.add(s(i,a))}return o}(e,n,r,t);return{solved:o,errorNodes:l,cycleCells:pe(e,r,t),satisfiedNodes:De(e,n,r,t)}}function dn(e,n){const{numbers:r,solution:t}=an(e,n);return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:x(e),cols:x(n),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function fn(){const e=K("sm"),[t,o]=n.useState(!1),{isOpen:c,toggle:u}=b(),d=r.useRef(null),f=r.useRef({rows:0,cols:0}),p=r.useCallback((e,n,r)=>{t||function(e,n,r){const t=Ue(n,r);try{localStorage.setItem(t,JSON.stringify(Ke(e)))}catch{}}(e,n,r)},[t]),{generating:g,requestGeneration:y,handleNextAsync:m,prefetch:x,cancelGeneration:A}=Je({getInitialState:dn,dispatchRef:d,dimsRef:f,onStaleResult:p}),{rows:w,cols:C,state:I,dispatch:k,size:j,controlsProps:N}=S({...Ye(e),logic:{reducer:cn,getInitialState:(e,n)=>dn(e,n),onNext:m,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!t,serialize:Ke,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const n=e;return Array.isArray(n.grid)&&Array.isArray(n.numbers)&&Array.isArray(n.solution)&&"number"==typeof n.rows&&"number"==typeof n.cols&&"boolean"==typeof n.solved&&Array.isArray(n.errorNodes)&&Array.isArray(n.cycleCells)&&Array.isArray(n.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});d.current=k,f.current={rows:w,cols:C};const{analysisMoves:E,boardSx:M,handleAnalysisMove:O,handleAnalysisCopy:T,handleAnalysisClear:R,handleAnalysisClose:P,handleAnalysisApply:z,handleBoxClick:D,handleOpenAnalysis:L}=function({isAnalysisMode:e,setIsAnalysisMode:n,state:t,rows:o,cols:l,storageKey:i,toggleInfo:a,dispatch:c}){const[u,d]=r.useState(new Map);h({storageKey:i,rows:o,cols:l,state:u,onRestore:e=>{d(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const f=r.useRef("");r.useEffect(()=>{const e=JSON.stringify(t.numbers);f.current&&f.current!==e&&d(new Map),f.current=e},[t.numbers,t.rows,t.cols]);const p=r.useCallback((e,n)=>{d(r=>{const t=new Map(r);return void 0===n?t.delete(e):t.set(e,n),t})},[]),g=r.useCallback(()=>{const e=new Map;t.grid.forEach((n,r)=>{n.forEach((n,t)=>{0!==n&&e.set(s(r,t),n)})}),d(e)},[t.grid]),y=r.useCallback(()=>{d(new Map)},[]),m=r.useCallback(()=>{n(!1)},[n]),x=r.useCallback(e=>{c({type:"applyAnalysis",moves:e??u}),m()},[c,u,m]),b=r.useCallback(e=>{e.stopPropagation()},[]),S=r.useMemo(()=>e?{padding:{xs:0,sm:0},border:"none"}:void 0,[e]),v=r.useCallback(()=>{a(),n(!0)},[a,n]);return{analysisMoves:u,boardSx:S,handleAnalysisMove:p,handleAnalysisCopy:g,handleAnalysisClear:y,handleAnalysisClose:m,handleAnalysisApply:x,handleBoxClick:b,handleOpenAnalysis:v}}({isAnalysisMode:t,setIsAnalysisMode:o,state:I,rows:w,cols:C,storageKey:re.ANALYSIS_MOVES,toggleInfo:u,dispatch:k});Ve({rows:w,cols:C,isAnalysisMode:t,requestGeneration:y,cancelGeneration:A}),r.useEffect(()=>{I.solved&&!t&&x(w,C)},[I.solved,t,w,C,x]);const{handleKeyDown:$}=a({rows:w,cols:C}),{getDragProps:B}=l({onToggle:(e,n,r)=>{k({type:"toggle",row:v(e),col:v(n),reverse:r})},checkEnabled:()=>!I.solved,touchTimeout:i.timing.touchHoldDelay}),H=r.useCallback(e=>{const n=B(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),$(e)}}},[B,$]);return on({game:{state:I,rows:w,cols:C,size:j,mobile:e,isAnalysisMode:t,generating:g,handleNextAsync:m},analysis:{analysisMoves:E,handleAnalysisMove:O,handleAnalysisCopy:T,handleAnalysisClear:R,handleAnalysisClose:P,handleAnalysisApply:z,handleBoxClick:D,handleOpenAnalysis:L,boardSx:M},info:{infoOpen:c,toggleInfo:u},controls:N,getDragProps:H})}function pn(){const{boardProps:n,controlsProps:r,layoutProps:t,infoProps:o,trophyProps:s}=fn();return e.jsxs(A,{title:U.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",controls:e.jsx(w,{...r}),trophyProps:s,layout:{paddingBottom:{xs:"120px",md:"150px"},contentSx:t.contentSx,boardSx:t.boardSx},onClick:n.isAnalysisMode?n.onAnalysisClose:void 0,children:[e.jsx(I,{onClick:o.handleBoxClick,children:e.jsx(me,{...n})}),e.jsx(qe,{...o})]})}export{pn as Slant};
