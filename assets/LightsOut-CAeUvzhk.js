import{r as e,j as t,a as n}from"./vendor_react-WaSaIrII.js";import{a as o,T as r,R as s,d as i,e as a,g as c,L as l}from"./index-CJNoln05.js";import{C as d,u,c as f}from"./CustomGrid-Dh9zMd4h.js";import{B as p,G as m,d as x,M as h,h as g,I as y,e as j}from"./vendor_mui_core-DywNDz3b.js";import{u as b,G as w}from"./gameConfig-B431Wh6b.js";import{g as v}from"./matrices-Dq-TTQb4.js";import{G as S}from"./GlassCard-wfXsehA3.js";import{k,l as C,C as z,K as $,m as I,n as E,R as P,o as M,p as L,M as A,q as D,r as R}from"./vendor_mui_icons-Chfod4Q9.js";import{G as B}from"./GlobalHeader-DSL1wzOx.js";function T(e){const{frontProps:n,backProps:o,size:r,rows:s,cols:i}=e;return t.jsxs(p,{sx:{display:"grid",placeItems:"center"},children:[t.jsx(p,{sx:{gridArea:"1/1"},children:t.jsx(d,{space:0,size:r,rows:s-1,cols:i-1,cellProps:o})}),t.jsx(p,{sx:{gridArea:"1/1",zIndex:1},children:t.jsx(d,{space:0,size:r,rows:s,cols:i,cellProps:n})})]})}function F(t,n){const o=e.useCallback((e,o)=>{const r=t(e,o);return{front:r?n.primary:n.secondary,back:r?n.secondary:n.primary}},[t,n]),r=e.useCallback((e,n)=>function(e,t,n){const o=n(e,t),r={},s=o===n(e-1,t),i=o===n(e+1,t),a=o===n(e,t-1),c=o===n(e,t+1);return(s||a)&&(r.borderTopLeftRadius=0),(s||c)&&(r.borderTopRightRadius=0),(i||a)&&(r.borderBottomLeftRadius=0),(i||c)&&(r.borderBottomRightRadius=0),r}(e,n,t),[t]),s=e.useCallback((e,o)=>{const r=function(e,t,n){const o=n(e,t),r=n(e,t+1),s=n(e+1,t),i=n(e+1,t+1);let a=!0;const c=Number(o)+Number(r)+Number(s)+Number(i);return o&&i||!(c<3)||(a=!1),a}(e,o,t);return r?n.primary:n.secondary},[t,n]);return{getColor:o,getBorder:r,getFiller:s}}function W(t,n){const{grid:o,rows:r,cols:s}=t;return F(e.useCallback((e,t)=>e<0||t<0||e>=r||t>=s?-1:o[e]?.[t]??-1,[o,r,s]),n)}function H(e,t){return Array.from({length:e},()=>Array(t).fill(0))}function N(e,t,n){const o=n.length,r=n.map(e=>[...e]),s=r[e];if(s&&t>=0&&t<s.length){const e=s[t];void 0!==e&&(s[t]=1^e)}if(e>0){const n=r[e-1];if(n&&t>=0&&t<n.length){const e=n[t];void 0!==e&&(n[t]=1^e)}}if(e<o-1){const n=r[e+1];if(n&&t>=0&&t<n.length){const e=n[t];void 0!==e&&(n[t]=1^e)}}if(s){if(t>0){const e=s[t-1];void 0!==e&&(s[t-1]=1^e)}if(t<s.length-1){const e=s[t+1];void 0!==e&&(s[t+1]=1^e)}}return r}function _(e,t){const n=H(e,t);for(let o=0;o<e;o++)for(let r=0;r<t;r++)if(Math.random()>.5){const s=[[o,r],[o-1,r],[o+1,r],[o,r-1],[o,r+1]];for(const o of s){const r=o[0],s=o[1];if(void 0!==r&&void 0!==s&&r>=0&&r<e&&s>=0&&s<t){const e=n[r];if(e&&s>=0&&s<e.length){const t=e[s];void 0!==t&&(e[s]=1^t)}}}}return n}function G(e){const t=e.length,n=e[0],o=n?n.length:0;for(let s=0;s<t-1;s++){const t=e[s];if(t)for(let e=0;e<o;e++)if(1===t[e])return[{row:s+1,col:e}]}const r=e[t-1];if(r?.some(e=>1===e)){const e=function(e,t,n){const o=v(n,e,t),r=[];return o.forEach((e,t)=>{1===e&&r.push(t)}),r.length>0?r:null}(t,o,r);if(e&&e.length>0)return e.map(e=>({row:0,col:e}))}return null}function O(e,t){const{type:n,row:o,col:r,moves:s}=t;let{grid:i,score:a,rows:c,cols:l,auto:d,initialized:u}=e;switch(n){case"auto":d=!d;break;case"adjacent":void 0!==o&&void 0!==r&&(i=N(o,r,i));break;case"multi_adjacent":s&&s.forEach(e=>{i=N(e.row,e.col,i)});break;case"random":case"randomize":i=_(c,l),d=!1;break;case"resize":{const{newRows:e,newCols:n}=t;void 0!==e&&void 0!==n&&(c=e,l=n,i=_(c,l),d=!1,u=!0);break}case"reset":i=H(c,l),a=0,d=!1;break;case"next":i=_(c,l),a+=1}return{grid:i,score:a,rows:c,cols:l,auto:d,initialized:u||!1}}function Y(e,t){const n=[...e];let o=e.at(-1);if(!o)return n;for(let r=1;r<t;r++)for(let e=0;e<t;e++){if(!o[r-1]?.[e])continue;const t=N(r,e,o);n.push(t),o=t}return n}function U(e,t){const n=e.at(-1);if(!n)return e;const o=[...e];for(;o.length<t;)o.push([...n]);return o}function X(e,t){let n=H(t,t);for(const x of e){n=N(Math.floor(x/t),x%t,n)}const o=Y([n],t),r=o.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const s=r.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:a}=function(e,t){const n=Array(t).fill(0),o=[n],r=[n],s=[...n];for(let i=0;i<t;i++){if(!e[i])continue;s[i]=1;const n=[...s],a=v(n,t,t);o.push(n),r.push(a)}return{input:o,output:r}}(s,t),c=o.length+i.length+1,l=a.at(-1);if(!l)return{boardStates:[],inputStates:[],outputStates:[]};let d=[...r];for(let x=0;x<c-o.length;x++)o.push([...r]);const u=i[0];for(let x=0;x<c-i.length;x++)u&&i.unshift([...u]);const f=a[0];for(let x=0;x<c-a.length;x++)f&&a.unshift([...f]);for(let x=0;x<t;x++)l[x]&&(d=N(0,x,d),o.push([...d]));const p=Y(o,t),m=p.length;return{boardStates:p,inputStates:U(i,m),outputStates:U(a,m)}}function q({getColor:e,getBorder:n}){return(o,r)=>{const{front:s}=e(o,r);return{backgroundColor:s,color:s,children:t.jsx(k,{}),style:n(o,r),sx:{transition:"all 200ms ease"}}}}function K(t,n,o){return F(e.useCallback((e,o)=>0!==e||o<0||o>=n?-1:t[o],[t,n]),o)}function Z(e,t,n,o,r,s=1){const i=e.length,a={},c=100/i;for(let l=0;l<i;l++){const d=l*c,u=(l+1)*c;let f=r.secondary,p=!1,m="";const x=e[l],h=l+1<i?e[l+1]:null;if(x&&h){const e=N(t,n,x);p=!0;for(let t=0;t<o;t++){const n=e[t],r=h[t];if(!n||!r){p=!1;break}for(let e=0;e<o;e++)if(n[e]!==r[e]){p=!1;break}if(!p)break}if(p){f=1===x[t]?.[n]?r.secondary:r.primary,m=`"${String(l+1)}"`}}p?(a[`${String(d)}%`]={opacity:0,content:m,color:f,transform:"scale(0.5)"},a[`${String(d+c*(.1/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1.2)"},a[`${String(d+c*(.2/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1)"},a[`${String(u-c*(.1/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1)"},a[`${String(u)}%`]={opacity:0,content:m,color:f,transform:"scale(0.5)"}):(a[`${String(d)}%`]={opacity:0,content:'""',color:f,transform:"scale(0.5)"},a[`${String(u)}%`]={opacity:0,content:'""',color:f,transform:"scale(0.5)"})}return a}function J({start:n=[],dims:r=3,size:s,palette:i,getFrontProps:a,getBackProps:c}){const[l,u]=e.useState(0);e.useEffect(()=>{const e=setInterval(()=>{u(e=>e+1)},2e3);return()=>{clearInterval(e)}},[]);const f=X(n,r),h=s,{boardStates:g,inputStates:y,outputStates:j}=f,b=l%y.length,w=b===y.length-1,v=W({grid:g[b]??g[0]??[],rows:r,cols:r},i),S=a(v),k=c(v),z=function(e,n,o,r){return(s,i)=>{const a=Z(e,s,i,n,r),c=e.length,l=`${o}-board-icon-${String(s)}-${String(i)}`;return{icon:t.jsx(p,{sx:{width:"100%",height:"100%",position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2,"&::after":{content:'""',fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",paddingTop:{xs:"0.08rem",sm:"0.15rem"},animation:`${l} ${String(2*c)}s linear infinite`}}}),keyframes:a,keyframeName:l}}}(g,r,"example",i),$=K(y[b]??[],r,i),I=K(j[b]??[],r,i),E=q($),P=q(I),M=function(e,n,o,r){return(n,s)=>{const i=e.length,a={},c=100/i;for(let t=0;t<i;t++){const n=t*c,o=(t+1)*c;let l=r.secondary,d=!1,u="";const f=e[t],p=t+1<i?e[t+1]:null;f&&p&&f[s]!==p[s]&&(d=!0,l=1===f[s]?r.secondary:r.primary,u=`"${String(t+1)}"`),d?(a[`${String(n)}%`]={opacity:0,content:u,color:l,transform:"scale(0.5)"},a[`${String(n+.05*c)}%`]={opacity:1,content:u,color:l,transform:"scale(1.2)"},a[`${String(n+.1*c)}%`]={opacity:1,content:u,color:l,transform:"scale(1)"},a[`${String(o-.05*c)}%`]={opacity:1,content:u,color:l,transform:"scale(1)"},a[`${String(o)}%`]={opacity:0,content:u,color:l,transform:"scale(0.5)"}):(a[`${String(n)}%`]={opacity:0,content:'""',color:l,transform:"scale(0.5)"},a[`${String(o)}%`]={opacity:0,content:'""',color:l,transform:"scale(0.5)"})}const l=`${o}-input-icon-${String(n)}-${String(s)}`;return{icon:t.jsx(p,{sx:{width:"100%",height:"100%",position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2,"&::after":{content:'""',fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",paddingTop:{xs:"0.08rem",sm:"0.15rem"},animation:`${l} ${String(2*i)}s linear infinite`}}}),keyframes:a,keyframeName:l}}}(y,0,"example",i);return t.jsx(Q,{boardStates:g,inputStates:y,dims:r,id:"example",palette:i,children:t.jsx(m,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:t.jsxs(m,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%",overflow:"hidden"},children:[t.jsx(m,{size:6,sx:{display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:t.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[t.jsx(T,{size:h,rows:r,cols:r,frontProps:(e,n)=>{const o=S(e,n),r=z(e,n);return{...o,children:t.jsxs(t.Fragment,{children:[o.children,r.icon]}),sx:{...o.sx,position:"relative"}}},backProps:k}),t.jsx(p,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:w?1:0,transform:w?"scale(1)":"scale(0.5)",visibility:w?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",pointerEvents:"none",zIndex:10},children:(()=>{const e=g[y.length-1],n=e?.flat().every(e=>1===e);return t.jsx(C,{sx:{fontSize:{xs:"2.5rem",sm:"4rem"},color:n?i.secondary:i.primary}})})()})]})}),t.jsxs(m,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs(p,{sx:{mb:2,textAlign:"center"},children:[t.jsx(x,{variant:"subtitle2",sx:{mb:1,color:o.text.secondary},children:"Input"}),t.jsx(d,{rows:1,cols:r,size:h,cellProps:(e,n)=>{const o=E(e,n),r=M(e,n);return{...o,children:t.jsxs(t.Fragment,{children:[o.children,r.icon]}),sx:{...o.sx,position:"relative"}}},space:0})]}),t.jsxs(p,{sx:{textAlign:"center"},children:[t.jsx(d,{rows:1,cols:r,size:h,cellProps:P,space:0}),t.jsx(x,{variant:"subtitle2",sx:{mt:1,color:o.text.secondary},children:"Result"})]})]})]})})})}function Q({boardStates:n,inputStates:o,dims:r,id:s,palette:i,children:a}){const c=e.useMemo(()=>[...n.flatMap((e,t)=>Array.from({length:r},(e,o)=>({name:`${s}-board-icon-${String(t)}-${String(o)}`,frames:Z(n,t,o,r,i)}))),...o.flatMap((e,t)=>{const n=`${s}-input-icon-0-${String(t)}`,r={},a=o.length,c=100/a;for(let s=0;s<a;s++){const e=s*c,n=(s+1)*c;let l=!1,d=i.secondary,u="";const f=o[s],p=s+1<a?o[s+1]:null;f&&p&&f[t]!==p[t]&&(l=!0,u=`"${String(s+1)}"`,d=1===f[t]?i.secondary:i.primary),l?(r[`${String(e)}%`]={opacity:0,content:u,color:d,transform:"scale(0.5)"},r[`${String(e+.05*c)}%`]={opacity:1,content:u,color:d,transform:"scale(1.2)"},r[`${String(e+.1*c)}%`]={opacity:1,content:u,color:d,transform:"scale(1)"},r[`${String(n-.05*c)}%`]={opacity:1,content:u,color:d,transform:"scale(1)"},r[`${String(n)}%`]={opacity:0,content:u,color:d,transform:"scale(0.5)"}):(r[`${String(e)}%`]={opacity:0,content:'""',color:d},r[`${String(n)}%`]={opacity:0,content:'""',color:d})}return{name:n,frames:r}})],[n,o,r,s,i]);return t.jsxs(t.Fragment,{children:[t.jsx("style",{children:c.map(e=>`\n                @keyframes ${e.name} {\n                    ${Object.entries(e.frames).map(([e,t])=>`\n                        ${e} {\n                            ${Object.entries(t).map(([e,t])=>`${e.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}: ${t};`).join(" ")}\n                        }\n                    `).join("")}\n                }\n            `).join("")}),a]})}const V=({children:e})=>t.jsx(x,{variant:"h5",sx:{color:o.text.primary,fontWeight:r.fontWeight.bold,textAlign:"left",fontSize:r.fontSize.h2},children:e}),ee=({Icon:e,title:n,text:s})=>t.jsxs(p,{sx:{px:2},children:[t.jsxs(x,{variant:"h6",sx:{color:o.text.primary,fontWeight:r.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:r.fontSize.subheading},children:[t.jsx(e,{sx:{mr:2,color:o.primary.main,fontSize:"1.75rem"}}),n]}),t.jsx(x,{variant:"body1",sx:{color:o.text.secondary,lineHeight:1.6,fontSize:r.fontSize.body,ml:6},children:s})]}),te=["Chasing Lights","How It Works","Calculator"],ne=S;function oe(n){const{rows:r,cols:i,size:a,open:c,palette:l,toggleOpen:f,getFrontProps:m,getBackProps:b}=n,w=u("md"),[S,C]=e.useState(0),[D,R]=e.useState(Array(i).fill(0)),[B,T]=e.useState(!1),F=e.useRef(new Set),W=e.useRef(0);e.useEffect(()=>{R(Array(i).fill(0))},[i,l]);const H=e.useCallback(e=>{const t=[...D];void 0!==t[e]&&(t[e]^=1),R(t)},[D]),N=v(D,r,i);e.useEffect(()=>{const e=()=>{T(!1),F.current.clear()},t=e=>{if(!B||2!==S)return;const t=e.touches[0];if(!t)return;const n=document.elementFromPoint(t.clientX,t.clientY);if(!n)return;const o=n.closest("[data-col]");if(o){const e=o.getAttribute("data-col");if(null!==e){const t=parseInt(e,10);F.current.has(t)||(H(t),F.current.add(t))}}};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),window.removeEventListener("touchmove",t)}},[B,S,H]);const _=e.useCallback(e=>{F.current.add(e)},[]),G=K(D,i,l),O=K(N,i,l),Y=function(e,n,o=!1,r=()=>{},s,i=()=>{},a){const{getColor:c,getBorder:l}=e;return(e,d)=>{const{front:u,back:f}=c(e,d);return{backgroundColor:u,style:l(e,d),onMouseDown:e=>{0===e.button&&(Date.now()-a.current<500||(r(!0),n(d),i(d)))},onMouseEnter:()=>{o&&!s.current.has(d)&&(n(d),i(d))},onTouchStart:e=>{e.cancelable&&e.preventDefault(),a.current=Date.now(),r(!0),n(d),i(d)},"data-col":d.toString(),sx:{"&:hover":{cursor:"pointer",color:f},touchAction:"none",transition:"all 200ms ease"},color:u,children:t.jsx(k,{})}}}(G,H,B,T,F,_,W),U=q(O),X=()=>{f()},Z=`#${s.pages.LightsOutResearch}`;let Q;return Q=w?t.jsx(y,{component:"a",href:Z,size:"small",sx:{color:o.text.secondary},children:t.jsx(A,{})}):t.jsx(j,{component:"a",href:Z,variant:"outlined",size:"small",startIcon:t.jsx(A,{}),sx:{borderColor:o.border.subtle,color:o.text.secondary,fontSize:"0.75rem",py:.75,px:1.5,"&:hover":{borderColor:o.primary.main,color:o.primary.main,backgroundColor:o.interactive.hover}},children:"Analysis"}),t.jsx(h,{open:c,onClose:X,slots:{backdrop:g},slotProps:{backdrop:{sx:{backgroundColor:e=>"dark"===e.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)",transition:"all 0.3s ease-in-out !important"}}},sx:{zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsxs(p,{sx:{outline:"none",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:[t.jsxs(ne,{onClick:e=>{e.stopPropagation()},sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[t.jsxs(p,{sx:{flex:1,overflowY:1===S?"hidden":"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[t.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[t.jsx(V,{children:te[S]}),t.jsxs(p,{sx:{display:"flex",gap:2,alignItems:"center"},children:[Q,t.jsx(y,{onClick:X,size:"small",sx:{color:o.text.secondary},children:t.jsx(z,{})})]})]}),0===S&&t.jsx(p,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:t.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[t.jsx(ee,{Icon:$,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),t.jsx(ee,{Icon:I,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),t.jsx(ee,{Icon:E,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===S&&t.jsx(p,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:t.jsx(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:t.jsx(J,{dims:3,size:.7*a,start:[1,3,8],palette:l,getFrontProps:m,getBackProps:b})})}),2===S&&t.jsx(p,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:t.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[t.jsxs(p,{children:[t.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Input"," ",t.jsx(p,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),t.jsx(d,{space:0,rows:1,cols:i,size:a*(w?.9:.8),cellProps:Y})]}),t.jsxs(p,{children:[t.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Solution"," ",t.jsx(p,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),t.jsx(d,{space:0,rows:1,cols:i,size:a*(w?.9:.8),cellProps:U})]}),t.jsx(p,{sx:{display:"flex",justifyContent:"center"},children:t.jsx(j,{variant:"outlined",size:"small",startIcon:t.jsx(P,{}),onClick:()=>{R(Array(i).fill(0))},sx:{borderColor:o.border.subtle,color:o.text.secondary},children:"Clear Pattern"})})]})})]}),t.jsxs(p,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(j,{onClick:()=>{S>0&&C(S-1)},disabled:0===S,startIcon:t.jsx(M,{}),sx:{visibility:0===S?"hidden":"visible",color:o.text.primary},children:"Back"}),t.jsx(p,{sx:{display:"flex",gap:1},children:[0,1,2].map(e=>t.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:S===e?o.primary.main:o.interactive.disabled,transition:"background-color 0.3s"}},e))}),t.jsx(j,{onClick:()=>{S<2?C(S+1):f()},disabled:2===S,endIcon:t.jsx(L,{}),sx:{visibility:2===S?"hidden":"visible",color:o.text.primary},children:"Next"})]})]}),t.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})})}function re(e,n,o=!1,r=()=>{},s,i=()=>{},a){const{getColor:c,getBorder:l}=e,d=(e,t)=>{n({type:"adjacent",row:e,col:t})};return(e,n)=>{const u=l(e,n),{front:f,back:p}=c(e,n),m=`${e.toString()},${n.toString()}`;return{onMouseDown:t=>{0===t.button&&(Date.now()-a.current<500||(r(!0),d(e,n),i(m)))},onMouseEnter:()=>{o&&!s.current.has(m)&&(d(e,n),i(m))},onTouchStart:t=>{t.cancelable&&t.preventDefault(),a.current=Date.now(),r(!0),d(e,n),i(m)},"data-pos":m,children:t.jsx(k,{}),backgroundColor:f,color:f,style:u,sx:{"&:hover":{cursor:"pointer",color:p},touchAction:"none",transition:"all 100ms ease-in-out"}}}}function se(e){return(t,n)=>({backgroundColor:e.getFiller(t,n)})}function ie(e){const t=re(e,()=>{},!1,()=>{},{current:new Set},()=>{},{current:0});return(e,n)=>({...t(e,n),onMouseDown:void 0,onMouseEnter:void 0,sx:void 0})}function ae(){const{height:r,width:s}=b(),d=u("sm"),x=d?w.gridSizes.mobile:w.gridSizes.desktop,[h,g]=e.useState(()=>{const e=localStorage.getItem("lights-out-size");return e&&"null"!==e?parseInt(e,10):null}),y=e.useMemo(()=>{const e=d?l.headerHeight.xs:l.headerHeight.md,t=f(x,r-e,Math.min(s,1300));let n=t.rows-1;const o=t.cols-1;return d&&(n-=2),{rows:Math.max(2,n),cols:Math.max(2,o)}},[x,r,s,d]),{rows:j,cols:v}=e.useMemo(()=>null===h?y:{rows:Math.min(h,y.rows),cols:Math.min(h,y.cols)},[h,y]);e.useEffect(()=>{localStorage.setItem("lights-out-size",String(h))},[h]);const S=e.useMemo(()=>({grid:H(j,v),score:0,rows:j,cols:v,auto:!1,initialized:!1}),[j,v]),[k,z]=e.useReducer(O,S),[$,I]=e.useReducer(e=>!e,!1),[E,P]=e.useState(!1),M=e.useRef(new Set),L=e.useRef(0),F=e.useCallback(e=>{M.current.add(e)},[]);e.useEffect(()=>{const e=()=>{P(!1),M.current.clear()},t=e=>{if(!E)return;const t=e.touches[0];if(!t)return;const n=document.elementFromPoint(t.clientX,t.clientY);if(!n)return;const o=n.closest("[data-pos]");if(o){const e=o.getAttribute("data-pos");if(e&&!M.current.has(e)){const[t,n]=e.split(",").map(Number);void 0!==t&&void 0!==n&&(z({type:"adjacent",row:t,col:n}),F(e))}}};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),window.removeEventListener("touchmove",t)}},[E,M,F,z]);const N=e.useMemo(()=>({primary:o.primary.main,secondary:o.primary.dark}),[]),_=e.useMemo(()=>k.initialized&&function(e){const t=e.flat();return!t.includes(1)||!t.includes(0)}(k.grid),[k.initialized,k.grid]),Y=e.useMemo(()=>k.initialized&&k.grid.flat().every(e=>1===e),[k.initialized,k.grid]),U=e.useCallback(()=>{z({type:"next"})},[]);e.useEffect(()=>{if(_){const e=setTimeout(()=>{U()},2e3);return()=>{clearTimeout(e)}}},[_,U]),e.useEffect(()=>{document.title=i.lightsOut},[]),e.useEffect(()=>{z({type:"resize",newRows:j,newCols:v})},[j,v]);const[X,q]=n.useState([]);e.useEffect(()=>{if(!k.auto)return void(X.length>0&&q([]));const e=setTimeout(()=>{if(X.length>0){const e=X[0];e&&(z({type:"adjacent",row:e.row,col:e.col}),q(X.slice(1)))}else{const e=G(k.grid);if(e&&e.length>0){const t=e[0];1===e.length&&t?z({type:"adjacent",row:t.row,col:t.col}):q(e)}else z({type:"auto"})}},300);return()=>{clearTimeout(e)}},[k.auto,k.grid,X]);const K=W(k,N),Z=re(K,e=>{_||z(e)},E,P,M,F,L),J=se(K);return t.jsxs(m,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:o.surface.background,position:"relative",overflow:"hidden",height:"100vh"},children:[t.jsx(B,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),t.jsx(p,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:t.jsxs(p,{sx:{position:"relative",marginTop:d?"-28px":"-40px"},children:[t.jsx(T,{size:x,rows:j,cols:v,frontProps:Z,backProps:J}),t.jsx(p,{onClick:U,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:_?1:0,transform:_?"scale(1)":"scale(0.5)",visibility:_?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"pointer",zIndex:10,backgroundColor:"transparent"},children:t.jsx(C,{sx:{fontSize:`${(1.25*x).toString()}rem`,color:Y?N.secondary:N.primary}})})]})}),t.jsxs(a,{handler:()=>()=>{},onAutoPlay:()=>{z({type:"auto"})},autoPlayEnabled:k.auto,children:[t.jsx(c,{title:"Decrease Size",Icon:D,onClick:()=>{const e=Math.min(j,v);j!==v?g(e):e>2&&g(e-1)},disabled:j<=2&&v<=2}),t.jsx(c,{title:"Increase Size",Icon:R,onClick:()=>{const e=Math.min(y.rows,y.cols),t=Math.min(j,v);j===v&&g(t<e?t+1:null)},disabled:j===y.rows&&v===y.cols}),t.jsx(c,{title:"How to Play",Icon:A,onClick:I})]}),$&&t.jsx(oe,{rows:j,cols:v,size:x,open:$,palette:N,toggleOpen:I,getFrontProps:ie,getBackProps:se})]})}export{ae as default};
