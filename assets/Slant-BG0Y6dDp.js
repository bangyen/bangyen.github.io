import{r as e,j as t}from"./vendor_react-WaSaIrII.js";import{d as o,a as r,e as n,g as s}from"./index-CfjlFqDF.js";import{u as i,C as c,c as l}from"./CustomGrid-C2D3ZduD.js";import{G as a}from"./GlobalHeader-xtp9ILbm.js";import{u}from"./useWindow-BCvkQ8_7.js";import{G as d,B as f}from"./vendor_mui_core-D4-4kcvK.js";import{l as m,J as p,q as h,r as x}from"./vendor_mui_icons-D2mx3Sr-.js";class w{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error("Index out of bounds");t!==e&&(this.parent[e]=this.find(t));const o=this.parent[e];if(void 0===o)throw new Error("Root not found");return o}union(e,t){const o=this.find(e),r=this.find(t);return o!==r&&(this.parent[o]=r,!0)}}function v(e,t,o){return e*(o+1)+t}function g(e,t,o){const r=new w((t+1)*(o+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const s=t[e];if(void 0===s||0===s)continue;const i=v(n,1===s?e+1:e,o),c=v(n+1,1===s?e:e+1,o);if(!r.union(i,c))return!0}}return!1}function b(e,t,o){const r=Array.from({length:t+1},()=>Array(o+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const o=t[e];if(1===o){const t=r[n];if(t){const o=t[e+1];void 0!==o&&(t[e+1]=o+1)}const o=r[n+1];if(o){const t=o[e];void 0!==t&&(o[e]=t+1)}}else if(2===o){const t=r[n];if(t){const o=t[e];void 0!==o&&(t[e]=o+1)}const o=r[n+1];if(o){const t=o[e+1];void 0!==t&&(o[e+1]=t+1)}}}}return r}function y(e,t,o,r=2){let n=0;const s=(i,c)=>{if(n>=r)return;if(i===t*o)return void n++;const l=Math.floor(i/o),a=i%o,u=r=>{const n=c[l];if(!n)return!1;n[a]=r;const s=[{nr:l,nc:a},{nr:l,nc:a+1},{nr:l+1,nc:a},{nr:l+1,nc:a+1}];for(const{nr:i,nc:l}of s){const r=e[i]?.[l];if(null==r)continue;let n=0,s=0;const a=[{cr:i-1,cc:l-1,type:2},{cr:i-1,cc:l,type:1},{cr:i,cc:l-1,type:1},{cr:i,cc:l,type:2}];for(const{cr:e,cc:i,type:l}of a){if(e<0||e>=t||i<0||i>=o)continue;const r=c[e];if(!r)continue;const a=r[i];0!==a&&(s++,a===l&&n++)}if(n>r)return!1;if(s===a.filter(({cr:e,cc:r})=>e>=0&&e<t&&r>=0&&r<o).length&&n!==r)return!1}return!g(c,t,o)},d=c[l];d&&(u(1)&&s(i+1,c),n>=r||(u(2)&&s(i+1,c),d[a]=0))},i=Array.from({length:t},()=>Array(o).fill(0));return s(0,i),n}function j(e,t){const o=Array.from({length:e},()=>Array(t).fill(1)),r=e*t*20;for(let u=0;u<r;u++){const r=Math.floor(Math.random()*e),n=Math.floor(Math.random()*t),s=o[r];if(!s)continue;const i=s[n];if(void 0===i)continue;const c=i;s[n]=1===c?2:1,g(o,e,t)&&(s[n]=c)}const n=b(o,e,t).map(e=>[...e]),s=[];for(let u=0;u<=e;u++)for(let e=0;e<=t;e++)s.push({r:u,c:e});for(let u=s.length-1;u>0;u--){const e=Math.floor(Math.random()*(u+1)),t=s[u],o=s[e];t&&o&&(s[u]=o,s[e]=t)}const i=e*t<=16,c=i?100:e*t*4;let l=0,a=0;for(const{r:u,c:d}of s){if(l>=c)break;const o=n[u];if(!o)continue;const r=o[d];if(null!=r){if(a>(e+1)*(t+1)*.6)break;o[d]=null,i?y(n,e,t,2)>1?o[d]=r:a++:Math.random()<.5?o[d]=r:a++,l++}}return{numbers:n,solution:o}}function S(e,t){switch(t.type){case"toggle":{if(e.solved)return e;const{row:o,col:r}=t,n=e.grid.map(e=>[...e]),s=n[o];if(!s)return e;const i=s[r];if(void 0===i)return e;t.reverse?s[r]=0===i?2:2===i?1:0:s[r]=0===i?1:1===i?2:0;let c=!1;if(n.every(e=>e.every(e=>0!==e))){const t=b(n,e.rows,e.cols);e.numbers.every((e,o)=>e.every((e,r)=>null===e||e===t[o]?.[r]))&&!g(n,e.rows,e.cols)&&(c=!0)}return{...e,grid:n,solved:c}}case"resize":{if(t.rows<2||t.cols<2)return e;const{numbers:o}=j(t.rows,t.cols);return{grid:Array.from({length:t.rows},()=>Array(t.cols).fill(0)),numbers:o,rows:t.rows,cols:t.cols,solved:!1}}case"new":{const{numbers:t}=j(e.rows,e.cols);return{...e,grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:t,solved:!1}}default:return e}}function M(){const{height:w,width:v}=u(),g=i("sm"),[b,y]=e.useState(()=>{const e=localStorage.getItem("slant-size");return e&&"null"!==e?parseInt(e,10):5}),M=e.useMemo(()=>{const e=l(4,w-(g?64:80)-100,Math.min(v,1e3));let t=e.rows-1;const o=e.cols-1;return g&&(t-=2),{rows:Math.max(3,t),cols:Math.max(3,o)}},[w,v,g]),{rows:k,cols:z}=e.useMemo(()=>{const e=b??5;return{rows:Math.min(e,M.rows),cols:Math.min(e,M.cols)}},[b,M]),E=e.useMemo(()=>{const e=.95*Math.min(v,1200)/(z+1),t=.95*(w-160)/(k+1);return Math.min(e,t,100)/16},[v,w,k,z]),[A,C]=e.useReducer(S,{rows:k,cols:z},e=>function(e,t){const{numbers:o}=j(e,t);return{grid:Array.from({length:e},()=>Array(t).fill(0)),numbers:o,rows:e,cols:t,solved:!1}}(e.rows,e.cols));e.useEffect(()=>{localStorage.setItem("slant-size",String(b))},[b]),e.useEffect(()=>{A.rows===k&&A.cols===z||C({type:"resize",rows:k,cols:z})},[k,z,A.rows,A.cols]),e.useEffect(()=>{document.title=o.slant},[]);const I=()=>{C({type:"new"})},[$,D]=e.useState(null),L=e.useRef(new Set),R=e.useRef(0),_=e.useCallback(e=>{L.current.add(e)},[]);e.useEffect(()=>{const e=()=>{D(null),L.current.clear()},t=e=>{if(null===$)return;const t=e.touches[0];if(!t)return;const o=document.elementFromPoint(t.clientX,t.clientY);if(!o)return;const r=o.closest("[data-pos]");if(r){const e=r.getAttribute("data-pos");if(e&&!L.current.has(e)){const[t,o]=e.split(",").map(Number);void 0!==t&&void 0!==o&&(C({type:"toggle",row:t,col:o,reverse:2===$}),_(e))}}};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),window.removeEventListener("touchmove",t)}},[$,_]);const G=.4*E,P=E-G;return t.jsxs(d,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:`radial-gradient(circle at 50% 50%, ${r.surface.elevated} 0%, ${r.surface.background} 100%)`,position:"relative",overflow:"hidden",height:"100vh"},children:[t.jsx(a,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname"}),t.jsx(f,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:`${String(E)}rem`},children:t.jsxs(f,{children:[t.jsxs(f,{sx:{position:"relative"},children:[t.jsx(f,{sx:{position:"relative",zIndex:1},children:t.jsx(c,{size:E,rows:k,cols:z,cellProps:(e,o)=>{const n=A.grid[e]?.[o],s=`${String(e)},${String(o)}`;return{onMouseDown:t=>{A.solved||0!==t.button&&2!==t.button||Date.now()-R.current<500||(D(t.button),C({type:"toggle",row:e,col:o,reverse:2===t.button}),_(s))},onMouseEnter:()=>{null===$||L.current.has(s)||A.solved||(C({type:"toggle",row:e,col:o,reverse:2===$}),_(s))},onContextMenu:e=>{e.preventDefault()},onTouchStart:t=>{A.solved||(t.cancelable&&t.preventDefault(),R.current=Date.now(),D(0),C({type:"toggle",row:e,col:o}),_(s))},"data-pos":s,sx:{cursor:"pointer",border:`1px solid ${r.border.subtle}`,position:"relative",transition:"all 0.2s",touchAction:"none","&:hover":{backgroundColor:r.interactive.hover}},children:t.jsxs(f,{sx:{width:"100%",height:"100%",position:"relative"},children:[1===n&&t.jsx(f,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}}),2===n&&t.jsx(f,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}})]})}},space:0,sx:{width:"fit-content"}})}),t.jsx(f,{sx:{position:"absolute",top:0,left:0,transform:`translate(-${String(G/2-1.25)}rem, -${String(G/2)}rem)`,zIndex:10,pointerEvents:"none"},children:t.jsx(c,{size:G,rows:k+1,cols:z+1,cellProps:(e,t)=>{const o=A.numbers[e]?.[t];return{children:o??"",sx:{borderRadius:"50%",backgroundColor:r.surface.background,border:null!=o?`2px solid ${r.border.subtle}`:"none",fontSize:`${String(.5*G)}rem`,fontWeight:"800",color:r.text.primary,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",zIndex:5,opacity:null!=o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",paddingLeft:"0.1rem"}}},space:P})})]}),t.jsxs(f,{onClick:I,sx:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,opacity:A.solved?1:0,transform:A.solved?"scale(1)":"scale(0.95)",visibility:A.solved?"visible":"hidden",transition:"all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:20,backdropFilter:"blur(8px)",borderRadius:4,cursor:"pointer"},children:[t.jsx(m,{sx:{fontSize:"4rem",color:r.primary.main,filter:`drop-shadow(0 0 20px ${r.primary.main})`,animation:A.solved?"float 3s ease-in-out infinite":"none","@keyframes float":{"0%, 100%":{transform:"translateY(0)"},"50%":{transform:"translateY(-10px)"}}}}),t.jsx(f,{sx:{fontSize:"1.5rem",fontWeight:"bold",color:r.text.primary},children:"Puzzle Solved!"}),t.jsx(f,{sx:{fontSize:"0.875rem",color:r.text.secondary,marginTop:1},children:"Tap to play again"})]})]})}),t.jsxs(n,{handler:()=>()=>{},children:[t.jsx(s,{title:"Reset",Icon:p,onClick:I}),t.jsx(s,{title:"Decrease Size",Icon:h,onClick:()=>{y(e=>e&&e>3?e-1:3)},disabled:k<=3}),t.jsx(s,{title:"Increase Size",Icon:x,onClick:()=>{y(e=>e?e+1:4)},disabled:k>=10})]})]})}export{M as default};
