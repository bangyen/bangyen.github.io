import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{A as t,S as o,a as n,L as s,e as i,d as a}from"./index-B-l19WKQ.js";import{h as c,b as l,T as d,S as u,L as f,M as g,D as p,N as S,a as h,f as m,c as b,e as x,d as w,G as y,i as E,g as v,B as C}from"./useResponsiveBoardSize-C2D8zKRa.js";import{u as I,C as $}from"./layout-BFxZ9w7k.js";import{B as O}from"./vendor_mui_core-CC5VlWLf.js";import{u as A,v as R,c as T,P as k}from"./vendor_mui_icons-nmK6gwuH.js";import"./GlobalHeader-BJIpmPyL.js";const _=1,N=2;class z{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error("Index out of bounds");r!==e&&(this.parent[e]=this.find(r));const t=this.parent[e];if(void 0===t)throw new Error("Root not found");return t}union(e,r){const t=this.find(e),o=this.find(r);return t!==o&&(this.parent[t]=o,!0)}}function M(e,r,t){return e*(t+1)+r}function D(e,r,t){const o=new Map,n=new Set;for(let l=0;l<r;l++)for(let r=0;r<t;r++){const n=e[l]?.[r];if(!n||0===n)continue;const s=M(l,n===_?r+1:r,t),i=M(l+1,n===_?r:r+1,t);o.has(s)||o.set(s,[]),o.has(i)||o.set(i,[]),o.get(s)?.push({node:i,r:l,c:r}),o.get(i)?.push({node:s,r:l,c:r})}const s=new Set,i=new Set,a=[],c=(e,r)=>{s.add(e),i.add(e);const t=o.get(e)??[];for(const{node:o,r:l,c:d}of t)if(o!==r)if(i.has(o)){n.add(`${String(l)},${String(d)}`);for(let e=a.length-1;e>=0;e--){const r=a[e];if(!r)break;if(n.add(`${String(r.r)},${String(r.c)}`),r.u===o||r.v===o)break}}else s.has(o)||(a.push({r:l,c:d,u:e,v:o}),c(o,e),a.pop());i.delete(e)};for(const l of o.keys())s.has(l)||c(l,-1);return n}function j(e,r,t){const o=new z((r+1)*(t+1));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const s=r[e];if(void 0===s||0===s)continue;const i=M(n,s===_?e+1:e,t),a=M(n+1,s===_?e:e+1,t);if(!o.union(i,a))return!0}}return!1}function H(e,r,t,o){const n=new Set,s=B(e,t,o);for(let i=0;i<=t;i++)for(let a=0;a<=o;a++){const c=r[i]?.[a];if(null==c)continue;const l=s[i],d=(l?l[a]:0)??0;if(d>c){n.add(`${String(i)},${String(a)}`);continue}d+[{gr:i-1,gc:a-1,pt:N},{gr:i-1,gc:a,pt:_},{gr:i,gc:a-1,pt:_},{gr:i,gc:a,pt:N}].filter(({gr:r,gc:n,pt:s})=>{if(r<0||r>=t||n<0||n>=o)return!1;const i=e[r]?.[n];return 0===i||i===s}).length<c&&n.add(`${String(i)},${String(a)}`)}return n}function L(e,r,t,o){const n=new Set,s=B(e,t,o);for(let i=0;i<=t;i++)for(let e=0;e<=o;e++){const t=r[i]?.[e];if(null==t)continue;const o=s[i];(o?o[e]:0)===t&&n.add(`${String(i)},${String(e)}`)}return n}function B(e,r,t){const o=Array.from({length:r+1},()=>new Array(t+1).fill(0));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const t=r[e];if(t===_){const r=o[n],t=o[n+1];if(r&&t){const o=r[e+1],n=t[e];void 0!==o&&(r[e+1]=o+1),void 0!==n&&(t[e]=n+1)}}else if(t===N){const r=o[n],t=o[n+1];if(r&&t){const o=r[e],n=t[e+1];void 0!==o&&(r[e]=o+1),void 0!==n&&(t[e+1]=n+1)}}}}return o}function W(e,r,t,o){let n=!0;for(;n;){n=!1;for(let s=0;s<=t;s++){const i=r[s];if(i)for(let r=0;r<=o;r++){const a=i[r];if(null==a)continue;const c=[{gr:s-1,gc:r-1,pt:N},{gr:s-1,gc:r,pt:_},{gr:s,gc:r-1,pt:_},{gr:s,gc:r,pt:N}].filter(({gr:e,gc:r})=>e>=0&&e<t&&r>=0&&r<o);let l=0;const d=[];for(const r of c){const t=e[r.gr],o=t?t[r.gc]:0;0===o?d.push(r):o===r.pt&&l++}if(d.length>0)if(l===a)for(const{gr:r,gc:t,pt:o}of d){const s=e[r];s&&(s[t]=o===_?N:_,n=!0)}else if(l+d.length===a)for(const{gr:r,gc:t,pt:o}of d){const s=e[r];s&&(s[t]=o,n=!0)}}}if(!n)for(let r=0;r<t;r++){const s=e[r];if(s)for(let r=0;r<o;r++)if(0===s[r])if(s[r]=_,j(e,t,o)){if(s[r]=N,n=!0,j(e,t,o))return!1}else if(s[r]=N,j(e,t,o)){if(s[r]=_,n=!0,j(e,t,o))return!1}else s[r]=0}}return!j(e,t,o)&&!(H(e,r,t,o).size>0)}function G(e,r,t){const o=Array.from({length:r},()=>new Array(t).fill(0));if(!W(o,e,r,t))return!1;let n=!0;for(;n;){n=!1;for(let s=0;s<r;s++){const i=o[s];if(i)for(let a=0;a<t;a++){if(0!==i[a])continue;const c=o.map(e=>[...e]),l=c[s];if(l&&(l[a]=_,!W(c,e,r,t))){if(i[a]=N,n=!0,!W(o,e,r,t))return!1;continue}const d=o.map(e=>[...e]),u=d[s];if(!u||(u[a]=N,W(d,e,r,t)));else if(i[a]=_,n=!0,!W(o,e,r,t))return!1}}}return o.every(e=>e.every(e=>0!==e))}function F(e,r){const t=Array.from({length:e},()=>new Array(r).fill(_)),o=e*r*c.PUZZLE_GENERATION_ITERATIONS;for(let c=0;c<o;c++){const o=Math.floor(Math.random()*e),n=Math.floor(Math.random()*r),s=t[o];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===_?N:_,j(t,e,r)&&(s[n]=i))}const n=B(t,e,r),s=n.map(e=>[...e]),i=[];for(let c=0;c<=e;c++){const t=n[c];if(t)for(let o=0;o<=r;o++){const n=t[o];if(void 0===n)continue;const s=!(0!==c&&c!==e||0!==o&&o!==r),a=s?2:!s&&(0===c||c===e||0===o||o===r)?3:4;let l=0;l=0===n||n===a?100:1===n||n===a-1?50:25,i.push({r:c,c:o,score:l+20*Math.random()})}}i.sort((e,r)=>r.score-e.score);const a=i.map(({r:e,c:r})=>({r:e,c:r}));for(const{r:c,c:l}of a){const t=s[c];if(!t)continue;const o=t[l];void 0!==o&&(t[l]=null,G(s,e,r)||(t[l]=o))}return{numbers:s,solution:t}}function P(e,r){switch(r.type){case"toggle":{if(e.solved)return e;const t=e.grid.map(e=>[...e]),o=t[r.row];if(!o)return e;const n=o[r.col];r.reverse?o[r.col]=0===n?N:n===N?_:0:o[r.col]=0===n?_:n===_?N:0;let s=!1;if(t.every(e=>e.every(e=>0!==e))){const r=B(t,e.rows,e.cols);e.numbers.every((e,t)=>e.every((e,o)=>{const n=r[t];return null===e||e===n?.[o]}))&&!j(t,e.rows,e.cols)&&(s=!0)}return{...e,grid:t,solved:s,errorNodes:H(t,e.numbers,e.rows,e.cols),cycleCells:D(t,e.rows,e.cols),satisfiedNodes:L(t,e.numbers,e.rows,e.cols)}}case"hydrate":return{...r.state};case"resize":case"new":{const t="resize"===r.type?r.rows:e.rows,o="resize"===r.type?r.cols:e.cols,{numbers:n,solution:s}=F(t,o);return{grid:Array.from({length:t},()=>new Array(o).fill(0)),numbers:n,solution:s,rows:t,cols:o,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return e}}const U=({rows:a,cols:c,numbers:h,size:m,initialMoves:b,onMove:x,onCopy:w,onClear:y,onClose:E})=>{const v=I("sm"),C=b,{getDragProps:k}=l({onToggle:(e,r,t,o)=>{const n=`${String(e)},${String(r)}`;if(void 0!==o)return void x(n,o);const s=C.get(n);let i;return i=t?s===N?_:s===_?void 0:N:s===_?N:s===N?void 0:_,x(n,i),i},touchTimeout:d.TOUCH_HOLD_DELAY,checkEnabled:()=>!0}),[z,M]=e.useState(new Map),[j,H]=e.useState([]),[L,B]=e.useState(new Set);e.useEffect(()=>{const e=new Map,r=[],t=[];C.forEach((t,o)=>{e.set(o,{state:t,source:"user"});const[n,s]=o.split(",").map(Number);void 0!==n&&void 0!==s&&r.push({r:n,c:s})});const o=(r,t)=>{if(r<0||r>=a||t<0||t>=c)return 0;const o=`${String(r)},${String(t)}`;return e.get(o)?.state??0},n=(o,n,s,i)=>{const a=`${String(o)},${String(n)}`,c=e.get(a);c?c.state!==s&&t.push({type:"cell",r:o,c:n}):(e.set(a,{state:s,source:i}),r.push({r:o,c:n}))},s=(e,r)=>[{r:e-1,c:r-1,required:N},{r:e-1,c:r,required:_},{r:e,c:r-1,required:_},{r:e,c:r,required:N}].filter(e=>e.r>=0&&e.r<a&&e.c>=0&&e.c<c);let i=0;for(;i<r.length;){const a=r[i++];if(!a)break;const{r:c,c:l}=a,d=[{r:c,c:l},{r:c,c:l+1},{r:c+1,c:l},{r:c+1,c:l+1}];for(const r of d){const i=h[r.r]?.[r.c];if(null==i)continue;const a=s(r.r,r.c);let d=0;const u=[];for(const e of a){const r=o(e.r,e.c);0===r?u.push(e):r===e.required&&d++}if(d>i)t.push({type:"node",r:r.r,c:r.c});else if(d+u.length<i)t.push({type:"node",r:r.r,c:r.c});else if("user"===e.get(`${String(c)},${String(l)}`)?.source)if(d===i&&u.length>0)for(const e of u){const r=e.required===_?N:_;n(e.r,e.c,r,"propagated")}else if(d+u.length===i&&u.length>0)for(const e of u)n(e.r,e.c,e.required,"propagated")}}const l=Array.from({length:a},()=>Array(c).fill(0));e.forEach((e,r)=>{const[t,o]=r.split(",").map(Number);void 0!==t&&void 0!==o&&l[t]&&(l[t][o]=e.state)});const d=D(l,a,c);M(e),H(t),B(d)},[C,h,a,c]);const W=m*S,G=m-W,F=e.useMemo(()=>new Set(j.filter(e=>"cell"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[j]),P=e.useMemo(()=>new Set(j.filter(e=>"node"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[j]),U=e.useCallback((e,s)=>{const i=`${String(e)},${String(s)}`,a=z.get(i),c=a?.state??0,l=a?.source,d=F.has(i),g=L.has(i),p=k(i);let S=n.text.primary;return d?S=n.data.red:g?S="user"===l?n.data.red:"#ff9800":"user"===l?S=n.primary.main:"propagated"===l&&(S=n.data.green),{...p,sx:{...p.sx,cursor:"pointer",border:`1px solid ${u.GHOST.BORDER}`,position:"relative",backgroundColor:u.GHOST.BG_SUBTLE,"&:hover":{backgroundColor:u.GHOST.BG_HOVER}},children:r.jsxs(O,{sx:{width:"100%",height:"100%",position:"relative"},children:[c===_&&r.jsx(O,{sx:{position:"absolute",width:f.LINE_WIDTH,height:f.LINE_THICKNESS,backgroundColor:S,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),c===N&&r.jsx(O,{sx:{position:"absolute",width:f.LINE_WIDTH,height:f.LINE_THICKNESS,backgroundColor:S,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}},[z,F,L,k]),Z=e.useCallback((e,t)=>{const o=h[e]?.[t],s=P.has(`${String(e)},${String(t)}`);return{"data-pos":`${String(e)},${String(t)}`,"data-type":"hint",children:r.jsx(O,{children:o??""}),sx:{borderRadius:"50%",backgroundColor:s?n.data.red:u.GHOST.HINT_BG,border:null!==o?`2px solid ${s?n.data.red:u.GHOST.HINT_BORDER}`:"none",fontSize:`${String(.5*W)}rem`,fontWeight:"800",color:u.COLORS.WHITE,zIndex:5,opacity:null!==o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(1.1)":"scale(1)",position:"relative",pointerEvents:"none"}}},[h,P,W]);return r.jsxs(O,{sx:{position:"relative",userSelect:"none"},children:[r.jsxs(O,{sx:{position:"relative",padding:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,border:`2px dashed ${u.GHOST.DASHED_BORDER}`,borderRadius:f.CALCULATOR_BORDER_RADIUS},children:[r.jsx(O,{sx:{position:"relative",zIndex:s.zIndex.base+1},children:r.jsx($,{size:m,rows:a,cols:c,cellProps:U,space:0,sx:{width:"fit-content"}})}),r.jsx(O,{sx:{position:"absolute",top:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,left:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,transform:`translate(-${String(W/2)}rem, -${String(W/2)}rem)`,zIndex:s.zIndex.base+2,pointerEvents:"none"},children:r.jsx($,{size:W,rows:a+1,cols:c+1,cellProps:Z,space:G,sx:{width:"fit-content"}})})]}),r.jsxs(O,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:v?-72:-88,left:0,right:0,pointerEvents:"auto",zIndex:s.zIndex.base+5,paddingBottom:2},children:[r.jsx(i,{title:"Copy Board",Icon:A,onClick:w,sx:{backgroundColor:n.interactive.selected,color:n.primary.main,"&:hover":{backgroundColor:n.interactive.focus}}}),r.jsx(i,{title:"Clear Calculator",Icon:R,onClick:y,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:n.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),r.jsx(i,{title:"Close Calculator",Icon:T,onClick:E,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:n.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})]})};function Z(){const{rows:o,cols:s,handlePlus:I,handleMinus:$,mobile:A,dynamicSize:R,minSize:T,maxSize:z}=h({storageKey:E.SIZE,defaultSize:c.DEFAULT_SIZE,minSize:c.MIN_SIZE,headerOffset:{mobile:f.HEADER_OFFSET.MOBILE,desktop:f.HEADER_OFFSET.DESKTOP},paddingOffset:160,widthLimit:f.WIDTH_LIMIT,cellSizeReference:4,mobileRowOffset:-2}),[M,D]=e.useState(!1),j=m({rows:o+1,cols:s+1,headerOffset:{mobile:f.HEADER_OFFSET.MOBILE,desktop:f.HEADER_OFFSET.DESKTOP},paddingOffset:{x:A?128:224,y:f.PADDING_OFFSET},boardMaxWidth:f.BOARD_MAX_WIDTH,boardSizeFactor:f.BOARD_SIZE_FACTOR,maxCellSize:f.MAX_CELL_SIZE,remBase:f.REM_BASE}),H=e.useMemo(()=>function(e,r){const{numbers:t,solution:o}=F(e,r);return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:t,solution:o,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}(o,s),[o,s]),[L,B]=e.useReducer(P,H);b({storageKey:E.STATE,rows:o,cols:s,state:L,enabled:!M,onRestore:e=>{B({type:"hydrate",state:e})},serialize:e=>({...e,errorNodes:Array.from(e.errorNodes),cycleCells:Array.from(e.cycleCells),satisfiedNodes:Array.from(e.satisfiedNodes)}),deserialize:e=>{const r=e;return{...r,errorNodes:new Set(r.errorNodes),cycleCells:new Set(r.cycleCells),satisfiedNodes:new Set(r.satisfiedNodes)}}});const[W,G]=e.useState(new Map);b({storageKey:E.GHOST_MOVES,rows:o,cols:s,state:W,onRestore:e=>{G(e)},serialize:e=>Array.from(e.entries()),deserialize:e=>new Map(e)});const Z=e.useRef("");e.useEffect(()=>{const e=JSON.stringify(L.numbers);Z.current&&Z.current!==e&&G(new Map),Z.current=e},[L.numbers,L.rows,L.cols]),x(a.slant);const q=e.useCallback(()=>{B({type:"new"})},[B]);w(L.solved,q,d.WIN_ANIMATION_DELAY);const{getDragProps:K}=l({onToggle:(e,r,t)=>{B({type:"toggle",row:e,col:r,reverse:t})},checkEnabled:()=>!L.solved,touchTimeout:d.TOUCH_HOLD_DELAY}),Y=j*S,V=e.useMemo(()=>((e,o)=>(s,i)=>{const a=e.grid[s]?.[i],c=`${String(s)},${String(i)}`,l=e.cycleCells.has(c),d=o(c);return{...d,sx:{...d.sx,cursor:"pointer",border:`1px solid ${n.border.subtle}`,position:"relative","&:hover":{backgroundColor:n.interactive.hover}},children:r.jsxs(O,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===_&&r.jsx(O,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:l?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),a===N&&r.jsx(O,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:l?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}})(L,K),[L,K]),X=e.useMemo(()=>((e,t)=>(o,s)=>{const i=e.numbers[o]?.[s],a=e.errorNodes.has(`${String(o)},${String(s)}`),c=e.satisfiedNodes.has(`${String(o)},${String(s)}`);return{sx:{pointerEvents:"none"},children:r.jsx(O,{sx:{borderRadius:"50%",backgroundColor:a?n.data.red:n.surface.background,border:null!==i?`2px solid ${a?n.data.red:c?"transparent":n.border.subtle}`:"none",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:a?u.COLORS.WHITE:c?n.interactive.disabledText:n.text.primary,boxShadow:c&&!a?"none":u.SHADOWS.HINT,zIndex:5,opacity:null!==i?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:a?"scale(1.1)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}})(L,Y),[L,Y]);e.useEffect(()=>{B({type:"resize",rows:o,cols:s})},[o,s]);const J=M?r.jsx(r.Fragment,{}):r.jsx(v,{rows:o,cols:s,dynamicSize:R,minSize:T,maxSize:z,handlePlus:I,handleMinus:$,onRefresh:q,disabled:M,children:r.jsx(i,{title:"Open Calculator",Icon:k,onClick:()=>{D(!M)},sx:{color:"default"}})}),Q=e.useCallback((e,r)=>{G(t=>{const o=new Map(t);return void 0===r?o.delete(e):o.set(e,r),o})},[]),ee=e.useCallback(()=>{const e=new Map;L.grid.forEach((r,t)=>{r.forEach((r,o)=>{0!==r&&e.set(`${String(t)},${String(o)}`,r)})}),G(e)},[L.grid]),re=e.useCallback(()=>{G(new Map)},[]),te=e.useCallback(()=>{D(!1)},[]),oe=e.useCallback(e=>{e.stopPropagation()},[]),ne=e.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${n.surface.elevated} 0%, ${n.surface.background} 100%)`,padding:A?"1rem":"2rem"}),[A]),se=e.useMemo(()=>({userSelect:"none",padding:A?g:p,border:"2px solid transparent",borderRadius:f.CALCULATOR_BORDER_RADIUS}),[A]),ie=M?r.jsx(U,{rows:o,cols:s,numbers:L.numbers,size:j,initialMoves:W,onMove:Q,onCopy:ee,onClear:re,onClose:te}):r.jsx(C,{size:j,rows:o+1,cols:s+1,frontProps:X,backProps:V,frontLayerSx:{pointerEvents:"none"}});return r.jsx(y,{title:a.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:J,contentSx:ne,showTrophy:!M&&L.solved,onReset:q,boardSize:j,iconSizeRatio:f.ICON_SIZE_RATIO,primaryColor:n.primary.main,secondaryColor:n.primary.main,boardSx:se,children:r.jsx(O,{onClick:oe,children:ie})})}export{Z as default};
