import{r as e,j as t}from"./vendor_react-WaSaIrII.js";import{d as o,a as r,e as n,g as s}from"./index-Bw6W8Thg.js";import{u as i,C as l,c}from"./CustomGrid-B-BFcPhb.js";import{G as a}from"./GlobalHeader-D6hH8yHx.js";import{u}from"./useWindow-BCvkQ8_7.js";import{G as f,B as d}from"./vendor_mui_core-D4-4kcvK.js";import{l as m,J as p,q as h,r as g}from"./vendor_mui_icons-D2mx3Sr-.js";const v=1,w=2;class x{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error("Index out of bounds");t!==e&&(this.parent[e]=this.find(t));const o=this.parent[e];if(void 0===o)throw new Error("Root not found");return o}union(e,t){const o=this.find(e),r=this.find(t);return o!==r&&(this.parent[o]=r,!0)}}function b(e,t,o){return e*(o+1)+t}function y(e,t,o){const r=new x((t+1)*(o+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const s=t[e];if(void 0===s||0===s)continue;const i=b(n,s===v?e+1:e,o),l=b(n+1,s===v?e:e+1,o);if(!r.union(i,l))return!0}}return!1}function j(e,t,o){const r=Array.from({length:t+1},()=>Array(o+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const o=t[e];if(o===v){const t=r[n];if(t){const o=t[e+1];void 0!==o&&(t[e+1]=o+1)}const o=r[n+1];if(o){const t=o[e];void 0!==t&&(o[e]=t+1)}}else if(o===w){const t=r[n];if(t){const o=t[e];void 0!==o&&(t[e]=o+1)}const o=r[n+1];if(o){const t=o[e+1];void 0!==t&&(o[e+1]=t+1)}}}}return r}function S(e,t,o){const r=Array.from({length:t},()=>Array(o).fill(0));let n=!0;for(;n;){n=!1;for(let s=0;s<=t;s++)for(let i=0;i<=o;i++){const l=e[s]?.[i];if(null==l)continue;const c=[{gr:s-1,gc:i-1,pt:w},{gr:s-1,gc:i,pt:v},{gr:s,gc:i-1,pt:v},{gr:s,gc:i,pt:w}].filter(({gr:e,gc:r})=>e>=0&&e<t&&r>=0&&r<o);let a=0;const u=[];for(const e of c){const t=r[e.gr]?.[e.gc];0===t?u.push(e):t===e.pt&&a++}if(a===l&&u.length>0)for(const{gr:e,gc:t,pt:o}of u){const s=r[e];s&&(s[t]=o===v?w:v,n=!0)}else if(a+u.length===l&&u.length>0)for(const{gr:e,gc:t,pt:o}of u){const s=r[e];s&&(s[t]=o,n=!0)}}if(!n)for(let e=0;e<t;e++)for(let s=0;s<o;s++){const i=r[e];if(0===i?.[s])if(i[s]=v,y(r,t,o)){if(i[s]=w,n=!0,y(r,t,o))return!1}else if(i[s]=w,y(r,t,o)){if(i[s]=v,n=!0,y(r,t,o))return!1}else i[s]=0}}if(!r.every(e=>e.every(e=>0!==e)))return!1;const s=j(r,t,o);for(let i=0;i<=t;i++)for(let t=0;t<=o;t++){const o=e[i]?.[t];if(null!=o&&s[i]?.[t]!==o)return!1}return!y(r,t,o)}function k(e,t){const o=Array.from({length:e},()=>Array(t).fill(v)),r=e*t*30;for(let c=0;c<r;c++){const r=Math.floor(Math.random()*e),n=Math.floor(Math.random()*t),s=o[r];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===v?w:v,y(o,e,t)&&(s[n]=i))}const n=j(o,e,t).map(e=>[...e]),s=[];for(let c=0;c<=e;c++)for(let e=0;e<=t;e++)s.push({r:c,c:e});for(let c=s.length-1;c>0;c--){const e=Math.floor(Math.random()*(c+1)),t=s[c],o=s[e];t&&o&&(s[c]=o,s[e]=t)}const i=Math.floor((e+1)*(t+1)*.35);let l=(e+1)*(t+1);for(const{r:c,c:a}of s){if(l<=i)continue;const o=n[c];if(!o)continue;const r=o[a];null!=r&&(o[a]=null,S(n,e,t)?l--:o[a]=r)}return{numbers:n,solution:o}}function M(e,t){switch(t.type){case"toggle":{if(e.solved)return e;const{row:o,col:r}=t,n=e.grid.map(e=>[...e]),s=n[o];if(!s)return e;const i=s[r];if(void 0===i)return e;t.reverse?s[r]=0===i?w:i===w?v:0:s[r]=0===i?v:i===v?w:0;let l=!1;if(n.every(e=>e.every(e=>0!==e))){const t=j(n,e.rows,e.cols);e.numbers.every((e,o)=>e.every((e,r)=>null===e||e===t[o]?.[r]))&&!y(n,e.rows,e.cols)&&(l=!0)}return{...e,grid:n,solved:l}}case"resize":{if(t.rows<2||t.cols<2)return e;const{numbers:o}=k(t.rows,t.cols);return{grid:Array.from({length:t.rows},()=>Array(t.cols).fill(0)),numbers:o,rows:t.rows,cols:t.cols,solved:!1}}case"new":{const{numbers:t}=k(e.rows,e.cols);return{...e,grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:t,solved:!1}}default:return e}}function C(){const{height:x,width:b}=u(),y=i("sm"),[j,S]=e.useState(()=>{const e=localStorage.getItem("slant-size");return e&&"null"!==e?parseInt(e,10):5}),C=e.useMemo(()=>{const e=c(4,x-(y?64:80)-100,Math.min(b,1e3));let t=e.rows-1;const o=e.cols-1;return y&&(t-=2),{rows:Math.max(3,t),cols:Math.max(3,o)}},[x,b,y]),{rows:E,cols:z}=e.useMemo(()=>{const e=j??5;return{rows:Math.min(e,C.rows),cols:Math.min(e,C.cols)}},[j,C]),A=e.useMemo(()=>{const e=.95*Math.min(b,1200)/(z+1),t=.95*(x-160)/(E+1);return Math.min(e,t,100)/16},[b,x,E,z]),[I,$]=e.useReducer(M,{rows:E,cols:z},e=>function(e,t){const{numbers:o}=k(e,t);return{grid:Array.from({length:e},()=>Array(t).fill(0)),numbers:o,rows:e,cols:t,solved:!1}}(e.rows,e.cols));e.useEffect(()=>{localStorage.setItem("slant-size",String(j))},[j]),e.useEffect(()=>{I.rows===E&&I.cols===z||$({type:"resize",rows:E,cols:z})},[E,z,I.rows,I.cols]),e.useEffect(()=>{document.title=o.slant},[]);const D=e.useCallback(()=>{$({type:"new"})},[$]);e.useEffect(()=>{if(I.solved){const e=setTimeout(()=>{D()},2e3);return()=>{clearTimeout(e)}}},[I.solved,D]);const[L,R]=e.useState(null),_=e.useRef(new Set),G=e.useRef(0),H=e.useCallback(e=>{_.current.add(e)},[]);e.useEffect(()=>{const e=()=>{R(null),_.current.clear()},t=e=>{if(null===L)return;const t=e.touches[0];if(!t)return;const o=document.elementFromPoint(t.clientX,t.clientY);if(!o)return;const r=o.closest("[data-pos]");if(r){const e=r.getAttribute("data-pos");if(e&&!_.current.has(e)){const[t,o]=e.split(",").map(Number);void 0!==t&&void 0!==o&&($({type:"toggle",row:t,col:o,reverse:2===L}),H(e))}}};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),window.removeEventListener("touchmove",t)}},[L,H]);const P=.4*A,T=A-P;return t.jsxs(f,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:`radial-gradient(circle at 50% 50%, ${r.surface.elevated} 0%, ${r.surface.background} 100%)`,position:"relative",overflow:"hidden",height:"100vh"},children:[t.jsx(a,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname"}),t.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:`${String(A)}rem`},children:t.jsxs(d,{children:[t.jsxs(d,{sx:{position:"relative",userSelect:"none"},children:[t.jsx(d,{sx:{position:"relative",zIndex:1},children:t.jsx(l,{size:A,rows:E,cols:z,cellProps:(e,o)=>{const n=I.grid[e]?.[o],s=`${String(e)},${String(o)}`;return{onMouseDown:t=>{I.solved||0!==t.button&&2!==t.button||Date.now()-G.current<500||(t.preventDefault(),R(t.button),$({type:"toggle",row:e,col:o,reverse:2===t.button}),H(s))},onMouseEnter:()=>{null===L||_.current.has(s)||I.solved||($({type:"toggle",row:e,col:o,reverse:2===L}),H(s))},onContextMenu:e=>{e.preventDefault()},onTouchStart:t=>{I.solved||(t.cancelable&&t.preventDefault(),G.current=Date.now(),R(0),$({type:"toggle",row:e,col:o}),H(s))},"data-pos":s,sx:{cursor:"pointer",border:`1px solid ${r.border.subtle}`,position:"relative",transition:"all 0.2s",touchAction:"none","&:hover":{backgroundColor:r.interactive.hover}},children:t.jsxs(d,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===v&&t.jsx(d,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}}),n===w&&t.jsx(d,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)"}})]})}},space:0,sx:{width:"fit-content"}})}),t.jsx(d,{sx:{position:"absolute",top:0,left:0,transform:`translate(-${String(P/2)}rem, -${String(P/2)}rem)`,zIndex:10,pointerEvents:"none"},children:t.jsx(l,{size:P,rows:E+1,cols:z+1,cellProps:(e,t)=>{const o=I.numbers[e]?.[t];return{children:o??"",sx:{borderRadius:"50%",backgroundColor:r.surface.background,border:null!=o?`2px solid ${r.border.subtle}`:"none",fontSize:`${String(.5*P)}rem`,fontWeight:"800",color:r.text.primary,boxShadow:"0 4px 8px rgba(0,0,0,0.1)",zIndex:5,opacity:null!=o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",userSelect:"none",WebkitUserSelect:"none"}}},space:T,sx:{width:"fit-content"}})})]}),t.jsx(d,{onClick:D,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:I.solved?1:0,transform:I.solved?"scale(1)":"scale(0.5)",visibility:I.solved?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:20,backgroundColor:"transparent",cursor:"pointer",backdropFilter:"blur(2px)"},children:t.jsx(m,{sx:{fontSize:`${String(A)}rem`,color:r.primary.main,filter:`drop-shadow(0 0 30px ${r.primary.main}88)`,animation:I.solved?"float 3s ease-in-out infinite":"none","@keyframes float":{"0%, 100%":{transform:"translateY(0)"},"50%":{transform:"translateY(-10px)"}}}})})]})}),t.jsxs(n,{handler:()=>()=>{},children:[t.jsx(s,{title:"Reset",Icon:p,onClick:D}),t.jsx(s,{title:"Decrease Size",Icon:h,onClick:()=>{S(e=>e&&e>3?e-1:3)},disabled:E<=3}),t.jsx(s,{title:"Increase Size",Icon:g,onClick:()=>{S(e=>e?e+1:4)},disabled:E>=10})]})]})}export{C as default};
