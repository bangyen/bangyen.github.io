import{j as m,r as n}from"./vendor_react-CiGj4Onb.js";import{C as _,d as q,u as W,c as re}from"./layout-Bo_09a4v.js";import{B as I,G as ie,d as Q,e as ae}from"./vendor_mui_core-Cb6gYFA4.js";import{L as ce,f as le,e as V,a as J,E as ue,S as de}from"./index-aPQk9d5W.js";import{v as fe,w as me,E as he}from"./vendor_mui_icons-88WVDz42.js";import{G as pe}from"./GlobalHeader-CLOzPJK4.js";import{G as we}from"./GlassCard-Dg-JYzyH.js";function xe(e){const{frontProps:t,backProps:o,size:s,rows:l,cols:h,frontLayerSx:a,backLayerSx:d}=e;return m.jsxs(I,{sx:{display:"grid",placeItems:"center"},children:[m.jsx(I,{sx:{gridArea:"1/1",...d},children:m.jsx(_,{space:0,size:s,rows:l-1,cols:h-1,cellProps:o})}),m.jsx(I,{sx:{gridArea:"1/1",zIndex:ce.zIndex.base+1,...a},children:m.jsx(_,{space:0,size:s,rows:l,cols:h,cellProps:t})})]})}function ge({rows:e,cols:t,dynamicSize:o,minSize:s,maxSize:l,handlePlus:h,handleMinus:a,onRefresh:d,disabled:f=!1,children:r}){const i=e<=s&&t<=s,w=e>=l&&t>=l||e===o.rows&&t===o.cols;return m.jsxs(le,{onRefresh:d,children:[m.jsx(V,{title:"Decrease Size",Icon:fe,onClick:a,disabled:f||i}),m.jsx(V,{title:"Increase Size",Icon:me,onClick:h,disabled:f||w}),r]})}const be={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}};function Se(e,t){return`${e.toString()},${t.toString()}`}function ye(e){return(t,o)=>{if(e.customHandler){const s=e.customHandler(t,o);if(s!==t)return s}switch(o.type){case"resize":if("newRows"in o||"rows"in o||"cols"in o){const s=o.newRows??o.rows??t.rows,l=o.newCols??o.cols??t.cols;return e.getInitialState(s,l)}return t;case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return"state"in o?o.state:t;default:return t}}}function ve(e,t,o){return n.useMemo(()=>e(t,...o),[e,t,o])}const ze=e=>{if(e<1||e>100)throw new Error("Invalid grid size: must be between 1 and 100");return e},Ee=e=>{if(e<0)throw new Error("Invalid cell index: cannot be negative");return e};function Z({onAction:e,checkEnabled:t=()=>!0,touchTimeout:o=500,posAttribute:s="data-pos",preventDefault:l=!0,transition:h="all 0.2s"}){const[a,d]=n.useState(null),f=n.useRef(new Set),r=n.useRef(0),i=n.useCallback(()=>{d(null),f.current.clear()},[]),w=n.useCallback(u=>{if(a===null)return;const c=u.touches[0];if(!c)return;const z=document.elementFromPoint(c.clientX,c.clientY);if(!z)return;const D=z.closest(`[${s}]`);if(D){const T=D.getAttribute(s);T&&!f.current.has(T)&&(e(T,a===2,!1),f.current.add(T))}},[a,e,s]);n.useEffect(()=>(window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),window.addEventListener("touchmove",w,{passive:!1}),()=>{window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),window.removeEventListener("touchmove",w)}),[i,w]);const g=n.useCallback(u=>({onMouseDown:c=>{t()&&(c.button!==0&&c.button!==2||Date.now()-r.current<o||(l&&c.preventDefault(),d(c.button),e(u,c.button===2,!0),f.current.add(u)))},onMouseEnter:()=>{a!==null&&!f.current.has(u)&&t()&&(e(u,a===2,!1),f.current.add(u))},onTouchStart:c=>{t()&&(c.cancelable&&l&&c.preventDefault(),r.current=Date.now(),d(0),e(u,!1,!0),f.current.add(u))},onContextMenu:c=>{l&&c.preventDefault()},[s]:u,sx:{touchAction:"none",transition:h}}),[e,t,a,o,s,l,h]);return{isDragging:a!==null,draggingButton:a,getDragProps:g,lastTouchTime:r}}function ee({storageKey:e,rows:t,cols:o,state:s,onRestore:l,serialize:h,deserialize:a,enabled:d=!0,saveDebounceMs:f=300}){const r=`${e}-${String(t)}x${String(o)}`,i=n.useRef(l),w=n.useRef(a),g=n.useRef(h);n.useEffect(()=>{i.current=l,w.current=a,g.current=h}),n.useEffect(()=>{if(!d)return;const u=localStorage.getItem(r);if(u)try{const c=JSON.parse(u),z=w.current??(D=>D);i.current(z(c))}catch{localStorage.removeItem(r)}},[r,d]),n.useEffect(()=>{if(!d)return;const u=setTimeout(()=>{const c=(g.current??(z=>z))(s);localStorage.setItem(r,JSON.stringify(c))},f);return()=>{clearTimeout(u)}},[r,s,d,f])}function Me({storageKeys:e,pageTitle:t,gridConfig:o,boardConfig:s,reducer:l,getInitialState:h,winAnimationDelay:a,isSolved:d,persistence:f}){const{rows:r,cols:i,dynamicSize:w,handlePlus:g,handleMinus:u,mobile:c,minSize:z,maxSize:D}=(function({storageKey:b,defaultSize:j,minSize:x=2,maxSize:S=10,headerOffset:E,paddingOffset:A=0,widthLimit:H=1300,cellSizeReference:M,mobileRowOffset:$=0}){const{height:O,width:P}=q(),k=W("sm"),[y,R]=n.useState(()=>{const v=localStorage.getItem(b);return v==="null"?null:v?parseInt(v,10):j}),p=n.useMemo(()=>{const v=k?E.mobile:E.desktop,K=typeof M=="number"?M:k?M.mobile:M.desktop,X=re(K,O-v-A,Math.min(P,H));let Y=X.rows-1;const se=X.cols-1;return k&&(Y+=$),{rows:Math.max(x,Y),cols:Math.max(x,se)}},[M,O,P,k,E,A,H,x,$]),{rows:L,cols:G}=n.useMemo(()=>y===null?p:{rows:Math.min(y,p.rows),cols:Math.min(y,p.cols)},[y,p]);return n.useEffect(()=>{localStorage.setItem(b,String(y))},[y,b]),{rows:L,cols:G,dynamicSize:p,handlePlus:()=>{const v=Math.min(L,G);y!==null&&(v<Math.min(p.rows,p.cols)?R(v+1):p.rows===p.cols||L===p.rows&&G===p.cols||R(null))},handleMinus:()=>{const v=Math.min(L,G);if(y===null){const K=Math.min(p.rows,p.cols);p.rows===p.cols?R(Math.max(x,K-1)):R(K)}else v>x&&R(v-1)},desiredSize:y,setDesiredSize:R,mobile:k,width:P,height:O,minSize:x,maxSize:S}})({storageKey:e.size,...o}),T=n.useMemo(()=>h(r,i),[r,i,h]),[B,C]=n.useReducer(l,T),U=n.useMemo(()=>d(B),[B,d]),F=n.useCallback(()=>{C({type:"new"})},[C]);var N;ee({storageKey:e.state,rows:r,cols:i,state:B,onRestore:b=>{C({type:"restore",state:b}),C({type:"hydrate",state:b})},...f}),(function(b,j,x=2e3){const S=n.useRef(j);S.current=j,n.useEffect(()=>{if(b){const E=setTimeout(()=>{S.current()},x);return()=>{clearTimeout(E)}}},[b,x])})(U,F,a),N=t,n.useEffect(()=>{document.title=N},[N]),n.useEffect(()=>{C({type:"resize",rows:r,cols:i,newRows:r,newCols:i})},[r,i,C]);const oe=n.useMemo(()=>typeof s.paddingOffset=="function"?s.paddingOffset(c):s.paddingOffset,[s,c]),ne=(function({rows:b,cols:j,headerOffset:x,paddingOffset:S,boardMaxWidth:E,boardSizeFactor:A,maxCellSize:H,remBase:M}){const{width:$,height:O}=q(),P=W("sm");return n.useMemo(()=>{const k=P?x.mobile:x.desktop,y=typeof S=="number"?0:S.x,R=typeof S=="number"?S:S.y,p=(Math.min($,E)-y)*A,L=(O-k-R)*A;return Math.min(p/j,L/b,H)/M},[$,O,P,b,j,x,S,E,A,H,M])})({rows:r+(s.rowOffset??0),cols:i+(s.colOffset??0),headerOffset:o.headerOffset,...s,paddingOffset:oe});return{rows:r,cols:i,state:B,dispatch:C,size:ne,mobile:c,solved:U,handleNext:F,controlsProps:{rows:r,cols:i,dynamicSize:w,minSize:z,maxSize:D,handlePlus:g,handleMinus:u,onRefresh:F}}}function Re({onToggle:e,checkEnabled:t,touchTimeout:o,transition:s,posAttribute:l}){const h=n.useRef(void 0),a=n.useRef(e);a.current=e;const d=n.useCallback((r,i,w)=>{if(!t())return;const[g,u]=r.split(",").map(Number);g!==void 0&&u!==void 0&&(w?h.current=a.current(g,u,i,void 0,!0):a.current(g,u,i,h.current,!1))},[t]),{getDragProps:f}=Z({onAction:d,checkEnabled:t,touchTimeout:o,transition:s,posAttribute:l});return{getDragProps:f}}function Ce({show:e,onReset:t,size:o,iconSizeRatio:s,primaryColor:l,secondaryColor:h,useSecondary:a=!1}){const[d,f]=n.useState(!1);return n.useEffect(()=>{if(e){const r=setTimeout(()=>{f(!0)},500);return()=>{clearTimeout(r)}}f(!1)},[e]),m.jsx(I,{onClick:d?t:void 0,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:d?"pointer":"default",zIndex:10,backgroundColor:"transparent",pointerEvents:e?"auto":"none"},children:o>0&&m.jsx(he,{sx:{fontSize:`${(o*s).toString()}rem`,color:a?h:l,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}})})}function te(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function je({children:e,controls:t,infoUrl:o,_title:s,background:l=J.surface.background,paddingBottom:h={xs:"80px",md:"120px"},contentSx:a={},showTrophy:d=!1,onReset:f,boardSize:r=0,iconSizeRatio:i=1,primaryColor:w,secondaryColor:g,useSecondaryTrophy:u=!1,boardSx:c}){return W("sm"),m.jsxs(ie,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:l,position:"relative",overflow:"hidden",height:"100vh",transition:"background 0.5s ease-in-out"},children:[m.jsx(pe,{showHome:!0,infoUrl:o}),m.jsx(I,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:h},...te(a)],children:m.jsxs(I,{sx:[{position:"relative",width:"fit-content"},...te(c)],children:[e,m.jsx(Ce,{show:d,onReset:f,size:r,iconSizeRatio:i,primaryColor:w,secondaryColor:g,useSecondary:u})]})}),t]})}const ke=({children:e})=>m.jsx(ue,{FallbackComponent:({error:t,resetErrorBoundary:o})=>m.jsx(I,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4,minHeight:"300px"},children:m.jsxs(we,{sx:{p:4,maxWidth:"500px",textAlign:"center"},children:[m.jsx(Q,{variant:"h5",sx:{mb:2,color:J.text.primary,fontWeight:"bold"},children:"Game Error"}),m.jsx(Q,{sx:{mb:3,color:J.text.secondary,fontFamily:"monospace",fontSize:"0.9rem"},children:(t==null?void 0:t.message)??"An unexpected error occurred."}),m.jsx(ae,{variant:"contained",onClick:o,sx:{borderRadius:de.borderRadius.md,textTransform:"none"},children:"Reset Game"})]})}),children:e});export{xe as B,ke as G,ze as a,Me as b,ye as c,Re as d,ve as e,je as f,Se as g,ge as h,be as i,Ee as j,ee as k,Z as u};
