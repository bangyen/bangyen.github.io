import{r as e,j as t}from"./vendor_react-WaSaIrII.js";import{d as o,a as r,e as n,g as s}from"./index-CRhA4usf.js";import{u as i,C as l,c}from"./CustomGrid-cKvNW6YK.js";import{G as a}from"./GlobalHeader-vdTlryim.js";import{u}from"./useWindow-BCvkQ8_7.js";import{G as f,B as d}from"./vendor_mui_core-D4-4kcvK.js";import{l as g,r as p,s as h}from"./vendor_mui_icons-kUp0AcNR.js";const m=1,w=2;class v{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error("Index out of bounds");t!==e&&(this.parent[e]=this.find(t));const o=this.parent[e];if(void 0===o)throw new Error("Root not found");return o}union(e,t){const o=this.find(e),r=this.find(t);return o!==r&&(this.parent[o]=r,!0)}}function x(e,t,o){return e*(o+1)+t}function b(e,t,o){const r=new v((t+1)*(o+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const s=t[e];if(void 0===s||0===s)continue;const i=x(n,s===m?e+1:e,o),l=x(n+1,s===m?e:e+1,o);if(!r.union(i,l))return!0}}return!1}function y(e,t,o){const r=Array.from({length:t+1},()=>Array(o+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const o=t[e];if(o===m){const t=r[n];if(t){const o=t[e+1];void 0!==o&&(t[e+1]=o+1)}const o=r[n+1];if(o){const t=o[e];void 0!==t&&(o[e]=t+1)}}else if(o===w){const t=r[n];if(t){const o=t[e];void 0!==o&&(t[e]=o+1)}const o=r[n+1];if(o){const t=o[e+1];void 0!==t&&(o[e+1]=t+1)}}}}return r}function S(e,t,o){const r=Array.from({length:t},()=>Array(o).fill(0));let n=!0;for(;n;){n=!1;for(let s=0;s<=t;s++)for(let i=0;i<=o;i++){const l=e[s]?.[i];if(null==l)continue;const c=[{gr:s-1,gc:i-1,pt:w},{gr:s-1,gc:i,pt:m},{gr:s,gc:i-1,pt:m},{gr:s,gc:i,pt:w}].filter(({gr:e,gc:r})=>e>=0&&e<t&&r>=0&&r<o);let a=0;const u=[];for(const e of c){const t=r[e.gr]?.[e.gc];0===t?u.push(e):t===e.pt&&a++}if(a===l&&u.length>0)for(const{gr:e,gc:t,pt:o}of u){const s=r[e];s&&(s[t]=o===m?w:m,n=!0)}else if(a+u.length===l&&u.length>0)for(const{gr:e,gc:t,pt:o}of u){const s=r[e];s&&(s[t]=o,n=!0)}}if(!n)for(let e=0;e<t;e++)for(let s=0;s<o;s++){const i=r[e];if(0===i?.[s])if(i[s]=m,b(r,t,o)){if(i[s]=w,n=!0,b(r,t,o))return!1}else if(i[s]=w,b(r,t,o)){if(i[s]=m,n=!0,b(r,t,o))return!1}else i[s]=0}}if(!r.every(e=>e.every(e=>0!==e)))return!1;const s=y(r,t,o);for(let i=0;i<=t;i++)for(let t=0;t<=o;t++){const o=e[i]?.[t];if(null!=o&&s[i]?.[t]!==o)return!1}return!b(r,t,o)}function j(e,t){const o=Array.from({length:e},()=>Array(t).fill(m)),r=e*t*30;for(let c=0;c<r;c++){const r=Math.floor(Math.random()*e),n=Math.floor(Math.random()*t),s=o[r];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===m?w:m,b(o,e,t)&&(s[n]=i))}const n=y(o,e,t).map(e=>[...e]),s=[];for(let c=0;c<=e;c++)for(let e=0;e<=t;e++)s.push({r:c,c:e});for(let c=s.length-1;c>0;c--){const e=Math.floor(Math.random()*(c+1)),t=s[c],o=s[e];t&&o&&(s[c]=o,s[e]=t)}const i=Math.floor((e+1)*(t+1)*.35);let l=(e+1)*(t+1);for(const{r:c,c:a}of s){if(l<=i)continue;const o=n[c];if(!o)continue;const r=o[a];null!=r&&(o[a]=null,S(n,e,t)?l--:o[a]=r)}return{numbers:n,solution:o}}function $(e,t){switch(t.type){case"toggle":{if(e.solved)return e;const{row:o,col:r}=t,n=e.grid.map(e=>[...e]),s=n[o];if(!s)return e;const i=s[r];if(void 0===i)return e;t.reverse?s[r]=0===i?w:i===w?m:0:s[r]=0===i?m:i===m?w:0;let l=!1;if(n.every(e=>e.every(e=>0!==e))){const t=y(n,e.rows,e.cols);e.numbers.every((e,o)=>e.every((e,r)=>null===e||e===t[o]?.[r]))&&!b(n,e.rows,e.cols)&&(l=!0)}const c=function(e,t,o,r){const n=new Set,s=y(e,o,r);for(let i=0;i<=o;i++)for(let l=0;l<=r;l++){const c=t[i]?.[l];if(null==c)continue;const a=s[i]?.[l]??0;a>c?n.add(`${String(i)},${String(l)}`):a+[{gr:i-1,gc:l-1},{gr:i-1,gc:l},{gr:i,gc:l-1},{gr:i,gc:l}].filter(({gr:t,gc:n})=>t>=0&&t<o&&n>=0&&n<r&&0===e[t]?.[n]).length<c&&n.add(`${String(i)},${String(l)}`)}return n}(n,e.numbers,e.rows,e.cols),a=function(e,t,o){const r=new Map,n=new Set;for(let a=0;a<t;a++)for(let t=0;t<o;t++){const n=e[a]?.[t];if(!n||0===n)continue;const s=x(a,n===m?t+1:t,o),i=x(a+1,n===m?t:t+1,o);r.has(s)||r.set(s,[]),r.has(i)||r.set(i,[]),r.get(s)?.push({node:i,r:a,c:t}),r.get(i)?.push({node:s,r:a,c:t})}const s=new Set,i=new Set,l=[],c=(e,t)=>{s.add(e),i.add(e);const o=r.get(e)??[];for(const{node:r,r:a,c:u}of o)if(r!==t)if(i.has(r)){n.add(`${String(a)},${String(u)}`);for(let e=l.length-1;e>=0;e--){const t=l[e];if(!t)break;if(n.add(`${String(t.r)},${String(t.c)}`),t.u===r||t.v===r)break}}else s.has(r)||(l.push({r:a,c:u,u:e,v:r}),c(r,e),l.pop());i.delete(e)};for(const a of r.keys())s.has(a)||c(a,-1);return n}(n,e.rows,e.cols),u=function(e,t,o,r){const n=new Set,s=y(e,o,r);for(let i=0;i<=o;i++)for(let e=0;e<=r;e++){const o=t[i]?.[e];null!=o&&((s[i]?.[e]??0)===o&&n.add(`${String(i)},${String(e)}`))}return n}(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:l,auto:!l&&e.auto,errorNodes:c,cycleCells:a,satisfiedNodes:u}}case"auto":return{...e,auto:!e.auto};case"nextLogical":{const t=function(e){const{grid:t,numbers:o,rows:r,cols:n}=e;for(let s=0;s<=r;s++)for(let e=0;e<=n;e++){const i=o[s]?.[e];if(null==i)continue;const l=[{gr:s-1,gc:e-1,pt:w},{gr:s-1,gc:e,pt:m},{gr:s,gc:e-1,pt:m},{gr:s,gc:e,pt:w}].filter(({gr:e,gc:t})=>e>=0&&e<r&&t>=0&&t<n);let c=0;const a=[];for(const e of l){const o=t[e.gr]?.[e.gc];0===o?a.push(e):o===e.pt&&c++}if(a.length>0)if(c===i){const e=a[0];if(e)return{row:e.gr,col:e.gc,reverse:e.pt===m}}else if(c+a.length===i){const e=a[0];if(e)return{row:e.gr,col:e.gc,reverse:e.pt===w}}}for(let s=0;s<r;s++)for(let e=0;e<n;e++){if(0!==t[s]?.[e])continue;const o=t.map(e=>[...e]),i=o[s];if(i){if(i[e]=m,b(o,r,n))return{row:s,col:e,reverse:!0};if(i[e]=w,b(o,r,n))return{row:s,col:e,reverse:!1}}}for(let s=0;s<r;s++)for(let o=0;o<n;o++){const r=t[s]?.[o],n=e.solution[s]?.[o];if(0!==r&&r!==n&&void 0!==n)return{row:s,col:o,reverse:n===w}}return null}(e);return t?$(e,{type:"toggle",...t}):{...e,auto:!1}}case"resize":{if(t.rows<2||t.cols<2)return e;const{numbers:o,solution:r}=j(t.rows,t.cols);return{grid:Array.from({length:t.rows},()=>Array(t.cols).fill(0)),numbers:o,solution:r,rows:t.rows,cols:t.cols,solved:!1,auto:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}case"new":{const{numbers:t,solution:o}=j(e.rows,e.cols);return{...e,grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:t,solution:o,solved:!1,auto:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return e}}function k(){const{height:v,width:x}=u(),b=i("sm"),[y,S]=e.useState(()=>{const e=localStorage.getItem("slant-size");return e&&"null"!==e?parseInt(e,10):5}),k=e.useMemo(()=>{const e=c(4,v-(b?64:80)-100,Math.min(x,1e3));let t=e.rows-1;const o=e.cols-1;return b&&(t-=2),{rows:Math.max(3,t),cols:Math.max(3,o)}},[v,x,b]),{rows:C,cols:E}=e.useMemo(()=>{const e=y??5;return{rows:Math.min(e,k.rows),cols:Math.min(e,k.cols)}},[y,k]),M=e.useMemo(()=>{const e=.95*Math.min(x,1200)/(E+1),t=.95*(v-160)/(C+1);return Math.min(e,t,100)/16},[x,v,C,E]),[z,A]=e.useReducer($,{rows:C,cols:E},e=>function(e,t){const{numbers:o,solution:r}=j(e,t);return{grid:Array.from({length:e},()=>Array(t).fill(0)),numbers:o,solution:r,rows:e,cols:t,solved:!1,auto:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}(e.rows,e.cols));e.useEffect(()=>{localStorage.setItem("slant-size",String(y))},[y]),e.useEffect(()=>{z.rows===C&&z.cols===E||A({type:"resize",rows:C,cols:E})},[C,E,z.rows,z.cols]),e.useEffect(()=>{document.title=o.slant},[]);const I=e.useCallback(()=>{A({type:"new"})},[A]);e.useEffect(()=>{if(z.solved){const e=setTimeout(()=>{I()},2e3);return()=>{clearTimeout(e)}}},[z.solved,I]);const[N,L]=e.useState(!1);e.useEffect(()=>{if(z.solved){const e=setTimeout(()=>{L(!0)},500);return()=>{clearTimeout(e)}}L(!1)},[z.solved]);const[D,R]=e.useState(null),T=e.useRef(new Set),_=e.useRef(0),G=e.useCallback(e=>{T.current.add(e)},[]);e.useEffect(()=>{const e=()=>{R(null),T.current.clear()},t=e=>{if(null===D)return;const t=e.touches[0];if(!t)return;const o=document.elementFromPoint(t.clientX,t.clientY);if(!o)return;const r=o.closest("[data-pos]");if(r){const e=r.getAttribute("data-pos");if(e&&!T.current.has(e)){const[t,o]=e.split(",").map(Number);void 0!==t&&void 0!==o&&(A({type:"toggle",row:t,col:o,reverse:2===D}),G(e))}}};return window.addEventListener("mouseup",e),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e),window.addEventListener("touchmove",t,{passive:!1}),()=>{window.removeEventListener("mouseup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),window.removeEventListener("touchmove",t)}},[D,G]);const P=.4*M,H=M-P;return e.useEffect(()=>{if(!z.auto||z.solved)return;const e=setTimeout(()=>{A({type:"nextLogical"})},300);return()=>{clearTimeout(e)}},[z.auto,z.solved,z.grid]),t.jsxs(f,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:`radial-gradient(circle at 50% 50%, ${r.surface.elevated} 0%, ${r.surface.background} 100%)`,position:"relative",overflow:"hidden",height:"100vh"},children:[t.jsx(a,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname"}),t.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:`${String(M)}rem`},children:t.jsxs(d,{children:[t.jsxs(d,{sx:{position:"relative",userSelect:"none"},children:[t.jsx(d,{sx:{position:"relative",zIndex:1},children:t.jsx(l,{size:M,rows:C,cols:E,cellProps:(e,o)=>{const n=z.grid[e]?.[o],s=`${String(e)},${String(o)}`,i=z.cycleCells.has(s);return{onMouseDown:t=>{z.solved||0!==t.button&&2!==t.button||Date.now()-_.current<500||(t.preventDefault(),R(t.button),A({type:"toggle",row:e,col:o,reverse:2===t.button}),G(s))},onMouseEnter:()=>{null===D||T.current.has(s)||z.solved||(A({type:"toggle",row:e,col:o,reverse:2===D}),G(s))},onContextMenu:e=>{e.preventDefault()},onTouchStart:t=>{z.solved||(t.cancelable&&t.preventDefault(),_.current=Date.now(),R(0),A({type:"toggle",row:e,col:o}),G(s))},"data-pos":s,sx:{cursor:"pointer",border:`1px solid ${r.border.subtle}`,position:"relative",transition:"all 0.2s",touchAction:"none","&:hover":{backgroundColor:r.interactive.hover}},children:t.jsxs(d,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===m&&t.jsx(d,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:i?r.data.red:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",transition:"all 0.2s"}}),n===w&&t.jsx(d,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:i?r.data.red:r.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",transition:"all 0.2s"}})]})}},space:0,sx:{width:"fit-content"}})}),t.jsx(d,{sx:{position:"absolute",top:0,left:0,transform:`translate(-${String(P/2)}rem, -${String(P/2)}rem)`,zIndex:10,pointerEvents:"none"},children:t.jsx(l,{size:P,rows:C+1,cols:E+1,cellProps:(e,o)=>{const n=z.numbers[e]?.[o],s=z.errorNodes.has(`${String(e)},${String(o)}`),i=z.satisfiedNodes.has(`${String(e)},${String(o)}`);return{children:t.jsx(d,{sx:{opacity:i&&!s?.2:1,transition:"opacity 0.3s"},children:n??""}),sx:{borderRadius:"50%",backgroundColor:s?r.data.red:r.surface.background,border:null!==n?`2px solid ${s?r.data.red:i?"transparent":r.border.subtle}`:"none",fontSize:`${String(.5*P)}rem`,fontWeight:"800",color:s?"#fff":r.text.primary,boxShadow:i&&!s?"none":"0 4px 8px rgba(0,0,0,0.1)",zIndex:5,opacity:null!==n?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(1.1)":"scale(1)",position:"relative"}}},space:H,sx:{width:"fit-content"}})})]}),t.jsx(d,{onClick:I,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:z.solved?1:0,transform:z.solved?"scale(1)":"scale(0.5)",visibility:z.solved?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:20,backgroundColor:"transparent",pointerEvents:N?"auto":"none",cursor:N?"pointer":"default",backdropFilter:"blur(2px)"},children:t.jsx(g,{sx:{fontSize:`${String(M)}rem`,color:r.primary.main,filter:`drop-shadow(0 0 30px ${r.primary.main}88)`,animation:z.solved?"float 3s ease-in-out infinite":"none","@keyframes float":{"0%, 100%":{transform:"translateY(0)"},"50%":{transform:"translateY(-10px)"}}}})})]})}),t.jsxs(n,{handler:()=>()=>{},onAutoPlay:()=>{A({type:"auto"})},autoPlayEnabled:z.auto,children:[t.jsx(s,{title:"Decrease Size",Icon:p,onClick:()=>{S(e=>e&&e>3?e-1:3)},disabled:C<=3}),t.jsx(s,{title:"Increase Size",Icon:h,onClick:()=>{S(e=>e?e+1:4)},disabled:C>=10||C>=k.rows&&E>=k.cols})]})]})}export{k as default};
