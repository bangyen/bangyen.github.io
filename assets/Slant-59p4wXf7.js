import{j as k,r as A,a as ve}from"./vendor_react-CiGj4Onb.js";import{u as Se,C as ue}from"./layout-BjJQiv_g.js";import{b as fe,g as D,f as Q,c as Ce,a as ke,h as Ee,d as je,G as Ie,e as Re,B as ze}from"./GamePageLayout-CD18ndsJ.js";import{e as Z,a as E,L as re,A as ee,S as ge,d as pe}from"./index-Br2Z899S.js";import{B as H}from"./vendor_mui_core-D3ATvS1w.js";import{u as Ae,v as Ne,f as Me,P as Te}from"./vendor_mui_icons-CkUhQDGV.js";import"./GlobalHeader-Dnao0l7Y.js";const j=1,T=2,te="18px",ne="24px",be="130%",he="6px",me="24px",$e=100,Oe=1e3,Be=1200,De=.98,He=100,Le=16,We=.8,Ue="slant-size",Pe="slant-state",Ge="slant-ghost-moves",se=0,Fe=3,Ve=5,we={WHITE:"#fff"},V={LINE:"0 2px 4px rgba(0,0,0,0.2)",HINT:"0 4px 8px rgba(0,0,0,0.1)"},G={BORDER:"var(--slant-ghost-border)",BG_SUBTLE:"var(--slant-ghost-bg-subtle)",BG_HOVER:"var(--slant-ghost-bg-hover)",DASHED_BORDER:"var(--slant-ghost-dashed-border)",HINT_BG:"var(--slant-ghost-hint-bg)",HINT_BORDER:"var(--slant-ghost-hint-border)",HINT_TEXT:"var(--slant-ghost-hint-text)"},qe=({onCopy:e,onClear:t,onClose:o})=>k.jsxs(H,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:re.zIndex.base+5,paddingBottom:2},children:[k.jsx(Z,{title:"Copy Board",Icon:Ae,onClick:e,sx:{backgroundColor:E.interactive.selected,color:E.primary.main,"&:hover":{backgroundColor:E.interactive.focus}}}),k.jsx(Z,{title:"Clear Calculator",Icon:Ne,onClick:t,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:E.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),k.jsx(Z,{title:"Close Calculator",Icon:Me,onClick:o,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:E.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]}),Je=({value:e,color:t})=>k.jsxs(H,{sx:{width:"100%",height:"100%",position:"relative"},children:[e===j&&k.jsx(H,{sx:{position:"absolute",width:be,height:he,backgroundColor:t,borderRadius:ge.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:V.LINE,transition:ee.transition,pointerEvents:"none"}}),e===T&&k.jsx(H,{sx:{position:"absolute",width:be,height:he,backgroundColor:t,borderRadius:ge.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:V.LINE,transition:ee.transition,pointerEvents:"none"}})]}),Ke=({value:e,hasConflict:t,numberSize:o})=>k.jsx(H,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:t?we.WHITE:G.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:t?"scale(1.1)":"scale(1)"},children:e??""}),Xe=({rows:e,cols:t,numbers:o,size:i,initialMoves:n,onMove:a,onCopy:u,onClear:p,onClose:f})=>{const c=Se("sm"),l=n,{getDragProps:r}=fe({onToggle:(h,R,s,w,N)=>{const z=D(h,R);if(!N)return void a(z,w);const M=l.get(z);let U;return U=s?M===j?T:M===T?void 0:j:M===T?j:M===j?void 0:T,a(z,U),U},touchTimeout:Q.timing.touchHoldDelay,checkEnabled:()=>!0}),[d,m]=A.useState(new Map),[x,S]=A.useState([]),[y,_]=A.useState(new Set),g=ve.useRef(null);A.useEffect(()=>{const h=new Worker(new URL("/assets/solverWorker-ApWikmtY.js",import.meta.url),{type:"module"});return g.current=h,h.onmessage=R=>{const s=R.data;if(s.type==="RESULT"){const{gridState:w,conflicts:N,cycleCells:z}=s.payload;m(w),S(N),_(z)}},()=>{h.terminate()}},[]),A.useEffect(()=>{g.current&&g.current.postMessage({type:"SOLVE",payload:{rows:e,cols:t,numbers:o,userMoves:l}})},[l,o,e,t]);const b=.4*i,v=i-b,I=A.useMemo(()=>new Set(x.filter(h=>h.type==="cell").map(h=>D(h.r,h.c))),[x]),O=A.useMemo(()=>new Set(x.filter(h=>h.type==="node").map(h=>D(h.r,h.c))),[x]),L=A.useCallback((h,R)=>{const s=D(h,R),w=d.get(s),N=(w==null?void 0:w.state)??0,z=w==null?void 0:w.source,M=I.has(s),U=y.has(s),P=r(s);let W=E.text.primary;return M?W=E.data.red:U?W=z==="user"?E.data.red:"#ff9800":z==="user"?W=E.primary.main:z==="propagated"&&(W=E.data.green),{...P,"data-pos":s,"data-type":"cell",sx:{...P.sx,cursor:"pointer",border:`1px solid ${G.BORDER}`,position:"relative",backgroundColor:G.BG_SUBTLE,"&:hover":{backgroundColor:G.BG_HOVER}},children:k.jsx(Je,{value:N,color:W})}},[d,I,y,r]),C=A.useCallback((h,R)=>{var N;const s=(N=o[h])==null?void 0:N[R],w=O.has(D(h,R));return{"data-pos":D(h,R),"data-type":"hint",children:k.jsx(Ke,{value:s??null,hasConflict:w,numberSize:b}),sx:{borderRadius:"50%",backgroundColor:w?E.data.red:G.HINT_BG,border:s!=null?`2px solid ${w?E.data.red:G.HINT_BORDER}`:"none",zIndex:5,opacity:s!=null?1:0,position:"relative",pointerEvents:"none"}}},[o,O,b]);return k.jsxs(H,{sx:{position:"relative",userSelect:"none"},children:[k.jsxs(H,{sx:{position:"relative",padding:c?`calc(${te} + 16px)`:`calc(${ne} + 24px)`,border:`2px dashed ${G.DASHED_BORDER}`,borderRadius:me},children:[k.jsx(H,{sx:{position:"relative",zIndex:re.zIndex.base+1},children:k.jsx(ue,{size:i,rows:e,cols:t,cellProps:L,space:0,sx:{width:"fit-content"}})}),k.jsx(H,{sx:{position:"absolute",top:c?`calc(${te} + 16px)`:`calc(${ne} + 24px)`,left:c?`calc(${te} + 16px)`:`calc(${ne} + 24px)`,transform:`translate(-${String(b/2)}rem, -${String(b/2)}rem)`,zIndex:re.zIndex.base+2,pointerEvents:"none"},children:k.jsx(ue,{size:b,rows:e+1,cols:t+1,cellProps:C,space:v,sx:{width:"fit-content"}})})]}),k.jsx(qe,{onCopy:u,onClear:p,onClose:f})]})};function q(e,t,o){const i=Array.from({length:t+1},()=>Array(o+1).fill(0));for(let n=0;n<t;n++){const a=e[n];if(a)for(let u=0;u<o;u++){const p=a[u];if(p===j){const f=i[n];if(f){const l=f[u+1];l!==void 0&&(f[u+1]=l+1)}const c=i[n+1];if(c){const l=c[u];l!==void 0&&(c[u]=l+1)}}else if(p===T){const f=i[n];if(f){const l=f[u];l!==void 0&&(f[u]=l+1)}const c=i[n+1];if(c){const l=c[u+1];l!==void 0&&(c[u+1]=l+1)}}}}return i}class ie{constructor(t){this.parent=Array.from({length:t},(o,i)=>i)}find(t){const o=this.parent[t];if(o===void 0)throw new Error(`DSU: Index ${String(t)} out of bounds`);o!==t&&(this.parent[t]=this.find(o));const i=this.parent[t];if(i===void 0)throw new Error(`DSU: Parent of ${String(t)} became undefined`);return i}union(t,o){const i=this.find(t),n=this.find(o);return i!==n&&(this.parent[i]=n,!0)}connected(t,o){return this.find(t)===this.find(o)}}function Ye(e,t,o){const i=(function(p,f){const c=f(1*p.length,1)>>>0;return K().set(p,c/1),Y=p.length,c})(e,$.__wbindgen_malloc),n=Y,a=$.find_cycles_wasm(i,n,t,o);var u=(function(p,f){p>>>=0;const c=ce(),l=[];for(let r=p;r<p+4*f;r+=4)l.push($.__wbindgen_externrefs.get(c.getUint32(r,!0)));return $.__externref_drop_slice(p,f),l})(a[0],a[1]).slice();return $.__wbindgen_free(a[0],4*a[1],4),u}function Qe(){return{__proto__:null,"./slant_wasm_bg.js":{__proto__:null,__wbg___wbindgen_debug_string_0bc8482c6e3508ae:function(e,t){const o=(function(n,a,u){if(u===void 0){const r=X.encode(n),d=a(r.length,1)>>>0;return K().subarray(d,d+r.length).set(r),Y=r.length,d}let p=n.length,f=a(p,1)>>>0;const c=K();let l=0;for(;l<p;l++){const r=n.charCodeAt(l);if(r>127)break;c[f+l]=r}if(l!==p){l!==0&&(n=n.slice(l)),f=u(f,p,p=l+3*n.length,1)>>>0;const r=K().subarray(f+l,f+p);l+=X.encodeInto(n,r).written,f=u(f,p,l,1)>>>0}return Y=l,f})(ae(t),$.__wbindgen_malloc,$.__wbindgen_realloc),i=Y;ce().setInt32(e+4,i,!0),ce().setInt32(e+0,o,!0)},__wbg___wbindgen_throw_be289d5034ed271b:function(e,t){throw new Error(xe(e,t))},__wbg_new_361308b2356cecd0:function(){return new Object},__wbg_new_3eb36ae241fe6f44:function(){return new Array},__wbg_set_3f1d0b984ed272ed:function(e,t,o){e[t]=o},__wbg_set_f43e577aea94465b:function(e,t,o){e[t>>>0]=o},__wbindgen_cast_0000000000000001:function(e){return e},__wbindgen_cast_0000000000000002:function(e,t){return xe(e,t)},__wbindgen_init_externref_table:function(){const e=$.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)}}}}function ae(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const n=e.description;return n==null?"Symbol":`Symbol(${n})`}if(t=="function"){const n=e.name;return typeof n=="string"&&n.length>0?`Function(${n})`:"Function"}if(Array.isArray(e)){const n=e.length;let a="[";n>0&&(a+=ae(e[0]));for(let u=1;u<n;u++)a+=", "+ae(e[u]);return a+="]",a}const o=/\[object ([^\]]+)\]/.exec(toString.call(e));let i;if(!(o&&o.length>1))return toString.call(e);if(i=o[1],i=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:i}let F=null;function ce(){return(F===null||F.buffer.detached===!0||F.buffer.detached===void 0&&F.buffer!==$.memory.buffer)&&(F=new DataView($.memory.buffer)),F}function xe(e,t){return(function(o,i){return le+=i,le>=Ze&&(oe=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),oe.decode(),le=i),oe.decode(K().subarray(o,o+i))})(e>>>=0,t)}let J=null;function K(){return J!==null&&J.byteLength!==0||(J=new Uint8Array($.memory.buffer)),J}let oe=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});oe.decode();const Ze=2146435072;let le=0;const X=new TextEncoder;"encodeInto"in X||(X.encodeInto=function(e,t){const o=X.encode(e);return t.set(o),{read:e.length,written:o.length}});let $,Y=0;function B(e,t,o){return e*(o+1)+t}function et(e,t,o){var p,f,c,l;const i=Array.from({length:t},()=>Array(o).fill(0)),n=new ie((t+1)*(o+1));let a=!0;for(;a;){a=!1;for(let r=0;r<=t;r++)for(let d=0;d<=o;d++){const m=(p=e[r])==null?void 0:p[d];if(m==null)continue;const x=[{gr:r-1,gc:d-1,pt:T},{gr:r-1,gc:d,pt:j},{gr:r,gc:d-1,pt:j},{gr:r,gc:d,pt:T}].filter(({gr:_,gc:g})=>_>=0&&_<t&&g>=0&&g<o);let S=0;const y=[];for(const _ of x){const g=(f=i[_.gr])==null?void 0:f[_.gc];g===0?y.push(_):g===_.pt&&S++}if(S===m&&y.length>0)for(const{gr:_,gc:g,pt:b}of y){const v=i[_];if((v==null?void 0:v[g])===0){const I=b===j?T:j;v[g]=I,a=!0;const O=B(_,I===j?g+1:g,o),L=B(_+1,I===j?g:g+1,o);if(n.connected(O,L))return!1;n.union(O,L)}}else if(S+y.length===m&&y.length>0)for(const{gr:_,gc:g,pt:b}of y){const v=i[_];if((v==null?void 0:v[g])===0){v[g]=b,a=!0;const I=B(_,b===j?g+1:g,o),O=B(_+1,b===j?g:g+1,o);if(n.connected(I,O))return!1;n.union(I,O)}}}if(!a)for(let r=0;r<t;r++)for(let d=0;d<o;d++){const m=i[r];if((m==null?void 0:m[d])!==0)continue;const x=B(r,d+1,o),S=B(r+1,d,o),y=n.connected(x,S),_=B(r,d,o),g=B(r+1,d+1,o),b=n.connected(_,g);if(y&&b)return!1;y?(m[d]=T,a=!0,n.union(_,g)):b&&(m[d]=j,a=!0,n.union(x,S))}}if(!i.every(r=>r.every(d=>d!==0)))return!1;const u=q(i,t,o);for(let r=0;r<=t;r++)for(let d=0;d<=o;d++){const m=(c=e[r])==null?void 0:c[d];if(m!=null&&((l=u[r])==null?void 0:l[d])!==m)return!1}return!0}function ye(e,t,o,i){var f;const n=e.map(c=>[...c]),a=[];for(let c=0;c<=t;c++)for(let l=0;l<=o;l++)a.push({r:c,c:l});for(let c=a.length-1;c>0;c--){const l=Math.floor(Math.random()*(c+1)),r=a[c],d=a[l];r&&d&&(a[c]=d,a[l]=r)}const u=Math.floor((t+1)*(o+1)*i);let p=0;for(let c=0;c<=t;c++)for(let l=0;l<=o;l++)((f=n[c])==null?void 0:f[l])!==null&&p++;for(const{r:c,c:l}of a){if(p<=u)break;const r=n[c];if(!r)continue;const d=r[l];d!=null&&(r[l]=null,et(n,t,o)?p--:r[l]=d)}return n}function tt(e,t){try{const n=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)),a=(function(u,p,f,c){return $.generate_puzzle_wasm(u,p,f,c)})(e,t,n,se);return{numbers:ye(a.numbers,e,t,se),solution:a.solution}}catch{}let o=[],i=!1;for(let n=0;n<50&&!i;n++){o=Array.from({length:e},()=>Array(t).fill(0));const a=new ie((e+1)*(t+1)),u=[];for(let f=0;f<e;f++)for(let c=0;c<t;c++)u.push({r:f,c});for(let f=u.length-1;f>0;f--){const c=Math.floor(Math.random()*(f+1)),l=u[f],r=u[c];l&&r&&(u[f]=r,u[c]=l)}let p=!1;for(const{r:f,c}of u){const l=B(f,c+1,t),r=B(f+1,c,t),d=a.connected(l,r),m=B(f,c,t),x=B(f+1,c+1,t),S=a.connected(m,x);if(d&&S){p=!0;break}const y=o[f];y&&(d?(y[c]=T,a.union(m,x)):S||Math.random()<.5?(y[c]=j,a.union(l,r)):(y[c]=T,a.union(m,x)))}p||(i=!0)}return i||(o=Array.from({length:e},(n,a)=>Array(t).fill(a%2==0?j:T))),{numbers:ye(q(o,e,t).map(n=>n.map(a=>a)),e,t,se),solution:o}}(async function(e){if($!==void 0)return $;e!==void 0&&Object.getPrototypeOf(e)===Object.prototype&&({module_or_path:e}=e),e===void 0&&(e=new URL("/assets/slant_wasm_bg-kZzm8ut6.wasm",import.meta.url));const t=Qe();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:o}=await(async function(i,n){if(typeof Response=="function"&&i instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(i,n)}catch(u){if(!i.ok||!(function(p){switch(p){case"basic":case"cors":case"default":return!0}return!1})(i.type)||i.headers.get("Content-Type")==="application/wasm")throw u}const a=await i.arrayBuffer();return await WebAssembly.instantiate(a,n)}{const a=await WebAssembly.instantiate(i,n);return a instanceof WebAssembly.Instance?{instance:a,module:i}:a}})(await e,t);return(function(i){return $=i.exports,F=null,J=null,$.__wbindgen_start(),$})(o)})().catch(e=>{});const nt=Ce({getInitialState:_e,customHandler:(e,t)=>{if(t.type==="toggle"){if(e.solved)return e;const{row:o,col:i}=t,n=e.grid.map(r=>[...r]),a=n[o];if(!a)return e;const u=a[i];if(u===void 0)return e;t.reverse?a[i]=u===0?j:u===j?T:0:a[i]=u===0?T:u===T?j:0;let p=!1;if(n.every(r=>r.every(d=>d!==0))){const r=q(n,e.rows,e.cols);e.numbers.every((d,m)=>d.every((x,S)=>{var y;return x==null||x===((y=r[m])==null?void 0:y[S])}))&&!(function(d,m,x){const S=new ie((m+1)*(x+1));for(let y=0;y<m;y++){const _=d[y];if(_)for(let g=0;g<x;g++){const b=_[g];if(b===void 0||b===0)continue;const v=B(y,b===j?g+1:g,x),I=B(y+1,b===j?g:g+1,x);if(!S.union(v,I))return!0}}return!1})(n,e.rows,e.cols)&&(p=!0)}const f=(function(r,d,m,x){var _,g;const S=new Set,y=q(r,m,x);for(let b=0;b<=m;b++)for(let v=0;v<=x;v++){const I=(_=d[b])==null?void 0:_[v];if(I==null)continue;const O=((g=y[b])==null?void 0:g[v])??0;O>I?S.add(D(b,v)):O+[{gr:b-1,gc:v-1},{gr:b-1,gc:v},{gr:b,gc:v-1},{gr:b,gc:v}].filter(({gr:L,gc:C})=>{var h;return L>=0&&L<m&&C>=0&&C<x&&((h=r[L])==null?void 0:h[C])===0}).length<I&&S.add(D(b,v))}return S})(n,e.numbers,e.rows,e.cols),c=(function(r,d,m){var v,I,O,L;try{const C=new Uint8Array(d*m);for(let R=0;R<d;R++)for(let s=0;s<m;s++)C[R*m+s]=((v=r[R])==null?void 0:v[s])??0;const h=Ye(C,d,m);if(h.length>0)return new Set(h)}catch{}const x=new Map,S=new Set;for(let C=0;C<d;C++)for(let h=0;h<m;h++){const R=(I=r[C])==null?void 0:I[h];if(!R||R===0)continue;const s=B(C,R===j?h+1:h,m),w=B(C+1,R===j?h:h+1,m);x.has(s)||x.set(s,[]),x.has(w)||x.set(w,[]),(O=x.get(s))==null||O.push({node:w,r:C,c:h}),(L=x.get(w))==null||L.push({node:s,r:C,c:h})}const y=new Set,_=new Set,g=[],b=(C,h)=>{y.add(C),_.add(C);const R=x.get(C)??[];for(const{node:s,r:w,c:N}of R)if(s!==h)if(_.has(s)){S.add(D(w,N));for(let z=g.length-1;z>=0;z--){const M=g[z];if(!M||(S.add(D(M.r,M.c)),M.u===s||M.v===s))break}}else y.has(s)||(g.push({r:w,c:N,u:C,v:s}),b(s,C),g.pop());_.delete(C)};for(const C of x.keys())y.has(C)||b(C,-1);return S})(n,e.rows,e.cols),l=(function(r,d,m,x){var _,g;const S=new Set,y=q(r,m,x);for(let b=0;b<=m;b++)for(let v=0;v<=x;v++){const I=(_=d[b])==null?void 0:_[v];I!=null&&(((g=y[b])==null?void 0:g[v])??0)===I&&S.add(D(b,v))}return S})(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:p,errorNodes:f,cycleCells:c,satisfiedNodes:l}}return e}});function _e(e,t){const{numbers:o,solution:i}=tt(e,t);return{grid:Array.from({length:e},()=>Array(t).fill(0)),numbers:o,solution:i,rows:e,cols:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}const ot=(e,t,o)=>(i,n)=>{var c;const a=(c=t.grid[i])==null?void 0:c[n],u=D(i,n),p=t.cycleCells.has(u),f=e(u);return{...f,sx:{...f.sx,cursor:"pointer",border:`1px solid ${E.border.subtle}`,position:"relative","&:hover":{backgroundColor:E.interactive.hover}},children:k.jsxs(H,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===j&&k.jsx(H,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,o))}px`,backgroundColor:p?E.data.red:E.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:V.LINE,transition:ee.transition,pointerEvents:"none"}}),a===T&&k.jsx(H,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,o))}px`,backgroundColor:p?E.data.red:E.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:V.LINE,transition:ee.transition,pointerEvents:"none"}})]})}};function rt(){const[e,t]=A.useState(!1),{rows:o,cols:i,state:n,dispatch:a,size:u,mobile:p,handleNext:f,controlsProps:c}=ke({storageKeys:{size:Ue,state:Pe},pageTitle:pe.slant,gridConfig:{defaultSize:Ve,minSize:Fe,headerOffset:Q.layout.headerHeight,paddingOffset:160,widthLimit:Oe,cellSizeReference:4,mobileRowOffset:-2},boardConfig:{paddingOffset:s=>({x:s?32:224,y:$e}),boardMaxWidth:Be,boardSizeFactor:De,maxCellSize:He,remBase:Le,rowOffset:1,colOffset:1},reducer:nt,getInitialState:(s,w)=>_e(s,w),winAnimationDelay:Q.timing.winAnimationDelay,isSolved:s=>s.solved,persistence:{enabled:!e,serialize:s=>({...s,errorNodes:Array.from(s.errorNodes),cycleCells:Array.from(s.cycleCells),satisfiedNodes:Array.from(s.satisfiedNodes)}),deserialize:s=>{const w=s;return{...w,errorNodes:new Set(w.errorNodes),cycleCells:new Set(w.cycleCells),satisfiedNodes:new Set(w.satisfiedNodes)}}}}),[l,r]=A.useState(new Map);Ee({storageKey:Ge,rows:o,cols:i,state:l,onRestore:s=>{r(s)},serialize:s=>Array.from(s.entries()),deserialize:s=>new Map(s)});const d=A.useRef("");A.useEffect(()=>{const s=JSON.stringify(n.numbers);d.current&&d.current!==s&&r(new Map),d.current=s},[n.numbers,n.rows,n.cols]);const m=f,{getDragProps:x}=fe({onToggle:(s,w,N)=>{a({type:"toggle",row:s,col:w,reverse:N})},checkEnabled:()=>!n.solved,touchTimeout:Q.timing.touchHoldDelay}),S=.4*u,y=je(ot,x,[n,u]),_=A.useMemo(()=>((s,w)=>(N,z)=>{var de;const M=(de=s.numbers[N])==null?void 0:de[z],U=D(N,z),P=s.errorNodes.has(U),W=s.satisfiedNodes.has(U);return{sx:{pointerEvents:"none"},children:k.jsx(H,{sx:{borderRadius:"50%",backgroundColor:P?E.data.red:E.surface.background,border:M!=null?`2px solid ${P?E.data.red:W?"transparent":E.border.subtle}`:"none",fontSize:`${String(.5*w)}rem`,fontWeight:"800",color:P?we.WHITE:W?E.interactive.disabledText:E.text.primary,boxShadow:W&&!P?"none":V.HINT,zIndex:5,opacity:M!=null?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:P?"scale(1.1)":"scale(1)",width:`${String(w)}rem`,height:`${String(w)}rem`},children:M??""})}})(n,S),[n,S]),g=A.useCallback((s,w)=>{r(N=>{const z=new Map(N);return w===void 0?z.delete(s):z.set(s,w),z})},[]),b=A.useCallback(()=>{const s=new Map;n.grid.forEach((w,N)=>{w.forEach((z,M)=>{z!==0&&s.set(D(N,M),z)})}),r(s)},[n.grid]),v=A.useCallback(()=>{r(new Map)},[]),I=A.useCallback(()=>{t(!1)},[]),O=A.useCallback(s=>{s.stopPropagation()},[]),L=A.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${E.surface.elevated} 0%, ${E.surface.background} 100%)`,padding:p?"1rem":"2rem"}),[p]),C=A.useMemo(()=>({userSelect:"none",padding:p?te:ne,border:"2px solid transparent",borderRadius:me}),[p]),h=e?k.jsx(k.Fragment,{}):k.jsx(Re,{...c,disabled:e,children:k.jsx(Z,{title:"Open Calculator",Icon:Te,onClick:()=>{t(!e)},sx:{color:"default"}})}),R=e?k.jsx(Xe,{rows:o,cols:i,numbers:n.numbers,size:u,initialMoves:l,onMove:g,onCopy:b,onClear:v,onClose:I}):k.jsx(ze,{size:u,rows:o+1,cols:i+1,frontProps:_,backProps:y,frontLayerSx:{pointerEvents:"none"}});return k.jsx(Ie,{title:pe.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:h,contentSx:L,showTrophy:!e&&n.solved,onReset:m,boardSize:u,iconSizeRatio:We,primaryColor:E.primary.main,secondaryColor:E.primary.main,boardSx:C,children:k.jsx(H,{onClick:O,children:R})})}export{rt as default};
