import{r as e,j as t,a as o}from"./vendor_react-De-BR_RD.js";import{s as n,t as r,P as s}from"./PageLayout-Dmp8Me6n.js";import{g as i,G as a,T as l,a as c,L as d,S as u,c as f,A as m,R as h,b as g,d as p,C as x,u as b}from"./index-DqQpo8Wx.js";import{B as S,P as w,G as z,T as y}from"./vendor_mui_core-CNzb-YrG.js";import{f as v,A as O,M,E as R}from"./vendor_mui_icons-B5ml2Me4.js";import{a as D,u as j}from"./lazyNamed-CyJ53iul.js";const C=e.memo(function({size:o,children:r,...s}){const i=`${o.toString()}rem`,d=`${(o/a.cellSize.divisor).toString()}rem`,{backgroundColor:u,color:f,boxShadow:m,border:h,opacity:g,transition:p=!0,sx:x,...b}=s,w=!1===p?"none":"string"==typeof p?p:"background-color 200ms ease, color 200ms ease, opacity 200ms ease, transform 200ms ease, border-radius 200ms ease",z=e.useMemo(()=>({...c.flexCenter,borderRadius:d,height:i,width:i,fontSize:`${(o*a.cellSize.fontSizeMultiplier).toString()}rem`,fontWeight:l.fontWeight.semibold,fontFamily:"monospace"}),[d,i,o]);return t.jsx(S,{role:"gridcell",...z,...b,sx:{backgroundColor:u,color:f,boxShadow:m,border:h,opacity:g,transition:w,...n(x)},children:r})}),I=e.memo(function({cols:o,size:n,index:r,spacing:s,cellProps:i}){return t.jsx(S,{role:"row",sx:{display:"flex",gap:s,justifyContent:"center"},children:Array.from({length:o},(t,o)=>e.createElement(C,{...i(r,o),key:`${r.toString()}_${o.toString()}`,size:n}))})}),E=e.memo(function({size:e,rows:o,cols:r,cellProps:s,space:a,sx:l,...c}){const d=i(e),u=`${(a??d).toString()}rem`;return t.jsx(S,{role:"grid","aria-label":`Grid with ${o.toString()} rows and ${r.toString()} columns`,sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:u,...n(l)},...c,children:Array.from({length:o},(o,n)=>t.jsx(I,{index:n,cols:r,size:e,spacing:u,cellProps:s},`row_${n.toString()}`))})}),k=o.memo(function(e){const{overlayProps:o,cellProps:r,size:s,rows:i,cols:a,cellRows:l=i,cellCols:c=a,overlayLayerSx:u,cellLayerSx:f,overlayDecorative:m=!1,cellDecorative:h=!1}=e;return t.jsxs(S,{sx:{display:"grid",placeItems:"center"},children:[t.jsx(S,{sx:{gridArea:"1/1",...n(f)},children:t.jsx(E,{space:0,size:s,rows:l,cols:c,cellProps:r,...h?{role:"presentation","aria-hidden":!0}:{}})}),t.jsx(S,{sx:{gridArea:"1/1",zIndex:d.zIndex.base+1,...n(u)},children:t.jsx(E,{space:0,size:s,rows:i,cols:a,cellProps:o,...m?{role:"presentation","aria-hidden":!0}:{}})})]})});function P({children:e,...o}){return t.jsx(w,{elevation:0,component:"nav",role:"navigation","aria-label":"Game controls navigation",onClick:e=>{e.stopPropagation()},sx:{transform:"translateX(-50%)",position:"absolute",bottom:u.padding.xl,left:"50%",zIndex:d.zIndex.navigation,...m.presets.glass,borderRadius:u.borderRadius.lg,boxShadow:f.lg,padding:`${u.padding.sm} ${u.padding.lg}`,...o},children:t.jsx(z,{container:!0,spacing:2,sx:{...c.flexCenter,flexWrap:"nowrap",minWidth:0},children:e})})}const T=o.memo(function({rows:e,cols:o,dynamicSize:n,minSize:r,maxSize:s,handlePlus:i,handleMinus:a,onRefresh:l,disabled:c=!1,onOpenInfo:d,hidden:u=!1,children:f}){if(u)return null;const m=Math.min(e,o)<=r,p=Math.min(e,o)>=s||Math.min(e,o)>=Math.min(n.rows,n.cols);return t.jsxs(P,{children:[t.jsx(h,{onClick:l}),t.jsx(g,{title:"Decrease Size",Icon:v,onClick:a,disabled:c||m}),t.jsx(g,{title:"Increase Size",Icon:O,onClick:i,disabled:c||p}),d&&t.jsx(g,{title:"How to Play",Icon:M,onClick:d}),f]})}),A={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}},$={PADDING:{MOBILE:"30px",DESKTOP:"36px"},BORDER_RADIUS:"24px",BORDER:"2px solid transparent",SHADOW:"0 2px 4px rgba(0,0,0,0.2)",DROP_SHADOW:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"};function L(e){return{SIZE:`${e}-size`,STATE:`${e}-state`}}const B={paddingOffset:0,boardMaxWidth:1200,boardSizeFactor:.94,maxCellSize:80,remBase:16},N={defaultSize:null,minSize:3,maxSize:10,mobileRowOffset:2,headerOffset:A.layout.headerHeight,paddingOffset:0,widthLimit:1300,cellSizeReference:{mobile:A.gridSizes.mobile,desktop:A.gridSizes.desktop}},W=(e,t)=>[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:e},...r(t)],_=e=>[{position:"relative",width:"fit-content",userSelect:"none",padding:{xs:$.PADDING.MOBILE,sm:$.PADDING.DESKTOP},borderRadius:$.BORDER_RADIUS,border:$.BORDER},...r(e)];function G({show:e=!1,onReset:o,size:n=0,iconSizeRatio:r=1,primaryColor:s=x.primary.main,secondaryColor:i=x.primary.main,useSecondary:a=!1,showLabel:l=!0}){const c=a?i:s;return t.jsx(S,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:10,backgroundColor:"transparent",pointerEvents:"none"},children:n>0&&t.jsxs(p,{padding:u.padding.md,sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1.5,height:"auto",width:"auto",maxWidth:"80%"},children:[t.jsx(R,{sx:{fontSize:`${(n*r*.6).toString()}rem`,color:c,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}}),l&&t.jsx(y,{variant:"h6",sx:{color:x.text.primary,fontWeight:600,letterSpacing:"0.02em"},children:"Solved!"})]})})}function H({children:e,controls:o,infoUrl:n,title:r,background:i=x.surface.background,trophyProps:a={},layout:l={},onClick:c}){const{paddingBottom:d={xs:"80px",md:"120px"},contentSx:u={},boardSx:f}=l;return t.jsxs(s,{title:r,infoUrl:n,background:i,containerSx:{height:"100vh",transition:"background 0.5s ease-in-out",cursor:c?"pointer":"inherit"},sx:{justifyContent:"center",alignItems:"center"},onClick:c,children:[t.jsx(S,{sx:W(d,u),children:t.jsxs(S,{sx:_(f),children:[e,t.jsx(G,{...a})]})}),o]})}function K(e,t){return`${e.toString()},${t.toString()}`}function F(e){return(t,o)=>{if(e.customHandler){const n=e.customHandler(t,o);if(n!==t)return n}switch(o.type){case"resize":if("newRows"in o||"rows"in o||"cols"in o){const n=o.newRows??o.rows??t.rows,r=o.newCols??o.cols??t.cols;return n===t.rows&&r===t.cols?t:e.getInitialState(n,r)}return t;case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return"state"in o?o.state:t;default:return t}}}function U(t,o,n){return e.useMemo(()=>t(o,...n),[t,o,...n])}const J=e=>{if(e<1||e>100)throw new Error("Invalid grid size: must be between 1 and 100");return e},X=e=>{if(e<0)throw new Error("Invalid cell index: cannot be negative");return e};function Z(t){const o=e.useRef(t);return o.current=t,e.useCallback((...e)=>o.current(...e),[])}function Y({checkEnabled:t=()=>!0,touchTimeout:o=500,posAttribute:n="data-pos",preventDefault:r=!0,transition:s="all 0.2s",...i}){const a=e.useRef(void 0),l=e.useRef(i.onToggle);l.current=i.onToggle;const c=void 0!==i.onToggle,d=i.onAction,u=e.useMemo(()=>!c&&d?d:(e,o,n)=>{if(!t())return;const r=l.current;if(!r)return;const[s,i]=e.split(",").map(Number);void 0!==s&&void 0!==i&&(n?a.current=r(s,i,o,void 0,!0):r(s,i,o,a.current,!1))},[c,d,t]),[f,m]=e.useState(null),h=e.useRef(new Set),g=e.useRef(0),p=e.useCallback(()=>{m(null),h.current.clear()},[]),x=e.useCallback(e=>{if(null===f)return;const t=e.touches[0];if(!t)return;const o=document.elementFromPoint(t.clientX,t.clientY);if(!o)return;const r=o.closest(`[${n}]`);if(r){const e=r.getAttribute(n);e&&!h.current.has(e)&&(u(e,2===f,!1),h.current.add(e))}},[f,u,n]);e.useEffect(()=>(globalThis.addEventListener("mouseup",p),globalThis.addEventListener("touchend",p),globalThis.addEventListener("touchcancel",p),globalThis.addEventListener("touchmove",x,{passive:!1}),()=>{globalThis.removeEventListener("mouseup",p),globalThis.removeEventListener("touchend",p),globalThis.removeEventListener("touchcancel",p),globalThis.removeEventListener("touchmove",x)}),[p,x]);const b=e.useCallback(e=>({onMouseDown:n=>{t()&&(0!==n.button&&2!==n.button||Date.now()-g.current<o||(r&&n.preventDefault(),m(n.button),u(e,2===n.button,!0),h.current.add(e)))},onMouseEnter:()=>{null!==f&&!h.current.has(e)&&t()&&(u(e,2===f,!1),h.current.add(e))},onTouchStart:o=>{t()&&(o.cancelable&&r&&o.preventDefault(),g.current=Date.now(),m(0),u(e,!1,!0),h.current.add(e))},onKeyDown:o=>{t()&&("Enter"!==o.key&&" "!==o.key||(o.preventDefault(),u(e,!1,!0)))},onContextMenu:e=>{r&&e.preventDefault()},[n]:e,role:"button",tabIndex:0,sx:{touchAction:"none",transition:s}}),[u,t,f,o,n,r,s]);return{isDragging:null!==f,draggingButton:f,getDragProps:b,lastTouchTime:g}}function q({rows:t,cols:o,width:n,height:r,mobile:s,headerOffset:i,boardConfig:a}){return e.useMemo(()=>{const e="function"==typeof a.paddingOffset?a.paddingOffset(s):a.paddingOffset;return function({rows:e,cols:t,width:o,height:n,mobile:r,headerOffset:s,paddingOffset:i,boardMaxWidth:a,boardSizeFactor:l,maxCellSize:c,remBase:d}){const u=r?s.mobile:s.desktop,f="number"==typeof i?0:i.x,m="number"==typeof i?i:i.y,h=(Math.min(o,a)-f)*l,g=(n-u-m)*l;return Math.min(h/t,g/e,c)/d}({rows:t+(a.rowOffset??0),cols:o+(a.colOffset??0),width:n,height:r,mobile:s,headerOffset:i,...a,paddingOffset:e})},[t,o,n,r,s,i,a])}function Q({storageKey:t,rows:o,cols:n,state:r,onRestore:s,serialize:i,deserialize:a,enabled:l=!0,saveDebounceMs:c=300}){const d=`${t}-${String(o)}x${String(n)}`,u=Z(s),f=Z(i??(e=>e)),m=Z(a??(e=>e));var h,g,p;e.useEffect(()=>{if(!l)return;const e=localStorage.getItem(d);if(e)try{const t=JSON.parse(e);u(m(t))}catch{localStorage.removeItem(d)}},[d,l,u,m]),h=()=>{if(!l)return;const e=f(r);localStorage.setItem(d,JSON.stringify(e))},g=c,p=[d,r,l,f],e.useEffect(()=>{const e=setTimeout(h,g);return()=>{clearTimeout(e)}},[...p,g])}function V({storageKey:t,defaultSize:o,minSize:n=2,maxSize:r=10,headerOffset:s,paddingOffset:i=0,widthLimit:a=1300,cellSizeReference:l,mobileRowOffset:c=0}){const{height:d,width:u}=D(),f=j("sm"),[m,h]=b(t,o,{serialize:String,deserialize:e=>{if("null"===e)return null;const t=Number.parseInt(e,10);return Number.isNaN(t)?void 0:t}}),g=e.useMemo(()=>{const e=f?s.mobile:s.desktop,t="number"==typeof l?l:f?l.mobile:l.desktop,o="number"==typeof i?0:i.x,r="number"==typeof i?i:i.y,m=function(e,t,o){const n=16*e;return{rows:Math.floor(t/n),cols:Math.floor(o/n)}}(t,d-e-r,Math.min(u,a)-o);let h=m.rows-1;const g=m.cols-1;return f&&(h+=c),{rows:Math.max(n,h),cols:Math.max(n,g)}},[l,d,u,f,s,i,a,n,c]),{rows:p,cols:x}=e.useMemo(()=>{if(null===m)return g;const e=f?Math.max(0,c+1):0;return{rows:Math.min(m+e,g.rows),cols:Math.min(m,g.cols)}},[m,g,f,c]);return{rows:p,cols:x,dynamicSize:g,handlePlus:()=>{const e=Math.min(p,x);null!==m&&e<Math.min(g.rows,g.cols)&&e<r&&h(e+1)},handleMinus:()=>{const e=Math.min(p,x);if(null===m){const e=Math.min(g.rows,g.cols);g.rows===g.cols?h(Math.max(n,e-1)):h(e)}else e>n&&h(e-1)},desiredSize:m,setDesiredSize:h,mobile:f,width:u,height:d,minSize:n,maxSize:r}}function ee(e,t){return{...e,...Object.fromEntries(Object.entries(t).filter(([,e])=>void 0!==e))}}function te({storageKey:t,grid:o={},board:n={},logic:r}){const s=L(t),{reducer:i,getInitialState:a,isSolved:l,winAnimationDelay:c=A.timing.winAnimationDelay,persistence:d,manualResize:u=!1,onNext:f}=r,m=ee(N,{defaultSize:o.defaultSize,minSize:o.minSize,maxSize:o.maxSize,headerOffset:o.headerOffset,paddingOffset:o.gridPadding,widthLimit:o.widthLimit,cellSizeReference:o.cellSizeReference,mobileRowOffset:o.mobileRowOffset}),h=e.useMemo(()=>({...ee(B,{paddingOffset:n.boardPadding,boardMaxWidth:n.boardMaxWidth,boardSizeFactor:n.boardSizeFactor,maxCellSize:n.maxCellSize,remBase:n.remBase}),rowOffset:n.rowOffset,colOffset:n.colOffset}),[n.boardPadding,n.boardMaxWidth,n.boardSizeFactor,n.maxCellSize,n.remBase,n.rowOffset,n.colOffset]),{rows:g,cols:p,dynamicSize:x,handlePlus:b,handleMinus:S,mobile:w,width:z,height:y,minSize:v,maxSize:O}=V({storageKey:s.SIZE,...m}),M=e.useRef(null);null===M.current&&(M.current=a(g,p));const[R,D]=e.useReducer(i,M.current),j=e.useMemo(()=>l(R),[R,l]),C=e.useCallback(()=>{D({type:"new"})},[D]),I=f??C;Q({storageKey:s.STATE,rows:g,cols:p,state:R,onRestore:e=>{D({type:"hydrate",state:e})},...d}),function(t,o,n=2e3){const r=Z(o);e.useEffect(()=>{if(t){const e=setTimeout(()=>{r()},n);return()=>{clearTimeout(e)}}},[t,n,r])}(j,I,c),e.useEffect(()=>{u||D({type:"resize",rows:g,cols:p,newRows:g,newCols:p})},[g,p,D,u]);const E=q({rows:g,cols:p,width:z,height:y,mobile:w,headerOffset:m.headerOffset,boardConfig:h});return{rows:g,cols:p,state:R,dispatch:D,size:E,mobile:w,solved:j,handleNext:I,controlsProps:{rows:g,cols:p,dynamicSize:x,minSize:v,maxSize:O,handlePlus:b,handleMinus:S,onRefresh:I}}}export{$ as B,E as C,A as G,G as T,J as a,k as b,F as c,U as d,te as e,X as f,K as g,H as h,T as i,L as j,Q as k,Y as u};
