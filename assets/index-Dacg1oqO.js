import{r as e,j as o}from"./vendor_react-WaSaIrII.js";import{g as r,a as t,u as s,C as n,G as a}from"./CustomGrid-BLg5c2jn.js";import{u as i,G as c}from"./gameConfig-CQ15qQC4.js";import{d as l,a as f,C as u,L as d}from"./index-DGYDW4UN.js";import{G as m}from"./GlobalHeader-ixUoYs4a.js";import{u as h,a as p}from"./useTimer-DNifX3C9.js";import{F as g}from"./vendor_mui_icons-CSVaq0bZ.js";import{G as b,k as y}from"./vendor_mui_core-nu70VYgB.js";function k(e){return Math.floor(Math.random()*e)}function w(e,o){const r={};for(const t in e){const s=e[t];s+o>0?r[t]=s+o:s<0&&(r[t]=s)}return r}function x(e,o,r){const t=o*r,s=k(t);let n=k(t);return s===n&&(n=++n%t),{...e,rows:o,cols:r,head:s,board:{[s]:e.length,[n]:-1}}}function v(e){let{board:o,length:r,head:s,velocity:n,buffer:a}=e;const{rows:i,cols:c}=e,l=i*c;if(o=w(o,-1),s=t(s,n,i,c),s in o){const e=o[s];o[s]=r,e>0?o=w(o,-e):(o=w(o,1),o=function(e,o){let r=k(e);for(;r in o;)++r>=e&&(r=0);return{...o,[r]:-1}}(l,o)),r=o[s]}else o[s]=r;if(a.length){const[e,...o]=a;a=o,n+e&&(n=e)}return{...e,length:r,board:o,head:s,velocity:n,buffer:a}}function j(e,o){switch(o.type){case"resize":{const{rows:r,cols:t}=o.payload;return x(e,r,t)}case"steer":{const{payload:t}=o,s=r(t.key);let{buffer:n}=e;return s&&(n=[...n,s]),{...e,buffer:n}}case"move":return v(e);default:return e}}const C=y`
  0% { transform: scale(0.8) rotate(0deg); }
  50% { transform: scale(1.1) rotate(180deg); }
  100% { transform: scale(0.8) rotate(360deg); }
`;function z(){const{create:r}=h(0),{create:y}=p(),k=s("sm"),{height:w,width:v}=i(),z=c.snake.initialLength,M=k?c.gridSizes.mobile:c.gridSizes.desktop,{rows:_,cols:G}=e.useMemo(()=>{const e=k?d.headerHeight.xs:d.headerHeight.md,o=w-e,r=M*a.calculation.pixelMultiplier;return{rows:Math.floor(o/r),cols:Math.floor(v/r)}},[M,w,v,k]),S=e.useMemo(()=>({velocity:c.snake.initialVelocity,buffer:[],length:z,rows:0,cols:0,head:0,board:{}}),[z]),[H,E]=e.useReducer(j,x(S,_,G)),P=e.useCallback(e=>{const{clientX:o,clientY:r}=e,t=o-v/2,s=r-w/2,n=H.buffer.length>0?H.buffer[H.buffer.length-1]:H.velocity;let a="";a=2===Math.abs(n)?t>0?"right":"left":s>0?"down":"up";const i=c.controls.arrowPrefix+a;E({type:"steer",payload:{key:i}})},[E,H.velocity,H.buffer,v,w]),D=e.useCallback((e,r)=>{const s=e*G+r,n=H.board;let i="inherit";s in n&&(i=n[s]>0?f.primary.main:f.primary.dark);const c=t(s,-2,_,G),l=t(s,2,_,G),u=t(s,-1,_,G),d=t(s,1,_,G),m=n[c]>0,h=n[l]>0,p=n[u]>0,b=n[d]>0,y=M/a.cellSize.divisor+"rem";if("inherit"===i)return{backgroundColor:i};if(-1===n[s])return{backgroundColor:"transparent",children:o.jsx(g,{sx:{color:i,fontSize:.7*M+"rem",animation:`${C} 2s infinite ease-in-out`}})};const k=[0,0,0,0];m||p||(k[0]=1),m||b||(k[1]=1),h||b||(k[2]=1),h||p||(k[3]=1);const w=k.map(e=>e?y:"0").join(" ");return{backgroundColor:i,boxShadow:`0 0 1.25rem ${i.replace("hsl","hsla").replace(")",", 0.25)")}`,borderRadius:w}},[H,_,G,M]);return e.useEffect(()=>{r({repeat:()=>{E({type:"move"})},speed:100}),y(e=>E({type:"steer",payload:e}))},[r,y]),e.useEffect(()=>{E({type:"resize",payload:{rows:_,cols:G}})},[_,G,E]),e.useEffect(()=>{document.title=l.snake},[]),o.jsxs(b,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:f.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[o.jsx(m,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),o.jsx(b,{flex:1,onPointerDown:P,sx:{...u.flexCenter,zIndex:1},children:o.jsx(n,{size:M,rows:_,cols:G,space:0,cellProps:(e,o)=>({...D(e,o),transition:!1})})})]})}export{z as default};
