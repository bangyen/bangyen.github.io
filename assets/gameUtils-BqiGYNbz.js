import{j as w,r as t}from"./vendor_react-BC_ZxTUy.js";import{C as Y,u as F,c as ne}from"./layout-B0wDzl-L.js";import{L as oe,f as se,e as _,a as re}from"./index-DxkDet3P.js";import{B as P,G as ie}from"./vendor_mui_core-BH2K4FI9.js";import{w as ae,x as ce,E as le}from"./vendor_mui_icons-DLCmcMzz.js";import{G as ue}from"./GlobalHeader-C14muTK7.js";function de(e){const{frontProps:n,backProps:a,size:r,rows:u,cols:d,frontLayerSx:o,backLayerSx:f}=e;return w.jsxs(P,{sx:{display:"grid",placeItems:"center"},children:[w.jsx(P,{sx:{gridArea:"1/1",...f},children:w.jsx(Y,{space:0,size:r,rows:u-1,cols:d-1,cellProps:a})}),w.jsx(P,{sx:{gridArea:"1/1",zIndex:oe.zIndex.base+1,...o},children:w.jsx(Y,{space:0,size:r,rows:u,cols:d,cellProps:n})})]})}function fe({rows:e,cols:n,dynamicSize:a,minSize:r,maxSize:u,handlePlus:d,handleMinus:o,onRefresh:f,disabled:m=!1,children:c}){const i=e<=r&&n<=r,p=e>=u&&n>=u||e===a.rows&&n===a.cols;return w.jsxs(se,{onRefresh:f,children:[w.jsx(_,{title:"Decrease Size",Icon:ae,onClick:o,disabled:m||i}),w.jsx(_,{title:"Increase Size",Icon:ce,onClick:d,disabled:m||p}),c]})}const me={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}};function q(){const[e,n]=t.useState({height:window.innerHeight,width:window.innerWidth});return t.useEffect(()=>{const a=()=>{n({height:window.innerHeight,width:window.innerWidth})};return window.addEventListener("resize",a),()=>{window.removeEventListener("resize",a)}},[]),e}function Q({onAction:e,checkEnabled:n=()=>!0,touchTimeout:a=500,posAttribute:r="data-pos",preventDefault:u=!0,transition:d="all 0.2s"}){const[o,f]=t.useState(null),m=t.useRef(new Set),c=t.useRef(0),i=t.useCallback(()=>{f(null),m.current.clear()},[]),p=t.useCallback(l=>{if(o===null)return;const s=l.touches[0];if(!s)return;const v=document.elementFromPoint(s.clientX,s.clientY);if(!v)return;const D=v.closest(`[${r}]`);if(D){const I=D.getAttribute(r);I&&!m.current.has(I)&&(e(I,o===2,!1),m.current.add(I))}},[o,e,r]);t.useEffect(()=>(window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),window.addEventListener("touchmove",p,{passive:!1}),()=>{window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),window.removeEventListener("touchmove",p)}),[i,p]);const b=t.useCallback(l=>({onMouseDown:s=>{n()&&(s.button!==0&&s.button!==2||Date.now()-c.current<a||(u&&s.preventDefault(),f(s.button),e(l,s.button===2,!0),m.current.add(l)))},onMouseEnter:()=>{o!==null&&!m.current.has(l)&&n()&&(e(l,o===2,!1),m.current.add(l))},onTouchStart:s=>{n()&&(s.cancelable&&u&&s.preventDefault(),c.current=Date.now(),f(0),e(l,!1,!0),m.current.add(l))},onContextMenu:s=>{u&&s.preventDefault()},[r]:l,sx:{touchAction:"none",transition:d}}),[e,n,o,a,r,u,d]);return{isDragging:o!==null,draggingButton:o,getDragProps:b,lastTouchTime:c}}function V({storageKey:e,rows:n,cols:a,state:r,onRestore:u,serialize:d,deserialize:o,enabled:f=!0,saveDebounceMs:m=300}){const c=`${e}-${String(n)}x${String(a)}`,i=t.useRef(u),p=t.useRef(o),b=t.useRef(d);t.useEffect(()=>{i.current=u,p.current=o,b.current=d}),t.useEffect(()=>{if(!f)return;const l=localStorage.getItem(c);if(l)try{const s=JSON.parse(l),v=p.current??(D=>D);i.current(v(s))}catch{localStorage.removeItem(c)}},[c,f]),t.useEffect(()=>{if(!f)return;const l=setTimeout(()=>{const s=(b.current??(v=>v))(r);localStorage.setItem(c,JSON.stringify(s))},m);return()=>{clearTimeout(l)}},[c,r,f,m])}function he({storageKeys:e,pageTitle:n,gridConfig:a,boardConfig:r,reducer:u,getInitialState:d,winAnimationDelay:o,isSolved:f,persistence:m}){const{rows:c,cols:i,dynamicSize:p,handlePlus:b,handleMinus:l,mobile:s,minSize:v,maxSize:D}=(function({storageKey:x,defaultSize:R,minSize:g=2,maxSize:S=10,headerOffset:M,paddingOffset:A=0,widthLimit:$=1300,cellSizeReference:E,mobileRowOffset:H=0}){const{height:O,width:L}=q(),j=F("sm"),[y,k]=t.useState(()=>{const z=localStorage.getItem(x);return z==="null"?null:z?parseInt(z,10):R}),h=t.useMemo(()=>{const z=j?M.mobile:M.desktop,N=typeof E=="number"?E:j?E.mobile:E.desktop,U=ne(N,O-z-A,Math.min(L,$));let X=U.rows-1;const te=U.cols-1;return j&&(X+=H),{rows:Math.max(g,X),cols:Math.max(g,te)}},[E,O,L,j,M,A,$,g,H]),{rows:T,cols:K}=t.useMemo(()=>y===null?h:{rows:Math.min(y,h.rows),cols:Math.min(y,h.cols)},[y,h]);return t.useEffect(()=>{localStorage.setItem(x,String(y))},[y,x]),{rows:T,cols:K,dynamicSize:h,handlePlus:()=>{const z=Math.min(T,K);y!==null&&(z<Math.min(h.rows,h.cols)?k(z+1):h.rows===h.cols||T===h.rows&&K===h.cols||k(null))},handleMinus:()=>{const z=Math.min(T,K);if(y===null){const N=Math.min(h.rows,h.cols);h.rows===h.cols?k(Math.max(g,N-1)):k(N)}else z>g&&k(z-1)},desiredSize:y,setDesiredSize:k,mobile:j,width:L,height:O,minSize:g,maxSize:S}})({storageKey:e.size,...a}),I=t.useMemo(()=>d(c,i),[c,i,d]),[B,C]=t.useReducer(u,I),J=t.useMemo(()=>f(B),[B,f]),G=t.useCallback(()=>{C({type:"new"})},[C]);var W;V({storageKey:e.state,rows:c,cols:i,state:B,onRestore:x=>{C({type:"restore",state:x}),C({type:"hydrate",state:x})},...m}),(function(x,R,g=2e3){const S=t.useRef(R);S.current=R,t.useEffect(()=>{if(x){const M=setTimeout(()=>{S.current()},g);return()=>{clearTimeout(M)}}},[x,g])})(J,G,o),W=n,t.useEffect(()=>{document.title=W},[W]),t.useEffect(()=>{C({type:"resize",rows:c,cols:i,newRows:c,newCols:i})},[c,i,C]);const Z=t.useMemo(()=>typeof r.paddingOffset=="function"?r.paddingOffset(s):r.paddingOffset,[r,s]),ee=(function({rows:x,cols:R,headerOffset:g,paddingOffset:S,boardMaxWidth:M,boardSizeFactor:A,maxCellSize:$,remBase:E}){const{width:H,height:O}=q(),L=F("sm");return t.useMemo(()=>{const j=L?g.mobile:g.desktop,y=typeof S=="number"?0:S.x,k=typeof S=="number"?S:S.y,h=(Math.min(H,M)-y)*A,T=(O-j-k)*A;return Math.min(h/R,T/x,$)/E},[H,O,L,x,R,g,S,M,A,$,E])})({rows:c+(r.rowOffset??0),cols:i+(r.colOffset??0),headerOffset:a.headerOffset,...r,paddingOffset:Z});return{rows:c,cols:i,state:B,dispatch:C,size:ee,mobile:s,solved:J,handleNext:G,controlsProps:{rows:c,cols:i,dynamicSize:p,minSize:v,maxSize:D,handlePlus:b,handleMinus:l,onRefresh:G}}}function we({onToggle:e,checkEnabled:n,touchTimeout:a,transition:r,posAttribute:u}){const d=t.useRef(void 0),o=t.useRef(e);o.current=e;const f=t.useCallback((c,i,p)=>{if(!n())return;const[b,l]=c.split(",").map(Number);b!==void 0&&l!==void 0&&(p?d.current=o.current(b,l,i,void 0,!0):o.current(b,l,i,d.current,!1))},[n]),{getDragProps:m}=Q({onAction:f,checkEnabled:n,touchTimeout:a,transition:r,posAttribute:u});return{getDragProps:m}}function pe({show:e,onReset:n,size:a,iconSizeRatio:r,primaryColor:u,secondaryColor:d,useSecondary:o=!1}){return w.jsx(P,{onClick:n,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"pointer",zIndex:10,backgroundColor:"transparent"},children:a>0&&w.jsx(le,{sx:{fontSize:`${(a*r).toString()}rem`,color:o?d:u,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}})})}function ge({children:e,controls:n,infoUrl:a,_title:r,background:u=re.surface.background,paddingBottom:d={xs:"80px",md:"120px"},contentSx:o={},showTrophy:f=!1,onReset:m,boardSize:c=0,iconSizeRatio:i=1,primaryColor:p,secondaryColor:b,useSecondaryTrophy:l=!1,boardSx:s}){return F("sm"),w.jsxs(ie,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:u,position:"relative",overflow:"hidden",height:"100vh",transition:"background 0.5s ease-in-out"},children:[w.jsx(ue,{showHome:!0,infoUrl:a}),w.jsx(P,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:d},...o?Array.isArray(o)?o:[o]:[]],children:w.jsxs(P,{sx:[{position:"relative",width:"fit-content"},...s?Array.isArray(s)?s:[s]:[]],children:[e,w.jsx(pe,{show:f,onReset:m,size:c,iconSizeRatio:i,primaryColor:p,secondaryColor:b,useSecondary:l})]})}),n]})}function be(e,n){return`${e.toString()},${n.toString()}`}function xe(e,n,a){return t.useMemo(()=>e(n,...a),[e,n,...a])}export{de as B,ge as G,he as a,we as b,xe as c,fe as d,me as e,V as f,be as g,Q as u};
