import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{A as t,S as o,a as n,L as s,e as i,d as a}from"./index-DRVHd1NR.js";import{d as c,b as l,T as d,S as f,L as u,M as g,D as p,N as h,e as S,a as m,f as b,G as x,c as w,B as y,g as v}from"./useBaseGame-Dy2whSfu.js";import{u as C,C as E}from"./layout-CO2XOOno.js";import{B as I}from"./vendor_mui_core-CC5VlWLf.js";import{u as $,v as O,c as A,P as T}from"./vendor_mui_icons-nmK6gwuH.js";import"./GlobalHeader-DEYno4Cn.js";const k=1,R=2;class N{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error("Index out of bounds");r!==e&&(this.parent[e]=this.find(r));const t=this.parent[e];if(void 0===t)throw new Error("Root not found");return t}union(e,r){const t=this.find(e),o=this.find(r);return t!==o&&(this.parent[t]=o,!0)}}function _(e,r,t){return e*(t+1)+r}function z(e,r,t){const o=new Map,n=new Set;for(let l=0;l<r;l++)for(let r=0;r<t;r++){const n=e[l]?.[r];if(!n||0===n)continue;const s=_(l,n===k?r+1:r,t),i=_(l+1,n===k?r:r+1,t);o.has(s)||o.set(s,[]),o.has(i)||o.set(i,[]),o.get(s)?.push({node:i,r:l,c:r}),o.get(i)?.push({node:s,r:l,c:r})}const s=new Set,i=new Set,a=[],c=(e,r)=>{s.add(e),i.add(e);const t=o.get(e)??[];for(const{node:o,r:l,c:d}of t)if(o!==r)if(i.has(o)){n.add(`${String(l)},${String(d)}`);for(let e=a.length-1;e>=0;e--){const r=a[e];if(!r)break;if(n.add(`${String(r.r)},${String(r.c)}`),r.u===o||r.v===o)break}}else s.has(o)||(a.push({r:l,c:d,u:e,v:o}),c(o,e),a.pop());i.delete(e)};for(const l of o.keys())s.has(l)||c(l,-1);return n}function H(e,r,t){const o=new N((r+1)*(t+1));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const s=r[e];if(void 0===s||0===s)continue;const i=_(n,s===k?e+1:e,t),a=_(n+1,s===k?e:e+1,t);if(!o.union(i,a))return!0}}return!1}function j(e,r,t,o){const n=new Set,s=D(e,t,o);for(let i=0;i<=t;i++)for(let a=0;a<=o;a++){const c=r[i]?.[a];if(null==c)continue;const l=s[i],d=(l?l[a]:0)??0;if(d>c){n.add(`${String(i)},${String(a)}`);continue}d+[{gr:i-1,gc:a-1,pt:R},{gr:i-1,gc:a,pt:k},{gr:i,gc:a-1,pt:k},{gr:i,gc:a,pt:R}].filter(({gr:r,gc:n,pt:s})=>{if(r<0||r>=t||n<0||n>=o)return!1;const i=e[r]?.[n];return 0===i||i===s}).length<c&&n.add(`${String(i)},${String(a)}`)}return n}function M(e,r,t,o){const n=new Set,s=D(e,t,o);for(let i=0;i<=t;i++)for(let e=0;e<=o;e++){const t=r[i]?.[e];if(null==t)continue;const o=s[i];(o?o[e]:0)===t&&n.add(`${String(i)},${String(e)}`)}return n}function D(e,r,t){const o=Array.from({length:r+1},()=>new Array(t+1).fill(0));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const t=r[e];if(t===k){const r=o[n],t=o[n+1];if(r&&t){const o=r[e+1],n=t[e];void 0!==o&&(r[e+1]=o+1),void 0!==n&&(t[e]=n+1)}}else if(t===R){const r=o[n],t=o[n+1];if(r&&t){const o=r[e],n=t[e+1];void 0!==o&&(r[e]=o+1),void 0!==n&&(t[e+1]=n+1)}}}}return o}function L(e,r,t,o){let n=!0;for(;n;){n=!1;for(let s=0;s<=t;s++){const i=r[s];if(i)for(let r=0;r<=o;r++){const a=i[r];if(null==a)continue;const c=[{gr:s-1,gc:r-1,pt:R},{gr:s-1,gc:r,pt:k},{gr:s,gc:r-1,pt:k},{gr:s,gc:r,pt:R}].filter(({gr:e,gc:r})=>e>=0&&e<t&&r>=0&&r<o);let l=0;const d=[];for(const r of c){const t=e[r.gr],o=t?t[r.gc]:0;0===o?d.push(r):o===r.pt&&l++}if(d.length>0)if(l===a)for(const{gr:r,gc:t,pt:o}of d){const s=e[r];s&&(s[t]=o===k?R:k,n=!0)}else if(l+d.length===a)for(const{gr:r,gc:t,pt:o}of d){const s=e[r];s&&(s[t]=o,n=!0)}}}if(!n)for(let r=0;r<t;r++){const s=e[r];if(s)for(let r=0;r<o;r++)if(0===s[r])if(s[r]=k,H(e,t,o)){if(s[r]=R,n=!0,H(e,t,o))return!1}else if(s[r]=R,H(e,t,o)){if(s[r]=k,n=!0,H(e,t,o))return!1}else s[r]=0}}return!H(e,t,o)&&!(j(e,r,t,o).size>0)}function B(e,r,t){const o=Array.from({length:r},()=>new Array(t).fill(0));if(!L(o,e,r,t))return!1;let n=!0;for(;n;){n=!1;for(let s=0;s<r;s++){const i=o[s];if(i)for(let a=0;a<t;a++){if(0!==i[a])continue;const c=o.map(e=>[...e]),l=c[s];if(l&&(l[a]=k,!L(c,e,r,t))){if(i[a]=R,n=!0,!L(o,e,r,t))return!1;continue}const d=o.map(e=>[...e]),f=d[s];if(!f||(f[a]=R,L(d,e,r,t)));else if(i[a]=k,n=!0,!L(o,e,r,t))return!1}}}return o.every(e=>e.every(e=>0!==e))}function W(e,r){const t=Array.from({length:e},()=>new Array(r).fill(k)),o=e*r*c.PUZZLE_GENERATION_ITERATIONS;for(let c=0;c<o;c++){const o=Math.floor(Math.random()*e),n=Math.floor(Math.random()*r),s=t[o];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===k?R:k,H(t,e,r)&&(s[n]=i))}const n=D(t,e,r),s=n.map(e=>[...e]),i=[];for(let c=0;c<=e;c++){const t=n[c];if(t)for(let o=0;o<=r;o++){const n=t[o];if(void 0===n)continue;const s=!(0!==c&&c!==e||0!==o&&o!==r),a=s?2:!s&&(0===c||c===e||0===o||o===r)?3:4;let l=0;l=0===n||n===a?100:1===n||n===a-1?50:25,i.push({r:c,c:o,score:l+20*Math.random()})}}i.sort((e,r)=>r.score-e.score);const a=i.map(({r:e,c:r})=>({r:e,c:r}));for(const{r:c,c:l}of a){const t=s[c];if(!t)continue;const o=t[l];void 0!==o&&(t[l]=null,B(s,e,r)||(t[l]=o))}return{numbers:s,solution:t}}function G(e,r){switch(r.type){case"toggle":{if(e.solved)return e;const t=e.grid.map(e=>[...e]),o=t[r.row];if(!o)return e;const n=o[r.col];r.reverse?o[r.col]=0===n?R:n===R?k:0:o[r.col]=0===n?k:n===k?R:0;let s=!1;if(t.every(e=>e.every(e=>0!==e))){const r=D(t,e.rows,e.cols);e.numbers.every((e,t)=>e.every((e,o)=>{const n=r[t];return null===e||e===n?.[o]}))&&!H(t,e.rows,e.cols)&&(s=!0)}return{...e,grid:t,solved:s,errorNodes:j(t,e.numbers,e.rows,e.cols),cycleCells:z(t,e.rows,e.cols),satisfiedNodes:M(t,e.numbers,e.rows,e.cols)}}case"hydrate":return{...r.state};case"resize":case"next":case"new":{const t="resize"===r.type?r.rows:e.rows,o="resize"===r.type?r.cols:e.cols,{numbers:n,solution:s}=W(t,o);return{grid:Array.from({length:t},()=>new Array(o).fill(0)),numbers:n,solution:s,rows:t,cols:o,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return e}}function U(e,r){const{numbers:t,solution:o}=W(e,r);return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:t,solution:o,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}const Z=({rows:a,cols:c,numbers:S,size:m,initialMoves:b,onMove:x,onCopy:w,onClear:y,onClose:v})=>{const T=C("sm"),N=b,{getDragProps:_}=l({onToggle:(e,r,t,o)=>{const n=`${String(e)},${String(r)}`;if(void 0!==o)return void x(n,o);const s=N.get(n);let i;return i=t?s===R?k:s===k?void 0:R:s===k?R:s===R?void 0:k,x(n,i),i},touchTimeout:d.TOUCH_HOLD_DELAY,checkEnabled:()=>!0}),[H,j]=e.useState(new Map),[M,D]=e.useState([]),[L,B]=e.useState(new Set);e.useEffect(()=>{const e=new Map,r=[],t=[];N.forEach((t,o)=>{e.set(o,{state:t,source:"user"});const[n,s]=o.split(",").map(Number);void 0!==n&&void 0!==s&&r.push({r:n,c:s})});const o=(r,t)=>{if(r<0||r>=a||t<0||t>=c)return 0;const o=`${String(r)},${String(t)}`;return e.get(o)?.state??0},n=(o,n,s,i)=>{const a=`${String(o)},${String(n)}`,c=e.get(a);c?c.state!==s&&t.push({type:"cell",r:o,c:n}):(e.set(a,{state:s,source:i}),r.push({r:o,c:n}))},s=(e,r)=>[{r:e-1,c:r-1,required:R},{r:e-1,c:r,required:k},{r:e,c:r-1,required:k},{r:e,c:r,required:R}].filter(e=>e.r>=0&&e.r<a&&e.c>=0&&e.c<c);let i=0;for(;i<r.length;){const a=r[i++];if(!a)break;const{r:c,c:l}=a,d=[{r:c,c:l},{r:c,c:l+1},{r:c+1,c:l},{r:c+1,c:l+1}];for(const r of d){const i=S[r.r]?.[r.c];if(null==i)continue;const a=s(r.r,r.c);let d=0;const f=[];for(const e of a){const r=o(e.r,e.c);0===r?f.push(e):r===e.required&&d++}if(d>i)t.push({type:"node",r:r.r,c:r.c});else if(d+f.length<i)t.push({type:"node",r:r.r,c:r.c});else if("user"===e.get(`${String(c)},${String(l)}`)?.source)if(d===i&&f.length>0)for(const e of f){const r=e.required===k?R:k;n(e.r,e.c,r,"propagated")}else if(d+f.length===i&&f.length>0)for(const e of f)n(e.r,e.c,e.required,"propagated")}}const l=Array.from({length:a},()=>Array(c).fill(0));e.forEach((e,r)=>{const[t,o]=r.split(",").map(Number);void 0!==t&&void 0!==o&&l[t]&&(l[t][o]=e.state)});const d=z(l,a,c);j(e),D(t),B(d)},[N,S,a,c]);const W=m*h,G=m-W,U=e.useMemo(()=>new Set(M.filter(e=>"cell"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[M]),Z=e.useMemo(()=>new Set(M.filter(e=>"node"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[M]),P=e.useCallback((e,s)=>{const i=`${String(e)},${String(s)}`,a=H.get(i),c=a?.state??0,l=a?.source,d=U.has(i),g=L.has(i),p=_(i);let h=n.text.primary;return d?h=n.data.red:g?h="user"===l?n.data.red:"#ff9800":"user"===l?h=n.primary.main:"propagated"===l&&(h=n.data.green),{...p,sx:{...p.sx,cursor:"pointer",border:`1px solid ${f.GHOST.BORDER}`,position:"relative",backgroundColor:f.GHOST.BG_SUBTLE,"&:hover":{backgroundColor:f.GHOST.BG_HOVER}},children:r.jsxs(I,{sx:{width:"100%",height:"100%",position:"relative"},children:[c===k&&r.jsx(I,{sx:{position:"absolute",width:u.LINE_WIDTH,height:u.LINE_THICKNESS,backgroundColor:h,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:f.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),c===R&&r.jsx(I,{sx:{position:"absolute",width:u.LINE_WIDTH,height:u.LINE_THICKNESS,backgroundColor:h,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:f.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}},[H,U,L,_]),q=e.useCallback((e,t)=>{const o=S[e]?.[t],s=Z.has(`${String(e)},${String(t)}`);return{"data-pos":`${String(e)},${String(t)}`,"data-type":"hint",children:r.jsx(I,{children:o??""}),sx:{borderRadius:"50%",backgroundColor:s?n.data.red:f.GHOST.HINT_BG,border:null!==o?`2px solid ${s?n.data.red:f.GHOST.HINT_BORDER}`:"none",fontSize:`${String(.5*W)}rem`,fontWeight:"800",color:f.COLORS.WHITE,zIndex:5,opacity:null!==o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(1.1)":"scale(1)",position:"relative",pointerEvents:"none"}}},[S,Z,W]);return r.jsxs(I,{sx:{position:"relative",userSelect:"none"},children:[r.jsxs(I,{sx:{position:"relative",padding:T?`calc(${g} + 16px)`:`calc(${p} + 24px)`,border:`2px dashed ${f.GHOST.DASHED_BORDER}`,borderRadius:u.CALCULATOR_BORDER_RADIUS},children:[r.jsx(I,{sx:{position:"relative",zIndex:s.zIndex.base+1},children:r.jsx(E,{size:m,rows:a,cols:c,cellProps:P,space:0,sx:{width:"fit-content"}})}),r.jsx(I,{sx:{position:"absolute",top:T?`calc(${g} + 16px)`:`calc(${p} + 24px)`,left:T?`calc(${g} + 16px)`:`calc(${p} + 24px)`,transform:`translate(-${String(W/2)}rem, -${String(W/2)}rem)`,zIndex:s.zIndex.base+2,pointerEvents:"none"},children:r.jsx(E,{size:W,rows:a+1,cols:c+1,cellProps:q,space:G,sx:{width:"fit-content"}})})]}),r.jsxs(I,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:T?-72:-88,left:0,right:0,pointerEvents:"auto",zIndex:s.zIndex.base+5,paddingBottom:2},children:[r.jsx(i,{title:"Copy Board",Icon:$,onClick:w,sx:{backgroundColor:n.interactive.selected,color:n.primary.main,"&:hover":{backgroundColor:n.interactive.focus}}}),r.jsx(i,{title:"Clear Calculator",Icon:O,onClick:y,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:n.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),r.jsx(i,{title:"Close Calculator",Icon:A,onClick:v,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:n.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})]})};function P(){const[o,C]=e.useState(!1),E=S({storageKey:v.SIZE,defaultSize:c.DEFAULT_SIZE,minSize:c.MIN_SIZE,headerOffset:{mobile:s.headerHeight.xs,desktop:s.headerHeight.md},paddingOffset:160,widthLimit:u.WIDTH_LIMIT,cellSizeReference:4,mobileRowOffset:-2}),{state:$,dispatch:O,boardSize:A,handleReset:N}=m({pageTitle:a.slant,gridSizeConfig:{storageKey:v.SIZE,defaultSize:c.DEFAULT_SIZE,minSize:c.MIN_SIZE,headerOffset:{mobile:s.headerHeight.xs,desktop:s.headerHeight.md},paddingOffset:160,widthLimit:u.WIDTH_LIMIT,cellSizeReference:4,mobileRowOffset:-2},responsiveBoardConfig:{headerOffset:{mobile:s.headerHeight.xs,desktop:s.headerHeight.md},paddingOffset:{x:E.mobile?128:224,y:u.PADDING_OFFSET},boardMaxWidth:u.BOARD_MAX_WIDTH,boardSizeFactor:u.BOARD_SIZE_FACTOR,maxCellSize:u.MAX_CELL_SIZE,remBase:u.REM_BASE,rowOffset:1,colOffset:1},persistenceConfig:{storageKey:v.STATE,enabled:!o,serialize:e=>({...e,errorNodes:Array.from(e.errorNodes),cycleCells:Array.from(e.cycleCells),satisfiedNodes:Array.from(e.satisfiedNodes)}),deserialize:e=>{const r=e;return{...r,errorNodes:new Set(r.errorNodes),cycleCells:new Set(r.cycleCells),satisfiedNodes:new Set(r.satisfiedNodes)}}},winTransitionConfig:{delay:d.WIN_ANIMATION_DELAY},reducer:G,getInitialState:U}),[_,z]=e.useState(new Map);b({storageKey:v.GHOST_MOVES,rows:E.rows,cols:E.cols,state:_,onRestore:e=>{z(e)},serialize:e=>Array.from(e.entries()),deserialize:e=>new Map(e)});const H=e.useRef("");e.useEffect(()=>{const e=JSON.stringify($.numbers);H.current&&H.current!==e&&z(new Map),H.current=e},[$.numbers]);const{getDragProps:j}=l({onToggle:(e,r,t)=>{O({type:"toggle",row:e,col:r,reverse:t})},checkEnabled:()=>!$.solved,touchTimeout:d.TOUCH_HOLD_DELAY}),M=A*h,D=e.useMemo(()=>((e,o)=>(s,i)=>{const a=e.grid[s]?.[i],c=`${String(s)},${String(i)}`,l=e.cycleCells.has(c),d=o(c);return{...d,sx:{...d.sx,cursor:"pointer",border:`1px solid ${n.border.subtle}`,position:"relative","&:hover":{backgroundColor:n.interactive.hover}},children:r.jsxs(I,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===k&&r.jsx(I,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:l?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:f.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),a===R&&r.jsx(I,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:l?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:f.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}})($,j),[$,j]),L=e.useMemo(()=>((e,t)=>(o,s)=>{const i=e.numbers[o]?.[s],a=e.errorNodes.has(`${String(o)},${String(s)}`),c=e.satisfiedNodes.has(`${String(o)},${String(s)}`);return{sx:{pointerEvents:"none"},children:r.jsx(I,{sx:{borderRadius:"50%",backgroundColor:a?n.data.red:n.surface.background,border:null!==i?`2px solid ${a?n.data.red:c?"transparent":n.border.subtle}`:"none",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:a?f.COLORS.WHITE:c?n.interactive.disabledText:n.text.primary,boxShadow:c&&!a?"none":f.SHADOWS.HINT,zIndex:5,opacity:null!==i?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:a?"scale(1.1)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}})($,M),[$,M]),B=o?r.jsx(r.Fragment,{}):r.jsx(w,{gridSize:E,onRefresh:N,disabled:o,children:r.jsx(i,{title:"Open Calculator",Icon:T,onClick:()=>{C(!o)},sx:{color:"default"}})}),W=e.useCallback((e,r)=>{z(t=>{const o=new Map(t);return void 0===r?o.delete(e):o.set(e,r),o})},[]),P=e.useCallback(()=>{const e=new Map;$.grid.forEach((r,t)=>{r.forEach((r,o)=>{0!==r&&e.set(`${String(t)},${String(o)}`,r)})}),z(e)},[$.grid]),q=e.useCallback(()=>{z(new Map)},[]),F=e.useCallback(()=>{C(!1)},[]),K=e.useCallback(e=>{e.stopPropagation()},[]),Y=e.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${n.surface.elevated} 0%, ${n.surface.background} 100%)`,padding:E.mobile?"1rem":"2rem"}),[E.mobile]),V=e.useMemo(()=>({userSelect:"none",padding:E.mobile?g:p,border:"2px solid transparent",borderRadius:u.CALCULATOR_BORDER_RADIUS}),[E.mobile]),X=o?r.jsx(Z,{rows:E.rows,cols:E.cols,numbers:$.numbers,size:A,initialMoves:_,onMove:W,onCopy:P,onClear:q,onClose:F}):r.jsx(y,{size:A,rows:E.rows+1,cols:E.cols+1,frontProps:L,backProps:D,frontLayerSx:{pointerEvents:"none"}});return r.jsx(x,{title:a.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:B,contentSx:Y,showTrophy:!o&&$.solved,onReset:N,boardSize:A,iconSizeRatio:u.ICON_SIZE_RATIO,primaryColor:n.primary.main,secondaryColor:n.primary.main,boardSx:V,children:r.jsx(I,{onClick:K,children:X})})}export{P as default};
