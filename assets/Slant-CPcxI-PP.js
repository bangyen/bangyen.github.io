import{j as e,a as r,r as n}from"./vendor_react-De-BR_RD.js";import{B as t,l as o,g as s,d as a,G as l,u as i,C as c,b as u,m as d,T as f,n as p,L as g,o as h,e as y,c as m,a as b,h as S,f as x,i as v,j as A,k as w}from"./useBaseGame-C8AmdTPb.js";import{b as C,C as I,L as N,A as k,S as E,F as M,P as O}from"./index-B1VOl4vO.js";import{B as R,d as j}from"./vendor_mui_core-K-vIj0S5.js";import{c as P,D as T,d as z,T as D,e as L,N as $,P as B}from"./vendor_mui_icons-D2L4zTna.js";import{u as _,E as H,a as G}from"./lazyNamed-Dt7Xl9xO.js";import{t as W}from"./PageLayout-BauE-RPS.js";function Y({onCopy:r,onClear:n,onClose:t}){return e.jsxs(R,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:N.zIndex.base+5,paddingBottom:2},children:[e.jsx(C,{title:"Copy Board",Icon:P,onClick:r,sx:{backgroundColor:I.interactive.selected,color:I.primary.main,"&:hover":{backgroundColor:I.interactive.focus}}}),e.jsx(C,{title:"Clear Analysis",Icon:T,onClick:n,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:I.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(C,{title:"Close Analysis",Icon:z,onClick:t,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:I.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const q=100,K=1e3,U=100,V=.8,F={...o("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},J=0,X=8,Q=5,Z={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:t.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BORDER:"var(--slant-analysis-border)",BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:"\n            @keyframes slant-pop-in {\n                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }\n                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }\n                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }\n            }\n        ",POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},ee=1,re=2,ne=r.memo(function({value:r,color:n,size:t}){const o=`${String(Math.max(2,t))}px`;return e.jsxs(R,{sx:{width:"100%",height:"100%",position:"relative"},children:[r===ee&&e.jsx(R,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:n,borderRadius:E.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:Z.SHADOWS.LINE,transition:k.transition,animation:Z.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),r===re&&e.jsx(R,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:n,borderRadius:E.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:Z.SHADOWS.LINE,transition:k.transition,animation:Z.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),te=r.memo(function({value:r,hasConflict:n,numberSize:t}){return e.jsx(R,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:n?Z.COLORS.WHITE:Z.ANALYSIS.HINT_TEXT,transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:n?"scale(1.15)":"scale(1)"},children:r??""})});class oe{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Index ${String(e)} out of bounds`);r!==e&&(this.parent[e]=this.find(r));const n=this.parent[e];if(void 0===n)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return n}union(e,r){const n=this.find(e),t=this.find(r);return n!==t&&(this.parent[n]=t,!0)}connected(e,r){return this.find(e)===this.find(r)}}function se(e,r,n){return e*(n+1)+r}function ae(e,r,n){const t=new Map,o=new Set;for(let s=0;s<r;s++)for(let r=0;r<n;r++){const o=e[s]?.[r];if(!o||0===o)continue;const a=se(s,o===ee?r+1:r,n),l=se(s+1,o===ee?r:r+1,n);t.has(a)||t.set(a,[]),t.has(l)||t.set(l,[]),t.get(a)?.push({node:l,r:s,c:r}),t.get(l)?.push({node:a,r:s,c:r})}const a=new Set,l=new Set,i=[],c=(e,r)=>{a.add(e),l.add(e);const n=t.get(e)??[];for(const{node:t,r:u,c:d}of n)if(t!==r)if(l.has(t)){o.add(s(u,d));for(let e=i.length-1;e>=0;e--){const r=i[e];if(!r)break;if(o.add(s(r.r,r.c)),r.u===t||r.v===t)break}}else a.has(t)||(i.push({r:u,c:d,u:e,v:t}),c(t,e),i.pop());l.delete(e)};for(const s of t.keys())a.has(s)||c(s,-1);return o}function le({rows:e,cols:r,numbers:t,userMoves:o}){const[a,l]=n.useState(new Map),[i,c]=n.useState([]),[u,d]=n.useState(new Set),f=n.useRef(null),[p,g]=n.useState("probing");return n.useEffect(()=>{let e=!1;const r=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=r;const n=setTimeout(()=>{e||(g("broken"),f.current=null,r.terminate())},2e3);return r.onmessage=r=>{if(e)return;const t=r.data;"RESULT"===t.type&&g(e=>{if("probing"===e)return clearTimeout(n),"healthy";const{gridState:r,conflicts:o,cycleCells:s}=t.payload;return l(r),c(o),d(s),e})},r.onerror=()=>{clearTimeout(n),g("broken"),f.current=null,r.terminate()},r.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(n),r.terminate()}},[]),n.useEffect(()=>{if("healthy"===p&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:r,numbers:t,userMoves:o}});else if("broken"===p){const n=function(e,r,n,t){const o=new Map,a=[],l=[];t.forEach((e,r)=>{o.set(r,{state:e,source:"user"});const[n,t]=r.split(",").map(Number);void 0!==n&&void 0!==t&&a.push({r:n,c:t})});const i=(n,t)=>{if(n<0||n>=e||t<0||t>=r)return 0;const a=s(n,t);return o.get(a)?.state??0},c=(e,r,n,t)=>{const i=s(e,r),c=o.get(i);c?c.state!==n&&l.push({type:"cell",r:e,c:r}):(o.set(i,{state:n,source:t}),a.push({r:e,c:r}))},u=(n,t)=>[{r:n-1,c:t-1,required:re},{r:n-1,c:t,required:ee},{r:n,c:t-1,required:ee},{r:n,c:t,required:re}].filter(n=>n.r>=0&&n.r<e&&n.c>=0&&n.c<r);let d=0;for(;d<a.length;){const e=a[d++];if(!e)break;const{r:r,c:t}=e,f=[{r:r,c:t},{r:r,c:t+1},{r:r+1,c:t},{r:r+1,c:t+1}];for(const a of f){const e=n[a.r]?.[a.c];if(null==e)continue;const d=u(a.r,a.c);let f=0;const p=[];for(const r of d){const e=i(r.r,r.c);0===e?p.push(r):e===r.required&&f++}if(f>e)l.push({type:"node",r:a.r,c:a.c});else if(f+p.length<e)l.push({type:"node",r:a.r,c:a.c});else if("user"===o.get(s(r,t))?.source)if(f===e&&p.length>0)for(const r of p){const e=r.required===ee?re:ee;c(r.r,r.c,e,"propagated")}else if(f+p.length===e&&p.length>0)for(const r of p)c(r.r,r.c,r.required,"propagated")}}const f=Array.from({length:e},()=>new Array(r).fill(0));for(const[s,g]of o.entries()){const[e,r]=s.split(",").map(Number);void 0!==e&&void 0!==r&&f[e]&&(f[e][r]=g.state)}const p=ae(f,e,r);return{gridState:o,conflicts:l,cycleCells:p}}(e,r,t,o);l(n.gridState),c(n.conflicts),d(n.cycleCells)}},[o,t,e,r,p]),{gridState:a,conflicts:i,cycleCells:u}}function ie({rows:r,cols:o,numbers:u,size:d,initialMoves:f,onMove:p,onCopy:g,onClear:h,onClose:y}){const m=_("sm"),b=f,{getDragProps:S}=a({onToggle:(e,r,n,t,o)=>{const a=s(e,r);if(!o)return void p(a,t);const l=b.get(a);let i;return i=n?l===ee?re:l===re?void 0:ee:l===re?ee:l===ee?void 0:re,p(a,i),i},touchTimeout:l.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:x}=i({rows:r,cols:o}),v=n.useCallback(e=>{const r=S(e);return{...r,onKeyDown:e=>{r.onKeyDown(e),x(e)}}},[S,x]),{gridState:A,conflicts:w,cycleCells:C}=le({rows:r,cols:o,numbers:u,userMoves:b}),k=.4*d,E=d-k+.125,M=n.useMemo(()=>new Set(w.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[w]),O=n.useMemo(()=>new Set(w.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[w]),j=n.useCallback((r,n)=>function({r:r,c:n,gridState:t,conflictSet:o,cycleCells:a,getDragProps:l,size:i}){const c=s(r,n),u=t.get(c),d=u?.state??0,f=u?.source,p=o.has(c),g=a.has(c),h=l(c);let y=I.text.primary;return p?y=I.data.red:g?y="user"===f?I.data.red:I.data.orange:"user"===f?y=I.primary.main:"propagated"===f&&(y=I.data.green),{...h,"data-pos":c,"data-type":"cell",sx:{...h.sx,cursor:"pointer",outline:"none",border:`1px solid ${Z.ANALYSIS.BORDER}`,position:"relative",backgroundColor:Z.ANALYSIS.BG_SUBTLE,"&:hover":{backgroundColor:Z.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${I.primary.main}`,outlineOffset:"-3px",backgroundColor:Z.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${I.interactive.focus}`}},children:e.jsx(ne,{value:d,color:y,size:i})}}({r:r,c:n,gridState:A,conflictSet:M,cycleCells:C,getDragProps:v,size:d}),[A,M,C,v,d]),P=n.useCallback((r,n)=>function({r:r,c:n,numbers:t,nodeConflictSet:o,numberSize:a}){const l=t[r]?.[n],i=o.has(s(r,n));return{"data-pos":s(r,n),"data-type":"hint",children:e.jsx(te,{value:l??null,hasConflict:i,numberSize:a}),sx:{borderRadius:"50%",backgroundColor:i?I.data.red:Z.ANALYSIS.HINT_BG,border:null==l?"none":`2px solid ${i?I.data.red:Z.ANALYSIS.HINT_BORDER}`,zIndex:5,opacity:null==l?0:1,position:"relative",pointerEvents:"none"}}}({r:r,c:n,numbers:u,nodeConflictSet:O,numberSize:k}),[u,O,k]);return e.jsxs(R,{sx:{position:"relative",userSelect:"none"},onContextMenu:e=>{e.preventDefault()},children:[e.jsx("style",{children:Z.ANIMATIONS.POP_IN}),e.jsxs(R,{sx:{position:"relative",padding:m?t.PADDING.MOBILE:t.PADDING.DESKTOP,border:`2px dashed ${Z.ANALYSIS.DASHED_BORDER}`,borderRadius:t.BORDER_RADIUS},children:[e.jsx(R,{sx:{position:"relative",zIndex:N.zIndex.base+1},children:e.jsx(c,{size:d,rows:r,cols:o,cellProps:j,space:.125,sx:{width:"fit-content"}})}),e.jsx(R,{sx:{position:"absolute",top:m?t.PADDING.MOBILE:t.PADDING.DESKTOP,left:m?t.PADDING.MOBILE:t.PADDING.DESKTOP,transform:`translate(-${String(k/2)}rem, -${String(k/2)}rem)`,zIndex:N.zIndex.base+2,pointerEvents:"none"},children:e.jsx(c,{size:k,rows:r+1,cols:o+1,cellProps:P,space:E,sx:{width:"fit-content"}})})]}),e.jsx(Y,{onCopy:g,onClear:h,onClose:y})]})}function ce({size:r,rows:t,cols:o}){const s=n.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),a=n.useCallback(()=>({}),[]);return e.jsx(R,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:e.jsx(u,{size:r,rows:t+1,cols:o+1,cellRows:t,cellCols:o,overlayProps:a,cellProps:s,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}function ue({isAnalysisMode:r,generating:n,dimensionsMismatch:t,rows:o,cols:s,state:a,size:l,analysisMoves:i,onAnalysisMove:c,onAnalysisCopy:f,onAnalysisClear:p,onAnalysisClose:g,cellProps:h,overlayProps:y}){return r?e.jsx(H,{fallback:e.jsx(G,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:e.jsx(ie,{rows:o,cols:s,numbers:a.numbers,size:l,initialMoves:i,onMove:c,onCopy:f,onClear:p,onClose:g})}):n||t?e.jsx(ce,{size:l,rows:o,cols:s}):e.jsxs(H,{FallbackComponent:M,fallbackProps:{title:d.errors.boardTitle,resetLabel:d.errors.boardReset},children:[e.jsx("style",{children:Z.ANIMATIONS.POP_IN}),e.jsx(u,{size:l,rows:o+1,cols:s+1,cellRows:o,cellCols:s,space:.125,overlayProps:y,cellProps:h,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})]})}const de=[[re,ee,re],[re,ee,re],[re,ee,re]],fe=[[1,0,2,0],[1,2,2,1],[1,2,2,1],[0,2,0,1]],pe=[[0,0],[2,2],[0,2],[2,0],[0,1],[2,1],[1,0],[1,1],[1,2]];function ge(e,r,n){const t=Array.from({length:r+1},()=>new Array(n+1).fill(0));for(let o=0;o<r;o++){const r=e[o];if(r)for(let e=0;e<n;e++){const n=r[e];if(n===ee){const r=t[o];if(r){const n=r[e+1];void 0!==n&&(r[e+1]=n+1)}const n=t[o+1];if(n){const r=n[e];void 0!==r&&(n[e]=r+1)}}else if(n===re){const r=t[o];if(r){const n=r[e];void 0!==n&&(r[e]=n+1)}const n=t[o+1];if(n){const r=n[e+1];void 0!==r&&(n[e+1]=r+1)}}}}return t}function he(e,r,n,t){const o=new Set,a=ge(e,n,t);for(let l=0;l<=n;l++)for(let e=0;e<=t;e++){const n=r[l]?.[e];if(null==n)continue;(a[l]?.[e]??0)===n&&o.add(s(l,e))}return o}function ye(e,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:I.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:Z.SHADOWS.LINE,transition:k.transition,animation:Z.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}function me({size:r}){const t=n.useMemo(()=>function(){const e=[],r=Array.from({length:3},()=>new Array(3).fill(0));e.push(r);let n=r.map(e=>[...e]);for(const[t,o]of pe){n=n.map(e=>[...e]);const r=de[t]?.[o];if(void 0!==r){const e=n[t];e&&(e[o]=r)}e.push(n)}return e.push(n.map(e=>[...e])),e}(),[]),[o,a]=n.useState(0);n.useEffect(()=>{const e=setInterval(()=>{a(e=>(e+1)%t.length)},1500);return()=>{clearInterval(e)}},[t.length]);const l=n.useMemo(()=>t[o]??t[0]??[],[t,o]),i=o>0&&o<=pe.length?(()=>{const e=pe[o-1];return e?s(e[0],e[1]):null})():null,c=n.useMemo(()=>he(l,fe,3,3),[l]),d=.4*r,p=o>=pe.length&&l.every(e=>e.every(e=>0!==e)),g=n.useMemo(()=>function(r,n,t){return(o,a)=>{const l=r[o]?.[a],i=s(o,a)===t;return{sx:{border:`1px solid ${I.border.subtle}`,position:"relative",transition:k.transition,...i?{backgroundColor:I.interactive.hover}:{}},children:e.jsxs(R,{sx:{width:"100%",height:"100%",position:"relative"},children:[l===ee&&e.jsx(R,{sx:ye("-45deg",n)}),l===re&&e.jsx(R,{sx:ye("45deg",n)})]})}}}(l,r,i),[l,r,i]),h=n.useMemo(()=>function(r,n,t){return(o,a)=>{const l=r[o]?.[a],i=s(o,a),c=n.has(i);return{sx:{pointerEvents:"none"},children:e.jsx(R,{sx:{borderRadius:"50%",backgroundColor:I.surface.background,border:null==l?"none":`2px solid ${c?"transparent":I.border.subtle}`,fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:c?I.interactive.disabledText:I.text.primary,boxShadow:c?"none":Z.SHADOWS.HINT,zIndex:5,opacity:null==l?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",width:`${String(t)}rem`,height:`${String(t)}rem`},children:l??""})}}}(fe,c,d),[c,d]);return e.jsx(R,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:e.jsxs(R,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx("style",{children:Z.ANIMATIONS.POP_IN}),e.jsx(u,{size:r,rows:4,cols:4,cellRows:3,cellCols:3,overlayProps:h,cellProps:g,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0}),e.jsx(f,{show:p,size:r,iconSizeRatio:1,primaryColor:I.primary.main,showLabel:!1})]})})}const be={display:"flex",px:2,ml:{xs:5,sm:4},pt:{xs:0,sm:3},mt:{xs:-2,sm:0}},Se={borderColor:I.border.subtle,color:I.text.secondary},xe=["Slant Rules","Example"],ve=[{Icon:D,title:"Fill with Slashes",text:String.raw`Place a forward (/) or backward (\) slash in every cell of the grid.`},{Icon:L,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:$,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],Ae={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},we=e=>[...W(p(e)),{overflowY:"hidden"}];function Ce(e){return{storageKey:"slant",grid:{defaultSize:Q,maxSize:X,gridPadding:{x:e?48:80,y:120},widthLimit:K,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:q}),...e?{boardSizeFactor:.92}:{},maxCellSize:U,rowOffset:1,colOffset:1}}}function Ie({open:r,toggleOpen:n,handleOpenAnalysis:t}){const o=_("sm");return e.jsx(g,{open:r,toggleOpen:n,titles:xe,instructions:ve,instructionsFooter:e.jsx(R,{sx:be,children:e.jsx(j,{variant:"outlined",startIcon:e.jsx(B,{}),onClick:t,sx:Se,children:"Open Analysis"})}),exampleContent:e.jsx(me,{size:o?4:5}),cardSx:Ae,contentSxOverride:we})}function Ne(e,r){return`${F.STATE}-${String(e)}x${String(r)}`}function ke(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function Ee({rows:e,cols:r,isAnalysisMode:t,requestGeneration:o,cancelGeneration:s}){const a=n.useRef(`${String(e)},${String(r)}`);n.useEffect(()=>{const n=`${String(e)},${String(r)}`;n!==a.current&&(a.current=n,t||!function(e,r){const n=Ne(e,r),t=localStorage.getItem(n);if(!t)return!1;try{const e=JSON.parse(t);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,r)?o(e,r):s())},[e,r,o,s,t])}function Me(e,r,n,t){return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:n,solution:t,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Oe({getInitialState:e,dispatchRef:r,dimsRef:t,onStaleResult:o}){const[s,a]=n.useState(!1),l=n.useRef(null),i=n.useRef("probing"),c=n.useRef(0),u=n.useRef(0),d=n.useRef(null),f=n.useRef(0),p=n.useRef(o);p.current=o;const g=n.useRef(!1),h=n.useRef(null),y=n.useRef(!1),m=n.useCallback(()=>{if(h.current){const e=h.current;p.current?.(e,e.rows,e.cols)}g.current=!1,h.current=null,y.current=!1},[]),b=n.useCallback((n,t)=>{r.current?.({type:"hydrate",state:e(n,t)}),a(!1)},[r,e]),S=n.useCallback((e,r)=>{m(),a(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const n=++c.current;"healthy"===i.current&&l.current?(f.current++,l.current.postMessage({type:"GENERATE",payload:{rows:e,cols:r}})):u.current=requestAnimationFrame(()=>{c.current===n&&b(e,r)})},250)},[b,m]),x=n.useCallback((r,n)=>{g.current||(g.current=!0,h.current=null,y.current=!1,"healthy"===i.current&&l.current?(f.current++,l.current.postMessage({type:"GENERATE",payload:{rows:r,cols:n}})):requestAnimationFrame(()=>{g.current&&(h.current=e(r,n))}))},[e]),v=n.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),m(),a(!1)},[m]),A=n.useCallback(()=>{if(h.current){const e=h.current;return h.current=null,r.current?.({type:"hydrate",state:e}),m(),void a(!1)}if(g.current)return y.current=!0,void a(!0);S(t.current.rows,t.current.cols)},[S,t,r,m]);return n.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});l.current=n;const o=setTimeout(()=>{e||"probing"!==i.current||(i.current="broken",f.current=0,l.current=null,n.terminate())},2e3);return n.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(o),i.current="broken",f.current=0,l.current=null,void n.terminate();if("RESULT"===s.data.type){if("probing"===i.current)return clearTimeout(o),void(i.current="healthy");f.current--;const{rows:e,cols:n,numbers:l,solution:c}=s.data.payload,u=t.current;if(e!==u.rows||n!==u.cols)return p.current?.(Me(e,n,l,c),e,n),void(f.current<=0&&a(!1));if(f.current>0)return;const d=Me(e,n,l,c);if(g.current)return h.current=d,void(y.current&&(r.current?.({type:"hydrate",state:d}),g.current=!1,h.current=null,y.current=!1,a(!1)));r.current?.({type:"hydrate",state:d}),a(!1)}}},n.onerror=()=>{clearTimeout(o),i.current="broken",f.current=0,l.current=null,n.terminate()},n.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(o),null!==d.current&&clearTimeout(d.current),n.terminate()}},[r,t]),{generating:s,requestGeneration:S,handleNextAsync:A,prefetch:x,cancelGeneration:v}}function Re(e,r,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:n?I.data.red:I.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:Z.SHADOWS.LINE,transition:k.transition,animation:Z.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const je={border:`2px solid ${I.border.subtle}`,position:"relative"},Pe={width:"100%",height:"100%",position:"relative"},Te={pointerEvents:"none"},ze={cursor:"pointer",outline:"none","&:hover":{backgroundColor:I.interactive.hover},"&:focus-visible":{outline:`3px solid ${I.primary.main}`,outlineOffset:"-3px",backgroundColor:I.interactive.hover,boxShadow:`inset 0 0 15px ${I.interactive.focus}`}};function De(e){const{numberSize:r,hasError:n,isSatisfied:t,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:n?I.data.red:I.surface.background,border:o?`2px solid ${n?I.data.red:t?"transparent":I.border.subtle}`:"none",fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:n?Z.COLORS.WHITE:t?I.interactive.disabledText:I.text.primary,boxShadow:t&&!n?"none":Z.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:n?"scale(1.15)":t?"scale(0.95)":"scale(1)",width:`${String(r)}rem`,height:`${String(r)}rem`}}const Le=(r,n,t)=>{const o=function(r,n){return(t,o)=>{const a=r.grid[t]?.[o],l=s(t,o),i=r.cycleCells.has(l),c=[{v:r.numbers[t]?.[o],p:s(t,o)},{v:r.numbers[t]?.[o+1],p:s(t,o+1)},{v:r.numbers[t+1]?.[o],p:s(t+1,o)},{v:r.numbers[t+1]?.[o+1],p:s(t+1,o+1)}].map(({v:e,p:n})=>{if(null==e)return"-";const t=r.errorNodes.has(n)?"Error":r.satisfiedNodes.has(n)?"Ok":"Pending";return`${String(e)} (${t})`});return{"aria-label":`Cell ${String(t+1)}, ${String(o+1)}. Clues: ${c.join(", ")}. ${0===a?"Empty":a===ee?"Forward Slash":"Backward Slash"}${i?", Loop Error":""}`,sx:je,children:e.jsxs(R,{sx:Pe,children:[a===ee&&e.jsx(R,{sx:Re("-45deg",n,i)}),a===re&&e.jsx(R,{sx:Re("45deg",n,i)})]})}}}(n,t);return(e,n)=>{const t=o(e,n),a=s(e,n),l=r(a);return{...l,...t,sx:{...l.sx,...t.sx,...ze}}}};function $e({game:{state:r,rows:t,cols:o,size:a,mobile:l,isAnalysisMode:i,generating:c,handleNextAsync:u},analysis:{analysisMoves:d,handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:g,handleAnalysisClose:h,handleBoxClick:m,handleOpenAnalysis:b,boardSx:S},info:{infoOpen:x,toggleInfo:v},controls:A,getDragProps:w}){const C=.4*a,I=y(Le,w,[r,a]),N=n.useMemo(()=>((r,n)=>(t,o)=>{const a=r.numbers[t]?.[o],l=s(t,o),i=r.errorNodes.has(l),c=r.satisfiedNodes.has(l);return{sx:Te,children:e.jsx(R,{sx:De({numberSize:n,hasError:i,isSatisfied:c,isVisible:null!=a}),children:a??""})}})(r,C),[r,C]),k=n.useMemo(()=>(e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"}))(l),[l]);return{boardProps:{isAnalysisMode:i,generating:c,dimensionsMismatch:t!==r.rows||o!==r.cols,rows:t,cols:o,state:r,size:a,analysisMoves:d,onAnalysisMove:f,onAnalysisCopy:p,onAnalysisClear:g,onAnalysisClose:h,cellProps:I,overlayProps:N},controlsProps:{...A,onRefresh:u,disabled:c,onOpenInfo:v,hidden:i},layoutProps:{boardSx:S,contentSx:k,iconSizeRatio:V},infoProps:{open:x,toggleOpen:v,handleOpenAnalysis:b,handleBoxClick:m},trophyProps:{show:!i&&r.solved,onReset:u,size:a,iconSizeRatio:V}}}function Be(e,r,n,t,o,s){const a=e[n];if(!a)return!1;a[t]=o;const l=se(n,o===ee?t+1:t,s),i=se(n+1,o===ee?t:t+1,s);return!r.connected(l,i)&&(r.union(l,i),!0)}function _e(e,r,n){const t=Array.from({length:r},()=>new Array(n).fill(0)),o=new oe((r+1)*(n+1)),s=function(e,r,n,t,o){let s=!0;for(;s;){s=!1;for(let a=0;a<=n;a++)for(let l=0;l<=t;l++){const i=r[a]?.[l];if(null==i)continue;const c=[{gr:a-1,gc:l-1,pt:re},{gr:a-1,gc:l,pt:ee},{gr:a,gc:l-1,pt:ee},{gr:a,gc:l,pt:re}].filter(({gr:e,gc:r})=>e>=0&&e<n&&r>=0&&r<t);let u=0;const d=[];for(const r of c){const n=e[r.gr]?.[r.gc];0===n?d.push(r):n===r.pt&&u++}if(u>i)return"contradiction";if(u+d.length<i)return"contradiction";if(u===i&&d.length>0){for(const{gr:r,gc:n,pt:a}of d)if(0===e[r]?.[n]){if(!Be(e,o,r,n,a===ee?re:ee,t))return"contradiction";s=!0}}else if(u+d.length===i&&d.length>0)for(const{gr:r,gc:n,pt:a}of d)if(0===e[r]?.[n]){if(!Be(e,o,r,n,a,t))return"contradiction";s=!0}}if(!s){for(let r=0;r<n;r++)for(let n=0;n<t;n++){const a=e[r];if(0!==a?.[n])continue;const l=se(r,n+1,t),i=se(r+1,n,t),c=o.connected(l,i),u=se(r,n,t),d=se(r+1,n+1,t),f=o.connected(u,d);if(c&&f)return"contradiction";c?(a[n]=re,s=!0,o.union(u,d)):f&&(a[n]=ee,s=!0,o.union(l,i))}if(!s)for(let a=0;a<n;a++)for(let l=0;l<t;l++){const i=e[a];if(0!==i?.[l])continue;let c=!1,u=!1;const d=[{nr:a,nc:l,touchedBy:re},{nr:a,nc:l+1,touchedBy:ee},{nr:a+1,nc:l,touchedBy:ee},{nr:a+1,nc:l+1,touchedBy:re}];for(const{nr:o,nc:s,touchedBy:a}of d){const l=r[o]?.[s];if(null==l)continue;const i=[{gr:o-1,gc:s-1,pt:re},{gr:o-1,gc:s,pt:ee},{gr:o,gc:s-1,pt:ee},{gr:o,gc:s,pt:re}].filter(({gr:e,gc:r})=>e>=0&&e<n&&r>=0&&r<t);let d=0,f=0;for(const r of i){const n=e[r.gr]?.[r.gc];0===n?f++:n===r.pt&&d++}a===ee?(d+1>l&&(c=!0),d+(f-1)<l&&(u=!0)):(d+1>l&&(u=!0),d+(f-1)<l&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!Be(e,o,a,l,re,t))return"contradiction";s=!0}else if(u){if(!Be(e,o,a,l,ee,t))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(t,e,r,n,o);return"contradiction"!==s&&("solved"===s&&function(e,r,n,t){const o=ge(e,n,t);for(let s=0;s<=n;s++)for(let e=0;e<=t;e++){const n=r[s]?.[e];if(null!=n&&o[s]?.[e]!==n)return!1}return!0}(t,e,r,n))}function He(e,r){let n=[],t=!1;for(let s=0;s<50&&!t;s++){n=Array.from({length:e},()=>new Array(r).fill(0));const o=new oe((e+1)*(r+1)),s=[];for(let n=0;n<e;n++)for(let e=0;e<r;e++)s.push({r:n,c:e});for(let e=s.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1)),n=s[e],t=s[r];n&&t&&(s[e]=t,s[r]=n)}let a=!1;for(const{r:e,c:t}of s){const s=se(e,t+1,r),l=se(e+1,t,r),i=o.connected(s,l),c=se(e,t,r),u=se(e+1,t+1,r),d=o.connected(c,u);if(i&&d){a=!0;break}const f=n[e];f&&(i?(f[t]=re,o.union(c,u)):d||Math.random()<.5?(f[t]=ee,o.union(s,l)):(f[t]=re,o.union(c,u)))}a||(t=!0)}t||(n=Array.from({length:e},(e,n)=>new Array(r).fill(n%2==0?ee:re)));const o=function(e,r,n,t){const o=e.map(e=>[...e]),s=[];for(let i=0;i<=r;i++)for(let e=0;e<=n;e++)s.push({r:i,c:e});for(let i=s.length-1;i>0;i--){const e=Math.floor(Math.random()*(i+1)),r=s[i],n=s[e];r&&n&&(s[i]=n,s[e]=r)}const a=Math.floor((r+1)*(n+1)*t);let l=0;for(let i=0;i<=r;i++)for(let e=0;e<=n;e++)null!==o[i]?.[e]&&l++;for(const{r:i,c:c}of s){if(l<=a)break;const e=o[i];if(!e)continue;const t=e[c];null!=t&&(e[c]=null,_e(o,r,n)?l--:e[c]=t)}return o}(ge(n,e,r).map(e=>e.map(e=>e)),e,r,J);return{numbers:o,solution:n}}const Ge=m({getInitialState:We,customHandler:(e,r)=>{if("toggle"!==r.type)return null;if(e.solved)return e;const{row:n,col:t}=r,o=e.grid.map(e=>[...e]),a=o[n];if(!a)return e;const l=a[t];if(void 0===l)return e;r.reverse?a[t]=0===l?ee:l===ee?re:0:a[t]=0===l?re:l===re?ee:0;let i=!1;if(o.every(e=>e.every(e=>0!==e))){const r=ge(o,e.rows,e.cols);e.numbers.every((e,n)=>e.every((e,t)=>null==e||e===r[n]?.[t]))&&!function(e,r,n){const t=new oe((r+1)*(n+1));for(let o=0;o<r;o++){const r=e[o];if(r)for(let e=0;e<n;e++){const s=r[e];if(void 0===s||0===s)continue;const a=se(o,s===ee?e+1:e,n),l=se(o+1,s===ee?e:e+1,n);if(!t.union(a,l))return!0}}return!1}(o,e.rows,e.cols)&&(i=!0)}const c=function(e,r,n,t){const o=new Set,a=ge(e,n,t);for(let l=0;l<=n;l++)for(let i=0;i<=t;i++){const c=r[l]?.[i];if(null==c)continue;const u=a[l]?.[i]??0;u>c?o.add(s(l,i)):u+[{gr:l-1,gc:i-1},{gr:l-1,gc:i},{gr:l,gc:i-1},{gr:l,gc:i}].filter(({gr:r,gc:o})=>r>=0&&r<n&&o>=0&&o<t&&0===e[r]?.[o]).length<c&&o.add(s(l,i))}return o}(o,e.numbers,e.rows,e.cols),u=ae(o,e.rows,e.cols),d=he(o,e.numbers,e.rows,e.cols);return{...e,grid:o,solved:i,errorNodes:c,cycleCells:u,satisfiedNodes:d}}});function We(e,r){const{numbers:n,solution:t}=He(e,r);return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:n,solution:t,rows:b(e),cols:b(r),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Ye(){const e=_("sm"),[t,o]=r.useState(!1),{isOpen:c,toggle:u}=S(),d=n.useRef(null),f=n.useRef({rows:0,cols:0}),p=n.useCallback((e,r,n)=>{t||function(e,r,n){const t=Ne(r,n);try{localStorage.setItem(t,JSON.stringify(ke(e)))}catch{}}(e,r,n)},[t]),{generating:g,requestGeneration:y,handleNextAsync:m,prefetch:b,cancelGeneration:A}=Oe({getInitialState:We,dispatchRef:d,dimsRef:f,onStaleResult:p}),{rows:w,cols:C,state:I,dispatch:N,size:k,controlsProps:E}=x({...Ce(e),logic:{reducer:Ge,getInitialState:(e,r)=>We(e,r),onNext:m,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!t,serialize:ke,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const r=e;return Array.isArray(r.grid)&&Array.isArray(r.numbers)&&Array.isArray(r.solution)&&"number"==typeof r.rows&&"number"==typeof r.cols&&"boolean"==typeof r.solved&&Array.isArray(r.errorNodes)&&Array.isArray(r.cycleCells)&&Array.isArray(r.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});d.current=N,f.current={rows:w,cols:C};const{analysisMoves:M,boardSx:O,handleAnalysisMove:R,handleAnalysisCopy:j,handleAnalysisClear:P,handleAnalysisClose:T,handleBoxClick:z,handleOpenAnalysis:D}=function({isAnalysisMode:e,setIsAnalysisMode:r,state:t,rows:o,cols:a,storageKey:l,toggleInfo:i}){const[c,u]=n.useState(new Map);h({storageKey:l,rows:o,cols:a,state:c,onRestore:e=>{u(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const d=n.useRef("");n.useEffect(()=>{const e=JSON.stringify(t.numbers);d.current&&d.current!==e&&u(new Map),d.current=e},[t.numbers,t.rows,t.cols]);const f=n.useCallback((e,r)=>{u(n=>{const t=new Map(n);return void 0===r?t.delete(e):t.set(e,r),t})},[]),p=n.useCallback(()=>{const e=new Map;t.grid.forEach((r,n)=>{r.forEach((r,t)=>{0!==r&&e.set(s(n,t),r)})}),u(e)},[t.grid]),g=n.useCallback(()=>{u(new Map)},[]),y=n.useCallback(()=>{r(!1)},[r]),m=n.useCallback(e=>{e.stopPropagation()},[]);return{analysisMoves:c,boardSx:n.useMemo(()=>e?{padding:{xs:0,sm:0}}:void 0,[e]),handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:g,handleAnalysisClose:y,handleBoxClick:m,handleOpenAnalysis:n.useCallback(()=>{i(),r(!0)},[i,r])}}({isAnalysisMode:t,setIsAnalysisMode:o,state:I,rows:w,cols:C,storageKey:F.ANALYSIS_MOVES,toggleInfo:u});Ee({rows:w,cols:C,isAnalysisMode:t,requestGeneration:y,cancelGeneration:A}),n.useEffect(()=>{I.solved&&!t&&b(w,C)},[I.solved,t,w,C,b]);const{handleKeyDown:L}=i({rows:w,cols:C}),{getDragProps:$}=a({onToggle:(e,r,n)=>{N({type:"toggle",row:v(e),col:v(r),reverse:n})},checkEnabled:()=>!I.solved,touchTimeout:l.timing.touchHoldDelay}),B=n.useCallback(e=>{const r=$(e);return{...r,onKeyDown:e=>{r.onKeyDown(e),L(e)}}},[$,L]);return $e({game:{state:I,rows:w,cols:C,size:k,mobile:e,isAnalysisMode:t,generating:g,handleNextAsync:m},analysis:{analysisMoves:M,handleAnalysisMove:R,handleAnalysisCopy:j,handleAnalysisClear:P,handleAnalysisClose:T,handleBoxClick:z,handleOpenAnalysis:D,boardSx:O},info:{infoOpen:c,toggleInfo:u},controls:E,getDragProps:B})}function qe(){const{boardProps:r,controlsProps:n,layoutProps:t,infoProps:o,trophyProps:s}=Ye();return e.jsxs(A,{title:O.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",controls:e.jsx(w,{...n}),trophyProps:s,layout:{paddingBottom:{xs:"120px",md:"150px"},contentSx:t.contentSx,boardSx:t.boardSx},onClick:r.isAnalysisMode?r.onAnalysisClose:void 0,children:[e.jsx(R,{onClick:o.handleBoxClick,children:e.jsx(ue,{...r})}),e.jsx(Ie,{...o})]})}export{qe as Slant};
