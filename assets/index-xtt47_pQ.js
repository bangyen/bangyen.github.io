import{r as e,j as o}from"./vendor_react-WaSaIrII.js";import{g as r,a as t,u as s,C as n,G as i}from"./CustomGrid-CTYLlJUN.js";import{u as a,G as l}from"./gameConfig-CQ15qQC4.js";import{d as c,a as f,C as u,L as d}from"./index-DoRVFqS8.js";import{G as h}from"./GlobalHeader-yLAIm46B.js";import{u as m,a as p}from"./useTimer-DNifX3C9.js";import{F as g}from"./vendor_mui_icons-CYo0hoT1.js";import{G as b}from"./vendor_mui_core-3PJY_Tg4.js";function y(e){return Math.floor(Math.random()*e)}function w(e,o){const r={};for(const t in e){const s=e[t];s+o>0?r[t]=s+o:s<0&&(r[t]=s)}return r}function x(e,o,r){const t=o*r,s=y(t);let n=y(t);return s===n&&(n=++n%t),{...e,rows:o,cols:r,head:s,board:{[s]:e.length,[n]:-1}}}function k(e){let{board:o,length:r,head:s,velocity:n,buffer:i}=e;const{rows:a,cols:l}=e,c=a*l;if(o=w(o,-1),s=t(s,n,a,l),s in o){const e=o[s];o[s]=r,e>0?o=w(o,-e):(o=w(o,1),o=function(e,o){let r=y(e);for(;r in o;)++r>=e&&(r=0);return{...o,[r]:-1}}(c,o)),r=o[s]}else o[s]=r;if(i.length){const[e,...o]=i;i=o,n+e&&(n=e)}return{...e,length:r,board:o,head:s,velocity:n,buffer:i}}function v(e,o){switch(o.type){case"resize":{const{rows:r,cols:t}=o.payload;return x(e,r,t)}case"steer":{const{payload:t}=o,s=r(t.key);let{buffer:n}=e;return s&&(n=[...n,s]),{...e,buffer:n}}case"move":return k(e);default:return e}}function j(){const{create:r}=m(0),{create:y}=p(),w=s("sm"),{height:k,width:j}=a(),C=l.snake.initialLength,z=w?l.gridSizes.mobile:l.gridSizes.desktop,{rows:M,cols:_}=e.useMemo(()=>{const e=w?d.headerHeight.xs:d.headerHeight.md,o=k-e,r=z*i.calculation.pixelMultiplier;return{rows:Math.floor(o/r),cols:Math.floor(j/r)}},[z,k,j,w]),G=e.useMemo(()=>({velocity:l.snake.initialVelocity,buffer:[],length:C,rows:0,cols:0,head:0,board:{}}),[C]),[S,H]=e.useReducer(v,x(G,M,_)),E=e.useCallback(e=>{const{clientX:o,clientY:r}=e,t=o-j/2,s=r-k/2,n=S.buffer.length>0?S.buffer[S.buffer.length-1]:S.velocity;let i="";i=2===Math.abs(n)?t>0?"right":"left":s>0?"down":"up";const a=l.controls.arrowPrefix+i;H({type:"steer",payload:{key:a}})},[H,S.velocity,S.buffer,j,k]),P=e.useCallback((e,r)=>{const s=e*_+r,n=S.board;let a="inherit";s in n&&(a=n[s]>0?f.primary.main:f.primary.dark);const l=t(s,-2,M,_),c=t(s,2,M,_),u=t(s,-1,M,_),d=t(s,1,M,_),h=n[l]>0,m=n[c]>0,p=n[u]>0,b=n[d]>0,y=z/i.cellSize.divisor+"rem";if("inherit"===a)return{backgroundColor:a};if(-1===n[s])return{backgroundColor:"transparent",children:o.jsx(g,{sx:{color:a,fontSize:.7*z+"rem"}})};const w=[0,0,0,0];h||p||(w[0]=1),h||b||(w[1]=1),m||b||(w[2]=1),m||p||(w[3]=1);const x=w.map(e=>e?y:"0").join(" ");return{backgroundColor:a,boxShadow:`0 0 1.25rem ${a.replace("hsl","hsla").replace(")",", 0.25)")}`,borderRadius:x}},[S,M,_,z]);return e.useEffect(()=>{r({repeat:()=>{H({type:"move"})},speed:100}),y(e=>H({type:"steer",payload:e}))},[r,y]),e.useEffect(()=>{H({type:"resize",payload:{rows:M,cols:_}})},[M,_,H]),e.useEffect(()=>{document.title=c.snake},[]),o.jsxs(b,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:f.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[o.jsx(h,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),o.jsx(b,{flex:1,onPointerDown:E,sx:{...u.flexCenter,zIndex:1},children:o.jsx(n,{size:z,rows:M,cols:_,space:0,cellProps:(e,o)=>({...P(e,o),transition:!1})})})]})}export{j as default};
