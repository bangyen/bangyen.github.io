const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B3dZVpWa.js","assets/vendor_react-De-BR_RD.js","assets/GameInfo.styles-EJwFT5CT.js","assets/index-CSo_BsSi.js","assets/vendor_mui_core-CNzb-YrG.js","assets/vendor_mui_icons-B5Ke0Ezt.js","assets/index-GLeeZWEo.css","assets/PageLayout-B7XtVyvX.js"])))=>i.map(i=>d[i]);
import{a as e,j as t,r}from"./vendor_react-De-BR_RD.js";import{B as o,l as n,g as s,u as l,i as a,C as i,b as c,G as u,T as d,m as f,d as h,c as p,a as g,f as m,e as b,h as x,j as y,k as S}from"./useBaseGame-CnPbz8wj.js";import{B as v,d as C}from"./vendor_mui_core-CNzb-YrG.js";import{A as w,S as k,C as E,b as G,L as R,F as j,_ as M,P as O}from"./index-CSo_BsSi.js";import{c as I,D as T,d as A,T as N,e as z,N as D,P}from"./vendor_mui_icons-B5Ke0Ezt.js";import{u as H,a as B,E as $,L,l as _}from"./lazyNamed-zInXtDnI.js";import{i as W}from"./GameInfo.styles-EJwFT5CT.js";import{t as q}from"./PageLayout-B7XtVyvX.js";const U="130%",F="6px",V=100,K=1e3,J=100,X=.8,Y={...n("slant"),GHOST_MOVES:"slant-ghost-moves"},Q=0,Z=8,ee=5,te={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:o.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},GHOST:{BORDER:"var(--slant-ghost-border)",BG_SUBTLE:"var(--slant-ghost-bg-subtle)",BG_HOVER:"var(--slant-ghost-bg-hover)",DASHED_BORDER:"var(--slant-ghost-dashed-border)",HINT_BG:"var(--slant-ghost-hint-bg)",HINT_BORDER:"var(--slant-ghost-hint-border)",HINT_TEXT:"var(--slant-ghost-hint-text)"}},re=1,oe=2,ne=e.memo(function({value:e,color:r}){return t.jsxs(v,{sx:{width:"100%",height:"100%",position:"relative"},children:[e===re&&t.jsx(v,{sx:{position:"absolute",width:U,height:F,backgroundColor:r,borderRadius:k.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:te.SHADOWS.LINE,transition:w.transition,pointerEvents:"none"}}),e===oe&&t.jsx(v,{sx:{position:"absolute",width:U,height:F,backgroundColor:r,borderRadius:k.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:te.SHADOWS.LINE,transition:w.transition,pointerEvents:"none"}})]})}),se=e.memo(function({value:e,hasConflict:r,numberSize:o}){return t.jsx(v,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:r?te.COLORS.WHITE:te.GHOST.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:r?"scale(1.1)":"scale(1)"},children:e??""})});function le({onCopy:e,onClear:r,onClose:o}){return t.jsxs(v,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:R.zIndex.base+5,paddingBottom:2},children:[t.jsx(G,{title:"Copy Board",Icon:I,onClick:e,sx:{backgroundColor:E.interactive.selected,color:E.primary.main,"&:hover":{backgroundColor:E.interactive.focus}}}),t.jsx(G,{title:"Clear Calculator",Icon:T,onClick:r,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:E.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),t.jsx(G,{title:"Close Calculator",Icon:A,onClick:o,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:E.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}class ae{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error(`DSU: Index ${String(e)} out of bounds`);t!==e&&(this.parent[e]=this.find(t));const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return r}union(e,t){const r=this.find(e),o=this.find(t);return r!==o&&(this.parent[r]=o,!0)}connected(e,t){return this.find(e)===this.find(t)}}function ie(e,t,r){return e*(r+1)+t}function ce(e,t,r){const o=new Map,n=new Set;for(let s=0;s<t;s++)for(let t=0;t<r;t++){const n=e[s]?.[t];if(!n||0===n)continue;const l=ie(s,n===re?t+1:t,r),a=ie(s+1,n===re?t:t+1,r);o.has(l)||o.set(l,[]),o.has(a)||o.set(a,[]),o.get(l)?.push({node:a,r:s,c:t}),o.get(a)?.push({node:l,r:s,c:t})}const l=new Set,a=new Set,i=[],c=(e,t)=>{l.add(e),a.add(e);const r=o.get(e)??[];for(const{node:o,r:u,c:d}of r)if(o!==t)if(a.has(o)){n.add(s(u,d));for(let e=i.length-1;e>=0;e--){const t=i[e];if(!t)break;if(n.add(s(t.r,t.c)),t.u===o||t.v===o)break}}else l.has(o)||(i.push({r:u,c:d,u:e,v:o}),c(o,e),i.pop());a.delete(e)};for(const s of o.keys())l.has(s)||c(s,-1);return n}function ue({rows:e,cols:t,numbers:o,userMoves:n}){const[l,a]=r.useState(new Map),[i,c]=r.useState([]),[u,d]=r.useState(new Set),f=r.useRef(null),[h,p]=r.useState("probing");return r.useEffect(()=>{let e=!1;const t=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=t;const r=setTimeout(()=>{e||(p("broken"),f.current=null,t.terminate())},2e3);return t.onmessage=t=>{if(e)return;const o=t.data;"RESULT"===o.type&&p(e=>{if("probing"===e)return clearTimeout(r),"healthy";const{gridState:t,conflicts:n,cycleCells:s}=o.payload;return a(t),c(n),d(s),e})},t.onerror=()=>{clearTimeout(r),p("broken"),f.current=null,t.terminate()},t.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(r),t.terminate()}},[]),r.useEffect(()=>{if("healthy"===h&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:t,numbers:o,userMoves:n}});else if("broken"===h){const r=function(e,t,r,o){const n=new Map,l=[],a=[];o.forEach((e,t)=>{n.set(t,{state:e,source:"user"});const[r,o]=t.split(",").map(Number);void 0!==r&&void 0!==o&&l.push({r:r,c:o})});const i=(r,o)=>{if(r<0||r>=e||o<0||o>=t)return 0;const l=s(r,o);return n.get(l)?.state??0},c=(e,t,r,o)=>{const i=s(e,t),c=n.get(i);c?c.state!==r&&a.push({type:"cell",r:e,c:t}):(n.set(i,{state:r,source:o}),l.push({r:e,c:t}))},u=(r,o)=>[{r:r-1,c:o-1,required:oe},{r:r-1,c:o,required:re},{r:r,c:o-1,required:re},{r:r,c:o,required:oe}].filter(r=>r.r>=0&&r.r<e&&r.c>=0&&r.c<t);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:t,c:o}=e,f=[{r:t,c:o},{r:t,c:o+1},{r:t+1,c:o},{r:t+1,c:o+1}];for(const l of f){const e=r[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const h=[];for(const t of d){const e=i(t.r,t.c);0===e?h.push(t):e===t.required&&f++}if(f>e)a.push({type:"node",r:l.r,c:l.c});else if(f+h.length<e)a.push({type:"node",r:l.r,c:l.c});else if("user"===n.get(s(t,o))?.source)if(f===e&&h.length>0)for(const t of h){const e=t.required===re?oe:re;c(t.r,t.c,e,"propagated")}else if(f+h.length===e&&h.length>0)for(const t of h)c(t.r,t.c,t.required,"propagated")}}const f=Array.from({length:e},()=>new Array(t).fill(0));for(const[s,p]of n.entries()){const[e,t]=s.split(",").map(Number);void 0!==e&&void 0!==t&&f[e]&&(f[e][t]=p.state)}const h=ce(f,e,t);return{gridState:n,conflicts:a,cycleCells:h}}(e,t,o,n);a(r.gridState),c(r.conflicts),d(r.cycleCells)}},[n,o,e,t,h]),{gridState:l,conflicts:i,cycleCells:u}}function de({rows:e,cols:n,numbers:c,size:u,initialMoves:d,onMove:f,onCopy:h,onClear:p,onClose:g}){const m=H("sm"),b=d,{getDragProps:x}=l({onToggle:(e,t,r,o,n)=>{const l=s(e,t);if(!n)return void f(l,o);const a=b.get(l);let i;return i=r?a===re?oe:a===oe?void 0:re:a===oe?re:a===re?void 0:oe,f(l,i),i},touchTimeout:a.timing.touchHoldDelay,checkEnabled:()=>!0}),{gridState:y,conflicts:S,cycleCells:C}=ue({rows:e,cols:n,numbers:c,userMoves:b}),w=.4*u,k=u-w,G=r.useMemo(()=>new Set(S.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[S]),j=r.useMemo(()=>new Set(S.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[S]),M=r.useCallback((e,r)=>function({r:e,c:r,gridState:o,conflictSet:n,cycleCells:l,getDragProps:a}){const i=s(e,r),c=o.get(i),u=c?.state??0,d=c?.source,f=n.has(i),h=l.has(i),p=a(i);let g=E.text.primary;return f?g=E.data.red:h?g="user"===d?E.data.red:E.data.orange:"user"===d?g=E.primary.main:"propagated"===d&&(g=E.data.green),{...p,"data-pos":i,"data-type":"cell",sx:{...p.sx,cursor:"pointer",border:`1px solid ${te.GHOST.BORDER}`,position:"relative",backgroundColor:te.GHOST.BG_SUBTLE,"&:hover":{backgroundColor:te.GHOST.BG_HOVER}},children:t.jsx(ne,{value:u,color:g})}}({r:e,c:r,gridState:y,conflictSet:G,cycleCells:C,getDragProps:x}),[y,G,C,x]),O=r.useCallback((e,r)=>function({r:e,c:r,numbers:o,nodeConflictSet:n,numberSize:l}){const a=o[e]?.[r],i=n.has(s(e,r));return{"data-pos":s(e,r),"data-type":"hint",children:t.jsx(se,{value:a??null,hasConflict:i,numberSize:l}),sx:{borderRadius:"50%",backgroundColor:i?E.data.red:te.GHOST.HINT_BG,border:null==a?"none":`2px solid ${i?E.data.red:te.GHOST.HINT_BORDER}`,zIndex:5,opacity:null==a?0:1,position:"relative",pointerEvents:"none"}}}({r:e,c:r,numbers:c,nodeConflictSet:j,numberSize:w}),[c,j,w]);return t.jsxs(v,{sx:{position:"relative",userSelect:"none"},children:[t.jsxs(v,{sx:{position:"relative",padding:m?o.PADDING.MOBILE:o.PADDING.DESKTOP,border:`2px dashed ${te.GHOST.DASHED_BORDER}`,borderRadius:o.BORDER_RADIUS},children:[t.jsx(v,{sx:{position:"relative",zIndex:R.zIndex.base+1},children:t.jsx(i,{size:u,rows:e,cols:n,cellProps:M,space:0,sx:{width:"fit-content"}})}),t.jsx(v,{sx:{position:"absolute",top:m?o.PADDING.MOBILE:o.PADDING.DESKTOP,left:m?o.PADDING.MOBILE:o.PADDING.DESKTOP,transform:`translate(-${String(w/2)}rem, -${String(w/2)}rem)`,zIndex:R.zIndex.base+2,pointerEvents:"none"},children:t.jsx(i,{size:w,rows:e+1,cols:n+1,cellProps:O,space:k,sx:{width:"fit-content"}})})]}),t.jsx(le,{onCopy:h,onClear:p,onClose:g})]})}function fe({size:e,rows:o,cols:n}){const s=r.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),l=r.useCallback(()=>({}),[]);return t.jsx(v,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:t.jsx(c,{size:e,rows:o+1,cols:n+1,cellRows:o,cellCols:n,overlayProps:l,cellProps:s,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}function he({isGhostMode:e,generating:r,dimensionsMismatch:o,rows:n,cols:s,state:l,size:a,ghostMoves:i,onGhostMove:d,onGhostCopy:f,onGhostClear:h,onGhostClose:p,cellProps:g,overlayProps:m}){return e?t.jsx(B,{fallback:t.jsx($,{message:"Ghost mode encountered an error. Close and reopen to continue."}),children:t.jsx(de,{rows:n,cols:s,numbers:l.numbers,size:a,initialMoves:i,onMove:d,onCopy:f,onClear:h,onClose:p})}):r||o?t.jsx(fe,{size:a,rows:n,cols:s}):t.jsx(B,{FallbackComponent:j,fallbackProps:{title:u.errors.boardTitle,resetLabel:u.errors.boardReset},children:t.jsx(c,{size:a,rows:n+1,cols:s+1,cellRows:n,cellCols:s,overlayProps:m,cellProps:g,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}const pe=[[oe,re,oe],[oe,re,oe],[oe,re,oe]],ge=[[1,0,2,0],[1,2,2,1],[1,2,2,1],[0,2,0,1]],me=[[0,0],[2,2],[0,2],[2,0],[0,1],[2,1],[1,0],[1,1],[1,2]];function be(e,t,r){const o=Array.from({length:t+1},()=>new Array(r+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<r;e++){const r=t[e];if(r===re){const t=o[n];if(t){const r=t[e+1];void 0!==r&&(t[e+1]=r+1)}const r=o[n+1];if(r){const t=r[e];void 0!==t&&(r[e]=t+1)}}else if(r===oe){const t=o[n];if(t){const r=t[e];void 0!==r&&(t[e]=r+1)}const r=o[n+1];if(r){const t=r[e+1];void 0!==t&&(r[e+1]=t+1)}}}}return o}function xe(e,t,r,o){const n=new Set,l=be(e,r,o);for(let a=0;a<=r;a++)for(let e=0;e<=o;e++){const r=t[a]?.[e];if(null==r)continue;(l[a]?.[e]??0)===r&&n.add(s(a,e))}return n}function ye(e,t){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:E.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:te.SHADOWS.LINE,transition:w.transition,pointerEvents:"none"}}function Se({size:e}){const o=r.useMemo(()=>function(){const e=[],t=Array.from({length:3},()=>new Array(3).fill(0));e.push(t);let r=t.map(e=>[...e]);for(const[o,n]of me){r=r.map(e=>[...e]);const t=pe[o]?.[n];if(void 0!==t){const e=r[o];e&&(e[n]=t)}e.push(r)}return e.push(r.map(e=>[...e])),e}(),[]),[n,l]=r.useState(0);r.useEffect(()=>{const e=setInterval(()=>{l(e=>(e+1)%o.length)},1500);return()=>{clearInterval(e)}},[o.length]);const a=r.useMemo(()=>o[n]??o[0]??[],[o,n]),i=n>0&&n<=me.length?(()=>{const e=me[n-1];return e?s(e[0],e[1]):null})():null,u=r.useMemo(()=>xe(a,ge,3,3),[a]),f=.4*e,h=n>=me.length&&a.every(e=>e.every(e=>0!==e)),p=r.useMemo(()=>function(e,r,o){return(n,l)=>{const a=e[n]?.[l],i=s(n,l)===o;return{sx:{border:`1px solid ${E.border.subtle}`,position:"relative",transition:w.transition,...i?{backgroundColor:E.interactive.hover}:{}},children:t.jsxs(v,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===re&&t.jsx(v,{sx:ye("-45deg",r)}),a===oe&&t.jsx(v,{sx:ye("45deg",r)})]})}}}(a,e,i),[a,e,i]),g=r.useMemo(()=>function(e,r,o){return(n,l)=>{const a=e[n]?.[l],i=s(n,l),c=r.has(i);return{sx:{pointerEvents:"none"},children:t.jsx(v,{sx:{borderRadius:"50%",backgroundColor:E.surface.background,border:null==a?"none":`2px solid ${c?"transparent":E.border.subtle}`,fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:c?E.interactive.disabledText:E.text.primary,boxShadow:c?"none":te.SHADOWS.HINT,zIndex:5,opacity:null==a?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",width:`${String(o)}rem`,height:`${String(o)}rem`},children:a??""})}}}(ge,u,f),[u,f]);return t.jsx(v,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsxs(v,{sx:{position:"relative",display:"inline-flex"},children:[t.jsx(c,{size:e,rows:4,cols:4,cellRows:3,cellCols:3,overlayProps:g,cellProps:p,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0}),t.jsx(d,{show:h,size:e,iconSizeRatio:1,primaryColor:E.primary.main,showLabel:!1})]})})}const ve=["Slant Rules","Example"],Ce=[{Icon:N,title:"Fill with Slashes",text:String.raw`Place a forward (/) or backward (\) slash in every cell of the grid.`},{Icon:z,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:D,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],we={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},ke=e=>[...q(W(e)),{overflowY:"hidden"}];function Ee(e){return{storageKey:"slant",grid:{defaultSize:ee,maxSize:Z,gridPadding:{x:e?48:80,y:120},widthLimit:K,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:V}),...e?{boardSizeFactor:.92}:{},maxCellSize:J,rowOffset:1,colOffset:1}}}const Ge=_(()=>M(()=>import("./index-B3dZVpWa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])),"GameInfo");function Re({open:e,toggleOpen:r,handleOpenCalculator:o}){const n=H("sm");return e?t.jsx(L,{message:u.info.loading,errorFallback:t.jsx($,{message:u.info.loadError}),children:t.jsx(Ge,{open:e,toggleOpen:r,titles:ve,instructions:Ce,instructionsFooter:t.jsx(v,{sx:{display:"flex",px:2,ml:{xs:5,sm:4},pt:{xs:0,sm:3},mt:{xs:-2,sm:0}},children:t.jsx(C,{variant:"outlined",startIcon:t.jsx(P,{}),onClick:o,sx:{borderColor:E.border.subtle,color:E.text.secondary},children:"Open Calculator"})}),exampleContent:t.jsx(Se,{size:n?4:5}),cardSx:we,contentSxOverride:ke})}):null}function je(e,t){return`${Y.STATE}-${String(e)}x${String(t)}`}function Me(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function Oe({rows:e,cols:t,isGhostMode:o,requestGeneration:n,cancelGeneration:s}){const l=r.useRef(`${String(e)},${String(t)}`);r.useEffect(()=>{const r=`${String(e)},${String(t)}`;r!==l.current&&(l.current=r,o||!function(e,t){const r=je(e,t),o=localStorage.getItem(r);if(!o)return!1;try{const e=JSON.parse(o);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,t)?n(e,t):s())},[e,t,n,s,o])}function Ie(e,t,r,o){return{grid:Array.from({length:e},()=>new Array(t).fill(0)),numbers:r,solution:o,rows:e,cols:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Te({getInitialState:e,dispatchRef:t,dimsRef:o,onStaleResult:n}){const[s,l]=r.useState(!1),a=r.useRef(null),i=r.useRef("probing"),c=r.useRef(0),u=r.useRef(0),d=r.useRef(null),f=r.useRef(0),h=r.useRef(n);h.current=n;const p=r.useRef(!1),g=r.useRef(null),m=r.useRef(!1),b=r.useCallback(()=>{if(g.current){const e=g.current;h.current?.(e,e.rows,e.cols)}p.current=!1,g.current=null,m.current=!1},[]),x=r.useCallback((r,o)=>{t.current?.({type:"hydrate",state:e(r,o)}),l(!1)},[t,e]),y=r.useCallback((e,t)=>{b(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const r=++c.current;"healthy"===i.current&&a.current?(f.current++,a.current.postMessage({type:"GENERATE",payload:{rows:e,cols:t}})):u.current=requestAnimationFrame(()=>{c.current===r&&x(e,t)})},250)},[x,b]),S=r.useCallback((t,r)=>{p.current||(p.current=!0,g.current=null,m.current=!1,"healthy"===i.current&&a.current?(f.current++,a.current.postMessage({type:"GENERATE",payload:{rows:t,cols:r}})):requestAnimationFrame(()=>{p.current&&(g.current=e(t,r))}))},[e]),v=r.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),b(),l(!1)},[b]),C=r.useCallback(()=>{if(g.current){const e=g.current;return g.current=null,t.current?.({type:"hydrate",state:e}),b(),void l(!1)}if(p.current)return m.current=!0,void l(!0);y(o.current.rows,o.current.cols)},[y,o,t,b]);return r.useEffect(()=>{let e=!1;const r=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});a.current=r;const n=setTimeout(()=>{e||"probing"!==i.current||(i.current="broken",f.current=0,a.current=null,r.terminate())},2e3);return r.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(n),i.current="broken",f.current=0,a.current=null,void r.terminate();if("RESULT"===s.data.type){if("probing"===i.current)return clearTimeout(n),void(i.current="healthy");f.current--;const{rows:e,cols:r,numbers:a,solution:c}=s.data.payload,u=o.current;if(e!==u.rows||r!==u.cols)return h.current?.(Ie(e,r,a,c),e,r),void(f.current<=0&&l(!1));if(f.current>0)return;const d=Ie(e,r,a,c);if(p.current)return g.current=d,void(m.current&&(t.current?.({type:"hydrate",state:d}),p.current=!1,g.current=null,m.current=!1,l(!1)));t.current?.({type:"hydrate",state:d}),l(!1)}}},r.onerror=()=>{clearTimeout(n),i.current="broken",f.current=0,a.current=null,r.terminate()},r.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(n),null!==d.current&&clearTimeout(d.current),r.terminate()}},[t,o]),{generating:s,requestGeneration:y,handleNextAsync:C,prefetch:S,cancelGeneration:v}}function Ae(e,t,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:r?E.data.red:E.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:te.SHADOWS.LINE,transition:w.transition,pointerEvents:"none"}}const Ne=(e,r,o)=>(n,l)=>{const a=r.grid[n]?.[l],i=s(n,l),c=r.cycleCells.has(i),u=e(i),d=[{v:r.numbers[n]?.[l],p:s(n,l)},{v:r.numbers[n]?.[l+1],p:s(n,l+1)},{v:r.numbers[n+1]?.[l],p:s(n+1,l)},{v:r.numbers[n+1]?.[l+1],p:s(n+1,l+1)}].map(({v:e,p:t})=>{if(null==e)return"-";const o=r.errorNodes.has(t)?"Error":r.satisfiedNodes.has(t)?"Ok":"Pending";return`${String(e)} (${o})`});return{...u,"aria-label":`Cell ${String(n+1)}, ${String(l+1)}. Clues: ${d.join(", ")}. ${0===a?"Empty":a===re?"Forward Slash":"Backward Slash"}${c?", Loop Error":""}`,sx:{...u.sx,cursor:"pointer",border:`1px solid ${E.border.subtle}`,position:"relative","&:hover":{backgroundColor:E.interactive.hover}},children:t.jsxs(v,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===re&&t.jsx(v,{sx:Ae("-45deg",o,c)}),a===oe&&t.jsx(v,{sx:Ae("45deg",o,c)})]})}};function ze({game:{state:e,rows:o,cols:n,size:l,mobile:a,isGhostMode:i,generating:c,handleNextAsync:u},ghost:{ghostMoves:d,handleGhostMove:f,handleGhostCopy:p,handleGhostClear:g,handleGhostClose:m,handleBoxClick:b,handleOpenCalculator:x,boardSx:y},info:{infoOpen:S,toggleInfo:C},controls:w,getDragProps:k}){const G=.4*l,R=h(Ne,k,[e,l]),j=r.useMemo(()=>((e,r)=>(o,n)=>{const l=e.numbers[o]?.[n],a=s(o,n),i=e.errorNodes.has(a),c=e.satisfiedNodes.has(a);return{sx:{pointerEvents:"none"},children:t.jsx(v,{sx:{borderRadius:"50%",backgroundColor:i?E.data.red:E.surface.background,border:null==l?"none":`2px solid ${i?E.data.red:c?"transparent":E.border.subtle}`,fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:i?te.COLORS.WHITE:c?E.interactive.disabledText:E.text.primary,boxShadow:c&&!i?"none":te.SHADOWS.HINT,zIndex:5,opacity:null==l?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:i?"scale(1.1)":"scale(1)",width:`${String(r)}rem`,height:`${String(r)}rem`},children:l??""})}})(e,G),[e,G]),M=r.useMemo(()=>({px:a?"1rem":"2rem",pt:a?"1rem":"2rem"}),[a]);return{boardProps:{isGhostMode:i,generating:c,dimensionsMismatch:o!==e.rows||n!==e.cols,rows:o,cols:n,state:e,size:l,ghostMoves:d,onGhostMove:f,onGhostCopy:p,onGhostClear:g,onGhostClose:m,cellProps:R,overlayProps:j},controlsProps:{...w,onRefresh:u,disabled:c,onOpenInfo:C,hidden:i},layoutProps:{boardSx:y,contentSx:M,iconSizeRatio:X},infoProps:{open:S,toggleOpen:C,handleOpenCalculator:x,handleBoxClick:b},trophyProps:{show:!i&&e.solved,onReset:u,size:l,iconSizeRatio:X}}}function De(e,t,r,o,n,s){const l=e[r];if(!l)return!1;l[o]=n;const a=ie(r,n===re?o+1:o,s),i=ie(r+1,n===re?o:o+1,s);return!t.connected(a,i)&&(t.union(a,i),!0)}function Pe(e,t,r){const o=Array.from({length:t},()=>new Array(r).fill(0)),n=new ae((t+1)*(r+1)),s=function(e,t,r,o,n){let s=!0;for(;s;){s=!1;for(let l=0;l<=r;l++)for(let a=0;a<=o;a++){const i=t[l]?.[a];if(null==i)continue;const c=[{gr:l-1,gc:a-1,pt:oe},{gr:l-1,gc:a,pt:re},{gr:l,gc:a-1,pt:re},{gr:l,gc:a,pt:oe}].filter(({gr:e,gc:t})=>e>=0&&e<r&&t>=0&&t<o);let u=0;const d=[];for(const t of c){const r=e[t.gr]?.[t.gc];0===r?d.push(t):r===t.pt&&u++}if(u>i)return"contradiction";if(u+d.length<i)return"contradiction";if(u===i&&d.length>0){for(const{gr:t,gc:r,pt:l}of d)if(0===e[t]?.[r]){if(!De(e,n,t,r,l===re?oe:re,o))return"contradiction";s=!0}}else if(u+d.length===i&&d.length>0)for(const{gr:t,gc:r,pt:l}of d)if(0===e[t]?.[r]){if(!De(e,n,t,r,l,o))return"contradiction";s=!0}}if(!s){for(let t=0;t<r;t++)for(let r=0;r<o;r++){const l=e[t];if(0!==l?.[r])continue;const a=ie(t,r+1,o),i=ie(t+1,r,o),c=n.connected(a,i),u=ie(t,r,o),d=ie(t+1,r+1,o),f=n.connected(u,d);if(c&&f)return"contradiction";c?(l[r]=oe,s=!0,n.union(u,d)):f&&(l[r]=re,s=!0,n.union(a,i))}if(!s)for(let l=0;l<r;l++)for(let a=0;a<o;a++){const i=e[l];if(0!==i?.[a])continue;let c=!1,u=!1;const d=[{nr:l,nc:a,touchedBy:oe},{nr:l,nc:a+1,touchedBy:re},{nr:l+1,nc:a,touchedBy:re},{nr:l+1,nc:a+1,touchedBy:oe}];for(const{nr:n,nc:s,touchedBy:l}of d){const a=t[n]?.[s];if(null==a)continue;const i=[{gr:n-1,gc:s-1,pt:oe},{gr:n-1,gc:s,pt:re},{gr:n,gc:s-1,pt:re},{gr:n,gc:s,pt:oe}].filter(({gr:e,gc:t})=>e>=0&&e<r&&t>=0&&t<o);let d=0,f=0;for(const t of i){const r=e[t.gr]?.[t.gc];0===r?f++:r===t.pt&&d++}l===re?(d+1>a&&(c=!0),d+(f-1)<a&&(u=!0)):(d+1>a&&(u=!0),d+(f-1)<a&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!De(e,n,l,a,oe,o))return"contradiction";s=!0}else if(u){if(!De(e,n,l,a,re,o))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(o,e,t,r,n);return"contradiction"!==s&&("solved"===s&&function(e,t,r,o){const n=be(e,r,o);for(let s=0;s<=r;s++)for(let e=0;e<=o;e++){const r=t[s]?.[e];if(null!=r&&n[s]?.[e]!==r)return!1}return!0}(o,e,t,r))}function He(e,t){let r=[],o=!1;for(let s=0;s<50&&!o;s++){r=Array.from({length:e},()=>new Array(t).fill(0));const n=new ae((e+1)*(t+1)),s=[];for(let r=0;r<e;r++)for(let e=0;e<t;e++)s.push({r:r,c:e});for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1)),r=s[e],o=s[t];r&&o&&(s[e]=o,s[t]=r)}let l=!1;for(const{r:e,c:o}of s){const s=ie(e,o+1,t),a=ie(e+1,o,t),i=n.connected(s,a),c=ie(e,o,t),u=ie(e+1,o+1,t),d=n.connected(c,u);if(i&&d){l=!0;break}const f=r[e];f&&(i?(f[o]=oe,n.union(c,u)):d||Math.random()<.5?(f[o]=re,n.union(s,a)):(f[o]=oe,n.union(c,u)))}l||(o=!0)}o||(r=Array.from({length:e},(e,r)=>new Array(t).fill(r%2==0?re:oe)));const n=function(e,t,r,o){const n=e.map(e=>[...e]),s=[];for(let i=0;i<=t;i++)for(let e=0;e<=r;e++)s.push({r:i,c:e});for(let i=s.length-1;i>0;i--){const e=Math.floor(Math.random()*(i+1)),t=s[i],r=s[e];t&&r&&(s[i]=r,s[e]=t)}const l=Math.floor((t+1)*(r+1)*o);let a=0;for(let i=0;i<=t;i++)for(let e=0;e<=r;e++)null!==n[i]?.[e]&&a++;for(const{r:i,c:c}of s){if(a<=l)break;const e=n[i];if(!e)continue;const o=e[c];null!=o&&(e[c]=null,Pe(n,t,r)?a--:e[c]=o)}return n}(be(r,e,t).map(e=>e.map(e=>e)),e,t,Q);return{numbers:n,solution:r}}const Be=p({getInitialState:$e,customHandler:(e,t)=>{if("toggle"!==t.type)return null;if(e.solved)return e;const{row:r,col:o}=t,n=e.grid.map(e=>[...e]),l=n[r];if(!l)return e;const a=l[o];if(void 0===a)return e;t.reverse?l[o]=0===a?re:a===re?oe:0:l[o]=0===a?oe:a===oe?re:0;let i=!1;if(n.every(e=>e.every(e=>0!==e))){const t=be(n,e.rows,e.cols);e.numbers.every((e,r)=>e.every((e,o)=>null==e||e===t[r]?.[o]))&&!function(e,t,r){const o=new ae((t+1)*(r+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<r;e++){const s=t[e];if(void 0===s||0===s)continue;const l=ie(n,s===re?e+1:e,r),a=ie(n+1,s===re?e:e+1,r);if(!o.union(l,a))return!0}}return!1}(n,e.rows,e.cols)&&(i=!0)}const c=function(e,t,r,o){const n=new Set,l=be(e,r,o);for(let a=0;a<=r;a++)for(let i=0;i<=o;i++){const c=t[a]?.[i];if(null==c)continue;const u=l[a]?.[i]??0;u>c?n.add(s(a,i)):u+[{gr:a-1,gc:i-1},{gr:a-1,gc:i},{gr:a,gc:i-1},{gr:a,gc:i}].filter(({gr:t,gc:n})=>t>=0&&t<r&&n>=0&&n<o&&0===e[t]?.[n]).length<c&&n.add(s(a,i))}return n}(n,e.numbers,e.rows,e.cols),u=ce(n,e.rows,e.cols),d=xe(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:i,errorNodes:c,cycleCells:u,satisfiedNodes:d}}});function $e(e,t){const{numbers:r,solution:o}=He(e,t);return{grid:Array.from({length:e},()=>new Array(t).fill(0)),numbers:r,solution:o,rows:g(e),cols:g(t),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Le(){const t=H("sm"),[o,n]=e.useState(!1),{isOpen:i,toggle:c}=m(),u=r.useRef(null),d=r.useRef({rows:0,cols:0}),h=r.useCallback((e,t,r)=>{o||function(e,t,r){const o=je(t,r);try{localStorage.setItem(o,JSON.stringify(Me(e)))}catch{}}(e,t,r)},[o]),{generating:p,requestGeneration:g,handleNextAsync:y,prefetch:S,cancelGeneration:v}=Te({getInitialState:$e,dispatchRef:u,dimsRef:d,onStaleResult:h}),{rows:C,cols:w,state:k,dispatch:E,size:G,controlsProps:R}=b({...Ee(t),logic:{reducer:Be,getInitialState:(e,t)=>$e(e,t),onNext:y,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!o,serialize:Me,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const t=e;return Array.isArray(t.grid)&&Array.isArray(t.numbers)&&Array.isArray(t.solution)&&"number"==typeof t.rows&&"number"==typeof t.cols&&"boolean"==typeof t.solved&&Array.isArray(t.errorNodes)&&Array.isArray(t.cycleCells)&&Array.isArray(t.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});u.current=E,d.current={rows:C,cols:w};const{ghostMoves:j,boardSx:M,handleGhostMove:O,handleGhostCopy:I,handleGhostClear:T,handleGhostClose:A,handleBoxClick:N,handleOpenCalculator:z}=function({isGhostMode:e,setIsGhostMode:t,state:o,rows:n,cols:l,storageKey:a,toggleInfo:i}){const[c,u]=r.useState(new Map);f({storageKey:a,rows:n,cols:l,state:c,onRestore:e=>{u(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const d=r.useRef("");r.useEffect(()=>{const e=JSON.stringify(o.numbers);d.current&&d.current!==e&&u(new Map),d.current=e},[o.numbers,o.rows,o.cols]);const h=r.useCallback((e,t)=>{u(r=>{const o=new Map(r);return void 0===t?o.delete(e):o.set(e,t),o})},[]),p=r.useCallback(()=>{const e=new Map;o.grid.forEach((t,r)=>{t.forEach((t,o)=>{0!==t&&e.set(s(r,o),t)})}),u(e)},[o.grid]),g=r.useCallback(()=>{u(new Map)},[]),m=r.useCallback(()=>{t(!1)},[t]),b=r.useCallback(e=>{e.stopPropagation()},[]);return{ghostMoves:c,boardSx:r.useMemo(()=>e?{padding:{xs:0,sm:0}}:void 0,[e]),handleGhostMove:h,handleGhostCopy:p,handleGhostClear:g,handleGhostClose:m,handleBoxClick:b,handleOpenCalculator:r.useCallback(()=>{i(),t(!0)},[i,t])}}({isGhostMode:o,setIsGhostMode:n,state:k,rows:C,cols:w,storageKey:Y.GHOST_MOVES,toggleInfo:c});Oe({rows:C,cols:w,isGhostMode:o,requestGeneration:g,cancelGeneration:v}),r.useEffect(()=>{k.solved&&!o&&S(C,w)},[k.solved,o,C,w,S]);const{getDragProps:D}=l({onToggle:(e,t,r)=>{E({type:"toggle",row:x(e),col:x(t),reverse:r})},checkEnabled:()=>!k.solved,touchTimeout:a.timing.touchHoldDelay});return ze({game:{state:k,rows:C,cols:w,size:G,mobile:t,isGhostMode:o,generating:p,handleNextAsync:y},ghost:{ghostMoves:j,handleGhostMove:O,handleGhostCopy:I,handleGhostClear:T,handleGhostClose:A,handleBoxClick:N,handleOpenCalculator:z,boardSx:M},info:{infoOpen:i,toggleInfo:c},controls:R,getDragProps:D})}function _e(){const{boardProps:e,controlsProps:r,layoutProps:o,infoProps:n,trophyProps:s}=Le();return t.jsxs(y,{title:O.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",controls:t.jsx(S,{...r}),trophyProps:s,layout:{paddingBottom:{xs:"120px",md:"150px"},contentSx:o.contentSx,boardSx:o.boardSx},onClick:e.isGhostMode?e.onGhostClose:void 0,children:[t.jsx(v,{onClick:n.handleBoxClick,children:t.jsx(he,{...e})}),t.jsx(Re,{...n})]})}export{_e as Slant};
