import{j as p,r as s}from"./vendor_react-CiGj4Onb.js";import{C as Y,d as _,u as J,c as se}from"./layout-BjJQiv_g.js";import{B as L,G as oe}from"./vendor_mui_core-D3ATvS1w.js";import{L as re,f as ie,e as q,a as ae}from"./index-Br2Z899S.js";import{w as ce,x as le,E as ue}from"./vendor_mui_icons-CkUhQDGV.js";import{G as de}from"./GlobalHeader-Dnao0l7Y.js";function fe(e){const{frontProps:t,backProps:n,size:o,rows:l,cols:m,frontLayerSx:a,backLayerSx:d}=e;return p.jsxs(L,{sx:{display:"grid",placeItems:"center"},children:[p.jsx(L,{sx:{gridArea:"1/1",...d},children:p.jsx(Y,{space:0,size:o,rows:l-1,cols:m-1,cellProps:n})}),p.jsx(L,{sx:{gridArea:"1/1",zIndex:re.zIndex.base+1,...a},children:p.jsx(Y,{space:0,size:o,rows:l,cols:m,cellProps:t})})]})}function me({rows:e,cols:t,dynamicSize:n,minSize:o,maxSize:l,handlePlus:m,handleMinus:a,onRefresh:d,disabled:f=!1,children:r}){const i=e<=o&&t<=o,w=e>=l&&t>=l||e===n.rows&&t===n.cols;return p.jsxs(ie,{onRefresh:d,children:[p.jsx(q,{title:"Decrease Size",Icon:ce,onClick:a,disabled:f||i}),p.jsx(q,{title:"Increase Size",Icon:le,onClick:m,disabled:f||w}),r]})}const he={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}};function pe(e,t){return`${e.toString()},${t.toString()}`}function we(e){return(t,n)=>{if(e.customHandler){const o=e.customHandler(t,n);if(o!==t)return o}switch(n.type){case"resize":if("newRows"in n||"rows"in n||"cols"in n){const o=n.newRows??n.rows??t.rows,l=n.newCols??n.cols??t.cols;return e.getInitialState(o,l)}return t;case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return"state"in n?n.state:t;default:return t}}}function ge(e,t,n){return s.useMemo(()=>e(t,...n),[e,t,n])}function Q({onAction:e,checkEnabled:t=()=>!0,touchTimeout:n=500,posAttribute:o="data-pos",preventDefault:l=!0,transition:m="all 0.2s"}){const[a,d]=s.useState(null),f=s.useRef(new Set),r=s.useRef(0),i=s.useCallback(()=>{d(null),f.current.clear()},[]),w=s.useCallback(u=>{if(a===null)return;const c=u.touches[0];if(!c)return;const v=document.elementFromPoint(c.clientX,c.clientY);if(!v)return;const D=v.closest(`[${o}]`);if(D){const I=D.getAttribute(o);I&&!f.current.has(I)&&(e(I,a===2,!1),f.current.add(I))}},[a,e,o]);s.useEffect(()=>(window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),window.addEventListener("touchmove",w,{passive:!1}),()=>{window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),window.removeEventListener("touchmove",w)}),[i,w]);const x=s.useCallback(u=>({onMouseDown:c=>{t()&&(c.button!==0&&c.button!==2||Date.now()-r.current<n||(l&&c.preventDefault(),d(c.button),e(u,c.button===2,!0),f.current.add(u)))},onMouseEnter:()=>{a!==null&&!f.current.has(u)&&t()&&(e(u,a===2,!1),f.current.add(u))},onTouchStart:c=>{t()&&(c.cancelable&&l&&c.preventDefault(),r.current=Date.now(),d(0),e(u,!1,!0),f.current.add(u))},onContextMenu:c=>{l&&c.preventDefault()},[o]:u,sx:{touchAction:"none",transition:m}}),[e,t,a,n,o,l,m]);return{isDragging:a!==null,draggingButton:a,getDragProps:x,lastTouchTime:r}}function V({storageKey:e,rows:t,cols:n,state:o,onRestore:l,serialize:m,deserialize:a,enabled:d=!0,saveDebounceMs:f=300}){const r=`${e}-${String(t)}x${String(n)}`,i=s.useRef(l),w=s.useRef(a),x=s.useRef(m);s.useEffect(()=>{i.current=l,w.current=a,x.current=m}),s.useEffect(()=>{if(!d)return;const u=localStorage.getItem(r);if(u)try{const c=JSON.parse(u),v=w.current??(D=>D);i.current(v(c))}catch{localStorage.removeItem(r)}},[r,d]),s.useEffect(()=>{if(!d)return;const u=setTimeout(()=>{const c=(x.current??(v=>v))(o);localStorage.setItem(r,JSON.stringify(c))},f);return()=>{clearTimeout(u)}},[r,o,d,f])}function xe({storageKeys:e,pageTitle:t,gridConfig:n,boardConfig:o,reducer:l,getInitialState:m,winAnimationDelay:a,isSolved:d,persistence:f}){const{rows:r,cols:i,dynamicSize:w,handlePlus:x,handleMinus:u,mobile:c,minSize:v,maxSize:D}=(function({storageKey:S,defaultSize:E,minSize:g=2,maxSize:b=10,headerOffset:M,paddingOffset:T=0,widthLimit:$=1300,cellSizeReference:R,mobileRowOffset:H=0}){const{height:O,width:A}=_(),j=J("sm"),[y,C]=s.useState(()=>{const z=localStorage.getItem(S);return z==="null"?null:z?parseInt(z,10):E}),h=s.useMemo(()=>{const z=j?M.mobile:M.desktop,N=typeof R=="number"?R:j?R.mobile:R.desktop,W=se(N,O-z-T,Math.min(A,$));let X=W.rows-1;const ne=W.cols-1;return j&&(X+=H),{rows:Math.max(g,X),cols:Math.max(g,ne)}},[R,O,A,j,M,T,$,g,H]),{rows:P,cols:K}=s.useMemo(()=>y===null?h:{rows:Math.min(y,h.rows),cols:Math.min(y,h.cols)},[y,h]);return s.useEffect(()=>{localStorage.setItem(S,String(y))},[y,S]),{rows:P,cols:K,dynamicSize:h,handlePlus:()=>{const z=Math.min(P,K);y!==null&&(z<Math.min(h.rows,h.cols)?C(z+1):h.rows===h.cols||P===h.rows&&K===h.cols||C(null))},handleMinus:()=>{const z=Math.min(P,K);if(y===null){const N=Math.min(h.rows,h.cols);h.rows===h.cols?C(Math.max(g,N-1)):C(N)}else z>g&&C(z-1)},desiredSize:y,setDesiredSize:C,mobile:j,width:A,height:O,minSize:g,maxSize:b}})({storageKey:e.size,...n}),I=s.useMemo(()=>m(r,i),[r,i,m]),[B,k]=s.useReducer(l,I),U=s.useMemo(()=>d(B),[B,d]),G=s.useCallback(()=>{k({type:"new"})},[k]);var F;V({storageKey:e.state,rows:r,cols:i,state:B,onRestore:S=>{k({type:"restore",state:S}),k({type:"hydrate",state:S})},...f}),(function(S,E,g=2e3){const b=s.useRef(E);b.current=E,s.useEffect(()=>{if(S){const M=setTimeout(()=>{b.current()},g);return()=>{clearTimeout(M)}}},[S,g])})(U,G,a),F=t,s.useEffect(()=>{document.title=F},[F]),s.useEffect(()=>{k({type:"resize",rows:r,cols:i,newRows:r,newCols:i})},[r,i,k]);const ee=s.useMemo(()=>typeof o.paddingOffset=="function"?o.paddingOffset(c):o.paddingOffset,[o,c]),te=(function({rows:S,cols:E,headerOffset:g,paddingOffset:b,boardMaxWidth:M,boardSizeFactor:T,maxCellSize:$,remBase:R}){const{width:H,height:O}=_(),A=J("sm");return s.useMemo(()=>{const j=A?g.mobile:g.desktop,y=typeof b=="number"?0:b.x,C=typeof b=="number"?b:b.y,h=(Math.min(H,M)-y)*T,P=(O-j-C)*T;return Math.min(h/E,P/S,$)/R},[H,O,A,S,E,g,b,M,T,$,R])})({rows:r+(o.rowOffset??0),cols:i+(o.colOffset??0),headerOffset:n.headerOffset,...o,paddingOffset:ee});return{rows:r,cols:i,state:B,dispatch:k,size:te,mobile:c,solved:U,handleNext:G,controlsProps:{rows:r,cols:i,dynamicSize:w,minSize:v,maxSize:D,handlePlus:x,handleMinus:u,onRefresh:G}}}function Se({onToggle:e,checkEnabled:t,touchTimeout:n,transition:o,posAttribute:l}){const m=s.useRef(void 0),a=s.useRef(e);a.current=e;const d=s.useCallback((r,i,w)=>{if(!t())return;const[x,u]=r.split(",").map(Number);x!==void 0&&u!==void 0&&(w?m.current=a.current(x,u,i,void 0,!0):a.current(x,u,i,m.current,!1))},[t]),{getDragProps:f}=Q({onAction:d,checkEnabled:t,touchTimeout:n,transition:o,posAttribute:l});return{getDragProps:f}}function be({show:e,onReset:t,size:n,iconSizeRatio:o,primaryColor:l,secondaryColor:m,useSecondary:a=!1}){const[d,f]=s.useState(!1);return s.useEffect(()=>{if(e){const r=setTimeout(()=>{f(!0)},500);return()=>{clearTimeout(r)}}f(!1)},[e]),p.jsx(L,{onClick:d?t:void 0,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:d?"pointer":"default",zIndex:10,backgroundColor:"transparent",pointerEvents:e?"auto":"none"},children:n>0&&p.jsx(ue,{sx:{fontSize:`${(n*o).toString()}rem`,color:a?m:l,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}})})}function Z(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function ye({children:e,controls:t,infoUrl:n,_title:o,background:l=ae.surface.background,paddingBottom:m={xs:"80px",md:"120px"},contentSx:a={},showTrophy:d=!1,onReset:f,boardSize:r=0,iconSizeRatio:i=1,primaryColor:w,secondaryColor:x,useSecondaryTrophy:u=!1,boardSx:c}){return J("sm"),p.jsxs(oe,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:l,position:"relative",overflow:"hidden",height:"100vh",transition:"background 0.5s ease-in-out"},children:[p.jsx(de,{showHome:!0,infoUrl:n}),p.jsx(L,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:m},...Z(a)],children:p.jsxs(L,{sx:[{position:"relative",width:"fit-content"},...Z(c)],children:[e,p.jsx(be,{show:d,onReset:f,size:r,iconSizeRatio:i,primaryColor:w,secondaryColor:x,useSecondary:u})]})}),t]})}export{fe as B,ye as G,xe as a,Se as b,we as c,ge as d,me as e,he as f,pe as g,V as h,Q as u};
