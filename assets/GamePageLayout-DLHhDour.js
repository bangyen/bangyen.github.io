import{j as w,r as o}from"./vendor_react-BC_ZxTUy.js";import{C as Y,u as F,c as oe}from"./layout-Csyrq1KZ.js";import{L as se,f as re,e as _,a as ie}from"./index-C8P4Xo67.js";import{B as P,G as ae}from"./vendor_mui_core-D6ruIU1t.js";import{w as ce,x as le,E as ue}from"./vendor_mui_icons-DNj8xVz8.js";import{G as de}from"./GlobalHeader-1JimkmyO.js";function fe(e){const{frontProps:t,backProps:s,size:n,rows:l,cols:d,frontLayerSx:i,backLayerSx:f}=e;return w.jsxs(P,{sx:{display:"grid",placeItems:"center"},children:[w.jsx(P,{sx:{gridArea:"1/1",...f},children:w.jsx(Y,{space:0,size:n,rows:l-1,cols:d-1,cellProps:s})}),w.jsx(P,{sx:{gridArea:"1/1",zIndex:se.zIndex.base+1,...i},children:w.jsx(Y,{space:0,size:n,rows:l,cols:d,cellProps:t})})]})}function me({rows:e,cols:t,dynamicSize:s,minSize:n,maxSize:l,handlePlus:d,handleMinus:i,onRefresh:f,disabled:m=!1,children:a}){const r=e<=n&&t<=n,p=e>=l&&t>=l||e===s.rows&&t===s.cols;return w.jsxs(re,{onRefresh:f,children:[w.jsx(_,{title:"Decrease Size",Icon:ce,onClick:i,disabled:m||r}),w.jsx(_,{title:"Increase Size",Icon:le,onClick:d,disabled:m||p}),a]})}const he={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}};function we(e,t){return`${e.toString()},${t.toString()}`}function pe(e){return(t,s)=>{if(e.customHandler){const n=e.customHandler(t,s);if(n!==t)return n}switch(s.type){case"resize":{const n=s,l=n.newRows??n.rows??t.rows,d=n.newCols??n.cols??t.cols;return e.getInitialState(l,d)}case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return s.state;default:return t}}}function ge(e,t,s){return o.useMemo(()=>e(t,...s),[e,t,s])}function q(){const[e,t]=o.useState({height:window.innerHeight,width:window.innerWidth});return o.useEffect(()=>{const s=()=>{t({height:window.innerHeight,width:window.innerWidth})};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]),e}function Q({onAction:e,checkEnabled:t=()=>!0,touchTimeout:s=500,posAttribute:n="data-pos",preventDefault:l=!0,transition:d="all 0.2s"}){const[i,f]=o.useState(null),m=o.useRef(new Set),a=o.useRef(0),r=o.useCallback(()=>{f(null),m.current.clear()},[]),p=o.useCallback(u=>{if(i===null)return;const c=u.touches[0];if(!c)return;const v=document.elementFromPoint(c.clientX,c.clientY);if(!v)return;const D=v.closest(`[${n}]`);if(D){const I=D.getAttribute(n);I&&!m.current.has(I)&&(e(I,i===2,!1),m.current.add(I))}},[i,e,n]);o.useEffect(()=>(window.addEventListener("mouseup",r),window.addEventListener("touchend",r),window.addEventListener("touchcancel",r),window.addEventListener("touchmove",p,{passive:!1}),()=>{window.removeEventListener("mouseup",r),window.removeEventListener("touchend",r),window.removeEventListener("touchcancel",r),window.removeEventListener("touchmove",p)}),[r,p]);const x=o.useCallback(u=>({onMouseDown:c=>{t()&&(c.button!==0&&c.button!==2||Date.now()-a.current<s||(l&&c.preventDefault(),f(c.button),e(u,c.button===2,!0),m.current.add(u)))},onMouseEnter:()=>{i!==null&&!m.current.has(u)&&t()&&(e(u,i===2,!1),m.current.add(u))},onTouchStart:c=>{t()&&(c.cancelable&&l&&c.preventDefault(),a.current=Date.now(),f(0),e(u,!1,!0),m.current.add(u))},onContextMenu:c=>{l&&c.preventDefault()},[n]:u,sx:{touchAction:"none",transition:d}}),[e,t,i,s,n,l,d]);return{isDragging:i!==null,draggingButton:i,getDragProps:x,lastTouchTime:a}}function V({storageKey:e,rows:t,cols:s,state:n,onRestore:l,serialize:d,deserialize:i,enabled:f=!0,saveDebounceMs:m=300}){const a=`${e}-${String(t)}x${String(s)}`,r=o.useRef(l),p=o.useRef(i),x=o.useRef(d);o.useEffect(()=>{r.current=l,p.current=i,x.current=d}),o.useEffect(()=>{if(!f)return;const u=localStorage.getItem(a);if(u)try{const c=JSON.parse(u),v=p.current??(D=>D);r.current(v(c))}catch{localStorage.removeItem(a)}},[a,f]),o.useEffect(()=>{if(!f)return;const u=setTimeout(()=>{const c=(x.current??(v=>v))(n);localStorage.setItem(a,JSON.stringify(c))},m);return()=>{clearTimeout(u)}},[a,n,f,m])}function xe({storageKeys:e,pageTitle:t,gridConfig:s,boardConfig:n,reducer:l,getInitialState:d,winAnimationDelay:i,isSolved:f,persistence:m}){const{rows:a,cols:r,dynamicSize:p,handlePlus:x,handleMinus:u,mobile:c,minSize:v,maxSize:D}=(function({storageKey:b,defaultSize:k,minSize:g=2,maxSize:S=10,headerOffset:M,paddingOffset:O=0,widthLimit:H=1300,cellSizeReference:C,mobileRowOffset:$=0}){const{height:L,width:T}=q(),j=F("sm"),[y,E]=o.useState(()=>{const z=localStorage.getItem(b);return z==="null"?null:z?parseInt(z,10):k}),h=o.useMemo(()=>{const z=j?M.mobile:M.desktop,N=typeof C=="number"?C:j?C.mobile:C.desktop,U=oe(N,L-z-O,Math.min(T,H));let X=U.rows-1;const ne=U.cols-1;return j&&(X+=$),{rows:Math.max(g,X),cols:Math.max(g,ne)}},[C,L,T,j,M,O,H,g,$]),{rows:A,cols:K}=o.useMemo(()=>y===null?h:{rows:Math.min(y,h.rows),cols:Math.min(y,h.cols)},[y,h]);return o.useEffect(()=>{localStorage.setItem(b,String(y))},[y,b]),{rows:A,cols:K,dynamicSize:h,handlePlus:()=>{const z=Math.min(A,K);y!==null&&(z<Math.min(h.rows,h.cols)?E(z+1):h.rows===h.cols||A===h.rows&&K===h.cols||E(null))},handleMinus:()=>{const z=Math.min(A,K);if(y===null){const N=Math.min(h.rows,h.cols);h.rows===h.cols?E(Math.max(g,N-1)):E(N)}else z>g&&E(z-1)},desiredSize:y,setDesiredSize:E,mobile:j,width:T,height:L,minSize:g,maxSize:S}})({storageKey:e.size,...s}),I=o.useMemo(()=>d(a,r),[a,r,d]),[B,R]=o.useReducer(l,I),J=o.useMemo(()=>f(B),[B,f]),G=o.useCallback(()=>{R({type:"new"})},[R]);var W;V({storageKey:e.state,rows:a,cols:r,state:B,onRestore:b=>{R({type:"restore",state:b}),R({type:"hydrate",state:b})},...m}),(function(b,k,g=2e3){const S=o.useRef(k);S.current=k,o.useEffect(()=>{if(b){const M=setTimeout(()=>{S.current()},g);return()=>{clearTimeout(M)}}},[b,g])})(J,G,i),W=t,o.useEffect(()=>{document.title=W},[W]),o.useEffect(()=>{R({type:"resize",rows:a,cols:r,newRows:a,newCols:r})},[a,r,R]);const ee=o.useMemo(()=>typeof n.paddingOffset=="function"?n.paddingOffset(c):n.paddingOffset,[n,c]),te=(function({rows:b,cols:k,headerOffset:g,paddingOffset:S,boardMaxWidth:M,boardSizeFactor:O,maxCellSize:H,remBase:C}){const{width:$,height:L}=q(),T=F("sm");return o.useMemo(()=>{const j=T?g.mobile:g.desktop,y=typeof S=="number"?0:S.x,E=typeof S=="number"?S:S.y,h=(Math.min($,M)-y)*O,A=(L-j-E)*O;return Math.min(h/k,A/b,H)/C},[$,L,T,b,k,g,S,M,O,H,C])})({rows:a+(n.rowOffset??0),cols:r+(n.colOffset??0),headerOffset:s.headerOffset,...n,paddingOffset:ee});return{rows:a,cols:r,state:B,dispatch:R,size:te,mobile:c,solved:J,handleNext:G,controlsProps:{rows:a,cols:r,dynamicSize:p,minSize:v,maxSize:D,handlePlus:x,handleMinus:u,onRefresh:G}}}function be({onToggle:e,checkEnabled:t,touchTimeout:s,transition:n,posAttribute:l}){const d=o.useRef(void 0),i=o.useRef(e);i.current=e;const f=o.useCallback((a,r,p)=>{if(!t())return;const[x,u]=a.split(",").map(Number);x!==void 0&&u!==void 0&&(p?d.current=i.current(x,u,r,void 0,!0):i.current(x,u,r,d.current,!1))},[t]),{getDragProps:m}=Q({onAction:f,checkEnabled:t,touchTimeout:s,transition:n,posAttribute:l});return{getDragProps:m}}function Se({show:e,onReset:t,size:s,iconSizeRatio:n,primaryColor:l,secondaryColor:d,useSecondary:i=!1}){return w.jsx(P,{onClick:t,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"pointer",zIndex:10,backgroundColor:"transparent"},children:s>0&&w.jsx(ue,{sx:{fontSize:`${(s*n).toString()}rem`,color:i?d:l,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}})})}function Z(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function ye({children:e,controls:t,infoUrl:s,_title:n,background:l=ie.surface.background,paddingBottom:d={xs:"80px",md:"120px"},contentSx:i={},showTrophy:f=!1,onReset:m,boardSize:a=0,iconSizeRatio:r=1,primaryColor:p,secondaryColor:x,useSecondaryTrophy:u=!1,boardSx:c}){return F("sm"),w.jsxs(ae,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:l,position:"relative",overflow:"hidden",height:"100vh",transition:"background 0.5s ease-in-out"},children:[w.jsx(de,{showHome:!0,infoUrl:s}),w.jsx(P,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:d},...Z(i)],children:w.jsxs(P,{sx:[{position:"relative",width:"fit-content"},...Z(c)],children:[e,w.jsx(Se,{show:f,onReset:m,size:a,iconSizeRatio:r,primaryColor:p,secondaryColor:x,useSecondary:u})]})}),t]})}export{fe as B,ye as G,xe as a,be as b,pe as c,ge as d,me as e,he as f,we as g,V as h,Q as u};
