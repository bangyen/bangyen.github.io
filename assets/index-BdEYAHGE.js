import{r as e,a as o,j as t}from"./vendor_react-Dmhynvug.js";import{d as r,a as s,C as n,e as i,f as a,L as l}from"./index-hv61pLxN.js";import{g as c,a as f,G as u,C as d}from"./CustomGrid-DMd4GmtK.js";import{G as h}from"./gameConfig-nraIanc0.js";import{G as m}from"./GlobalHeader-D-txO0Pk.js";import{u as p,a as g}from"./useTimer-B47nxNy0.js";import{u as b}from"./layout-CG8ipCwr.js";import{u as v}from"./useWindow-BBwwMb5V.js";import{F as w}from"./vendor_mui_icons-CSaB1Iuy.js";import{G as y,k}from"./vendor_mui_core-DlAVUGaJ.js";function j(e){return Math.floor(Math.random()*e)}function x(e,o){const t={};for(const r in e){const s=e[r];void 0!==s&&(s+o>0?t[r]=s+o:s<0&&(t[r]=s))}return t}function S(e,o,t){const r=o*t,s=j(r);let n=j(r);return s===n&&(n=++n%r),{...e,rows:o,cols:t,head:s,board:{[s]:e.length??5,[n]:-1}}}function M(e){let{board:o,length:t,head:r,velocity:s,buffer:n}=e;if(void 0===t)return e;const{rows:i,cols:a}=e,l=i*a;o=x(o,-1);const c=f(r,s,i,a);if(o[c]&&o[c]>0){const e=[-2,2,-1,1],t=[];for(const n of e){if(n===-s||n===s)continue;const e=f(r,n,i,a);(void 0===o[e]||o[e]<0)&&t.push(n)}if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];void 0!==e&&(s=e)}}if(r=f(r,s,i,a),r in o){const e=o[r];o[r]=t,void 0!==e&&(e>0?o=x(o,-e):(o=x(o,1),o=function(e,o){let t=j(e);for(;t in o;)++t>=e&&(t=0);return{...o,[t]:-1}}(l,o))),t=o[r]}else o[r]=t;if(n.length){const[e,...o]=n;n=o,void 0!==e&&s+e&&(s=e)}return{...e,length:t,board:o,head:r,velocity:s,buffer:n}}function C(e,o){switch(o.type){case"resize":{const{rows:t,cols:r}=o.payload;return S(e,t,r)}case"steer":{const{payload:t}=o,r=c(t.key);let{buffer:s}=e;if(["NorthWest","NorthEast","SouthWest","SouthEast"].includes(t.key)){const o=t.key,r=-2,n=2,i=-1,a=1;let l=0,c=0;"NorthWest"===o?(l=r,c=i):"NorthEast"===o?(l=r,c=a):"SouthWest"===o?(l=n,c=i):"SouthEast"===o&&(l=n,c=a);const f=s.length>0?s[s.length-1]??e.velocity:e.velocity;2===Math.abs(f)?(f===l||f===-l)&&(s=[...s,c,l]):(f===c||f===-c)&&(s=[...s,l,c]),0===f&&(s=[...s,l])}else r&&(s=[...s,r]);return{...e,buffer:s}}case"move":return M(e);default:return e}}const E=k`
  0% { transform: scale(0.8) rotate(0deg); }
  50% { transform: scale(1.1) rotate(180deg); }
  100% { transform: scale(0.8) rotate(360deg); }
`;function z(){const{create:c}=p(0),{create:k}=g(),j=b("sm"),{height:x,width:M}=v(),z=h.snake.initialLength,_=j?h.gridSizes.mobile:h.gridSizes.desktop,{rows:W,cols:G}=e.useMemo(()=>{const e=j?l.headerHeight.xs:l.headerHeight.md,o=x-e,t=_*u.calculation.pixelMultiplier;return{rows:Math.floor(o/t),cols:Math.floor(M/t)}},[_,x,M,j]),N=e.useMemo(()=>({velocity:h.snake.initialVelocity,buffer:[],length:z,rows:0,cols:0,head:0,board:{}}),[z]),[A,H]=e.useReducer(C,S(N,W,G)),$=e.useCallback(e=>{const{clientX:o,clientY:t}=e,r=o-M/2,s=t-x/2,n=A.buffer.length>0?A.buffer[A.buffer.length-1]??A.velocity:A.velocity;let i="";i=2===Math.abs(n)?r>0?"right":"left":s>0?"down":"up";const a=h.controls.arrowPrefix+i;H({type:"steer",payload:{key:a}})},[H,A.velocity,A.buffer,M,x]),[D,L]=o.useState(!1),P=e.useCallback(e=>()=>{H({type:"steer",payload:{key:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight","up-left":"NorthWest","up-right":"NorthEast","down-left":"SouthWest","down-right":"SouthEast"}[e]??""}})},[H]),R=e.useCallback((e,o)=>{const r=e*G+o,n=A.board;let i="inherit";if(r in n){const e=n[r];void 0!==e&&(i=e>0?s.primary.main:s.primary.dark)}const a=f(r,-2,W,G),l=f(r,2,W,G),c=f(r,-1,W,G),d=f(r,1,W,G),h=n[r],m=e=>{const o=n[e];return void 0!==o&&-1!==o&&(void 0!==h&&1===Math.abs(o-h))},p=m(a),g=m(l),b=m(c),v=m(d),y=h===A.length||1===h,k=`${(_/u.cellSize.divisor).toString()}rem`,j=`${(_/2.5).toString()}rem`;if("inherit"===i)return{backgroundColor:i};if(-1===h)return{backgroundColor:"transparent",children:t.jsx(w,{sx:{color:i,fontSize:`${(.7*_).toString()}rem`,animation:`${E} 2s infinite ease-in-out`}})};const x=[0,0,0,0];p||b||(x[0]=1),p||v||(x[1]=1),g||v||(x[2]=1),g||b||(x[3]=1);const S=x.map(e=>e?y?j:k:"0").join(" ");return{backgroundColor:i,boxShadow:`0 0 1.25rem ${i.replace("hsl","hsla").replace(")",", 0.25)")}`,borderRadius:S}},[A,W,G,_]);return e.useEffect(()=>{c({repeat:()=>{H({type:"move"})},speed:100}),k(e=>{H({type:"steer",payload:e})})},[c,k]),e.useEffect(()=>{H({type:"resize",payload:{rows:W,cols:G}})},[W,G,H]),e.useEffect(()=>{document.title=r.snake},[]),t.jsxs(y,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:s.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[t.jsx(m,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),t.jsx(y,{flex:1,onPointerDown:$,sx:{...n.flexCenter,zIndex:1},children:t.jsx(d,{size:_,rows:W,cols:G,space:0,cellProps:(e,o)=>({...R(e,o),transition:!1})})}),t.jsx(i,{children:t.jsx(a,{show:D,setShow:L,handler:P,diagonals:!0})})]})}export{z as default};
