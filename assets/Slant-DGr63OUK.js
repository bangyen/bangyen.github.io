import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{A as t,S as o,a as n,L as s,e as i,d as a}from"./index-D08kVr1C.js";import{u as l,C as c}from"./layout-_boOtwMs.js";import{b as d,e as u,g as f,a as g,f as p,c as h,G as b,d as m,B as x}from"./gameUtils-DOH-xqF3.js";import{B as S}from"./vendor_mui_core-CC5VlWLf.js";import{u as w,v as y,c as v,P as C}from"./vendor_mui_icons-nmK6gwuH.js";import"./GlobalHeader-CxAfY2Df.js";const $="32px",k="48px",E="130%",j="6px",N="24px",z=100,R=1e3,I=1200,M=.95,A=100,B=16,T=.8,H="slant-size",D="slant-state",O="slant-ghost-moves",_=0,L=3,G=5,P=30,W={WHITE:"#fff"},q={LINE:"0 2px 4px rgba(0,0,0,0.2)",HINT:"0 4px 8px rgba(0,0,0,0.1)"},U={BORDER:"rgba(255, 255, 255, 0.1)",BG_SUBTLE:"rgba(255, 255, 255, 0.02)",BG_HOVER:"rgba(255, 255, 255, 0.1)",DASHED_BORDER:"rgba(255, 255, 255, 0.2)",HINT_BG:"hsl(217, 50%, 8%)",HINT_BORDER:"rgba(255, 255, 255, 0.3)"},F=1,K=2;class V{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error("Index out of bounds");r!==e&&(this.parent[e]=this.find(r));const t=this.parent[e];if(void 0===t)throw new Error("Root not found");return t}union(e,r){const t=this.find(e),o=this.find(r);return t!==o&&(this.parent[t]=o,!0)}}function J(e,r,t){return e*(t+1)+r}function Q(e,r,t){const o=new Map,n=new Set;for(let c=0;c<r;c++)for(let r=0;r<t;r++){const n=e[c]?.[r];if(!n||0===n)continue;const s=J(c,n===F?r+1:r,t),i=J(c+1,n===F?r:r+1,t);o.has(s)||o.set(s,[]),o.has(i)||o.set(i,[]),o.get(s)?.push({node:i,r:c,c:r}),o.get(i)?.push({node:s,r:c,c:r})}const s=new Set,i=new Set,a=[],l=(e,r)=>{s.add(e),i.add(e);const t=o.get(e)??[];for(const{node:o,r:c,c:d}of t)if(o!==r)if(i.has(o)){n.add(`${String(c)},${String(d)}`);for(let e=a.length-1;e>=0;e--){const r=a[e];if(!r)break;if(n.add(`${String(r.r)},${String(r.c)}`),r.u===o||r.v===o)break}}else s.has(o)||(a.push({r:c,c:d,u:e,v:o}),l(o,e),a.pop());i.delete(e)};for(const c of o.keys())s.has(c)||l(c,-1);return n}function X(e,r,t){const o=new V((r+1)*(t+1));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const s=r[e];if(void 0===s||0===s)continue;const i=J(n,s===F?e+1:e,t),a=J(n+1,s===F?e:e+1,t);if(!o.union(i,a))return!0}}return!1}function Y(e,r,t){const o=Array.from({length:r+1},()=>Array(t+1).fill(0));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const t=r[e];if(t===F){const r=o[n];if(r){const t=r[e+1];void 0!==t&&(r[e+1]=t+1)}const t=o[n+1];if(t){const r=t[e];void 0!==r&&(t[e]=r+1)}}else if(t===K){const r=o[n];if(r){const t=r[e];void 0!==t&&(r[e]=t+1)}const t=o[n+1];if(t){const r=t[e+1];void 0!==r&&(t[e+1]=r+1)}}}}return o}function Z(e,r,t){const o=Array.from({length:r},()=>Array(t).fill(0));let n=!0;for(;n;){n=!1;for(let s=0;s<=r;s++)for(let i=0;i<=t;i++){const a=e[s]?.[i];if(null==a)continue;const l=[{gr:s-1,gc:i-1,pt:K},{gr:s-1,gc:i,pt:F},{gr:s,gc:i-1,pt:F},{gr:s,gc:i,pt:K}].filter(({gr:e,gc:o})=>e>=0&&e<r&&o>=0&&o<t);let c=0;const d=[];for(const e of l){const r=o[e.gr]?.[e.gc];0===r?d.push(e):r===e.pt&&c++}if(c===a&&d.length>0)for(const{gr:e,gc:r,pt:t}of d){const s=o[e];s&&(s[r]=t===F?K:F,n=!0)}else if(c+d.length===a&&d.length>0)for(const{gr:e,gc:r,pt:t}of d){const s=o[e];s&&(s[r]=t,n=!0)}}if(!n)for(let e=0;e<r;e++)for(let s=0;s<t;s++){const i=o[e];if(0===i?.[s])if(i[s]=F,X(o,r,t)){if(i[s]=K,n=!0,X(o,r,t))return!1}else if(i[s]=K,X(o,r,t)){if(i[s]=F,n=!0,X(o,r,t))return!1}else i[s]=0}}if(!o.every(e=>e.every(e=>0!==e)))return!1;const s=Y(o,r,t);for(let i=0;i<=r;i++)for(let r=0;r<=t;r++){const t=e[i]?.[r];if(null!=t&&s[i]?.[r]!==t)return!1}return!X(o,r,t)}function ee(e,r){const t=Array.from({length:e},()=>Array(r).fill(F)),o=e*r*P;for(let l=0;l<o;l++){const o=Math.floor(Math.random()*e),n=Math.floor(Math.random()*r),s=t[o];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===F?K:F,X(t,e,r)&&(s[n]=i))}const n=Y(t,e,r).map(e=>[...e]),s=[];for(let l=0;l<=e;l++)for(let e=0;e<=r;e++)s.push({r:l,c:e});for(let l=s.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1)),r=s[l],t=s[e];r&&t&&(s[l]=t,s[e]=r)}const i=Math.floor((e+1)*(r+1)*_);let a=(e+1)*(r+1);for(const{r:l,c:c}of s){if(a<=i)continue;const t=n[l];if(!t)continue;const o=t[c];null!=o&&(t[c]=null,Z(n,e,r)?a--:t[c]=o)}return{numbers:n,solution:t}}function re(e,r){switch(r.type){case"toggle":{if(e.solved)return e;const{row:t,col:o}=r,n=e.grid.map(e=>[...e]),s=n[t];if(!s)return e;const i=s[o];if(void 0===i)return e;r.reverse?s[o]=0===i?K:i===K?F:0:s[o]=0===i?F:i===F?K:0;let a=!1;if(n.every(e=>e.every(e=>0!==e))){const r=Y(n,e.rows,e.cols);e.numbers.every((e,t)=>e.every((e,o)=>null===e||e===r[t]?.[o]))&&!X(n,e.rows,e.cols)&&(a=!0)}const l=function(e,r,t,o){const n=new Set,s=Y(e,t,o);for(let i=0;i<=t;i++)for(let a=0;a<=o;a++){const l=r[i]?.[a];if(null==l)continue;const c=s[i]?.[a]??0;c>l?n.add(`${String(i)},${String(a)}`):c+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:r,gc:n})=>r>=0&&r<t&&n>=0&&n<o&&0===e[r]?.[n]).length<l&&n.add(`${String(i)},${String(a)}`)}return n}(n,e.numbers,e.rows,e.cols),c=Q(n,e.rows,e.cols),d=function(e,r,t,o){const n=new Set,s=Y(e,t,o);for(let i=0;i<=t;i++)for(let e=0;e<=o;e++){const t=r[i]?.[e];null!=t&&((s[i]?.[e]??0)===t&&n.add(`${String(i)},${String(e)}`))}return n}(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:a,errorNodes:l,cycleCells:c,satisfiedNodes:d}}case"hydrate":return{...r.state};case"resize":{if(r.rows<L||r.cols<L)return e;const{numbers:t,solution:o}=ee(r.rows,r.cols);return{grid:Array.from({length:r.rows},()=>Array(r.cols).fill(0)),numbers:t,solution:o,rows:r.rows,cols:r.cols,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}case"new":{const{numbers:r,solution:t}=ee(e.rows,e.cols);return{...e,grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:r,solution:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return e}}const te=({rows:a,cols:f,numbers:g,size:p,initialMoves:h,onMove:b,onCopy:m,onClear:x,onClose:C})=>{const z=l("sm"),R=h,{getDragProps:I}=d({onToggle:(e,r,t,o,n)=>{const s=`${String(e)},${String(r)}`;if(!n)return void b(s,o);const i=R.get(s);let a;return a=t?i===K?F:i===F?void 0:K:i===F?K:i===K?void 0:F,b(s,a),a},touchTimeout:u.timing.touchHoldDelay,checkEnabled:()=>!0}),[M,A]=e.useState(new Map),[B,T]=e.useState([]),[H,D]=e.useState(new Set);e.useEffect(()=>{const e=new Map,r=[],t=[];R.forEach((t,o)=>{e.set(o,{state:t,source:"user"});const[n,s]=o.split(",").map(Number);void 0!==n&&void 0!==s&&r.push({r:n,c:s})});const o=(r,t)=>{if(r<0||r>=a||t<0||t>=f)return 0;const o=`${String(r)},${String(t)}`;return e.get(o)?.state??0},n=(o,n,s,i)=>{const a=`${String(o)},${String(n)}`,l=e.get(a);l?l.state!==s&&t.push({type:"cell",r:o,c:n}):(e.set(a,{state:s,source:i}),r.push({r:o,c:n}))},s=(e,r)=>[{r:e-1,c:r-1,required:K},{r:e-1,c:r,required:F},{r:e,c:r-1,required:F},{r:e,c:r,required:K}].filter(e=>e.r>=0&&e.r<a&&e.c>=0&&e.c<f);let i=0;for(;i<r.length;){const a=r[i++];if(!a)break;const{r:l,c:c}=a,d=[{r:l,c:c},{r:l,c:c+1},{r:l+1,c:c},{r:l+1,c:c+1}];for(const r of d){const i=g[r.r]?.[r.c];if(null==i)continue;const a=s(r.r,r.c);let d=0;const u=[];for(const e of a){const r=o(e.r,e.c);0===r?u.push(e):r===e.required&&d++}if(d>i)t.push({type:"node",r:r.r,c:r.c});else if(d+u.length<i)t.push({type:"node",r:r.r,c:r.c});else if("user"===e.get(`${String(l)},${String(c)}`)?.source)if(d===i&&u.length>0)for(const e of u){const r=e.required===F?K:F;n(e.r,e.c,r,"propagated")}else if(d+u.length===i&&u.length>0)for(const e of u)n(e.r,e.c,e.required,"propagated")}}const l=Array.from({length:a},()=>Array(f).fill(0));e.forEach((e,r)=>{const[t,o]=r.split(",").map(Number);void 0!==t&&void 0!==o&&l[t]&&(l[t][o]=e.state)});const c=Q(l,a,f);A(e),T(t),D(c)},[R,g,a,f]);const O=.4*p,_=p-O,L=e.useMemo(()=>new Set(B.filter(e=>"cell"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[B]),G=e.useMemo(()=>new Set(B.filter(e=>"node"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[B]),P=e.useCallback((e,s)=>{const i=`${String(e)},${String(s)}`,a=M.get(i),l=a?.state??0,c=a?.source,d=L.has(i),u=H.has(i),f=I(i);let g=n.text.primary;return d?g=n.data.red:u?g="user"===c?n.data.red:"#ff9800":"user"===c?g=n.primary.main:"propagated"===c&&(g=n.data.green),{...f,sx:{...f.sx,cursor:"pointer",border:`1px solid ${U.BORDER}`,position:"relative",backgroundColor:U.BG_SUBTLE,"&:hover":{backgroundColor:U.BG_HOVER}},children:r.jsxs(S,{sx:{width:"100%",height:"100%",position:"relative"},children:[l===F&&r.jsx(S,{sx:{position:"absolute",width:E,height:j,backgroundColor:g,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:q.LINE,transition:t.transition,pointerEvents:"none"}}),l===K&&r.jsx(S,{sx:{position:"absolute",width:E,height:j,backgroundColor:g,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:q.LINE,transition:t.transition,pointerEvents:"none"}})]})}},[M,L,H,I]),V=e.useCallback((e,t)=>{const o=g[e]?.[t],s=G.has(`${String(e)},${String(t)}`);return{"data-pos":`${String(e)},${String(t)}`,"data-type":"hint",children:r.jsx(S,{children:o??""}),sx:{borderRadius:"50%",backgroundColor:s?n.data.red:U.HINT_BG,border:null!==o?`2px solid ${s?n.data.red:U.HINT_BORDER}`:"none",fontSize:`${String(.5*O)}rem`,fontWeight:"800",color:W.WHITE,zIndex:5,opacity:null!==o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(1.1)":"scale(1)",position:"relative",pointerEvents:"none"}}},[g,G,O]);return r.jsxs(S,{sx:{position:"relative",userSelect:"none"},children:[r.jsxs(S,{sx:{position:"relative",padding:z?`calc(${$} + 16px)`:`calc(${k} + 24px)`,border:`2px dashed ${U.DASHED_BORDER}`,borderRadius:N},children:[r.jsx(S,{sx:{position:"relative",zIndex:s.zIndex.base+1},children:r.jsx(c,{size:p,rows:a,cols:f,cellProps:P,space:0,sx:{width:"fit-content"}})}),r.jsx(S,{sx:{position:"absolute",top:z?`calc(${$} + 16px)`:`calc(${k} + 24px)`,left:z?`calc(${$} + 16px)`:`calc(${k} + 24px)`,transform:`translate(-${String(O/2)}rem, -${String(O/2)}rem)`,zIndex:s.zIndex.base+2,pointerEvents:"none"},children:r.jsx(c,{size:O,rows:a+1,cols:f+1,cellProps:V,space:_,sx:{width:"fit-content"}})})]}),r.jsxs(S,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:z?-72:-88,left:0,right:0,pointerEvents:"auto",zIndex:s.zIndex.base+5,paddingBottom:2},children:[r.jsx(i,{title:"Copy Board",Icon:w,onClick:m,sx:{backgroundColor:n.interactive.selected,color:n.primary.main,"&:hover":{backgroundColor:n.interactive.focus}}}),r.jsx(i,{title:"Clear Calculator",Icon:y,onClick:x,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:n.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),r.jsx(i,{title:"Close Calculator",Icon:v,onClick:C,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:n.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})]})},oe=(e,o)=>(s,i)=>{const a=o.grid[s]?.[i],l=f(s,i),c=o.cycleCells.has(l),d=e(l);return{...d,sx:{...d.sx,cursor:"pointer",border:`1px solid ${n.border.subtle}`,position:"relative","&:hover":{backgroundColor:n.interactive.hover}},children:r.jsxs(S,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===F&&r.jsx(S,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:c?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:q.LINE,transition:t.transition,pointerEvents:"none"}}),a===K&&r.jsx(S,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:c?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:q.LINE,transition:t.transition,pointerEvents:"none"}})]})}};function ne(){const[t,o]=e.useState(!1),{rows:s,cols:l,state:c,dispatch:w,size:y,mobile:v,handleNext:E,controlsProps:j}=g({storageKeys:{size:H,state:D},pageTitle:a.slant,gridConfig:{defaultSize:G,minSize:L,headerOffset:u.layout.headerHeight,paddingOffset:160,widthLimit:R,cellSizeReference:4,mobileRowOffset:-2},boardConfig:{paddingOffset:e=>({x:e?128:224,y:z}),boardMaxWidth:I,boardSizeFactor:M,maxCellSize:A,remBase:B,rowOffset:1,colOffset:1},reducer:re,getInitialState:(e,r)=>function(e,r){const{numbers:t,solution:o}=ee(e,r);return{grid:Array.from({length:e},()=>Array(r).fill(0)),numbers:t,solution:o,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}(e,r),winAnimationDelay:u.timing.winAnimationDelay,isSolved:e=>e.solved,persistence:{enabled:!t,serialize:e=>({...e,errorNodes:Array.from(e.errorNodes),cycleCells:Array.from(e.cycleCells),satisfiedNodes:Array.from(e.satisfiedNodes)}),deserialize:e=>{const r=e;return{...r,errorNodes:new Set(r.errorNodes),cycleCells:new Set(r.cycleCells),satisfiedNodes:new Set(r.satisfiedNodes)}}}}),[_,P]=e.useState(new Map);p({storageKey:O,rows:s,cols:l,state:_,onRestore:e=>{P(e)},serialize:e=>Array.from(e.entries()),deserialize:e=>new Map(e)});const U=e.useRef("");e.useEffect(()=>{const e=JSON.stringify(c.numbers);U.current&&U.current!==e&&P(new Map),U.current=e},[c.numbers,c.rows,c.cols]);const F=E,{getDragProps:K}=d({onToggle:(e,r,t)=>{w({type:"toggle",row:e,col:r,reverse:t})},checkEnabled:()=>!c.solved,touchTimeout:u.timing.touchHoldDelay}),V=.4*y,J=h(oe,K,[c]),Q=e.useMemo(()=>((e,t)=>(o,s)=>{const i=e.numbers[o]?.[s],a=f(o,s),l=e.errorNodes.has(a),c=e.satisfiedNodes.has(a);return{sx:{pointerEvents:"none"},children:r.jsx(S,{sx:{borderRadius:"50%",backgroundColor:l?n.data.red:n.surface.background,border:null!==i?`2px solid ${l?n.data.red:c?"transparent":n.border.subtle}`:"none",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:l?W.WHITE:c?n.interactive.disabledText:n.text.primary,boxShadow:c&&!l?"none":q.HINT,zIndex:5,opacity:null!==i?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:l?"scale(1.1)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}})(c,V),[c,V]),X=e.useCallback((e,r)=>{P(t=>{const o=new Map(t);return void 0===r?o.delete(e):o.set(e,r),o})},[]),Y=e.useCallback(()=>{const e=new Map;c.grid.forEach((r,t)=>{r.forEach((r,o)=>{0!==r&&e.set(`${String(t)},${String(o)}`,r)})}),P(e)},[c.grid]),Z=e.useCallback(()=>{P(new Map)},[]),ne=e.useCallback(()=>{o(!1)},[]),se=e.useCallback(e=>{e.stopPropagation()},[]),ie=e.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${n.surface.elevated} 0%, ${n.surface.background} 100%)`,padding:v?"1rem":"2rem"}),[v]),ae=e.useMemo(()=>({userSelect:"none",padding:v?$:k,border:"2px solid transparent",borderRadius:N}),[v]),le=t?r.jsx(r.Fragment,{}):r.jsx(m,{...j,disabled:t,children:r.jsx(i,{title:"Open Calculator",Icon:C,onClick:()=>{o(!t)},sx:{color:"default"}})}),ce=t?r.jsx(te,{rows:s,cols:l,numbers:c.numbers,size:y,initialMoves:_,onMove:X,onCopy:Y,onClear:Z,onClose:ne}):r.jsx(x,{size:y,rows:s+1,cols:l+1,frontProps:Q,backProps:J,frontLayerSx:{pointerEvents:"none"}});return r.jsx(b,{title:a.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:le,contentSx:ie,showTrophy:!t&&c.solved,onReset:F,boardSize:y,iconSizeRatio:T,primaryColor:n.primary.main,secondaryColor:n.primary.main,boardSx:ae,children:r.jsx(S,{onClick:se,children:ce})})}export{ne as default};
