import{r,j as t}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-6HdIgUKQ.js";import{a as n}from"./index-CB88SnMb.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(r,t)=>{const e=[];for(let n=0;n<r;n++){const r=[];for(let e=0;e<t;e++)r.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(r)}return e},c=(r,t,e,n,o=!1)=>{const a=[],{row:i,col:l}=r;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([r,i])=>{if(void 0!==r&&void 0!==i&&r>=0&&r<e&&i>=0&&i<n&&t[r]?.[i]?.visited===o){const e=t[r][i];a.push(e)}}),a},u=(r,t)=>{const e=r.row-t.row,n=r.col-t.col;1===e?(r.walls.top=!1,t.walls.bottom=!1):-1===e?(r.walls.bottom=!1,t.walls.top=!1):1===n?(r.walls.left=!1,t.walls.right=!1):-1===n&&(r.walls.right=!1,t.walls.left=!1)};const d={backtracker:function(r,t,e){const n=[],o=r[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,r,t,e,!1);if(a.length>0){const r=a[Math.floor(Math.random()*a.length)];r&&(u(o,r),r.visited=!0,n.push(r))}else n.pop()}},prims:function(r,t,e){const n=r[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,r,t,e,!1).map(r=>({parent:n,cell:r}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,r,t,e,!1).forEach(r=>{o.push({parent:l,cell:r})})}}}};const g=21,p=100;function f(){const c=r.useRef(null),u=r.useRef(null),[f,m]=r.useState(null),[y,h]=r.useState("start"),[w]=r.useState("backtracker"),x=r.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:v,width:b}=o(),k=a("sm"),C=v-(k?56:80),T=r.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[M,E]=r.useState({active:!1,originConfig:null,currentConfig:null}),j=r.useCallback(()=>{const r=function(r,t,e="backtracker"){const n=s(r,t);return(0,d[e])(n,r,t),{grid:n,rows:r,cols:t,start:[0,0],end:[r-1,t-1]}}(g,g,w);m(r),x.current.player={x:r.start[1]*p+50,y:r.start[0]*p+50,vx:0,vy:0,rotation:0},x.current.goal={x:r.end[1]*p+50,y:r.end[0]*p+50,rotation:0},x.current.gameState="playing",x.current.lastTime=0,h("playing")},[w]);r.useEffect(()=>{j()},[j]),r.useEffect(()=>{if(!c.current)return;const r=c.current,t=window.devicePixelRatio||1;r.width=b*t,r.height=C*t;const e=r.getContext("2d");e&&e.scale(t,t)},[b,C]),r.useEffect(()=>{if(!f||"playing"!==y||!c.current)return;const r=c.current.getContext("2d",{alpha:!0});if(!r)return;let t;const e={},o=r=>{e[r.key.toLowerCase()]=!0},a=r=>{e[r.key.toLowerCase()]=!1};window.addEventListener("keydown",o),window.addEventListener("keyup",a);const i=o=>{t=requestAnimationFrame(i);const a=x.current.lastTime?(o-x.current.lastTime)/16.67:1;x.current.lastTime=o;const l=1.2*a,s=Math.pow(.88,a),c=(e.d||e.arrowright?1:0)-(e.a||e.arrowleft?1:0),u=(e.s||e.arrowdown?1:0)-(e.w||e.arrowup?1:0);let d=0,m=0;T.current.isDown&&(d=Math.max(-1,Math.min(1,(T.current.currentX-T.current.startX)/80)),m=Math.max(-1,Math.min(1,(T.current.currentY-T.current.startY)/80)));const y=c+d,w=u+m;x.current.player.vx+=y*l,x.current.player.vy+=w*l,x.current.player.vx*=s,x.current.player.vy*=s;const v=(r,t)=>{const e=Math.floor(r/p),n=Math.floor(t/p);if(n<0||n>=g||e<0||e>=g)return!0;const o=f.grid[n]?.[e];if(!o)return!0;const a=e*p,i=(e+1)*p,l=n*p,s=(n+1)*p;return!!(o.walls.left&&r-14<a)||(!!(o.walls.right&&r+14>i)||(!!(o.walls.top&&t-14<l)||!!(o.walls.bottom&&t+14>s)))},k=x.current.player.x+x.current.player.vx*a;v(k,x.current.player.y)?x.current.player.vx*=-.5:x.current.player.x=k;const M=x.current.player.y+x.current.player.vy*a;v(x.current.player.x,M)?x.current.player.vy*=-.5:x.current.player.y=M;const E=Math.sqrt(x.current.player.vx**2+x.current.player.vy**2);x.current.player.rotation+=.05*E*a,E>.1&&x.current.trail.push({x:x.current.player.x,y:x.current.player.y});const S=x.current.trail;S.length>(E>.1?15:0)&&S.shift();const X=1-Math.pow(.9,a);x.current.camera.x+=(x.current.player.x-x.current.camera.x)*X,x.current.camera.y+=(x.current.player.y-x.current.camera.y)*X;Math.sqrt(Math.pow(x.current.player.x-x.current.goal.x,2)+Math.pow(x.current.player.y-x.current.goal.y,2))<30&&"playing"===x.current.gameState&&(x.current.gameState="won",h("won"),setTimeout(()=>{j()},1500)),r.clearRect(0,0,b,C),r.save(),r.translate(b/2-x.current.camera.x,C/2-x.current.camera.y);const Y=50,L=x.current.camera.x-b/2,P=x.current.camera.x+b/2,A=x.current.camera.y-C/2,D=x.current.camera.y+C/2;r.beginPath(),r.strokeStyle=n.primary.main,r.globalAlpha=.03,r.lineWidth=1;for(let t=Math.floor(L/Y)*Y;t<=P;t+=Y)r.moveTo(t,A),r.lineTo(t,D);for(let t=Math.floor(A/Y)*Y;t<=D;t+=Y)r.moveTo(L,t),r.lineTo(P,t);r.stroke(),r.globalAlpha=1,r.strokeStyle=n.primary.main,r.lineWidth=4,r.lineCap="round",r.shadowColor=n.primary.main,r.shadowBlur=0;const R=12;r.beginPath();for(let t=0;t<=g;t++)for(let e=0;e<=g;e++){const n=e*p,o=t*p,a=t>0&&(e<g?f.grid[t-1]?.[e]?.walls.left??!1:f.grid[t-1]?.[e-1]?.walls.right??!1),i=t<g&&(e<g?f.grid[t]?.[e]?.walls.left??!1:f.grid[t]?.[e-1]?.walls.right??!1),l=e>0&&(t<g?f.grid[t]?.[e-1]?.walls.top??!1:f.grid[t-1]?.[e-1]?.walls.bottom??!1),s=e<g&&(t<g?f.grid[t]?.[e]?.walls.top??!1:f.grid[t-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(r.moveTo(n,o-R),r.arcTo(n,o,n+R,o,R)):s&&i&&!l&&!a?(r.moveTo(n+R,o),r.arcTo(n,o,n,o+R,R)):i&&l&&!a&&!s?(r.moveTo(n,o+R),r.arcTo(n,o,n-R,o,R)):l&&a&&!s&&!i&&(r.moveTo(n-R,o),r.arcTo(n,o,n,o-R,R))),i){const a=2===c&&(l||s)?o+R:o,i=t+1,u=i<g&&(e<g?f.grid[i]?.[e]?.walls.left??!1:f.grid[i]?.[e-1]?.walls.right??!1),d=e>0&&(i<g?f.grid[i]?.[e-1]?.walls.top??!1:f.grid[i-1]?.[e-1]?.walls.bottom??!1),m=e<g&&(i<g?f.grid[i]?.[e]?.walls.top??!1:f.grid[i-1]?.[e]?.walls.bottom??!1),y=2===1+(u?1:0)+(d?1:0)+(m?1:0)&&(d||m)?(t+1)*p-R:(t+1)*p;r.moveTo(n,a),r.lineTo(n,y)}if(s){const l=2===c&&(a||i)?n+R:n,s=e+1,u=t>0&&(s<g?f.grid[t-1]?.[s]?.walls.left??!1:f.grid[t-1]?.[s-1]?.walls.right??!1),d=t<g&&(s<g?f.grid[t]?.[s]?.walls.left??!1:f.grid[t]?.[s-1]?.walls.right??!1),m=s<g&&(t<g?f.grid[t]?.[s]?.walls.top??!1:f.grid[t-1]?.[s]?.walls.bottom??!1),y=s*p-(2===1+(u?1:0)+(d?1:0)+(m?1:0)&&(u||d)?R:0);r.moveTo(l,o),r.lineTo(y,o)}}r.stroke(),r.shadowBlur=0;const q=x.current.goal;q.rotation+=.02*a,r.save(),r.translate(q.x,q.y),r.rotate(q.rotation),r.fillStyle=n.primary.dark,r.shadowColor=n.primary.dark,r.shadowBlur=0,r.beginPath(),r.rect(-10,-10,20,20),r.fill(),r.restore();const B=x.current.trail,W=B.length;if(W>2){r.save(),r.beginPath(),r.strokeStyle=n.text.primary,r.lineWidth=12,r.lineCap="round",r.lineJoin="round";const t=B[0];if(t){r.moveTo(t.x,t.y);for(let t=1;t<W-1;t++){const e=B[t],n=B[t+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;r.globalAlpha=t/W*.15,r.quadraticCurveTo(e.x,e.y,o,a),r.stroke(),r.beginPath(),r.moveTo(o,a)}}}r.restore()}else if(W>1){const t=B[0],e=B[1];t&&e&&(r.save(),r.beginPath(),r.strokeStyle=n.text.primary,r.lineWidth=12,r.lineCap="round",r.globalAlpha=.15,r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke(),r.restore())}const _=x.current.player;r.save(),r.translate(_.x,_.y),r.fillStyle=n.text.primary,r.beginPath(),r.arc(0,0,12,0,2*Math.PI),r.fill(),r.restore(),r.restore()};return requestAnimationFrame(i),()=>{cancelAnimationFrame(t),window.removeEventListener("keydown",o),window.removeEventListener("keyup",a)}},[f,y,b,C,k,j]);const S=r=>{T.current.isDown&&(T.current.currentX=r.clientX,T.current.currentY=r.clientY,E(t=>{if(!t.originConfig)return t;const e=r.clientX-t.originConfig.x,n=r.clientY-t.originConfig.y,o=Math.sqrt(e*e+n*n);let a=r.clientX,i=r.clientY;if(o>50){const r=50/o;a=t.originConfig.x+e*r,i=t.originConfig.y+n*r}return{...t,currentConfig:{x:a,y:i}}}))},X=()=>{T.current.isDown=!1,E({active:!1,originConfig:null,currentConfig:null})};return r.useEffect(()=>(window.addEventListener("pointermove",S),window.addEventListener("pointerup",X),()=>{window.removeEventListener("pointermove",S),window.removeEventListener("pointerup",X)}),[]),r.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),t.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[t.jsx(e,{showHome:!0}),t.jsx(l,{ref:u,onPointerDown:r=>{"playing"===y&&(T.current.isDown=!0,T.current.startX=r.clientX,T.current.startY=r.clientY,T.current.currentX=r.clientX,T.current.currentY=r.clientY,E({active:!0,originConfig:{x:r.clientX,y:r.clientY},currentConfig:{x:r.clientX,y:r.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:t.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),M.active&&M.originConfig&&M.currentConfig&&t.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[t.jsx(l,{sx:{position:"absolute",left:M.originConfig.x,top:M.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),t.jsx(l,{sx:{position:"absolute",left:M.currentConfig.x,top:M.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{f as default};
