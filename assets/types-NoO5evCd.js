import{j as h,r as n}from"./vendor_react-D9AZKRQJ.js";import{C as Y,d as _,u as q,c as re}from"./layout-CxuVozs6.js";import{B as I,d as Q,e as ie}from"./vendor_mui_core-CcNgE9EE.js";import{L as ae,f as ce,e as V,E as le,C as W,S as ue}from"./index-DuW26yrh.js";import{v as de,w as fe,E as me}from"./vendor_mui_icons-i_Xb35He.js";import{G as he}from"./GlassCard-DggpD6sM.js";import{P as pe,t as Z}from"./PageLayout-B434fvh6.js";function we(e){const{frontProps:t,backProps:o,size:s,rows:l,cols:m,frontLayerSx:a,backLayerSx:d}=e;return h.jsxs(I,{sx:{display:"grid",placeItems:"center"},children:[h.jsx(I,{sx:{gridArea:"1/1",...d},children:h.jsx(Y,{space:0,size:s,rows:l-1,cols:m-1,cellProps:o})}),h.jsx(I,{sx:{gridArea:"1/1",zIndex:ae.zIndex.base+1,...a},children:h.jsx(Y,{space:0,size:s,rows:l,cols:m,cellProps:t})})]})}function ge({rows:e,cols:t,dynamicSize:o,minSize:s,maxSize:l,handlePlus:m,handleMinus:a,onRefresh:d,disabled:f=!1,children:r}){const i=e<=s&&t<=s,w=e>=l&&t>=l||e===o.rows&&t===o.cols;return h.jsxs(ce,{onRefresh:d,children:[h.jsx(V,{title:"Decrease Size",Icon:de,onClick:a,disabled:f||i}),h.jsx(V,{title:"Increase Size",Icon:fe,onClick:m,disabled:f||w}),r]})}const xe=({children:e})=>h.jsx(le,{FallbackComponent:({error:t,resetErrorBoundary:o})=>h.jsx(I,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4,minHeight:"300px"},children:h.jsxs(he,{sx:{p:4,maxWidth:"500px",textAlign:"center"},children:[h.jsx(Q,{variant:"h5",sx:{mb:2,color:W.text.primary,fontWeight:"bold"},children:"Game Error"}),h.jsx(Q,{sx:{mb:3,color:W.text.secondary,fontFamily:"monospace",fontSize:"0.9rem"},children:(t==null?void 0:t.message)??"An unexpected error occurred."}),h.jsx(ie,{variant:"contained",onClick:o,sx:{borderRadius:ue.borderRadius.md,textTransform:"none"},children:"Reset Game"})]})}),children:e});function be({show:e,onReset:t,size:o,iconSizeRatio:s,primaryColor:l,secondaryColor:m,useSecondary:a=!1}){const[d,f]=n.useState(!1);return n.useEffect(()=>{if(e){const r=setTimeout(()=>{f(!0)},500);return()=>{clearTimeout(r)}}f(!1)},[e]),h.jsx(I,{onClick:r=>{d&&t&&(r.stopPropagation(),t())},sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:d?"pointer":"default",zIndex:10,backgroundColor:"transparent",pointerEvents:e?"auto":"none"},children:o>0&&h.jsx(me,{sx:{fontSize:`${(o*s).toString()}rem`,color:a?m:l,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}})})}function Se({children:e,controls:t,infoUrl:o,_title:s,background:l=W.surface.background,paddingBottom:m={xs:"80px",md:"120px"},contentSx:a={},showTrophy:d=!1,onReset:f,boardSize:r=0,iconSizeRatio:i=1,primaryColor:w,secondaryColor:x,useSecondaryTrophy:u=!1,boardSx:c,onClick:S}){return h.jsxs(pe,{infoUrl:o,background:l,containerSx:{height:"100vh",transition:"background 0.5s ease-in-out",cursor:S?"pointer":"inherit"},sx:{justifyContent:"center",alignItems:"center"},onClick:S,children:[h.jsx(I,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:m},...Z(a)],children:h.jsxs(I,{sx:[{position:"relative",width:"fit-content"},...Z(c)],children:[e,h.jsx(be,{show:d,onReset:f,size:r,iconSizeRatio:i,primaryColor:w,secondaryColor:x,useSecondary:u})]})}),t]})}const ye={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}};function ee({storageKey:e,rows:t,cols:o,state:s,onRestore:l,serialize:m,deserialize:a,enabled:d=!0,saveDebounceMs:f=300}){const r=`${e}-${String(t)}x${String(o)}`,i=n.useRef(l),w=n.useRef(a),x=n.useRef(m);n.useEffect(()=>{i.current=l,w.current=a,x.current=m}),n.useEffect(()=>{if(!d)return;const u=localStorage.getItem(r);if(u)try{const c=JSON.parse(u),S=w.current??(D=>D);i.current(S(c))}catch{localStorage.removeItem(r)}},[r,d]),n.useEffect(()=>{if(!d)return;const u=setTimeout(()=>{const c=(x.current??(S=>S))(s);localStorage.setItem(r,JSON.stringify(c))},f);return()=>{clearTimeout(u)}},[r,s,d,f])}function ze({storageKeys:e,pageTitle:t,gridConfig:o,boardConfig:s,reducer:l,getInitialState:m,winAnimationDelay:a,isSolved:d,persistence:f}){const{rows:r,cols:i,dynamicSize:w,handlePlus:x,handleMinus:u,mobile:c,minSize:S,maxSize:D}=(function({storageKey:b,defaultSize:E,minSize:g=2,maxSize:y=10,headerOffset:C,paddingOffset:O=0,widthLimit:$=1300,cellSizeReference:k,mobileRowOffset:B=0}){const{height:P,width:A}=_(),j=q("sm"),[z,M]=n.useState(()=>{const v=localStorage.getItem(b);return v==="null"?null:v?parseInt(v,10):E}),p=n.useMemo(()=>{const v=j?C.mobile:C.desktop,F=typeof k=="number"?k:j?k.mobile:k.desktop,U=re(F,P-v-O,Math.min(A,$));let X=U.rows-1;const se=U.cols-1;return j&&(X+=B),{rows:Math.max(g,X),cols:Math.max(g,se)}},[k,P,A,j,C,O,$,g,B]),{rows:L,cols:K}=n.useMemo(()=>z===null?p:{rows:Math.min(z,p.rows),cols:Math.min(z,p.cols)},[z,p]);return n.useEffect(()=>{localStorage.setItem(b,String(z))},[z,b]),{rows:L,cols:K,dynamicSize:p,handlePlus:()=>{const v=Math.min(L,K);z!==null&&(v<Math.min(p.rows,p.cols)?M(v+1):p.rows===p.cols||L===p.rows&&K===p.cols||M(null))},handleMinus:()=>{const v=Math.min(L,K);if(z===null){const F=Math.min(p.rows,p.cols);p.rows===p.cols?M(Math.max(g,F-1)):M(F)}else v>g&&M(v-1)},desiredSize:z,setDesiredSize:M,mobile:j,width:A,height:P,minSize:g,maxSize:y}})({storageKey:e.size,...o}),T=n.useMemo(()=>m(r,i),[r,i,m]),[H,R]=n.useReducer(l,T),J=n.useMemo(()=>d(H),[H,d]),G=n.useCallback(()=>{R({type:"new"})},[R]);var N;ee({storageKey:e.state,rows:r,cols:i,state:H,onRestore:b=>{R({type:"restore",state:b}),R({type:"hydrate",state:b})},...f}),(function(b,E,g=2e3){const y=n.useRef(E);y.current=E,n.useEffect(()=>{if(b){const C=setTimeout(()=>{y.current()},g);return()=>{clearTimeout(C)}}},[b,g])})(J,G,a),N=t,n.useEffect(()=>{document.title=N},[N]),n.useEffect(()=>{R({type:"resize",rows:r,cols:i,newRows:r,newCols:i})},[r,i,R]);const oe=n.useMemo(()=>typeof s.paddingOffset=="function"?s.paddingOffset(c):s.paddingOffset,[s,c]),ne=(function({rows:b,cols:E,headerOffset:g,paddingOffset:y,boardMaxWidth:C,boardSizeFactor:O,maxCellSize:$,remBase:k}){const{width:B,height:P}=_(),A=q("sm");return n.useMemo(()=>{const j=A?g.mobile:g.desktop,z=typeof y=="number"?0:y.x,M=typeof y=="number"?y:y.y,p=(Math.min(B,C)-z)*O,L=(P-j-M)*O;return Math.min(p/E,L/b,$)/k},[B,P,A,b,E,g,y,C,O,$,k])})({rows:r+(s.rowOffset??0),cols:i+(s.colOffset??0),headerOffset:o.headerOffset,...s,paddingOffset:oe});return{rows:r,cols:i,state:H,dispatch:R,size:ne,mobile:c,solved:J,handleNext:G,controlsProps:{rows:r,cols:i,dynamicSize:w,minSize:S,maxSize:D,handlePlus:x,handleMinus:u,onRefresh:G}}}function te({onAction:e,checkEnabled:t=()=>!0,touchTimeout:o=500,posAttribute:s="data-pos",preventDefault:l=!0,transition:m="all 0.2s"}){const[a,d]=n.useState(null),f=n.useRef(new Set),r=n.useRef(0),i=n.useCallback(()=>{d(null),f.current.clear()},[]),w=n.useCallback(u=>{if(a===null)return;const c=u.touches[0];if(!c)return;const S=document.elementFromPoint(c.clientX,c.clientY);if(!S)return;const D=S.closest(`[${s}]`);if(D){const T=D.getAttribute(s);T&&!f.current.has(T)&&(e(T,a===2,!1),f.current.add(T))}},[a,e,s]);n.useEffect(()=>(window.addEventListener("mouseup",i),window.addEventListener("touchend",i),window.addEventListener("touchcancel",i),window.addEventListener("touchmove",w,{passive:!1}),()=>{window.removeEventListener("mouseup",i),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i),window.removeEventListener("touchmove",w)}),[i,w]);const x=n.useCallback(u=>({onMouseDown:c=>{t()&&(c.button!==0&&c.button!==2||Date.now()-r.current<o||(l&&c.preventDefault(),d(c.button),e(u,c.button===2,!0),f.current.add(u)))},onMouseEnter:()=>{a!==null&&!f.current.has(u)&&t()&&(e(u,a===2,!1),f.current.add(u))},onTouchStart:c=>{t()&&(c.cancelable&&l&&c.preventDefault(),r.current=Date.now(),d(0),e(u,!1,!0),f.current.add(u))},onContextMenu:c=>{l&&c.preventDefault()},[s]:u,sx:{touchAction:"none",transition:m}}),[e,t,a,o,s,l,m]);return{isDragging:a!==null,draggingButton:a,getDragProps:x,lastTouchTime:r}}function ve({onToggle:e,checkEnabled:t,touchTimeout:o,transition:s,posAttribute:l}){const m=n.useRef(void 0),a=n.useRef(e);a.current=e;const d=n.useCallback((r,i,w)=>{if(!t())return;const[x,u]=r.split(",").map(Number);x!==void 0&&u!==void 0&&(w?m.current=a.current(x,u,i,void 0,!0):a.current(x,u,i,m.current,!1))},[t]),{getDragProps:f}=te({onAction:d,checkEnabled:t,touchTimeout:o,transition:s,posAttribute:l});return{getDragProps:f}}function Ce(e,t){return`${e.toString()},${t.toString()}`}function ke(e){return(t,o)=>{if(e.customHandler){const s=e.customHandler(t,o);if(s!==t)return s}switch(o.type){case"resize":if("newRows"in o||"rows"in o||"cols"in o){const s=o.newRows??o.rows??t.rows,l=o.newCols??o.cols??t.cols;return e.getInitialState(s,l)}return t;case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return"state"in o?o.state:t;default:return t}}}function Me(e,t,o){return n.useMemo(()=>e(t,...o),[e,t,o])}const Re=e=>{if(e<1||e>100)throw new Error("Invalid grid size: must be between 1 and 100");return e},Ee=e=>{if(e<0)throw new Error("Invalid cell index: cannot be negative");return e};export{we as B,xe as G,Re as a,ze as b,ke as c,ve as d,Me as e,Se as f,Ce as g,ge as h,ye as i,Ee as j,ee as k,te as u};
