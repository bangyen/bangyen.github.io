import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{A as t,S as o,a as n,L as s,e as i,d as a}from"./index-vWmC5ICu.js";import{h as l,b as c,T as d,S as u,L as f,M as g,D as p,N as S,a as h,f as m,c as b,e as x,d as w,G as y,i as E,g as v,B as C}from"./useResponsiveBoardSize-Brvr6A0U.js";import{u as I,C as $}from"./layout-BI-gH9on.js";import{B as A}from"./vendor_mui_core-CC5VlWLf.js";import{u as O,v as N,c as R,P as T}from"./vendor_mui_icons-nmK6gwuH.js";import"./GlobalHeader-CEbLBcFO.js";const _=1,k=2;class M{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error("Index out of bounds");r!==e&&(this.parent[e]=this.find(r));const t=this.parent[e];if(void 0===t)throw new Error("Root not found");return t}union(e,r){const t=this.find(e),o=this.find(r);return t!==o&&(this.parent[t]=o,!0)}}function D(e,r,t){return e*(t+1)+r}function z(e,r,t){const o=new Map,n=new Set;for(let c=0;c<r;c++)for(let r=0;r<t;r++){const n=e[c]?.[r];if(!n||0===n)continue;const s=D(c,n===_?r+1:r,t),i=D(c+1,n===_?r:r+1,t);o.has(s)||o.set(s,[]),o.has(i)||o.set(i,[]),o.get(s)?.push({node:i,r:c,c:r}),o.get(i)?.push({node:s,r:c,c:r})}const s=new Set,i=new Set,a=[],l=(e,r)=>{s.add(e),i.add(e);const t=o.get(e)??[];for(const{node:o,r:c,c:d}of t)if(o!==r)if(i.has(o)){n.add(`${String(c)},${String(d)}`);for(let e=a.length-1;e>=0;e--){const r=a[e];if(!r)break;if(n.add(`${String(r.r)},${String(r.c)}`),r.u===o||r.v===o)break}}else s.has(o)||(a.push({r:c,c:d,u:e,v:o}),l(o,e),a.pop());i.delete(e)};for(const c of o.keys())s.has(c)||l(c,-1);return n}function j(e,r,t){const o=new M((r+1)*(t+1));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const s=r[e];if(void 0===s||0===s)continue;const i=D(n,s===_?e+1:e,t),a=D(n+1,s===_?e:e+1,t);if(!o.union(i,a))return!0}}return!1}function H(e,r,t){const o=Array.from({length:r+1},()=>Array(t+1).fill(0));for(let n=0;n<r;n++){const r=e[n];if(r)for(let e=0;e<t;e++){const t=r[e];if(t===_){const r=o[n];if(r){const t=r[e+1];void 0!==t&&(r[e+1]=t+1)}const t=o[n+1];if(t){const r=t[e];void 0!==r&&(t[e]=r+1)}}else if(t===k){const r=o[n];if(r){const t=r[e];void 0!==t&&(r[e]=t+1)}const t=o[n+1];if(t){const r=t[e+1];void 0!==r&&(t[e+1]=r+1)}}}}return o}function L(e,r,t){const o=Array.from({length:r},()=>Array(t).fill(0));let n=!0;for(;n;){n=!1;for(let s=0;s<=r;s++)for(let i=0;i<=t;i++){const a=e[s]?.[i];if(null==a)continue;const l=[{gr:s-1,gc:i-1,pt:k},{gr:s-1,gc:i,pt:_},{gr:s,gc:i-1,pt:_},{gr:s,gc:i,pt:k}].filter(({gr:e,gc:o})=>e>=0&&e<r&&o>=0&&o<t);let c=0;const d=[];for(const e of l){const r=o[e.gr]?.[e.gc];0===r?d.push(e):r===e.pt&&c++}if(c===a&&d.length>0)for(const{gr:e,gc:r,pt:t}of d){const s=o[e];s&&(s[r]=t===_?k:_,n=!0)}else if(c+d.length===a&&d.length>0)for(const{gr:e,gc:r,pt:t}of d){const s=o[e];s&&(s[r]=t,n=!0)}}if(!n)for(let e=0;e<r;e++)for(let s=0;s<t;s++){const i=o[e];if(0===i?.[s])if(i[s]=_,j(o,r,t)){if(i[s]=k,n=!0,j(o,r,t))return!1}else if(i[s]=k,j(o,r,t)){if(i[s]=_,n=!0,j(o,r,t))return!1}else i[s]=0}}if(!o.every(e=>e.every(e=>0!==e)))return!1;const s=H(o,r,t);for(let i=0;i<=r;i++)for(let r=0;r<=t;r++){const t=e[i]?.[r];if(null!=t&&s[i]?.[r]!==t)return!1}return!j(o,r,t)}function B(e,r){const t=Array.from({length:e},()=>Array(r).fill(_)),o=e*r*l.PUZZLE_GENERATION_ITERATIONS;for(let l=0;l<o;l++){const o=Math.floor(Math.random()*e),n=Math.floor(Math.random()*r),s=t[o];if(!s)continue;const i=s[n];void 0!==i&&(s[n]=i===_?k:_,j(t,e,r)&&(s[n]=i))}const n=H(t,e,r).map(e=>[...e]),s=[];for(let l=0;l<=e;l++)for(let e=0;e<=r;e++)s.push({r:l,c:e});for(let l=s.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1)),r=s[l],t=s[e];r&&t&&(s[l]=t,s[e]=r)}const i=Math.floor((e+1)*(r+1)*l.HINT_DENSITY);let a=(e+1)*(r+1);for(const{r:l,c:c}of s){if(a<=i)continue;const t=n[l];if(!t)continue;const o=t[c];null!=o&&(t[c]=null,L(n,e,r)?a--:t[c]=o)}return{numbers:n,solution:t}}function W(e,r){switch(r.type){case"toggle":{if(e.solved)return e;const{row:t,col:o}=r,n=e.grid.map(e=>[...e]),s=n[t];if(!s)return e;const i=s[o];if(void 0===i)return e;r.reverse?s[o]=0===i?k:i===k?_:0:s[o]=0===i?_:i===_?k:0;let a=!1;if(n.every(e=>e.every(e=>0!==e))){const r=H(n,e.rows,e.cols);e.numbers.every((e,t)=>e.every((e,o)=>null===e||e===r[t]?.[o]))&&!j(n,e.rows,e.cols)&&(a=!0)}const l=function(e,r,t,o){const n=new Set,s=H(e,t,o);for(let i=0;i<=t;i++)for(let a=0;a<=o;a++){const l=r[i]?.[a];if(null==l)continue;const c=s[i]?.[a]??0;c>l?n.add(`${String(i)},${String(a)}`):c+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:r,gc:n})=>r>=0&&r<t&&n>=0&&n<o&&0===e[r]?.[n]).length<l&&n.add(`${String(i)},${String(a)}`)}return n}(n,e.numbers,e.rows,e.cols),c=z(n,e.rows,e.cols),d=function(e,r,t,o){const n=new Set,s=H(e,t,o);for(let i=0;i<=t;i++)for(let e=0;e<=o;e++){const t=r[i]?.[e];null!=t&&((s[i]?.[e]??0)===t&&n.add(`${String(i)},${String(e)}`))}return n}(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:a,errorNodes:l,cycleCells:c,satisfiedNodes:d}}case"hydrate":return{...r.state};case"resize":{if(r.rows<l.MIN_SIZE||r.cols<l.MIN_SIZE)return e;const{numbers:t,solution:o}=B(r.rows,r.cols);return{grid:Array.from({length:r.rows},()=>Array(r.cols).fill(0)),numbers:t,solution:o,rows:r.rows,cols:r.cols,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}case"new":{const{numbers:r,solution:t}=B(e.rows,e.cols);return{...e,grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:r,solution:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return e}}const G=({rows:a,cols:l,numbers:h,size:m,initialMoves:b,onMove:x,onCopy:w,onClear:y,onClose:E})=>{const v=I("sm"),C=b,{getDragProps:T}=c({onToggle:(e,r,t,o)=>{const n=`${String(e)},${String(r)}`;if(void 0!==o)return void x(n,o);const s=C.get(n);let i;return i=t?s===k?_:s===_?void 0:k:s===_?k:s===k?void 0:_,x(n,i),i},touchTimeout:d.TOUCH_HOLD_DELAY,checkEnabled:()=>!0}),[M,D]=e.useState(new Map),[j,H]=e.useState([]),[L,B]=e.useState(new Set);e.useEffect(()=>{const e=new Map,r=[],t=[];C.forEach((t,o)=>{e.set(o,{state:t,source:"user"});const[n,s]=o.split(",").map(Number);void 0!==n&&void 0!==s&&r.push({r:n,c:s})});const o=(r,t)=>{if(r<0||r>=a||t<0||t>=l)return 0;const o=`${String(r)},${String(t)}`;return e.get(o)?.state??0},n=(o,n,s,i)=>{const a=`${String(o)},${String(n)}`,l=e.get(a);l?l.state!==s&&t.push({type:"cell",r:o,c:n}):(e.set(a,{state:s,source:i}),r.push({r:o,c:n}))},s=(e,r)=>[{r:e-1,c:r-1,required:k},{r:e-1,c:r,required:_},{r:e,c:r-1,required:_},{r:e,c:r,required:k}].filter(e=>e.r>=0&&e.r<a&&e.c>=0&&e.c<l);let i=0;for(;i<r.length;){const a=r[i++];if(!a)break;const{r:l,c:c}=a,d=[{r:l,c:c},{r:l,c:c+1},{r:l+1,c:c},{r:l+1,c:c+1}];for(const r of d){const i=h[r.r]?.[r.c];if(null==i)continue;const a=s(r.r,r.c);let d=0;const u=[];for(const e of a){const r=o(e.r,e.c);0===r?u.push(e):r===e.required&&d++}if(d>i)t.push({type:"node",r:r.r,c:r.c});else if(d+u.length<i)t.push({type:"node",r:r.r,c:r.c});else if("user"===e.get(`${String(l)},${String(c)}`)?.source)if(d===i&&u.length>0)for(const e of u){const r=e.required===_?k:_;n(e.r,e.c,r,"propagated")}else if(d+u.length===i&&u.length>0)for(const e of u)n(e.r,e.c,e.required,"propagated")}}const c=Array.from({length:a},()=>Array(l).fill(0));e.forEach((e,r)=>{const[t,o]=r.split(",").map(Number);void 0!==t&&void 0!==o&&c[t]&&(c[t][o]=e.state)});const d=z(c,a,l);D(e),H(t),B(d)},[C,h,a,l]);const W=m*S,G=m-W,F=e.useMemo(()=>new Set(j.filter(e=>"cell"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[j]),P=e.useMemo(()=>new Set(j.filter(e=>"node"===e.type).map(e=>`${String(e.r)},${String(e.c)}`)),[j]),U=e.useCallback((e,s)=>{const i=`${String(e)},${String(s)}`,a=M.get(i),l=a?.state??0,c=a?.source,d=F.has(i),g=L.has(i),p=T(i);let S=n.text.primary;return d?S=n.data.red:g?S="user"===c?n.data.red:"#ff9800":"user"===c?S=n.primary.main:"propagated"===c&&(S=n.data.green),{...p,sx:{...p.sx,cursor:"pointer",border:`1px solid ${u.GHOST.BORDER}`,position:"relative",backgroundColor:u.GHOST.BG_SUBTLE,"&:hover":{backgroundColor:u.GHOST.BG_HOVER}},children:r.jsxs(A,{sx:{width:"100%",height:"100%",position:"relative"},children:[l===_&&r.jsx(A,{sx:{position:"absolute",width:f.LINE_WIDTH,height:f.LINE_THICKNESS,backgroundColor:S,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),l===k&&r.jsx(A,{sx:{position:"absolute",width:f.LINE_WIDTH,height:f.LINE_THICKNESS,backgroundColor:S,borderRadius:o.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}},[M,F,L,T]),Z=e.useCallback((e,t)=>{const o=h[e]?.[t],s=P.has(`${String(e)},${String(t)}`);return{"data-pos":`${String(e)},${String(t)}`,"data-type":"hint",children:r.jsx(A,{children:o??""}),sx:{borderRadius:"50%",backgroundColor:s?n.data.red:u.GHOST.HINT_BG,border:null!==o?`2px solid ${s?n.data.red:u.GHOST.HINT_BORDER}`:"none",fontSize:`${String(.5*W)}rem`,fontWeight:"800",color:u.COLORS.WHITE,zIndex:5,opacity:null!==o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(1.1)":"scale(1)",position:"relative",pointerEvents:"none"}}},[h,P,W]);return r.jsxs(A,{sx:{position:"relative",userSelect:"none"},children:[r.jsxs(A,{sx:{position:"relative",padding:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,border:`2px dashed ${u.GHOST.DASHED_BORDER}`,borderRadius:f.CALCULATOR_BORDER_RADIUS},children:[r.jsx(A,{sx:{position:"relative",zIndex:s.zIndex.base+1},children:r.jsx($,{size:m,rows:a,cols:l,cellProps:U,space:0,sx:{width:"fit-content"}})}),r.jsx(A,{sx:{position:"absolute",top:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,left:v?`calc(${g} + 16px)`:`calc(${p} + 24px)`,transform:`translate(-${String(W/2)}rem, -${String(W/2)}rem)`,zIndex:s.zIndex.base+2,pointerEvents:"none"},children:r.jsx($,{size:W,rows:a+1,cols:l+1,cellProps:Z,space:G,sx:{width:"fit-content"}})})]}),r.jsxs(A,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:v?-72:-88,left:0,right:0,pointerEvents:"auto",zIndex:s.zIndex.base+5,paddingBottom:2},children:[r.jsx(i,{title:"Copy Board",Icon:O,onClick:w,sx:{backgroundColor:n.interactive.selected,color:n.primary.main,"&:hover":{backgroundColor:n.interactive.focus}}}),r.jsx(i,{title:"Clear Calculator",Icon:N,onClick:y,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:n.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),r.jsx(i,{title:"Close Calculator",Icon:R,onClick:E,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:n.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})]})};function F(){const{rows:o,cols:s,handlePlus:I,handleMinus:$,mobile:O,dynamicSize:N,minSize:R,maxSize:M}=h({storageKey:E.SIZE,defaultSize:l.DEFAULT_SIZE,minSize:l.MIN_SIZE,headerOffset:{mobile:f.HEADER_OFFSET.MOBILE,desktop:f.HEADER_OFFSET.DESKTOP},paddingOffset:160,widthLimit:f.WIDTH_LIMIT,cellSizeReference:4,mobileRowOffset:-2}),[D,z]=e.useState(!1),j=m({rows:o+1,cols:s+1,headerOffset:{mobile:f.HEADER_OFFSET.MOBILE,desktop:f.HEADER_OFFSET.DESKTOP},paddingOffset:{x:O?128:224,y:f.PADDING_OFFSET},boardMaxWidth:f.BOARD_MAX_WIDTH,boardSizeFactor:f.BOARD_SIZE_FACTOR,maxCellSize:f.MAX_CELL_SIZE,remBase:f.REM_BASE}),H=e.useMemo(()=>function(e,r){const{numbers:t,solution:o}=B(e,r);return{grid:Array.from({length:e},()=>Array(r).fill(0)),numbers:t,solution:o,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}(o,s),[o,s]),[L,F]=e.useReducer(W,H);b({storageKey:E.STATE,rows:o,cols:s,state:L,enabled:!D,onRestore:e=>{F({type:"hydrate",state:e})},serialize:e=>({...e,errorNodes:Array.from(e.errorNodes),cycleCells:Array.from(e.cycleCells),satisfiedNodes:Array.from(e.satisfiedNodes)}),deserialize:e=>{const r=e;return{...r,errorNodes:new Set(r.errorNodes),cycleCells:new Set(r.cycleCells),satisfiedNodes:new Set(r.satisfiedNodes)}}});const[P,U]=e.useState(new Map);b({storageKey:E.GHOST_MOVES,rows:o,cols:s,state:P,onRestore:e=>{U(e)},serialize:e=>Array.from(e.entries()),deserialize:e=>new Map(e)});const Z=e.useRef("");e.useEffect(()=>{const e=JSON.stringify(L.numbers);Z.current&&Z.current!==e&&U(new Map),Z.current=e},[L.numbers,L.rows,L.cols]),x(a.slant);const q=e.useCallback(()=>{F({type:"new"})},[F]);w(L.solved,q,d.WIN_ANIMATION_DELAY);const{getDragProps:K}=c({onToggle:(e,r,t)=>{F({type:"toggle",row:e,col:r,reverse:t})},checkEnabled:()=>!L.solved,touchTimeout:d.TOUCH_HOLD_DELAY}),Y=j*S,V=e.useMemo(()=>((e,o)=>(s,i)=>{const a=e.grid[s]?.[i],l=`${String(s)},${String(i)}`,c=e.cycleCells.has(l),d=o(l);return{...d,sx:{...d.sx,cursor:"pointer",border:`1px solid ${n.border.subtle}`,position:"relative","&:hover":{backgroundColor:n.interactive.hover}},children:r.jsxs(A,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===_&&r.jsx(A,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:c?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}}),a===k&&r.jsx(A,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:c?n.data.red:n.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:u.SHADOWS.LINE,transition:t.transition,pointerEvents:"none"}})]})}})(L,K),[L,K]),X=e.useMemo(()=>((e,t)=>(o,s)=>{const i=e.numbers[o]?.[s],a=e.errorNodes.has(`${String(o)},${String(s)}`),l=e.satisfiedNodes.has(`${String(o)},${String(s)}`);return{sx:{pointerEvents:"none"},children:r.jsx(A,{sx:{borderRadius:"50%",backgroundColor:a?n.data.red:n.surface.background,border:null!==i?`2px solid ${a?n.data.red:l?"transparent":n.border.subtle}`:"none",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:a?u.COLORS.WHITE:l?n.interactive.disabledText:n.text.primary,boxShadow:l&&!a?"none":u.SHADOWS.HINT,zIndex:5,opacity:null!==i?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:a?"scale(1.1)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}})(L,Y),[L,Y]);e.useEffect(()=>{F({type:"resize",rows:o,cols:s})},[o,s]);const J=D?r.jsx(r.Fragment,{}):r.jsx(v,{rows:o,cols:s,dynamicSize:N,minSize:R,maxSize:M,handlePlus:I,handleMinus:$,onRefresh:q,disabled:D,children:r.jsx(i,{title:"Open Calculator",Icon:T,onClick:()=>{z(!D)},sx:{color:"default"}})}),Q=e.useCallback((e,r)=>{U(t=>{const o=new Map(t);return void 0===r?o.delete(e):o.set(e,r),o})},[]),ee=e.useCallback(()=>{const e=new Map;L.grid.forEach((r,t)=>{r.forEach((r,o)=>{0!==r&&e.set(`${String(t)},${String(o)}`,r)})}),U(e)},[L.grid]),re=e.useCallback(()=>{U(new Map)},[]),te=e.useCallback(()=>{z(!1)},[]),oe=e.useCallback(e=>{e.stopPropagation()},[]),ne=e.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${n.surface.elevated} 0%, ${n.surface.background} 100%)`,padding:O?"1rem":"2rem"}),[O]),se=e.useMemo(()=>({userSelect:"none",padding:O?g:p,border:"2px solid transparent",borderRadius:f.CALCULATOR_BORDER_RADIUS}),[O]),ie=D?r.jsx(G,{rows:o,cols:s,numbers:L.numbers,size:j,initialMoves:P,onMove:Q,onCopy:ee,onClear:re,onClose:te}):r.jsx(C,{size:j,rows:o+1,cols:s+1,frontProps:X,backProps:V,frontLayerSx:{pointerEvents:"none"}});return r.jsx(y,{title:a.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:J,contentSx:ne,showTrophy:!D&&L.solved,onReset:q,boardSize:j,iconSizeRatio:f.ICON_SIZE_RATIO,primaryColor:n.primary.main,secondaryColor:n.primary.main,boardSx:se,children:r.jsx(A,{onClick:oe,children:ie})})}export{F as default};
