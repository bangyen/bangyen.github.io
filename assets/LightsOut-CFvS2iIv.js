import{r as t,j as e,a as n}from"./vendor_react-WaSaIrII.js";import{a as o,T as s,d as r,e as i,g as l,L as a}from"./index-DoUnjv5M.js";import{C as c,u,c as f}from"./CustomGrid-COI-JC9O.js";import{B as d,G as x,i as p,r as h,s as m,I as g,C as j,t as y,u as b,v as w,j as C,R as k,N as z,w as v,x as S}from"./vendor_mui-Dq5yL91G.js";import{u as I,G as A}from"./gameConfig-Bl_NC4gL.js";import{G as P}from"./GlassCard-Cc1rGejI.js";import{G as $}from"./GlobalHeader-A2dwxARC.js";function R(t){const{frontProps:n,backProps:o,size:s,rows:r,cols:i}=t;return e.jsxs(d,{sx:{display:"grid",placeItems:"center"},children:[e.jsx(d,{sx:{gridArea:"1/1"},children:e.jsx(c,{space:0,size:s,rows:r-1,cols:i-1,cellProps:o})}),e.jsx(d,{sx:{gridArea:"1/1",zIndex:1},children:e.jsx(c,{space:0,size:s,rows:r,cols:i,cellProps:n})})]})}function D(e,n){const o=t.useCallback((t,o)=>{const s=e(t,o);return{front:s?n.primary:n.secondary,back:s?n.secondary:n.primary}},[e,n]),s=t.useCallback((t,n)=>function(t,e,n){const o=n(t,e),s={},r=o===n(t-1,e),i=o===n(t+1,e),l=o===n(t,e-1),a=o===n(t,e+1);return(r||l)&&(s.borderTopLeftRadius=0),(r||a)&&(s.borderTopRightRadius=0),(i||l)&&(s.borderBottomLeftRadius=0),(i||a)&&(s.borderBottomRightRadius=0),s}(t,n,e),[e]),r=t.useCallback((t,o)=>{const s=function(t,e,n){const o=n(t,e),s=n(t,e+1),r=n(t+1,e),i=n(t+1,e+1);let l=!0;const a=Number(o)+Number(s)+Number(r)+Number(i);return o&&i||!(a<3)||(l=!1),l}(t,o,e);return s?n.primary:n.secondary},[e,n]);return{getColor:o,getBorder:s,getFiller:r}}function B(t,e){return[...Array(t)].map(()=>Array(e).fill(0))}function W(t,e,n){const o=n[0].length,s=n.length,r=n.map(t=>[...t]);return r[t][e]^=1,t>0&&(r[t-1][e]^=1),t<s-1&&(r[t+1][e]^=1),e>0&&(r[t][e-1]^=1),e<o-1&&(r[t][e+1]^=1),r}function M(t,e){let n=B(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++){Math.random()>.5&&(n=W(o,t,n))}return n}const H={};function T(t){const e=t.length,n=t[0].length;for(let s=0;s<e-1;s++)for(let e=0;e<n;e++)if(1===t[s][e])return[{row:s+1,col:e}];const o=t[e-1];if(o.some(t=>1===t)){const t=function(t,e,n){const o=`${t},${e}`;if(!H[o]){const n={},s=1<<e;for(let o=0;o<s;o++){let s=B(t,e);const r=[];for(let t=0;t<e;t++)o>>t&1&&(s=W(0,t,s),r.push(t));for(let n=0;n<t-1;n++)for(let t=0;t<e;t++)1===s[n][t]&&(s=W(n+1,t,s));const i=s[t-1].join("");n[i]||(n[i]=r)}H[o]=n}const s=n.join("");return H[o][s]||null}(e,n,o);if(t&&t.length>0)return t.map(t=>({row:0,col:t}))}return null}function E(t,e){const{type:n,row:o,col:s,moves:r}=e;let{grid:i,score:l,rows:a,cols:c,auto:u}=t;switch(n){case"auto":u=!u;break;case"adjacent":if(void 0!==o&&void 0!==s){i=W(o,s,i);const t=i.flatMap(t=>t);(!t.includes(1)||!t.includes(0))&&(i=M(a,c),l+=1)}break;case"multi_adjacent":if(r){r.forEach(t=>{i=W(t.row,t.col,i)});const t=i.flatMap(t=>t);(!t.includes(1)||!t.includes(0))&&(i=M(a,c),l+=1)}break;case"random":case"randomize":i=M(a,c),u=!1;break;case"resize":{const{newRows:t,newCols:n}=e;void 0!==t&&void 0!==n&&(a=t,c=n,i=M(a,c),u=!1);break}case"reset":i=B(a,c),l=0,u=!1}return{grid:i,score:l,rows:a,cols:c,auto:u}}function G(t){let e=0;for(;t;)t&=t-1,e++;return e}function N(t,e){const n=t.length,o=[];for(let s=0;s<n;s++){const r=t[s];let i=0;for(let t=0;t<n;t++){i<<=1,i+=1&G(r&e[t])}o.push(i)}return o}function L(t){const e=Array(t).fill(1);for(let n=0;n<t;n++)e[n]<<=t-n-1;return e}function _(t,e){let n=L(t.length);for(let o=0;o<e;o++)n=N(n,t);return n}function O(t,e){const n=t.length,o=[];for(let s=0;s<n;s++){const n=t[s]^e[s];o.push(n)}return o}function F(t,e){const n=t.length,o=[...Array(n).keys()].sort((e,n)=>t[n]-t[e]);return[o.map(e=>t[e]),o.map(t=>e[t])]}function Y(t,e,n){const o=function(t){const e=[7<<t-2];for(let n=1;n<t;n++){const t=e[n-1]>>1;e.push(t)}return e[0]-=2**t,e}(n),s=function(t,e){const n=t.length;let o=Array(n).fill(0),s=0;for(;e;)1&e&&(o=O(o,_(t,s))),e>>=1,s++;return o}(o,function(t){const e=[0,1];for(let n=1;n<t;n++){const t=e[n],o=e[n-1],s=t<<1;e.push(s^o)}return e[t]}(e+1)),r=function(t){const e=t.length;let n=t,o=L(e);for(let s=0;s<e;s++){const t=1<<e-s-1;[n,o]=F(n,o);for(let r=0;r<e;r++){const e=n[r];r!==s&&e&t&&(n[r]^=n[s],o[r]^=o[s])}}return o}(s),i=parseInt(t.join(""),2);return r.map(t=>1&G(t&i))}function U(t,e){const n=[...t];let o=t.at(-1);if(!o)return n;for(let s=1;s<e;s++)for(let t=0;t<e;t++){if(!o[s-1][t])continue;const e=W(s,t,o);n.push(e),o=e}return n}function q(t,e){const n=t.at(-1);if(!n)return t;const o=[...t];for(;o.length<e;)o.push([...n]);return o}function J(t,e){let n=B(e,e);for(const x of t){n=W(Math.floor(x/e),x%e,n)}const o=U([n],e),s=o.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const r=s.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:l}=function(t,e){const n=Array(e).fill(0),o=[n],s=[n],r=[...n];for(let i=0;i<e;i++){if(!t[i])continue;r[i]=1;const n=[...r],l=Y(n,e,e);o.push(n),s.push(l)}return{input:o,output:s}}(r,e),a=o.length+i.length-1,c=l.at(-1);if(!c)return{boardStates:[],inputStates:[],outputStates:[]};let u=[...s];for(let x=0;x<a-o.length;x++)o.push([...s]);for(let x=0;x<a-i.length;x++)i.unshift([...i[0]]);for(let x=0;x<a-l.length;x++)l.unshift([...l[0]]);for(let x=0;x<e;x++)c[x]&&(u=W(0,x,u),o.push([...u]));const f=U(o,e),d=f.length;return{boardStates:f,inputStates:q(i,d),outputStates:q(l,d)}}function K(t,e,n,o){return(s,r)=>{const i=function(t,e){const n=[-1,...t,-1],o=t.length,s={};for(let r=0;r<o+1;r++){const t=n[r],i=(t+1?t:n[r+1])?e.primary:e.secondary,l=100*r/o;s[`${Math.floor(l)}%`]={backgroundColor:i}}return s}(e(t,s,r),n),l=t.length,a=`${o}-${s}-${r}`,c=`@keyframes ${a}`,u=`\n            ${a}\n            ${2*l}s\n            steps(1, start)\n            infinite\n        `;return{sx:{[c]:i,animation:u}}}}function Q(t,n,o,s){return(r,i)=>{const l=function(t,e,n,o,s){const r=t.length,i={};for(let l=0;l<r+1;l++){const a=100*l/r,c=Math.floor(a);let u=0,f=s.secondary;const d=l>0&&l<=r?t[l-1]:null,x=l>0&&l<r?t[l]:null;if(d&&x){const t=W(e,n,d);let r=!0;t:for(let e=0;e<o;e++)for(let n=0;n<o;n++)if(t[e][n]!==x[e][n]){r=!1;break t}r&&(u=1,f=1===d[e][n]?s.secondary:s.primary)}i[`${c}%`]={opacity:u,color:f}}return i}(t,r,i,n,s),a=t.length,c=`${o}-icon-${r}-${i}`,u=`@keyframes ${c}`,f=`\n            ${c}\n            ${2*a}s\n            steps(1, start)\n            infinite\n        `;return{children:e.jsx(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",[u]:l,animation:f},children:e.jsx(h,{sx:{fontSize:"inherit"}})})}}}function V({start:t=[],dims:n=3,size:s,palette:r}){const i=J(t,n),l=s,{boardStates:a,inputStates:u,outputStates:f}=i,h=(t,e,n)=>t.map(t=>t[n]),m=K(a,(t,e,n)=>t.map(t=>t[e][n]),r,"board"),g=Q(a,n,"board",r),j=K(u,h,r,"input"),y=K(f,h,r,"output");return e.jsx(x,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:e.jsxs(x,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%"},children:[e.jsx(x,{size:6,sx:{display:"flex",justifyContent:"center"},children:e.jsx(c,{size:l,rows:n,cols:n,cellProps:(t,e)=>({...m(t,e),...g(t,e)}),space:0})}),e.jsxs(x,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{mb:2,textAlign:"center"},children:[e.jsx(p,{variant:"subtitle2",sx:{mb:1,color:o.text.secondary},children:"Input"}),e.jsx(c,{rows:1,cols:n,size:l,cellProps:j,space:0})]}),e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(c,{rows:1,cols:n,size:l,cellProps:y,space:0}),e.jsx(p,{variant:"subtitle2",sx:{mt:1,color:o.text.secondary},children:"Result"})]})]})]})})}function X(e,n,o){return D(t.useCallback((t,o)=>0!==t||o<0||o>=n?-1:e[o],[e,n]),o)}const Z=({children:t})=>e.jsx(p,{variant:"h5",sx:{color:o.text.primary,fontWeight:s.fontWeight.bold,textAlign:"left",fontSize:s.fontSize.h2},children:t}),tt=({Icon:t,title:n,text:r})=>e.jsxs(d,{sx:{px:2},children:[e.jsxs(p,{variant:"h6",sx:{color:o.text.primary,fontWeight:s.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:s.fontSize.subheading},children:[e.jsx(t,{sx:{mr:2,color:o.primary.main,fontSize:"1.75rem"}}),n]}),e.jsx(p,{variant:"body1",sx:{color:o.text.secondary,lineHeight:1.6,fontSize:s.fontSize.body,ml:6},children:r})]}),et=["Chasing Lights","How It Works","Calculator"],nt=P;function ot(n){const{rows:s,cols:r,size:i,open:l,palette:a,toggleOpen:f}=n,x=u("md"),[S,I]=t.useState(0),[A,P]=t.useState(Array(r).fill(0));t.useEffect(()=>{P(Array(r).fill(0))},[r,a]);const $=Y(A,s,r),R=X(A,r,a),D=X($,r,a),B=function(t,n){const{getColor:o,getBorder:s}=t;return(t,r)=>{const{front:i,back:l}=o(t,r);return{backgroundColor:i,style:s(t,r),onClick:n(r),sx:{"&:hover":{cursor:"pointer",color:l},transition:"all 200ms ease"},color:i,children:e.jsx(h,{})}}}(R,t=>e=>{e.stopPropagation();const n=[...A];n[t]^=1,P(n)}),W=function({getColor:t,getBorder:e}){return(n,o)=>{const{front:s}=t(n,o);return{backgroundColor:s,style:e(n,o),transition:"all 200ms ease"}}}(D);return e.jsxs(m,{open:l,onClick:f,sx:{zIndex:9999,backgroundColor:t=>"dark"===t.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)"},children:[e.jsxs(nt,{onClick:t=>t.stopPropagation(),sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[e.jsxs(d,{sx:{flex:1,overflowY:"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsx(Z,{children:et[S]}),e.jsx(g,{onClick:()=>{f()},size:"small",sx:{color:o.text.secondary},children:e.jsx(j,{})})]}),0===S&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[e.jsx(tt,{Icon:y,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),e.jsx(tt,{Icon:b,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),e.jsx(tt,{Icon:w,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===S&&e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(V,{dims:3,size:.7*i,start:[1,3,8],palette:a})})}),2===S&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Input"," ",e.jsx(d,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),e.jsx(c,{space:0,rows:1,cols:r,size:i*(x?.9:.8),cellProps:B})]}),e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Solution"," ",e.jsx(d,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),e.jsx(c,{space:0,rows:1,cols:r,size:i*(x?.9:.8),cellProps:W})]}),e.jsx(d,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(C,{variant:"outlined",size:"small",startIcon:e.jsx(k,{}),onClick:()=>{P(Array(r).fill(0))},sx:{borderColor:o.border.subtle,color:o.text.secondary},children:"Clear Pattern"})})]})})]}),e.jsxs(d,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(C,{onClick:()=>{S>0&&I(S-1)},disabled:0===S,startIcon:e.jsx(z,{}),sx:{visibility:0===S?"hidden":"visible",color:o.text.primary},children:"Back"}),e.jsx(d,{sx:{display:"flex",gap:1},children:[0,1,2].map(t=>e.jsx(d,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:S===t?o.primary.main:o.interactive.disabled,transition:"background-color 0.3s"}},t))}),e.jsx(C,{onClick:()=>{S<2?I(S+1):f()},disabled:2===S,endIcon:e.jsx(v,{}),sx:{visibility:2===S?"hidden":"visible",color:o.text.primary},children:"Next"})]})]}),e.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})}function st(t,n){const{getColor:o,getBorder:s}=t;return(t,r)=>{const i=s(t,r),{front:l,back:a}=o(t,r);return{onClick:()=>((t,e)=>{n({type:"adjacent",row:t,col:e})})(t,r),children:e.jsx(h,{}),backgroundColor:l,color:l,style:i,sx:{"&:hover":{cursor:"pointer",color:a}}}}}function rt(){const{height:s,width:c}=I(),p=u("sm"),h=p?A.gridSizes.mobile:A.gridSizes.desktop;let{rows:m,cols:g}=t.useMemo(()=>{const t=p?a.headerHeight.xs:a.headerHeight.md;return f(h,s-t,Math.min(c,1300))},[h,s,c,p]);m-=1,g-=1,p&&(m-=2);const j={grid:B(m,g),score:0,rows:m,cols:g,auto:!1},[y,b]=t.useReducer(E,j),[w,C]=t.useReducer(t=>!t,!1),k=t.useMemo(()=>({primary:o.primary.main,secondary:o.primary.dark}),[]);t.useEffect(()=>{document.title=r.lightsOut},[]),t.useEffect(()=>{b({type:"resize",newRows:m,newCols:g})},[m,g]);const[z,v]=n.useState([]);t.useEffect(()=>{if(!y.auto)return void(z.length>0&&v([]));const t=setTimeout(()=>{if(z.length>0){const[t,...e]=z;b({type:"adjacent",row:t.row,col:t.col}),v(e)}else{const t=T(y.grid);t&&t.length>0?1===t.length?b({type:"adjacent",row:t[0].row,col:t[0].col}):v(t):b({type:"auto"})}},300);return()=>clearTimeout(t)},[y.auto,y.grid,z]);const P=function(e,n){const{grid:o,rows:s,cols:r}=e;return D(t.useCallback((t,e)=>t<0||e<0||t>=s||e>=r?-1:o[t][e],[o,s,r]),n)}(y,k),W=st(P,t=>b(t));return e.jsxs(x,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:o.surface.background,position:"relative"},children:[e.jsx($,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),e.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",paddingTop:6},children:e.jsx(R,{size:h,rows:m,cols:g,frontProps:W,backProps:(t,e)=>({backgroundColor:P.getFiller(t,e)})})}),e.jsx(i,{handler:()=>()=>{},onAutoPlay:()=>b({type:"auto"}),autoPlayEnabled:y.auto,children:e.jsx(l,{title:"Info",Icon:S,onClick:C})}),e.jsx(ot,{rows:m,cols:g,size:h,open:w,palette:k,toggleOpen:C})]})}export{rt as default};
