import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{g as o,a as t,u as s,c as n,C as a}from"./CustomGrid-CqoN2_bn.js";import{d as i,a as l,C as c,e as u,f,L as d}from"./index-DLpm49uc.js";import{u as h,G as m}from"./gameConfig-Bl_NC4gL.js";import{G as p}from"./GlobalHeader-klXvgWwj.js";import{u as y,a as b}from"./useTimer-DNifX3C9.js";import{G as g}from"./vendor_mui_core-3PJY_Tg4.js";import"./vendor_mui_icons-BivQhPxB.js";function w(e){return Math.floor(Math.random()*e)}function k(e,r){const o={};for(const t in e){const s=e[t];s+r>0?o[t]=s+r:s<0&&(o[t]=s)}return o}function x(e,r,o){const t=r*o,s=w(t);let n=w(t);return s===n&&(n=++n%t),{...e,rows:r,cols:o,head:s,board:{[s]:e.length,[n]:-1}}}function v(e){let{board:r,length:o,head:s,velocity:n,buffer:a}=e;const{rows:i,cols:l}=e,c=i*l;if(r=k(r,-1),s=t(s,n,i,l),s in r){const e=r[s];r[s]=o,e>0?r=k(r,-e):(r=k(r,1),r=function(e,r){let o=w(e);for(;o in r;)++o>=e&&(o=0);return{...r,[o]:-1}}(c,r)),o=r[s]}else r[s]=o;if(a.length){const[e,...r]=a;a=r,n+e&&(n=e)}return{...e,length:o,board:r,head:s,velocity:n,buffer:a}}function j(e,r){switch(r.type){case"resize":{const{rows:o,cols:t}=r.payload;return x(e,o,t)}case"steer":{const{payload:t}=r,s=o(t.key);let{buffer:n}=e;return s&&(n=[...n,s]),{...e,buffer:n}}case"move":return v(e);default:return e}}function C(){const{create:o}=y(0),{create:t}=b(),k=s("sm"),{height:v,width:C}=h(),_=m.snake.initialLength,S=k?m.gridSizes.mobile:m.gridSizes.desktop,[z,P]=e.useState(!1),E=e.useRef(!1),[G,H]=e.useState(!1),{rows:M,cols:A}=e.useMemo(()=>{const e=k?d.headerHeight.xs:d.headerHeight.md;return n(S,v-e,C)},[S,v,C,k]),D=e.useMemo(()=>({velocity:m.snake.initialVelocity,buffer:[],length:_,rows:0,cols:0,head:0,board:{}}),[_]),[L,R]=e.useReducer(j,x(D,M,A)),$=e.useCallback(e=>()=>{const r=m.controls.arrowPrefix+e;R({type:"steer",payload:{key:r}})},[]),B=e.useCallback(e=>{const{clientX:r,clientY:o}=e,t=r-C/2,s=o-v/2,n=L.buffer.length>0?L.buffer[L.buffer.length-1]:L.velocity;let a="";a=2===Math.abs(n)?t>0?"right":"left":s>0?"down":"up";const i=m.controls.arrowPrefix+a;R({type:"steer",payload:{key:i}})},[R,L.velocity,L.buffer,C,v]),I=e.useCallback((e,r)=>{const o=e*A+r,t=L.board;let s="inherit";return o in t&&(s=t[o]>0?l.primary.main:l.primary.dark),{backgroundColor:s,boxShadow:"inherit"!==s?`0 0 1.25rem ${s.replace("hsl","hsla").replace(")",", 0.25)")}`:"none",border:"inherit"!==s?`0.0625rem solid ${s}`:"none"}},[L,A]);return e.useEffect(()=>{o({repeat:()=>{const e="wasd"[w(4)];R({type:"move"}),w(2)&&E.current&&R({type:"steer",payload:{key:e}})},speed:100}),t(e=>R({type:"steer",payload:e}))},[o,t]),e.useEffect(()=>{E.current=z},[z]),e.useEffect(()=>{R({type:"resize",payload:{rows:M,cols:A}})},[M,A]),e.useEffect(()=>{document.title=i.snake},[]),r.jsxs(g,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:l.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[r.jsx(p,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),r.jsx(g,{flex:1,onPointerDown:B,sx:{...c.flexCenter,zIndex:1},children:r.jsx(a,{size:S,rows:M,cols:A,cellProps:I})}),r.jsx(u,{handler:$,onAutoPlay:()=>P(!z),autoPlayEnabled:z,hide:G,children:r.jsx(f,{show:G,setShow:H,handler:$})})]})}export{C as default};
