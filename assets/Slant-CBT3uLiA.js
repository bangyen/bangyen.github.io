import{j as f,r as m,a as B}from"./vendor_react-BjoZPjhv.js";import{B as xe,g as He,a as be,h as We,i as Fe,m as ze,b as Ae,G as Ce,u as ve,j as ae,T as we,k as Ue,L as Ye,l as qe,v as ce,c as Ke,d as Ve,e as ne,f as F}from"./gameUtils-C9ZmF7tp.js";import{T as V}from"./PageLayout-BOYuJdAS.js";import{d as E,s as ee,T as ke,B as Xe}from"./vendor_mui_core-Bzt2vl7i.js";import{e as Ze,D as Je,f as Qe,g as et,P as tt,c as nt,h as rt,N as ot,d as st,T as it,i as lt,j as at}from"./vendor_mui_icons-CLHgFD_-.js";import{C,L as ct,A as z,S as ue,F as ut,P as dt}from"./index-BKHJR21r.js";import{E as de,u as ft}from"./layout-DjuNrwTn.js";import{E as gt}from"./ErrorState-D3w5ap8w.js";const Ne=m.createContext(void 0);function pt({children:e,value:t}){return f.jsx(Ne.Provider,{value:t,children:e})}function ht(){const e=m.useContext(Ne);if(e===void 0)throw new Error("useAnalysisContext must be used within an AnalysisProvider");return e}function St(){const{onCopy:e,onClear:t,onClose:n,onApply:r}=ht();return f.jsxs(E,{sx:{display:"flex",justifyContent:"center",gap:2,pointerEvents:"auto",zIndex:ct.zIndex.base+5,width:"100%",paddingBottom:2,position:"absolute",top:"calc(100% + 32px)",left:0},children:[f.jsx(V,{title:"Copy Board",Icon:Ze,onClick:e,sx:{backgroundColor:C.interactive.selected,color:C.primary.main,"&:hover":{backgroundColor:C.interactive.focus}}}),f.jsx(V,{title:"Clear Analysis",Icon:Je,onClick:t,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:C.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),f.jsx(V,{title:"Apply to Game",Icon:Qe,onClick:r,sx:{backgroundColor:"rgba(76, 175, 80, 0.1)",color:C.data.green,"&:hover":{backgroundColor:"rgba(76, 175, 80, 0.2)"}}}),f.jsx(V,{title:"Close Analysis",Icon:et,onClick:n,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:C.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const se=.4;function Ee(e){return{numberSize:e*se}}const J={PADDING_OFFSET:100,WIDTH_LIMIT:1e3,MAX_CELL_SIZE:100,ICON_SIZE_RATIO:.8},Ie={...He("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},re={HINT_DENSITY:0,MAX_SIZE:8,DEFAULT_SIZE:5},R={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:xe.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:`
            @keyframes slant-pop-in {
                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }
                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }
                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }
            }
        `,POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},k=0,A=1,N=2,mt=B.memo(function({value:t,color:n,size:r}){const o=`${String(Math.max(2,r))}px`;return f.jsxs(E,{sx:{width:"100%",height:"100%",position:"relative"},children:[t===A&&f.jsx(E,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:n,borderRadius:ue.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:R.SHADOWS.LINE,transition:z.transition,animation:R.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),t===N&&f.jsx(E,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:n,borderRadius:ue.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:R.SHADOWS.LINE,transition:z.transition,animation:R.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),yt=B.memo(function({r:t,c:n,value:r,source:o,isConflict:l,isCycle:i,size:s,pos:a,getDragProps:u}){const c=u(a);let d=C.text.primary;return l?d=C.data.red:i?d=o==="user"?C.data.red:C.data.orange:o==="user"?d=C.primary.main:o==="propagated"&&(d=C.data.green),f.jsx(E,{"data-pos":a,"data-type":"cell",...c,sx:{...c.sx,cursor:"pointer",outline:"none",border:`2px solid ${C.border.subtle}`,position:"relative",width:"100%",height:"100%",boxSizing:"border-box",borderRadius:"inherit",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:R.ANALYSIS.BG_SUBTLE,transition:"background-color 0.2s, outline 0.2s, box-shadow 0.2s","&:hover":{backgroundColor:R.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${C.primary.main}`,outlineOffset:"-3px",backgroundColor:R.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${C.interactive.focus}`}},children:f.jsx(mt,{value:r,color:d,size:s})})}),xt=B.memo(function({value:t,hasConflict:n,isSatisfied:r,numberSize:o}){return f.jsx(E,{sx:{width:`${String(o)}rem`,height:`${String(o)}rem`,borderRadius:"50%",backgroundColor:n?C.data.red:R.ANALYSIS.HINT_BG,border:t==null?"none":`2px solid ${n?C.data.red:r?"transparent":R.ANALYSIS.HINT_BORDER}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(o*.5)}rem`,fontWeight:"800",color:n?R.COLORS.WHITE:r?C.interactive.disabledText:R.ANALYSIS.HINT_TEXT,boxShadow:r&&!n?"none":R.SHADOWS.HINT,opacity:t==null?0:r?.6:1,zIndex:5,position:"relative",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:n?"scale(1.15)":r?"scale(0.95)":"scale(1)"},children:t??""})}),bt=B.memo(function({r:t,c:n,value:r,hasConflict:o,isSatisfied:l,numberSize:i}){return f.jsx("div",{"data-pos":`${t.toString()},${n.toString()}`,"data-type":"hint",style:{pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:f.jsx(xt,{value:r,hasConflict:o,isSatisfied:l,numberSize:i})})});function fe(e,t,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:n?C.data.red:C.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:R.SHADOWS.LINE,transition:z.transition,animation:R.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const Te={border:`2px solid ${C.border.subtle}`,position:"relative",backgroundColor:R.ANALYSIS.BG_SUBTLE},At={width:"100%",height:"100%",position:"relative"},je={pointerEvents:"none"},Re={cursor:"pointer",outline:"none","&:hover":{backgroundColor:C.interactive.hover},"&:focus-visible":{outline:`3px solid ${C.primary.main}`,outlineOffset:"-3px",backgroundColor:C.interactive.hover,boxShadow:`inset 0 0 15px ${C.interactive.focus}`}};function Ct(e){const{numberSize:t,hasError:n,isSatisfied:r,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:n?C.data.red:C.surface.background,border:o?`2px solid ${n?C.data.red:r?"transparent":C.border.subtle}`:"none",fontSize:`${String(t*.5)}rem`,fontWeight:"800",color:n?R.COLORS.WHITE:r?C.interactive.disabledText:C.text.primary,boxShadow:r&&!n?"none":R.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:n?"scale(1.15)":r?"scale(0.95)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`}}function $e(e,t){return(n,r)=>{const o=e.grid[n]?.[r],l=`${n.toString()},${r.toString()}`,i=e.cycleCells.has(l),s=[{v:e.numbers[n]?.[r],p:`${n.toString()},${r.toString()}`},{v:e.numbers[n]?.[r+1],p:`${n.toString()},${(r+1).toString()}`},{v:e.numbers[n+1]?.[r],p:`${(n+1).toString()},${r.toString()}`},{v:e.numbers[n+1]?.[r+1],p:`${(n+1).toString()},${(r+1).toString()}`}].map(({v:a,p:u})=>{if(a==null)return"-";const c=e.errorNodes.has(u)?"Error":e.satisfiedNodes.has(u)?"Ok":"Pending";return`${String(a)} (${c})`});return{"aria-label":`Cell ${String(n+1)}, ${String(r+1)}. Clues: ${s.join(", ")}. ${o===k?"Empty":o===A?"Forward Slash":"Backward Slash"}${i?", Loop Error":""}`,sx:Te,children:f.jsxs(E,{sx:At,children:[o===A&&f.jsx(E,{sx:fe("-45deg",t,i)}),o===N&&f.jsx(E,{sx:fe("45deg",t,i)})]})}}}const vt=(e,t,n)=>{const r=$e(t,n);return(o,l)=>{const i=r(o,l),s=`${o.toString()},${l.toString()}`,a=e(s);return{...a,...i,sx:{...a.sx,...i.sx,...Re}}}},Pe=(e,t)=>(n,r)=>{const o=e.numbers[n]?.[r],l=`${n.toString()},${r.toString()}`,i=e.errorNodes.has(l),s=e.satisfiedNodes.has(l);return{sx:je,children:f.jsx(E,{sx:Ct({numberSize:t,hasError:i,isSatisfied:s,isVisible:o!=null}),children:o??""})}},wt=m.memo(function({row:t,col:n,size:r,state:o,isInteractive:l=!1,...i}){if(!o)return f.jsx(E,{...i,sx:Te});const s=$e(o,r)(t,n),a={...s.sx,...l?Re:{},...i.sx};return f.jsx(E,{...i,"aria-label":s["aria-label"],sx:a,children:s.children})},(e,t)=>{if(e.row!==t.row||e.col!==t.col||e.size!==t.size||e.isInteractive!==t.isInteractive)return!1;if(!e.state||!t.state)return e.state===t.state;const n=`${e.row.toString()},${e.col.toString()}`;if(e.state.grid[e.row]?.[e.col]!==t.state.grid[t.row]?.[t.col]||e.state.cycleCells.has(n)!==t.state.cycleCells.has(n))return!1;const r=[[0,0],[0,1],[1,0],[1,1]];for(const[o,l]of r){const i=e.row+o,s=e.col+l,a=`${i.toString()},${s.toString()}`;if(e.state.numbers[i]?.[s]!==t.state.numbers[i]?.[s]||e.state.errorNodes.has(a)!==t.state.errorNodes.has(a)||e.state.satisfiedNodes.has(a)!==t.state.satisfiedNodes.has(a))return!1}return!0}),kt=m.memo(function({row:t,col:n,size:r,state:o,...l}){if(!o)return f.jsx(E,{...l,sx:je});const i=r*.4,s=Pe(o,i)(t,n),a={...s.sx,...l.sx};return f.jsx(E,{...l,sx:a,children:s.children})},(e,t)=>{if(e.row!==t.row||e.col!==t.col||e.size!==t.size)return!1;if(!e.state||!t.state)return e.state===t.state;const n=`${e.row.toString()},${e.col.toString()}`;return!(e.state.numbers[e.row]?.[e.col]!==t.state.numbers[t.row]?.[t.col]||e.state.errorNodes.has(n)!==t.state.errorNodes.has(n)||e.state.satisfiedNodes.has(n)!==t.state.satisfiedNodes.has(n))});function te({state:e,size:t,rows:n,cols:r,CellComponent:o=wt,OverlayComponent:l=kt,cellProps:i,renderCell:s,overlayProps:a,renderOverlay:u}){const c=m.useMemo(()=>[{rows:n,cols:r,cellProps:(d,S)=>({state:e,size:t,isInteractive:!0,row:d,col:S,...i?.(d,S)}),renderCell:s,CellComponent:o},{rows:n+1,cols:r+1,cellProps:(d,S)=>({state:e,size:t,row:d,col:S,...a?.(d,S)}),renderCell:u,CellComponent:l,layerSx:{pointerEvents:"none"},decorative:!0}],[e,t,n,r,o,l,i,s,a,u]);return f.jsx(be,{size:t,layers:c,space:.125})}const Oe=ee(ze.div)({willChange:"transform, opacity"}),Me={...Fe,transition:We};class ie{constructor(t){this.parent=Array.from({length:t},(n,r)=>r)}find(t){const n=this.parent[t];if(n===void 0)throw new Error(`DSU: Index ${String(t)} out of bounds`);n!==t&&(this.parent[t]=this.find(n));const r=this.parent[t];if(r===void 0)throw new Error(`DSU: Parent of ${String(t)} became undefined`);return r}union(t,n){const r=this.find(t),o=this.find(n);return r!==o?(this.parent[r]=o,!0):!1}connected(t,n){return this.find(t)===this.find(n)}}function $(e,t,n){return e*(n+1)+t}function _e(e,t,n){const r=new Map,o=new Set;for(let u=0;u<t;u++)for(let c=0;c<n;c++){const d=e[u]?.[c];if(!d||d===k)continue;const S=d===A?$(u,c+1,n):$(u,c,n),g=d===A?$(u+1,c,n):$(u+1,c+1,n);r.has(S)||r.set(S,[]),r.has(g)||r.set(g,[]),r.get(S)?.push({node:g,r:u,c}),r.get(g)?.push({node:S,r:u,c})}const l=new Set,i=new Set,s=[],a=(u,c)=>{l.add(u),i.add(u);const d=r.get(u)??[];for(const{node:S,r:g,c:p}of d)if(S!==c)if(i.has(S)){o.add(`${g.toString()},${p.toString()}`);for(let h=s.length-1;h>=0;h--){const b=s[h];if(!b||(o.add(`${b.r.toString()},${b.c.toString()}`),b.u===S||b.v===S))break}}else l.has(S)||(s.push({r:g,c:p,u,v:S}),a(S,u),s.pop());i.delete(u)};for(const u of r.keys())l.has(u)||a(u,-1);return o}function Nt(e,t,n){const r=new ie((t+1)*(n+1));for(let o=0;o<t;o++){const l=e[o];if(l)for(let i=0;i<n;i++){const s=l[i];if(s===void 0||s===k)continue;const a=s===A?$(o,i+1,n):$(o,i,n),u=s===A?$(o+1,i,n):$(o+1,i+1,n);if(!r.union(a,u))return!0}}return!1}function Et(e,t,n,r,o,l){if(n==null)return!1;let i=0,s=0;const a=[{r:e-1,c:t-1,required:N},{r:e-1,c:t,required:A},{r:e,c:t-1,required:A},{r:e,c:t,required:N}];for(const u of a)if(u.r>=0&&u.r<o&&u.c>=0&&u.c<l){const c=r.get(`${u.r.toString()},${u.c.toString()}`);c&&c.state!==k&&(s++,c.state===u.required&&i++)}return i===n&&s>0}function It(e,t,n,r){const o=new Map,l=[],i=[];r.forEach((g,p)=>{o.set(p,{state:g,source:"user"});const[h,b]=p.split(",").map(Number);h!==void 0&&b!==void 0&&l.push({r:h,c:b})});const s=(g,p)=>{if(g<0||g>=e||p<0||p>=t)return k;const h=`${g.toString()},${p.toString()}`;return o.get(h)?.state??k},a=(g,p,h,b)=>{const y=`${g.toString()},${p.toString()}`,x=o.get(y);if(x){x.state!==h&&i.push({type:"cell",r:g,c:p});return}o.set(y,{state:h,source:b}),l.push({r:g,c:p})},u=(g,p)=>[{r:g-1,c:p-1,required:N},{r:g-1,c:p,required:A},{r:g,c:p-1,required:A},{r:g,c:p,required:N}].filter(h=>h.r>=0&&h.r<e&&h.c>=0&&h.c<t);let c=0;for(;c<l.length;){const g=l[c++];if(!g)break;const{r:p,c:h}=g,b=[{r:p,c:h},{r:p,c:h+1},{r:p+1,c:h},{r:p+1,c:h+1}];for(const y of b){const x=n[y.r]?.[y.c];if(x==null)continue;const w=u(y.r,y.c);let I=0;const j=[];for(const v of w){const T=s(v.r,v.c);T===k?j.push(v):T===v.required&&I++}if(I>x){i.push({type:"node",r:y.r,c:y.c});continue}if(I+j.length<x){i.push({type:"node",r:y.r,c:y.c});continue}if(o.get(`${p.toString()},${h.toString()}`)?.source==="user"){if(I===x&&j.length>0)for(const v of j){const T=v.required===A?N:A;a(v.r,v.c,T,"propagated")}else if(I+j.length===x&&j.length>0)for(const v of j)a(v.r,v.c,v.required,"propagated")}}}const d=Array.from({length:e},()=>new Array(t).fill(k));for(const[g,p]of o.entries()){const[h,b]=g.split(",").map(Number);h!==void 0&&b!==void 0&&d[h]&&(d[h][b]=p.state)}const S=_e(d,e,t);return{gridState:o,conflicts:i,cycleCells:S}}function Tt(e,t){return t?e===A?N:e===N?void 0:A:e===N?A:e===A?void 0:N}function jt(e){const t=new Map;return e.forEach((n,r)=>{n.state!==k&&t.set(r,n.state)}),t}function Rt(){return new Worker(new URL("/assets/solverWorker-DFXrBbMc.js",import.meta.url),{type:"module"})}function $t(){return new Worker(new URL("/assets/generationWorker-DtaRwRm0.js",import.meta.url),{type:"module"})}const Pt=2e3;function Ot({rows:e,cols:t,numbers:n,userMoves:r}){const[o,l]=m.useState(new Map),[i,s]=m.useState([]),[a,u]=m.useState(new Set),c=m.useRef(null),[d,S]=m.useState("probing");m.useEffect(()=>{let h=!1;const b=Rt();c.current=b;const y=setTimeout(()=>{h||(S("broken"),c.current=null,b.terminate())},Pt);return b.onmessage=x=>{if(h)return;const w=x.data;w.type==="RESULT"&&S(I=>{if(I==="probing")return clearTimeout(y),"healthy";const{gridState:j,conflicts:v,cycleCells:T}=w.payload;return l(j),s(v),u(T),I})},b.onerror=()=>{clearTimeout(y),S("broken"),c.current=null,b.terminate()},b.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{h=!0,clearTimeout(y),b.terminate()}},[]),m.useEffect(()=>{if(d==="healthy"&&c.current)c.current.postMessage({type:"SOLVE",payload:{rows:e,cols:t,numbers:n,userMoves:r}});else if(d==="broken"){const h=It(e,t,n,r);l(h.gridState),s(h.conflicts),u(h.cycleCells)}},[r,n,e,t,d]);const g=m.useMemo(()=>new Set(i.filter(h=>h.type==="cell").map(h=>`${h.r.toString()},${h.c.toString()}`)),[i]),p=m.useMemo(()=>new Set(i.filter(h=>h.type==="node").map(h=>`${h.r.toString()},${h.c.toString()}`)),[i]);return{gridState:o,conflicts:i,cycleCells:a,conflictSet:g,nodeConflictSet:p}}function Mt({rows:e,cols:t,numbers:n,size:r,initialMoves:o,onMove:l,onApply:i}){const s=o,{getDragProps:a}=Ae({onToggle:(y,x,w,I,j)=>{const v=`${y.toString()},${x.toString()}`;if(!j){l(v,I);return}const T=s.get(v),O=Tt(T,w);return l(v,O),O},touchTimeout:Ce.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:u}=ve({rows:e,cols:t}),c=m.useCallback(y=>{const x=a(y);return{...x,onKeyDown:w=>{x.onKeyDown(w),u(w)}}},[a,u]),{gridState:d,cycleCells:S,conflictSet:g,nodeConflictSet:p}=Ot({rows:e,cols:t,numbers:n,userMoves:s}),{numberSize:h}=Ee(r),b=m.useCallback(()=>{i&&i(jt(d))},[i,d]);return{gridState:d,conflictSet:g,cycleCells:S,nodeConflictSet:p,numberSize:h,getEnhancedDragProps:c,handleApply:b}}function _t({rows:e,cols:t,numbers:n,size:r,initialMoves:o,onMove:l,onCopy:i,onClear:s,onClose:a,onApply:u}){const{gridState:c,conflictSet:d,cycleCells:S,nodeConflictSet:g,numberSize:p,getEnhancedDragProps:h,handleApply:b}=Mt({rows:e,cols:t,numbers:n,size:r,initialMoves:o,onMove:l,onApply:u});return f.jsx(pt,{value:{onCopy:i,onClear:s,onClose:a,onApply:b},children:f.jsxs(Oe,{...Me,sx:{position:"relative",userSelect:"none"},onContextMenu:y=>{y.preventDefault()},children:[f.jsx(E,{sx:{position:"relative",border:`2px dashed ${R.ANALYSIS.DASHED_BORDER}`,borderRadius:xe.BORDER_RADIUS},children:f.jsx(te,{size:r,rows:e,cols:t,renderCell:(y,x)=>{const w=`${y.toString()},${x.toString()}`,I=c.get(w);return f.jsx(yt,{r:y,c:x,value:I?.state??k,source:I?.source,isConflict:d.has(w),isCycle:S.has(w),size:r,pos:w,getDragProps:h})},renderOverlay:(y,x)=>{const w=n[y]?.[x]??null,I=g.has(`${y.toString()},${x.toString()}`),j=Et(y,x,w,c,e,t);return f.jsx(bt,{r:y,c:x,value:w,hasConflict:I,isSatisfied:j,numberSize:p})}})}),f.jsx(St,{})]})})}function Bt({size:e,rows:t,cols:n}){const r=m.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),o=m.useCallback(()=>({}),[]);return f.jsx(E,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:f.jsx(te,{size:e,rows:t,cols:n,cellProps:r,overlayProps:o})})}function Lt({isAnalysisMode:e,generating:t,dimensionsMismatch:n,rows:r,cols:o,state:l,size:i,analysis:s,cellProps:a,overlayProps:u}){return e?f.jsx(de,{fallback:f.jsx(gt,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:f.jsx(_t,{rows:r,cols:o,numbers:l.numbers,size:i,initialMoves:s.moves,onMove:s.onMove,onCopy:s.onCopy,onClear:s.onClear,onClose:s.onClose,onApply:s.onApply})}):t||n?f.jsx(Bt,{size:i,rows:r,cols:o}):f.jsx(de,{FallbackComponent:ut,fallbackProps:{title:ae.errors.boardTitle,resetLabel:ae.errors.boardReset},children:f.jsx(Oe,{...Me,children:f.jsx(te,{state:l,size:i,rows:r,cols:o,cellProps:a,overlayProps:u})})})}const Dt=[{title:"Corner 0",description:'A "0" in a corner forces the line to point away from that corner.',rows:3,cols:3,numbers:[[0,null,null],[null,null,null],[null,null,null]],grid:[[A,k],[k,k]]},{title:"Corner 1",description:'A "1" in a corner forces the line to connect directly to that corner.',rows:3,cols:3,numbers:[[1,null,null],[null,null,null],[null,null,null]],grid:[[N,k],[k,k]]},{title:"Edge 0",description:'A "0" on the edge forces all surrounding lines to point away from it.',rows:3,cols:3,numbers:[[null,0,null],[null,null,null],[null,null,null]],grid:[[N,A],[k,k]]},{title:"Edge 1",description:'A "1" on the edge forces the two surrounding lines into the same orientation.',rows:3,cols:3,numbers:[[null,1,null],[null,null,null],[null,null,null]],grid:[[A,A],[k,k]]},{title:"Edge 2",description:'A "2" on the edge forces both surrounding lines to connect to it.',rows:3,cols:3,numbers:[[null,2,null],[null,null,null],[null,null,null]],grid:[[A,N],[k,k]]},{title:"Middle 4",description:'A "4" must catch lines from all four surrounding cells.',rows:3,cols:3,numbers:[[null,null,null],[null,4,null],[null,null,null]],grid:[[N,A],[A,N]]}];function ge(e,t){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:C.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:R.SHADOWS.LINE,pointerEvents:"none"}}function Gt(e,t){return(n,r)=>{const o=e[n]?.[r];return{sx:{border:`2px solid ${C.border.subtle}`,position:"relative",backgroundColor:R.ANALYSIS.BG_SUBTLE},children:f.jsxs(E,{sx:{width:"100%",height:"100%",position:"relative"},children:[o===A&&f.jsx(E,{sx:ge("-45deg",t)}),o===N&&f.jsx(E,{sx:ge("45deg",t)})]})}}}function Ht(e,t){return(n,r)=>{const o=e[n]?.[r];return{sx:{pointerEvents:"none"},children:f.jsx(E,{sx:{borderRadius:"50%",backgroundColor:C.surface.background,border:o==null?"none":`2px solid ${C.border.subtle}`,fontSize:`${String(t*.5)}rem`,fontWeight:"800",color:C.text.primary,boxShadow:o==null?"none":R.SHADOWS.HINT,zIndex:5,opacity:o==null?0:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0.05rem",lineHeight:1,width:`${String(t)}rem`,height:`${String(t)}rem`},children:o??""})}}}function Wt({children:e,sx:t={}}){return f.jsx(E,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.5em",height:"1.5em",borderRadius:"50%",backgroundColor:C.surface.background,border:`1px solid ${C.border.subtle}`,fontSize:"0.85em",fontWeight:"bold",mx:.4,verticalAlign:"middle",lineHeight:1,pt:"0.05em",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",position:"relative",top:"-0.1em",...t},children:e})}function Ft({text:e}){const t=e.split(/"(\d+)"/g);return f.jsx(ke,{variant:"body2",sx:{color:C.text.secondary},children:t.map((n,r)=>r%2===1?f.jsx(Wt,{children:n},`${String(r)}-${n}`):n)})}const zt={display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4,width:"100%",py:2,pr:4},Ut={display:"flex",flexDirection:"row",alignItems:"center",gap:0,width:"100%"},Yt={width:"180px",display:"flex",justifyContent:"center",flexShrink:0},qt={display:"flex",flexDirection:"column",gap:1,flex:1,minWidth:0};function Kt(){const{numberSize:t}=Ee(3);return f.jsx(E,{sx:zt,children:Dt.map(n=>f.jsxs(E,{sx:Ut,children:[f.jsx(E,{sx:Yt,children:f.jsx(te,{size:3,rows:n.rows-1,cols:n.cols-1,cellProps:Gt(n.grid,3),overlayProps:Ht(n.numbers,t)})}),f.jsxs(E,{sx:qt,children:[f.jsx(ke,{variant:"subtitle1",sx:{fontWeight:"bold",color:C.text.primary},children:n.title}),f.jsx(Ft,{text:n.description})]})]},n.title))})}const _=3,Vt=[[N,A,N],[A,A,N],[N,A,N]],pe=[[1,0,2,null],[null,null,null,1],[2,null,null,null],[null,2,0,1]],Q=[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[2,0],[1,0],[1,1]];function Xt(){const e=[],t=Array.from({length:_},()=>new Array(_).fill(k));e.push(t);let n=t.map(r=>[...r]);for(const[r,o]of Q){n=n.map(i=>[...i]);const l=Vt[r]?.[o];if(l!==void 0){const i=n[r];i&&(i[o]=l)}e.push(n)}return e}function U(e,t,n){const r=Array.from({length:t+1},()=>new Array(n+1).fill(0));for(let o=0;o<t;o++){const l=e[o];if(l)for(let i=0;i<n;i++){const s=l[i];if(s===A){const a=r[o];if(a){const c=a[i+1];c!==void 0&&(a[i+1]=c+1)}const u=r[o+1];if(u){const c=u[i];c!==void 0&&(u[i]=c+1)}}else if(s===N){const a=r[o];if(a){const c=a[i];c!==void 0&&(a[i]=c+1)}const u=r[o+1];if(u){const c=u[i+1];c!==void 0&&(u[i+1]=c+1)}}}}return r}function Zt(e,t,n,r){const o=new Set,l=U(e,n,r);for(let i=0;i<=n;i++)for(let s=0;s<=r;s++){const a=t[i]?.[s];if(a==null)continue;const u=l[i]?.[s]??0;if(u>a){o.add(`${i.toString()},${s.toString()}`);continue}const c=[{gr:i-1,gc:s-1},{gr:i-1,gc:s},{gr:i,gc:s-1},{gr:i,gc:s}].filter(({gr:d,gc:S})=>d>=0&&d<n&&S>=0&&S<r&&e[d]?.[S]===k).length;u+c<a&&o.add(`${i.toString()},${s.toString()}`)}return o}function Be(e,t,n,r){const o=new Set,l=U(e,n,r);for(let i=0;i<=n;i++)for(let s=0;s<=r;s++){const a=t[i]?.[s];if(a==null)continue;if((l[i]?.[s]??0)===a){let c=!1;const d=[{gr:i-1,gc:s-1},{gr:i-1,gc:s},{gr:i,gc:s-1},{gr:i,gc:s}];for(const{gr:S,gc:g}of d)if(S>=0&&S<n&&g>=0&&g<r&&e[S]?.[g]!==k){c=!0;break}c&&o.add(`${i.toString()},${s.toString()}`)}}return o}const Jt=1500;function he(e,t){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:C.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:R.SHADOWS.LINE,transition:z.transition,animation:R.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}function Qt(e,t,n){return(r,o)=>{const l=e[r]?.[o],s=`${r.toString()},${o.toString()}`===n;return{sx:{border:`2px solid ${C.border.subtle}`,position:"relative",transition:z.transition,backgroundColor:R.ANALYSIS.BG_SUBTLE,...s?{backgroundColor:C.interactive.hover}:{}},children:f.jsxs(E,{sx:{width:"100%",height:"100%",position:"relative"},children:[l===A&&f.jsx(E,{sx:he("-45deg",t)}),l===N&&f.jsx(E,{sx:he("45deg",t)})]})}}}function en(e,t,n){return(r,o)=>{const l=e[r]?.[o],i=`${r.toString()},${o.toString()}`,s=t.has(i);return{sx:{pointerEvents:"none"},children:f.jsx(E,{sx:{borderRadius:"50%",backgroundColor:C.surface.background,border:l==null?"none":`2px solid ${s?"transparent":C.border.subtle}`,fontSize:`${String(n*.5)}rem`,fontWeight:"800",color:s?C.interactive.disabledText:C.text.primary,boxShadow:s?"none":R.SHADOWS.HINT,zIndex:5,opacity:l==null?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(0.95)":"scale(1)",paddingTop:"0.05rem",lineHeight:1,width:`${String(n)}rem`,height:`${String(n)}rem`},children:l??""})}}}const tn=ee(E)(({theme:e})=>({display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",gap:e.spacing(4)},justifyContent:"center",alignItems:"center",gap:e.spacing(2),width:"100%",flex:1})),nn=ee(E)(({theme:e})=>({display:"grid",gridTemplateColumns:"repeat(2, 1fr)",[e.breakpoints.up("sm")]:{gridTemplateColumns:"1fr",marginTop:0,width:"auto",maxWidth:"none"},gap:e.spacing(1.5),justifyContent:"center",justifyItems:"center",alignItems:"center",marginTop:e.spacing(2),width:"100%",maxWidth:"320px"})),X=ee(Xe)(({theme:e})=>({borderColor:C.border.subtle,color:C.text.secondary,width:"140px",[e.breakpoints.up("sm")]:{width:"180px"},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),"& .MuiButton-startIcon":{marginRight:e.spacing(.5),[e.breakpoints.up("sm")]:{marginRight:e.spacing(1)}}}));function rn({size:e,handleOpenAnalysis:t}){const n=m.useMemo(()=>Xt(),[]),[r,o]=m.useState(0),[l,i]=m.useState(!0);m.useEffect(()=>{if(!l)return;const y=setInterval(()=>{o(x=>(x+1)%n.length)},Jt);return()=>{clearInterval(y)}},[n.length,l]);const s=()=>{i(y=>!y)},a=()=>{i(!1),o(y=>(y+1)%n.length)},u=()=>{i(!1),o(y=>(y-1+n.length)%n.length)},c=m.useMemo(()=>n[r]??n[0]??[],[n,r]),d=r>0&&r<=Q.length?(()=>{const y=Q[r-1];return y?`${y[0].toString()},${y[1].toString()}`:null})():null,S=m.useMemo(()=>Be(c,pe,_,_),[c]),g=e*se,p=r>=Q.length&&c.every(y=>y.every(x=>x!==k)),h=m.useMemo(()=>Qt(c,e,d),[c,e,d]),b=m.useMemo(()=>en(pe,S,g),[S,g]);return f.jsxs(tn,{children:[f.jsxs(E,{sx:{position:"relative",display:"inline-flex"},children:[f.jsx("style",{children:R.ANIMATIONS.POP_IN}),f.jsx(be,{size:e,layers:[{rows:_,cols:_,cellProps:h},{rows:_+1,cols:_+1,cellProps:b,layerSx:{pointerEvents:"none"},decorative:!0}],space:.125}),f.jsx(we,{show:p&&l,sizeVariant:"small",showLabel:!1})]}),f.jsxs(nn,{children:[f.jsx(X,{variant:"outlined",startIcon:l?f.jsx(tt,{}):f.jsx(nt,{}),onClick:s,children:l?"Pause":"Play"}),f.jsx(X,{variant:"outlined",startIcon:f.jsx(rt,{}),onClick:t,children:"Analysis"}),f.jsx(X,{variant:"outlined",startIcon:f.jsx(ot,{}),onClick:u,children:"Step Back"}),f.jsx(X,{variant:"outlined",startIcon:f.jsx(st,{}),onClick:a,children:"Step Next"})]})]})}const Se={display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"primary.main",fontSize:"1em",borderRadius:1,px:.6,lineHeight:1,verticalAlign:"baseline"},on=["Slant Rules","Example","Common Patterns"],sn=[{Icon:it,title:"Fill with Slashes",text:f.jsxs(f.Fragment,{children:["Place a forward"," ",f.jsx(E,{component:"span",sx:Se,children:f.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:f.jsx("line",{x1:"1",y1:"9",x2:"9",y2:"1"})})})," ","or backward"," ",f.jsx(E,{component:"span",sx:Se,children:f.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:f.jsx("line",{x1:"1",y1:"1",x2:"9",y2:"9"})})})," ","slash in every cell of the grid."]})},{Icon:lt,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:at,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],ln={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},an=e=>[Ue(),e<2?{overflowY:"hidden"}:{}];function cn(){return{storageKey:"slant",grid:{defaultSize:re.DEFAULT_SIZE,maxSize:re.MAX_SIZE,gridPadding:{x:80,y:120},widthLimit:J.WIDTH_LIMIT,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:J.PADDING_OFFSET}),maxCellSize:J.MAX_CELL_SIZE,rowOffset:1,colOffset:1}}}function un({open:e,toggleOpen:t,handleOpenAnalysis:n}){const r=ft("sm");return f.jsx(Ye,{open:e,toggleOpen:t,titles:on,instructions:sn,exampleContent:f.jsx(rn,{size:r?4:4.5,handleOpenAnalysis:n}),cardSx:ln,contentSxOverride:an,persistenceKey:"slant_info_step",extraSteps:[f.jsx(Kt,{},"patterns")]})}function dn({isAnalysisMode:e,setIsAnalysisMode:t,state:n,rows:r,cols:o,storageKey:l,toggleInfo:i,dispatch:s}){const[a,u]=m.useState(new Map);qe({storageKey:l,rows:r,cols:o,state:a,onRestore:w=>{u(w)},serialize:w=>[...w.entries()],deserialize:w=>new Map(w)});const c=m.useRef("");m.useEffect(()=>{const w=JSON.stringify(n.numbers);c.current&&c.current!==w&&u(new Map),c.current=w},[n.numbers,n.rows,n.cols]);const d=m.useCallback((w,I)=>{u(j=>{const v=new Map(j);return I===void 0?v.delete(w):v.set(w,I),v})},[]),S=m.useCallback(()=>{const w=new Map;n.grid.forEach((I,j)=>{I.forEach((v,T)=>{v!==k&&w.set(`${j.toString()},${T.toString()}`,v)})}),u(w)},[n.grid]),g=m.useCallback(()=>{u(new Map)},[]),p=m.useCallback(()=>{t(!1)},[t]),h=m.useCallback(w=>{s({type:"applyAnalysis",moves:w??a}),p()},[s,a,p]),b=m.useCallback(w=>{w.stopPropagation()},[]),y=m.useMemo(()=>e?{padding:{xs:0,sm:0},border:"none"}:void 0,[e]),x=m.useCallback(()=>{i(),t(!0)},[i,t]);return{analysisMoves:a,boardSx:y,handleAnalysisMove:d,handleAnalysisCopy:S,handleAnalysisClear:g,handleAnalysisClose:p,handleAnalysisApply:h,handleBoxClick:b,handleOpenAnalysis:x}}function Le(e,t){return`${Ie.STATE}-${String(e)}x${String(t)}`}function De(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function fn(e){if(typeof e!="object"||e===null)return!1;const t=e;return Array.isArray(t.grid)&&Array.isArray(t.numbers)&&Array.isArray(t.solution)&&typeof t.rows=="number"&&typeof t.cols=="number"&&typeof t.solved=="boolean"&&Array.isArray(t.errorNodes)&&Array.isArray(t.cycleCells)&&Array.isArray(t.satisfiedNodes)}function gn(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}function pn(e,t,n){const r=Le(t,n);try{localStorage.setItem(r,JSON.stringify(De(e)))}catch{}}function hn(e,t){const n=Le(e,t),r=localStorage.getItem(n);if(!r)return!1;try{const o=JSON.parse(r);return typeof o!="object"||o===null?!1:o.solved===!1}catch{return!1}}function Sn({rows:e,cols:t,isAnalysisMode:n,requestGeneration:r,cancelGeneration:o}){const l=m.useRef(`${String(e)},${String(t)}`);m.useEffect(()=>{const i=`${String(e)},${String(t)}`;if(i!==l.current){if(l.current=i,!n&&hn(e,t)){o();return}r(e,t)}},[e,t,r,o,n])}const mn=2e3,yn=250;function me(e,t,n,r){return{grid:Array.from({length:e},()=>new Array(t).fill(k)),numbers:n,solution:r,rows:e,cols:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function xn({getInitialState:e,dispatchRef:t,dimsRef:n,onStaleResult:r}){const[o,l]=m.useState(!1),i=m.useRef(null),s=m.useRef("probing"),a=m.useRef(0),u=m.useRef(0),c=m.useRef(null),d=m.useRef(0),S=m.useRef(r);S.current=r;const g=m.useRef(!1),p=m.useRef(null),h=m.useRef(!1),b=m.useCallback(()=>{if(p.current){const v=p.current;S.current?.(v,v.rows,v.cols)}g.current=!1,p.current=null,h.current=!1},[]),y=m.useCallback((v,T)=>{t.current?.({type:"hydrate",state:e(v,T)}),l(!1)},[t,e]),x=m.useCallback((v,T)=>{b(),l(!0),c.current!==null&&clearTimeout(c.current),cancelAnimationFrame(u.current),c.current=setTimeout(()=>{c.current=null;const O=++a.current;s.current==="healthy"&&i.current?(d.current++,i.current.postMessage({type:"GENERATE",payload:{rows:v,cols:T}})):u.current=requestAnimationFrame(()=>{a.current===O&&y(v,T)})},yn)},[y,b]),w=m.useCallback((v,T)=>{g.current||(g.current=!0,p.current=null,h.current=!1,s.current==="healthy"&&i.current?(d.current++,i.current.postMessage({type:"GENERATE",payload:{rows:v,cols:T}})):requestAnimationFrame(()=>{g.current&&(p.current=e(v,T))}))},[e]),I=m.useCallback(()=>{c.current!==null&&(clearTimeout(c.current),c.current=null),cancelAnimationFrame(u.current),b(),l(!1)},[b]),j=m.useCallback(()=>{if(p.current){const v=p.current;p.current=null,t.current?.({type:"hydrate",state:v}),b(),l(!1);return}if(g.current){h.current=!0,l(!0);return}x(n.current.rows,n.current.cols)},[x,n,t,b]);return m.useEffect(()=>{let v=!1;const T=$t();i.current=T;const O=setTimeout(()=>{!v&&s.current==="probing"&&(console.warn("[Slant] generation worker probe timed out"),s.current="broken",d.current=0,i.current=null,T.terminate())},mn);return T.onmessage=L=>{if(!v){if(L.data.type==="ERROR"){console.warn(`[Slant] generation worker error: ${String(L.data.payload.message)}`),clearTimeout(O),s.current="broken",d.current=0,i.current=null,T.terminate();return}if(L.data.type==="RESULT"){if(s.current==="probing"){clearTimeout(O),s.current="healthy";return}d.current--;const{rows:D,cols:G,numbers:Y,solution:q}=L.data.payload,K=n.current;if(D!==K.rows||G!==K.cols){S.current?.(me(D,G,Y,q),D,G),d.current<=0&&l(!1);return}if(d.current>0)return;const H=me(D,G,Y,q);if(g.current){p.current=H,h.current&&(t.current?.({type:"hydrate",state:H}),g.current=!1,p.current=null,h.current=!1,l(!1));return}t.current?.({type:"hydrate",state:H}),l(!1)}}},T.onerror=()=>{console.warn("[Slant] generation worker script error"),clearTimeout(O),s.current="broken",d.current=0,i.current=null,T.terminate()},T.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{v=!0,clearTimeout(O),c.current!==null&&clearTimeout(c.current),T.terminate()}},[t,n]),{generating:o,requestGeneration:x,handleNextAsync:j,prefetch:w,cancelGeneration:I}}function bn({state:e,size:t,getDragProps:n}){const r=t*se,o=m.useMemo(()=>vt(n,e,t),[n,e,t]),l=m.useMemo(()=>Pe(e,r),[e,r]);return{cellProps:o,overlayProps:l}}const An=e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"});function Cn({game:{state:e,rows:t,cols:n,size:r,mobile:o,isAnalysisMode:l,generating:i,scaling:s},analysis:{analysisMoves:a,handleAnalysisMove:u,handleAnalysisCopy:c,handleAnalysisClear:d,handleAnalysisClose:S,handleAnalysisApply:g,handleBoxClick:p,handleOpenAnalysis:h,boardSx:b},info:{infoOpen:y,toggleInfo:x},getDragProps:w}){const{cellProps:I,overlayProps:j}=bn({state:e,size:r,getDragProps:w}),v=m.useMemo(()=>An(o),[o]),T=t!==e.rows||n!==e.cols,O=m.useMemo(()=>({scaling:s}),[s]);return{boardProps:{isAnalysisMode:l,generating:i,dimensionsMismatch:T,rows:t,cols:n,state:e,size:r,analysis:{moves:a,onMove:u,onCopy:c,onClear:d,onClose:S,onApply:g},cellProps:I,overlayProps:j},layoutProps:{boardSx:b,contentSx:v,iconSizeRatio:J.ICON_SIZE_RATIO},infoProps:{open:y,toggleOpen:x,handleOpenAnalysis:h,handleBoxClick:p},trophyProps:O}}function vn(e,t,n,r){const o=U(e,n,r);for(let l=0;l<=n;l++)for(let i=0;i<=r;i++){const s=t[l]?.[i];if(s!=null&&o[l]?.[i]!==s)return!1}return!0}function Z(e,t,n,r,o,l){const i=e[n];if(!i)return!1;i[r]=o;const s=o===A?$(n,r+1,l):$(n,r,l),a=o===A?$(n+1,r,l):$(n+1,r+1,l);return t.connected(s,a)?!1:(t.union(s,a),!0)}function wn(e,t,n,r,o){let l=!0;for(;l;){l=!1;for(let s=0;s<=n;s++)for(let a=0;a<=r;a++){const u=t[s]?.[a];if(u==null)continue;const c=[{gr:s-1,gc:a-1,pt:N},{gr:s-1,gc:a,pt:A},{gr:s,gc:a-1,pt:A},{gr:s,gc:a,pt:N}].filter(({gr:g,gc:p})=>g>=0&&g<n&&p>=0&&p<r);let d=0;const S=[];for(const g of c){const p=e[g.gr]?.[g.gc];p===k?S.push(g):p===g.pt&&d++}if(d>u||d+S.length<u)return"contradiction";if(d===u&&S.length>0){for(const{gr:g,gc:p,pt:h}of S)if(e[g]?.[p]===k){if(!Z(e,o,g,p,h===A?N:A,r))return"contradiction";l=!0}}else if(d+S.length===u&&S.length>0){for(const{gr:g,gc:p,pt:h}of S)if(e[g]?.[p]===k){if(!Z(e,o,g,p,h,r))return"contradiction";l=!0}}}if(!l){for(let s=0;s<n;s++)for(let a=0;a<r;a++){const u=e[s];if(u?.[a]!==k)continue;const c=$(s,a+1,r),d=$(s+1,a,r),S=o.connected(c,d),g=$(s,a,r),p=$(s+1,a+1,r),h=o.connected(g,p);if(S&&h)return"contradiction";S?(u[a]=N,l=!0,o.union(g,p)):h&&(u[a]=A,l=!0,o.union(c,d))}if(!l)for(let s=0;s<n;s++)for(let a=0;a<r;a++){if(e[s]?.[a]!==k)continue;let c=!1,d=!1;const S=[{nr:s,nc:a,touchedBy:N},{nr:s,nc:a+1,touchedBy:A},{nr:s+1,nc:a,touchedBy:A},{nr:s+1,nc:a+1,touchedBy:N}];for(const{nr:g,nc:p,touchedBy:h}of S){const b=t[g]?.[p];if(b==null)continue;const y=[{gr:g-1,gc:p-1,pt:N},{gr:g-1,gc:p,pt:A},{gr:g,gc:p-1,pt:A},{gr:g,gc:p,pt:N}].filter(({gr:I,gc:j})=>I>=0&&I<n&&j>=0&&j<r);let x=0,w=0;for(const I of y){const j=e[I.gr]?.[I.gc];j===k?w++:j===I.pt&&x++}h===A?(x+1>b&&(c=!0),x+(w-1)<b&&(d=!0)):(x+1>b&&(d=!0),x+(w-1)<b&&(c=!0))}if(c&&d)return"contradiction";if(c){if(!Z(e,o,s,a,N,r))return"contradiction";l=!0}else if(d){if(!Z(e,o,s,a,A,r))return"contradiction";l=!0}}}}return e.every(s=>s.every(a=>a!==k))?"solved":"stuck"}function kn(e,t,n){const r=Array.from({length:t},()=>new Array(n).fill(k)),o=new ie((t+1)*(n+1)),l=wn(r,e,t,n,o);return l==="contradiction"||l!=="solved"?!1:vn(r,e,t,n)}function Nn(e,t,n,r){const o=e.map(a=>[...a]),l=[];for(let a=0;a<=t;a++)for(let u=0;u<=n;u++)l.push({r:a,c:u});for(let a=l.length-1;a>0;a--){const u=Math.floor(Math.random()*(a+1)),c=l[a],d=l[u];c&&d&&(l[a]=d,l[u]=c)}const i=Math.floor((t+1)*(n+1)*r);let s=0;for(let a=0;a<=t;a++)for(let u=0;u<=n;u++)o[a]?.[u]!==null&&s++;for(const{r:a,c:u}of l){if(s<=i)break;const c=o[a];if(!c)continue;const d=c[u];d!=null&&(c[u]=null,kn(o,t,n)?s--:c[u]=d)}return o}function En(e,t){let n=[],r=!1;for(let i=0;i<50&&!r;i++){n=Array.from({length:e},()=>new Array(t).fill(k));const s=new ie((e+1)*(t+1)),a=[];for(let c=0;c<e;c++)for(let d=0;d<t;d++)a.push({r:c,c:d});for(let c=a.length-1;c>0;c--){const d=Math.floor(Math.random()*(c+1)),S=a[c],g=a[d];S&&g&&(a[c]=g,a[d]=S)}let u=!1;for(const{r:c,c:d}of a){const S=$(c,d+1,t),g=$(c+1,d,t),p=s.connected(S,g),h=$(c,d,t),b=$(c+1,d+1,t),y=s.connected(h,b);if(p&&y){u=!0;break}const x=n[c];x&&(p?(x[d]=N,s.union(h,b)):y||Math.random()<.5?(x[d]=A,s.union(S,g)):(x[d]=N,s.union(h,b)))}u||(r=!0)}r||(n=Array.from({length:e},(i,s)=>new Array(t).fill(s%2===0?A:N)));const o=U(n,e,t);return{numbers:Nn(o.map(i=>i.map(s=>s)),e,t,re.HINT_DENSITY),solution:n}}const In=Ke({getInitialState:oe,customHandler:(e,t)=>{if(t.type==="reset")return{...e,grid:Array.from({length:e.rows},()=>new Array(e.cols).fill(k)),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set};if(t.type==="applyAnalysis"){if(!t.moves)return e;const s=Array.from({length:e.rows},()=>new Array(e.cols).fill(k));return t.moves.forEach((a,u)=>{const[c,d]=u.split(",").map(Number);if(c!==void 0&&d!==void 0){const S=s[c];S!==void 0&&(S[d]=a)}}),{...e,...ye(s,e.numbers,e.rows,e.cols),grid:s}}if(t.type!=="toggle")return null;if(e.solved)return e;const{row:n,col:r}=t;if(n===void 0||r===void 0)return e;const o=e.grid.map(s=>[...s]),l=o[n];if(!l)return e;const i=l[r];return i===void 0?e:(t.reverse?l[r]=i===k?A:i===A?N:k:l[r]=i===k?N:i===N?A:k,{...e,...ye(o,e.numbers,e.rows,e.cols),grid:o})}});function ye(e,t,n,r){const o=e.every(u=>u.every(c=>c!==k));let l=!1;if(o){const u=U(e,n,r);t.every((d,S)=>d.every((g,p)=>g==null||g===u[S]?.[p]))&&!Nt(e,n,r)&&(l=!0)}const i=Zt(e,t,n,r),s=_e(e,n,r),a=Be(e,t,n,r);return{solved:l,errorNodes:i,cycleCells:s,satisfiedNodes:a}}function oe(e,t){ce(e),ce(t);const{numbers:n,solution:r}=En(e,t);return{grid:Array.from({length:e},()=>new Array(t).fill(k)),numbers:n,solution:r,rows:e,cols:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Tn(){const[e,t]=B.useState(!1),[n,r]=B.useState(!1),o=B.useCallback(()=>{r(P=>!P)},[]),l=m.useRef(null),i=m.useRef({rows:0,cols:0}),s=m.useCallback((P,M,W)=>{e||pn(P,M,W)},[e]),{generating:a,requestGeneration:u,handleNextAsync:c,prefetch:d,cancelGeneration:S}=xn({getInitialState:oe,dispatchRef:l,dimsRef:i,onStaleResult:s}),g=Ve({...cn(),logic:{reducer:In,getInitialState:(P,M)=>oe(P,M),onNext:c,isSolved:P=>P.solved,manualResize:!0,persistence:{enabled:!e,serialize:De,deserialize:P=>{if(!fn(P))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(P).slice(0,100)}`);return gn(P)}}}}),{state:p,dispatch:h,layout:b}=g,{rows:y,cols:x,size:w,mobile:I,scaling:j}=b;l.current=h,i.current={rows:y,cols:x};const{analysisMoves:v,boardSx:T,handleAnalysisMove:O,handleAnalysisCopy:L,handleAnalysisClear:D,handleAnalysisClose:G,handleAnalysisApply:Y,handleBoxClick:q,handleOpenAnalysis:K}=dn({isAnalysisMode:e,setIsAnalysisMode:t,state:p,rows:y,cols:x,storageKey:Ie.ANALYSIS_MOVES,toggleInfo:o,dispatch:h});Sn({rows:y,cols:x,isAnalysisMode:e,requestGeneration:u,cancelGeneration:S}),m.useEffect(()=>{p.solved&&!e&&d(y,x)},[p.solved,e,y,x,d]);const{handleKeyDown:H}=ve({rows:y,cols:x}),{getDragProps:le}=Ae({onToggle:(P,M,W)=>{h({type:"toggle",row:P,col:M,reverse:W})},checkEnabled:()=>!p.solved,touchTimeout:Ce.timing.touchHoldDelay}),Ge=m.useCallback(P=>{const M=le(P);return{...M,onKeyDown:W=>{M.onKeyDown(W),H(W)}}},[le,H]);return{...Cn({game:{state:p,rows:y,cols:x,size:w,mobile:I,isAnalysisMode:e,generating:a,scaling:j},analysis:{analysisMoves:v,handleAnalysisMove:O,handleAnalysisCopy:L,handleAnalysisClear:D,handleAnalysisClose:G,handleAnalysisApply:Y,handleBoxClick:q,handleOpenAnalysis:K,boardSx:T},info:{infoOpen:n,toggleInfo:o},getDragProps:Ge}),gameState:{...g,solved:p.solved,handleNext:c}}}function Ln(){const{boardProps:e,layoutProps:t,infoProps:n,gameState:r,trophyProps:o}=Tn();return f.jsxs(f.Fragment,{children:[f.jsxs(ne,{title:dt.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",onClick:e.isAnalysisMode?e.analysis.onClose:void 0,children:[f.jsx(ne.Content,{paddingBottom:{xs:"120px",md:"150px"},sx:t.contentSx,children:f.jsxs(ne.BoardContainer,{sx:t.boardSx,children:[f.jsx(E,{onClick:n.handleBoxClick,children:f.jsx(Lt,{...e})}),f.jsx(we,{show:!e.isAnalysisMode&&e.state.solved,...o})]})}),f.jsxs(F,{...r.controlsProps,onRefresh:r.handleNext,disabled:e.generating,hidden:e.isAnalysisMode,children:[f.jsx(F.Refresh,{}),f.jsx(F.ResizeMinus,{}),f.jsx(F.ResizePlus,{}),f.jsx(F.Info,{onClick:n.toggleOpen})]})]}),f.jsx(un,{...n})]})}export{Ln as Slant};
