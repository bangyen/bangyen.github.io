import{r,j as t}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-DUcWo5vL.js";import{a as n}from"./index-B2NUz2pg.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(r,t)=>{const e=[];for(let n=0;n<r;n++){const r=[];for(let e=0;e<t;e++)r.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(r)}return e},c=(r,t,e,n,o=!1)=>{const a=[],{row:i,col:l}=r;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([r,i])=>{if(void 0!==r&&void 0!==i&&r>=0&&r<e&&i>=0&&i<n&&t[r]?.[i]?.visited===o){const e=t[r][i];a.push(e)}}),a},u=(r,t)=>{const e=r.row-t.row,n=r.col-t.col;1===e?(r.walls.top=!1,t.walls.bottom=!1):-1===e?(r.walls.bottom=!1,t.walls.top=!1):1===n?(r.walls.left=!1,t.walls.right=!1):-1===n&&(r.walls.right=!1,t.walls.left=!1)};const p={backtracker:function(r,t,e){const n=[],o=r[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,r,t,e,!1);if(a.length>0){const r=a[Math.floor(Math.random()*a.length)];r&&(u(o,r),r.visited=!0,n.push(r))}else n.pop()}},prims:function(r,t,e){const n=r[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,r,t,e,!1).map(r=>({parent:n,cell:r}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,r,t,e,!1).forEach(r=>{o.push({parent:l,cell:r})})}}}};const f=21,g=100;function d(){const c=r.useRef(null),u=r.useRef(null),[d,y]=r.useState(null),[h,m]=r.useState("start"),[w]=r.useState("backtracker"),v=r.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:x,width:b}=o(),C=a("sm"),k=x-(C?56:80),T=r.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[M,E]=r.useState({active:!1,originConfig:null,currentConfig:null}),S=r.useCallback(()=>{const r=function(r,t,e="backtracker"){const n=s(r,t);return(0,p[e])(n,r,t),{grid:n,rows:r,cols:t,start:[0,0],end:[r-1,t-1]}}(f,f,w);y(r),v.current.player={x:r.start[1]*g+50,y:r.start[0]*g+50,vx:0,vy:0,rotation:0},v.current.goal={x:r.end[1]*g+50,y:r.end[0]*g+50,rotation:0},v.current.gameState="playing",v.current.lastTime=0,m("playing")},[w]);r.useEffect(()=>{S()},[S]),r.useEffect(()=>{if(!c.current)return;const r=c.current,t=window.devicePixelRatio||1;r.width=b*t,r.height=k*t;const e=r.getContext("2d");e&&e.scale(t,t)},[b,k]),r.useEffect(()=>{if(!d||"playing"!==h||!c.current)return;const r=c.current,t=r.getContext("2d",{alpha:!0});if(!t)return;let e;const o={},a=r=>{o[r.key.toLowerCase()]=!0},i=r=>{o[r.key.toLowerCase()]=!1};window.addEventListener("keydown",a),window.addEventListener("keyup",i);const l=a=>{e=requestAnimationFrame(l);const i=v.current.lastTime?(a-v.current.lastTime)/16.67:1;v.current.lastTime=a;const s=t=>{if(t.startsWith("var(")){const e=t.slice(4,-1);return getComputedStyle(r).getPropertyValue(e).trim()||"#ffffff"}return t},c=s(n.text.primary),u=s(n.primary.main),p=s(n.primary.dark),y=s(n.primary.main),h=1.2*i,w=Math.pow(.88,i),x=(o.d||o.arrowright?1:0)-(o.a||o.arrowleft?1:0),C=(o.s||o.arrowdown?1:0)-(o.w||o.arrowup?1:0);let M=0,E=0;T.current.isDown&&(M=Math.max(-1,Math.min(1,(T.current.currentX-T.current.startX)/80)),E=Math.max(-1,Math.min(1,(T.current.currentY-T.current.startY)/80)));const j=x+M,X=C+E;v.current.player.vx+=j*h,v.current.player.vy+=X*h,v.current.player.vx*=w,v.current.player.vy*=w;const Y=(r,t)=>{const e=Math.floor(r/g),n=Math.floor(t/g);if(n<0||n>=f||e<0||e>=f)return!0;const o=d.grid[n]?.[e];if(!o)return!0;const a=e*g,i=(e+1)*g,l=n*g,s=(n+1)*g;return!!(o.walls.left&&r-14<a)||(!!(o.walls.right&&r+14>i)||(!!(o.walls.top&&t-14<l)||!!(o.walls.bottom&&t+14>s)))},P=v.current.player.x+v.current.player.vx*i;if(Y(P,v.current.player.y)){const r=v.current.player.x-2*Math.sign(v.current.player.vx);Y(r,v.current.player.y)||(v.current.player.x=r),v.current.player.vx*=-.8}else v.current.player.x=P;const L=v.current.player.y+v.current.player.vy*i;if(Y(v.current.player.x,L)){const r=v.current.player.y-2*Math.sign(v.current.player.vy);Y(v.current.player.x,r)||(v.current.player.y=r),v.current.player.vy*=-.8}else v.current.player.y=L;const A=Math.sqrt(v.current.player.vx**2+v.current.player.vy**2);v.current.player.rotation+=.05*A*i,A>.1&&v.current.trail.push({x:v.current.player.x,y:v.current.player.y});const D=v.current.trail;D.length>(A>.1?15:0)&&D.shift();const R=1-Math.pow(.9,i);v.current.camera.x+=(v.current.player.x-v.current.camera.x)*R,v.current.camera.y+=(v.current.player.y-v.current.camera.y)*R;Math.sqrt(Math.pow(v.current.player.x-v.current.goal.x,2)+Math.pow(v.current.player.y-v.current.goal.y,2))<30&&"playing"===v.current.gameState&&(v.current.gameState="won",m("won"),setTimeout(()=>{S()},1500)),t.clearRect(0,0,b,k),t.save(),t.translate(b/2-v.current.camera.x,k/2-v.current.camera.y);const q=50,W=v.current.camera.x-b/2,B=v.current.camera.x+b/2,_=v.current.camera.y-k/2,F=v.current.camera.y+k/2;t.beginPath(),t.strokeStyle=y,t.lineWidth=1,t.globalAlpha=.03;for(let r=Math.floor(W/q)*q;r<=B;r+=q)t.moveTo(r,_),t.lineTo(r,F);for(let r=Math.floor(_/q)*q;r<=F;r+=q)t.moveTo(W,r),t.lineTo(B,r);t.stroke(),t.globalAlpha=1,t.strokeStyle=u,t.lineWidth=4,t.lineCap="round",t.shadowColor=u,t.shadowBlur=0;const G=12;t.beginPath();for(let r=0;r<=f;r++)for(let e=0;e<=f;e++){const n=e*g,o=r*g,a=r>0&&(e<f?d.grid[r-1]?.[e]?.walls.left??!1:d.grid[r-1]?.[e-1]?.walls.right??!1),i=r<f&&(e<f?d.grid[r]?.[e]?.walls.left??!1:d.grid[r]?.[e-1]?.walls.right??!1),l=e>0&&(r<f?d.grid[r]?.[e-1]?.walls.top??!1:d.grid[r-1]?.[e-1]?.walls.bottom??!1),s=e<f&&(r<f?d.grid[r]?.[e]?.walls.top??!1:d.grid[r-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(t.moveTo(n,o-G),t.arcTo(n,o,n+G,o,G)):s&&i&&!l&&!a?(t.moveTo(n+G,o),t.arcTo(n,o,n,o+G,G)):i&&l&&!a&&!s?(t.moveTo(n,o+G),t.arcTo(n,o,n-G,o,G)):l&&a&&!s&&!i&&(t.moveTo(n-G,o),t.arcTo(n,o,n,o-G,G))),i){const a=2===c&&(l||s)?o+G:o,i=r+1,u=i<f&&(e<f?d.grid[i]?.[e]?.walls.left??!1:d.grid[i]?.[e-1]?.walls.right??!1),p=e>0&&(i<f?d.grid[i]?.[e-1]?.walls.top??!1:d.grid[i-1]?.[e-1]?.walls.bottom??!1),y=e<f&&(i<f?d.grid[i]?.[e]?.walls.top??!1:d.grid[i-1]?.[e]?.walls.bottom??!1),h=2===1+(u?1:0)+(p?1:0)+(y?1:0)&&(p||y)?(r+1)*g-G:(r+1)*g;t.moveTo(n,a),t.lineTo(n,h)}if(s){const l=2===c&&(a||i)?n+G:n,s=e+1,u=r>0&&(s<f?d.grid[r-1]?.[s]?.walls.left??!1:d.grid[r-1]?.[s-1]?.walls.right??!1),p=r<f&&(s<f?d.grid[r]?.[s]?.walls.left??!1:d.grid[r]?.[s-1]?.walls.right??!1),y=s<f&&(r<f?d.grid[r]?.[s]?.walls.top??!1:d.grid[r-1]?.[s]?.walls.bottom??!1),h=s*g-(2===1+(u?1:0)+(p?1:0)+(y?1:0)&&(u||p)?G:0);t.moveTo(l,o),t.lineTo(h,o)}}t.stroke(),t.shadowBlur=0;const H=v.current.goal;H.rotation+=.02*i,t.save(),t.translate(H.x,H.y),t.rotate(H.rotation),t.fillStyle=p,t.shadowColor=p,t.shadowBlur=0,t.beginPath(),t.rect(-10,-10,20,20),t.fill(),t.restore();const $=v.current.trail,z=$.length;if(z>2){t.save(),t.beginPath(),t.strokeStyle=c,t.lineWidth=12,t.lineCap="round",t.lineJoin="round";const r=$[0];if(r){t.moveTo(r.x,r.y);for(let r=1;r<z-1;r++){const e=$[r],n=$[r+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;t.globalAlpha=r/z*.15,t.quadraticCurveTo(e.x,e.y,o,a),t.stroke(),t.beginPath(),t.moveTo(o,a)}}}t.restore()}else if(z>1){const r=$[0],e=$[1];r&&e&&(t.save(),t.beginPath(),t.strokeStyle=c,t.lineWidth=12,t.lineCap="round",t.globalAlpha=.15,t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())}const I=v.current.player;t.save(),t.translate(I.x,I.y),t.fillStyle=c,t.beginPath(),t.arc(0,0,12,0,2*Math.PI),t.fill(),t.restore(),t.restore()};return requestAnimationFrame(l),()=>{cancelAnimationFrame(e),window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}},[d,h,b,k,C,S]);const j=r=>{T.current.isDown&&(T.current.currentX=r.clientX,T.current.currentY=r.clientY,E(t=>{if(!t.originConfig)return t;const e=r.clientX-t.originConfig.x,n=r.clientY-t.originConfig.y,o=Math.sqrt(e*e+n*n);let a=r.clientX,i=r.clientY;if(o>50){const r=50/o;a=t.originConfig.x+e*r,i=t.originConfig.y+n*r}return{...t,currentConfig:{x:a,y:i}}}))},X=()=>{T.current.isDown=!1,E({active:!1,originConfig:null,currentConfig:null})};return r.useEffect(()=>(window.addEventListener("pointermove",j),window.addEventListener("pointerup",X),()=>{window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",X)}),[]),r.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),t.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[t.jsx(e,{showHome:!0}),t.jsx(l,{ref:u,onPointerDown:r=>{"playing"===h&&(T.current.isDown=!0,T.current.startX=r.clientX,T.current.startY=r.clientY,T.current.currentX=r.clientX,T.current.currentY=r.clientY,E({active:!0,originConfig:{x:r.clientX,y:r.clientY},currentConfig:{x:r.clientX,y:r.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:t.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),M.active&&M.originConfig&&M.currentConfig&&t.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[t.jsx(l,{sx:{position:"absolute",left:M.originConfig.x,top:M.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),t.jsx(l,{sx:{position:"absolute",left:M.currentConfig.x,top:M.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{d as default};
