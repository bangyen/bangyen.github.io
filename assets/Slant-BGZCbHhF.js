import{r as M,a as de,j as R}from"./vendor_react-BC_ZxTUy.js";import{A as V,S as oe,a as $,L as Q,e as F,d as re}from"./index-DxkDet3P.js";import{u as ue,C as te}from"./layout-B0wDzl-L.js";import{b as ne,e as J,g as se,a as fe,f as ge,c as pe,G as he,d as be,B as me}from"./gameUtils-BqiGYNbz.js";import{B as H}from"./vendor_mui_core-BH2K4FI9.js";import{u as xe,v as Se,c as we,P as ye}from"./vendor_mui_icons-DLCmcMzz.js";import"./GlobalHeader-C14muTK7.js";const K="32px",q="48px",ie="130%",ae="6px",le="24px",ve=100,Ce=1e3,ke=1200,$e=.95,Ee=100,Re=16,Ne=.8,ze="slant-size",je="slant-state",Ie="slant-ghost-moves",Me=0,X=3,Ae=5,ce={WHITE:"#fff"},G={LINE:"0 2px 4px rgba(0,0,0,0.2)",HINT:"0 4px 8px rgba(0,0,0,0.1)"},W={BORDER:"rgba(255, 255, 255, 0.1)",BG_SUBTLE:"rgba(255, 255, 255, 0.02)",BG_HOVER:"rgba(255, 255, 255, 0.1)",DASHED_BORDER:"rgba(255, 255, 255, 0.2)",HINT_BG:"hsl(217, 50%, 8%)",HINT_BORDER:"rgba(255, 255, 255, 0.3)"},N=1,B=2;class Y{constructor(e){this.parent=Array.from({length:e},(n,u)=>u)}find(e){const n=this.parent[e];if(n===void 0)throw new Error("Index out of bounds");if(n!==e&&(this.parent[e]=this.find(n)),this.parent[e]===void 0)throw new Error("Parent undefined");return this.parent[e]}union(e,n){const u=this.find(e),a=this.find(n);return u!==a&&(this.parent[u]=a,!0)}connected(e,n){return this.find(e)===this.find(n)}}function O(r,e,n){return r*(n+1)+e}function U(r,e,n){const u=Array.from({length:e+1},()=>Array(n+1).fill(0));for(let a=0;a<e;a++){const y=r[a];if(y)for(let v=0;v<n;v++){const I=y[v];if(I===N){const b=u[a];if(b){const g=b[v+1];g!==void 0&&(b[v+1]=g+1)}const h=u[a+1];if(h){const g=h[v];g!==void 0&&(h[v]=g+1)}}else if(I===B){const b=u[a];if(b){const g=b[v];g!==void 0&&(b[v]=g+1)}const h=u[a+1];if(h){const g=h[v+1];g!==void 0&&(h[v+1]=g+1)}}}}return u}function Be(r,e,n){var I,b,h,g;const u=Array.from({length:e},()=>Array(n).fill(0)),a=new Y((e+1)*(n+1));let y=!0;for(;y;){y=!1;for(let s=0;s<=e;s++)for(let o=0;o<=n;o++){const l=(I=r[s])==null?void 0:I[o];if(l==null)continue;const d=[{gr:s-1,gc:o-1,pt:B},{gr:s-1,gc:o,pt:N},{gr:s,gc:o-1,pt:N},{gr:s,gc:o,pt:B}].filter(({gr:p,gc:i})=>p>=0&&p<e&&i>=0&&i<n);let w=0;const x=[];for(const p of d){const i=(b=u[p.gr])==null?void 0:b[p.gc];i===0?x.push(p):i===p.pt&&w++}if(w===l&&x.length>0)for(const{gr:p,gc:i,pt:c}of x){const f=u[p];if((f==null?void 0:f[i])===0){const j=c===N?B:N;f[i]=j,y=!0;const T=O(p,j===N?i+1:i,n),k=O(p+1,j===N?i:i+1,n);if(a.connected(T,k))return!1;a.union(T,k)}}else if(w+x.length===l&&x.length>0)for(const{gr:p,gc:i,pt:c}of x){const f=u[p];if((f==null?void 0:f[i])===0){f[i]=c,y=!0;const j=O(p,c===N?i+1:i,n),T=O(p+1,c===N?i:i+1,n);if(a.connected(j,T))return!1;a.union(j,T)}}}if(!y)for(let s=0;s<e;s++)for(let o=0;o<n;o++){const l=u[s];if((l==null?void 0:l[o])!==0)continue;const d=O(s,o+1,n),w=O(s+1,o,n),x=a.connected(d,w),p=O(s,o,n),i=O(s+1,o+1,n),c=a.connected(p,i);if(x&&c)return!1;x?(l[o]=B,y=!0,a.union(p,i)):c&&(l[o]=N,y=!0,a.union(d,w))}}if(!u.every(s=>s.every(o=>o!==0)))return!1;const v=U(u,e,n);for(let s=0;s<=e;s++)for(let o=0;o<=n;o++){const l=(h=r[s])==null?void 0:h[o];if(l!=null&&((g=v[s])==null?void 0:g[o])!==l)return!1}return!0}function Z(r,e){let n=[],u=!1;for(let b=0;b<50&&!u;b++){n=Array.from({length:r},()=>Array(e).fill(0));const h=new Y((r+1)*(e+1)),g=[];for(let o=0;o<r;o++)for(let l=0;l<e;l++)g.push({r:o,c:l});for(let o=g.length-1;o>0;o--){const l=Math.floor(Math.random()*(o+1)),d=g[o],w=g[l];d&&w&&(g[o]=w,g[l]=d)}let s=!1;for(const{r:o,c:l}of g){const d=O(o,l+1,e),w=O(o+1,l,e),x=h.connected(d,w),p=O(o,l,e),i=O(o+1,l+1,e),c=h.connected(p,i);if(x&&c){s=!0;break}const f=n[o];f&&(x?(f[l]=B,h.union(p,i)):c||Math.random()<.5?(f[l]=N,h.union(d,w)):(f[l]=B,h.union(p,i)))}s||(u=!0)}u||(n=Array.from({length:r},(b,h)=>Array(e).fill(h%2==0?N:B)));const a=U(n,r,e).map(b=>[...b]),y=[];for(let b=0;b<=r;b++)for(let h=0;h<=e;h++)y.push({r:b,c:h});for(let b=y.length-1;b>0;b--){const h=Math.floor(Math.random()*(b+1)),g=y[b],s=y[h];g&&s&&(y[b]=s,y[h]=g)}const v=Math.floor((r+1)*(e+1)*Me);let I=(r+1)*(e+1);for(const{r:b,c:h}of y){if(I<=v)continue;const g=a[b];if(!g)continue;const s=g[h];s!=null&&(g[h]=null,Be(a,r,e)?I--:g[h]=s)}return{numbers:a,solution:n}}function Te(r,e){switch(e.type){case"toggle":{if(r.solved)return r;const{row:n,col:u}=e,a=r.grid.map(s=>[...s]),y=a[n];if(!y)return r;const v=y[u];if(v===void 0)return r;e.reverse?y[u]=v===0?B:v===B?N:0:y[u]=v===0?N:v===N?B:0;let I=!1;if(a.every(s=>s.every(o=>o!==0))){const s=U(a,r.rows,r.cols);r.numbers.every((o,l)=>o.every((d,w)=>{var x;return d===null||d===((x=s[l])==null?void 0:x[w])}))&&!(function(o,l,d){const w=new Y((l+1)*(d+1));for(let x=0;x<l;x++){const p=o[x];if(p)for(let i=0;i<d;i++){const c=p[i];if(c===void 0||c===0)continue;const f=O(x,c===N?i+1:i,d),j=O(x+1,c===N?i:i+1,d);if(!w.union(f,j))return!0}}return!1})(a,r.rows,r.cols)&&(I=!0)}const b=(function(s,o,l,d){var p,i;const w=new Set,x=U(s,l,d);for(let c=0;c<=l;c++)for(let f=0;f<=d;f++){const j=(p=o[c])==null?void 0:p[f];if(j==null)continue;const T=((i=x[c])==null?void 0:i[f])??0;T>j?w.add(`${String(c)},${String(f)}`):T+[{gr:c-1,gc:f-1},{gr:c-1,gc:f},{gr:c,gc:f-1},{gr:c,gc:f}].filter(({gr:k,gc:A})=>{var S;return k>=0&&k<l&&A>=0&&A<d&&((S=s[k])==null?void 0:S[A])===0}).length<j&&w.add(`${String(c)},${String(f)}`)}return w})(a,r.numbers,r.rows,r.cols),h=(function(s,o,l){var f,j,T;const d=new Map,w=new Set;for(let k=0;k<o;k++)for(let A=0;A<l;A++){const S=(f=s[k])==null?void 0:f[A];if(!S||S===0)continue;const z=O(k,S===N?A+1:A,l),t=O(k+1,S===N?A:A+1,l);d.has(z)||d.set(z,[]),d.has(t)||d.set(t,[]),(j=d.get(z))==null||j.push({node:t,r:k,c:A}),(T=d.get(t))==null||T.push({node:z,r:k,c:A})}const x=new Set,p=new Set,i=[],c=(k,A)=>{x.add(k),p.add(k);const S=d.get(k)??[];for(const{node:z,r:t,c:m}of S)if(z!==A)if(p.has(z)){w.add(`${String(t)},${String(m)}`);for(let E=i.length-1;E>=0;E--){const C=i[E];if(!C||(w.add(`${String(C.r)},${String(C.c)}`),C.u===z||C.v===z))break}}else x.has(z)||(i.push({r:t,c:m,u:k,v:z}),c(z,k),i.pop());p.delete(k)};for(const k of d.keys())x.has(k)||c(k,-1);return w})(a,r.rows,r.cols),g=(function(s,o,l,d){var p,i;const w=new Set,x=U(s,l,d);for(let c=0;c<=l;c++)for(let f=0;f<=d;f++){const j=(p=o[c])==null?void 0:p[f];j!=null&&(((i=x[c])==null?void 0:i[f])??0)===j&&w.add(`${String(c)},${String(f)}`)}return w})(a,r.numbers,r.rows,r.cols);return{...r,grid:a,solved:I,errorNodes:b,cycleCells:h,satisfiedNodes:g}}case"hydrate":return{...e.state};case"resize":{if(e.rows<X||e.cols<X)return r;const{numbers:n,solution:u}=Z(e.rows,e.cols);return{grid:Array.from({length:e.rows},()=>Array(e.cols).fill(0)),numbers:n,solution:u,rows:e.rows,cols:e.cols,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}case"new":{const{numbers:n,solution:u}=Z(r.rows,r.cols);return{...r,grid:Array.from({length:r.rows},()=>Array(r.cols).fill(0)),numbers:n,solution:u,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}default:return r}}const Oe=({rows:r,cols:e,numbers:n,size:u,initialMoves:a,onMove:y,onCopy:v,onClear:I,onClose:b})=>{const h=ue("sm"),g=a,{getDragProps:s}=ne({onToggle:(S,z,t,m,E)=>{const C=`${String(S)},${String(z)}`;if(!E)return void y(C,m);const D=g.get(C);let L;return L=t?D===B?N:D===N?void 0:B:D===N?B:D===B?void 0:N,y(C,L),L},touchTimeout:J.timing.touchHoldDelay,checkEnabled:()=>!0}),[o,l]=M.useState(new Map),[d,w]=M.useState([]),[x,p]=M.useState(new Set),i=de.useRef(null);M.useEffect(()=>{const S=new Worker(new URL("/assets/solverWorker-pckxroy8.js",import.meta.url),{type:"module"});return i.current=S,S.onmessage=z=>{const t=z.data;if(t.type==="RESULT"){const{gridState:m,conflicts:E,cycleCells:C}=t.payload;l(m),w(E),p(C)}},()=>{S.terminate()}},[]),M.useEffect(()=>{i.current&&i.current.postMessage({type:"SOLVE",payload:{rows:r,cols:e,numbers:n,userMoves:g}})},[g,n,r,e]);const c=.4*u,f=u-c,j=M.useMemo(()=>new Set(d.filter(S=>S.type==="cell").map(S=>`${String(S.r)},${String(S.c)}`)),[d]),T=M.useMemo(()=>new Set(d.filter(S=>S.type==="node").map(S=>`${String(S.r)},${String(S.c)}`)),[d]),k=M.useCallback((S,z)=>{const t=`${String(S)},${String(z)}`,m=o.get(t),E=(m==null?void 0:m.state)??0,C=m==null?void 0:m.source,D=j.has(t),L=x.has(t),P=s(t);let _=$.text.primary;return D?_=$.data.red:L?_=C==="user"?$.data.red:"#ff9800":C==="user"?_=$.primary.main:C==="propagated"&&(_=$.data.green),{...P,"data-pos":t,"data-type":"cell",sx:{...P.sx,cursor:"pointer",border:`1px solid ${W.BORDER}`,position:"relative",backgroundColor:W.BG_SUBTLE,"&:hover":{backgroundColor:W.BG_HOVER}},children:R.jsxs(H,{sx:{width:"100%",height:"100%",position:"relative"},children:[E===N&&R.jsx(H,{sx:{position:"absolute",width:ie,height:ae,backgroundColor:_,borderRadius:oe.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:G.LINE,transition:V.transition,pointerEvents:"none"}}),E===B&&R.jsx(H,{sx:{position:"absolute",width:ie,height:ae,backgroundColor:_,borderRadius:oe.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:G.LINE,transition:V.transition,pointerEvents:"none"}})]})}},[o,j,x,s]),A=M.useCallback((S,z)=>{var E;const t=(E=n[S])==null?void 0:E[z],m=T.has(`${String(S)},${String(z)}`);return{"data-pos":`${String(S)},${String(z)}`,"data-type":"hint",children:R.jsx(H,{children:t??""}),sx:{borderRadius:"50%",backgroundColor:m?$.data.red:W.HINT_BG,border:t!==null?`2px solid ${m?$.data.red:W.HINT_BORDER}`:"none",fontSize:`${String(.5*c)}rem`,fontWeight:"800",color:ce.WHITE,zIndex:5,opacity:t!==null?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:m?"scale(1.1)":"scale(1)",position:"relative",pointerEvents:"none"}}},[n,T,c]);return R.jsxs(H,{sx:{position:"relative",userSelect:"none"},children:[R.jsxs(H,{sx:{position:"relative",padding:h?`calc(${K} + 16px)`:`calc(${q} + 24px)`,border:`2px dashed ${W.DASHED_BORDER}`,borderRadius:le},children:[R.jsx(H,{sx:{position:"relative",zIndex:Q.zIndex.base+1},children:R.jsx(te,{size:u,rows:r,cols:e,cellProps:k,space:0,sx:{width:"fit-content"}})}),R.jsx(H,{sx:{position:"absolute",top:h?`calc(${K} + 16px)`:`calc(${q} + 24px)`,left:h?`calc(${K} + 16px)`:`calc(${q} + 24px)`,transform:`translate(-${String(c/2)}rem, -${String(c/2)}rem)`,zIndex:Q.zIndex.base+2,pointerEvents:"none"},children:R.jsx(te,{size:c,rows:r+1,cols:e+1,cellProps:A,space:f,sx:{width:"fit-content"}})})]}),R.jsxs(H,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:h?-72:-88,left:0,right:0,pointerEvents:"auto",zIndex:Q.zIndex.base+5,paddingBottom:2},children:[R.jsx(F,{title:"Copy Board",Icon:xe,onClick:v,sx:{backgroundColor:$.interactive.selected,color:$.primary.main,"&:hover":{backgroundColor:$.interactive.focus}}}),R.jsx(F,{title:"Clear Calculator",Icon:Se,onClick:I,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:$.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),R.jsx(F,{title:"Close Calculator",Icon:we,onClick:b,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:$.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})]})},De=(r,e)=>(n,u)=>{var b;const a=(b=e.grid[n])==null?void 0:b[u],y=se(n,u),v=e.cycleCells.has(y),I=r(y);return{...I,sx:{...I.sx,cursor:"pointer",border:`1px solid ${$.border.subtle}`,position:"relative","&:hover":{backgroundColor:$.interactive.hover}},children:R.jsxs(H,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===N&&R.jsx(H,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:v?$.data.red:$.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:G.LINE,transition:V.transition,pointerEvents:"none"}}),a===B&&R.jsx(H,{sx:{position:"absolute",width:"130%",height:"6px",backgroundColor:v?$.data.red:$.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:G.LINE,transition:V.transition,pointerEvents:"none"}})]})}};function He(){const[r,e]=M.useState(!1),{rows:n,cols:u,state:a,dispatch:y,size:v,mobile:I,handleNext:b,controlsProps:h}=fe({storageKeys:{size:ze,state:je},pageTitle:re.slant,gridConfig:{defaultSize:Ae,minSize:X,headerOffset:J.layout.headerHeight,paddingOffset:160,widthLimit:Ce,cellSizeReference:4,mobileRowOffset:-2},boardConfig:{paddingOffset:t=>({x:t?128:224,y:ve}),boardMaxWidth:ke,boardSizeFactor:$e,maxCellSize:Ee,remBase:Re,rowOffset:1,colOffset:1},reducer:Te,getInitialState:(t,m)=>(function(E,C){const{numbers:D,solution:L}=Z(E,C);return{grid:Array.from({length:E},()=>Array(C).fill(0)),numbers:D,solution:L,rows:E,cols:C,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}})(t,m),winAnimationDelay:J.timing.winAnimationDelay,isSolved:t=>t.solved,persistence:{enabled:!r,serialize:t=>({...t,errorNodes:Array.from(t.errorNodes),cycleCells:Array.from(t.cycleCells),satisfiedNodes:Array.from(t.satisfiedNodes)}),deserialize:t=>{const m=t;return{...m,errorNodes:new Set(m.errorNodes),cycleCells:new Set(m.cycleCells),satisfiedNodes:new Set(m.satisfiedNodes)}}}}),[g,s]=M.useState(new Map);ge({storageKey:Ie,rows:n,cols:u,state:g,onRestore:t=>{s(t)},serialize:t=>Array.from(t.entries()),deserialize:t=>new Map(t)});const o=M.useRef("");M.useEffect(()=>{const t=JSON.stringify(a.numbers);o.current&&o.current!==t&&s(new Map),o.current=t},[a.numbers,a.rows,a.cols]);const l=b,{getDragProps:d}=ne({onToggle:(t,m,E)=>{y({type:"toggle",row:t,col:m,reverse:E})},checkEnabled:()=>!a.solved,touchTimeout:J.timing.touchHoldDelay}),w=.4*v,x=pe(De,d,[a]),p=M.useMemo(()=>((t,m)=>(E,C)=>{var ee;const D=(ee=t.numbers[E])==null?void 0:ee[C],L=se(E,C),P=t.errorNodes.has(L),_=t.satisfiedNodes.has(L);return{sx:{pointerEvents:"none"},children:R.jsx(H,{sx:{borderRadius:"50%",backgroundColor:P?$.data.red:$.surface.background,border:D!==null?`2px solid ${P?$.data.red:_?"transparent":$.border.subtle}`:"none",fontSize:`${String(.5*m)}rem`,fontWeight:"800",color:P?ce.WHITE:_?$.interactive.disabledText:$.text.primary,boxShadow:_&&!P?"none":G.HINT,zIndex:5,opacity:D!==null?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:P?"scale(1.1)":"scale(1)",width:`${String(m)}rem`,height:`${String(m)}rem`},children:D??""})}})(a,w),[a,w]),i=M.useCallback((t,m)=>{s(E=>{const C=new Map(E);return m===void 0?C.delete(t):C.set(t,m),C})},[]),c=M.useCallback(()=>{const t=new Map;a.grid.forEach((m,E)=>{m.forEach((C,D)=>{C!==0&&t.set(`${String(E)},${String(D)}`,C)})}),s(t)},[a.grid]),f=M.useCallback(()=>{s(new Map)},[]),j=M.useCallback(()=>{e(!1)},[]),T=M.useCallback(t=>{t.stopPropagation()},[]),k=M.useMemo(()=>({background:`radial-gradient(circle at 50% 50%, ${$.surface.elevated} 0%, ${$.surface.background} 100%)`,padding:I?"1rem":"2rem"}),[I]),A=M.useMemo(()=>({userSelect:"none",padding:I?K:q,border:"2px solid transparent",borderRadius:le}),[I]),S=r?R.jsx(R.Fragment,{}):R.jsx(be,{...h,disabled:r,children:R.jsx(F,{title:"Open Calculator",Icon:ye,onClick:()=>{e(!r)},sx:{color:"default"}})}),z=r?R.jsx(Oe,{rows:n,cols:u,numbers:a.numbers,size:v,initialMoves:g,onMove:i,onCopy:c,onClear:f,onClose:j}):R.jsx(me,{size:v,rows:n+1,cols:u+1,frontProps:p,backProps:x,frontLayerSx:{pointerEvents:"none"}});return R.jsx(he,{title:re.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"180px",md:"150px"},controls:S,contentSx:k,showTrophy:!r&&a.solved,onReset:l,boardSize:v,iconSizeRatio:Ne,primaryColor:$.primary.main,secondaryColor:$.primary.main,boardSx:A,children:R.jsx(H,{onClick:T,children:z})})}export{He as default};
