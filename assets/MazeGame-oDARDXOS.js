import{r,j as t}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-QNCdke0f.js";import{a as n}from"./index-BHrksqXE.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-CSaB1Iuy.js";const c=(r,t)=>{const e=[];for(let n=0;n<r;n++){const r=[];for(let e=0;e<t;e++)r.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(r)}return e},s=(r,t,e,n,o=!1)=>{const a=[],{row:i,col:l}=r;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([r,i])=>{if(void 0!==r&&void 0!==i&&r>=0&&r<e&&i>=0&&i<n&&t[r]?.[i]?.visited===o){const e=t[r][i];a.push(e)}}),a},u=(r,t)=>{const e=r.row-t.row,n=r.col-t.col;1===e?(r.walls.top=!1,t.walls.bottom=!1):-1===e?(r.walls.bottom=!1,t.walls.top=!1):1===n?(r.walls.left=!1,t.walls.right=!1):-1===n&&(r.walls.right=!1,t.walls.left=!1)};const p={backtracker:function(r,t,e){const n=[],o=r[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=s(o,r,t,e,!1);if(a.length>0){const r=a[Math.floor(Math.random()*a.length)];r&&(u(o,r),r.visited=!0,n.push(r))}else n.pop()}},prims:function(r,t,e){const n=r[0]?.[0];if(!n)return;n.visited=!0;const o=s(n,r,t,e,!1).map(r=>({parent:n,cell:r}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);s(l,r,t,e,!1).forEach(r=>{o.push({parent:l,cell:r})})}}}};const y=21;function f(){const s=r.useRef(null),u=r.useRef(null),[f,g]=r.useState(null),[d,m]=r.useState("start"),[h]=r.useState("backtracker"),w=r.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:x,width:v}=o(),b=a("sm"),C=x-(b?56:80),k=Math.max(60,Math.min(120,v/7)),T=.12*k,M=Math.max(2,.04*k),E=.12*k,S=.02*k,j=r.useRef(k);r.useEffect(()=>{if(j.current!==k){const r=k/j.current;w.current.player.x*=r,w.current.player.y*=r,w.current.player.vx*=r,w.current.player.vy*=r,w.current.goal.x*=r,w.current.goal.y*=r,w.current.trail=w.current.trail.map(t=>({x:t.x*r,y:t.y*r})),j.current=k}},[k]);const X=r.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[Y,P]=r.useState({active:!1,originConfig:null,currentConfig:null}),L=r.useCallback(()=>{const r=function(r,t,e="backtracker"){const n=c(r,t);return(0,p[e])(n,r,t),{grid:n,rows:r,cols:t,start:[0,0],end:[r-1,t-1]}}(y,y,h);g(r),w.current.player={x:r.start[1]*k+k/2,y:r.start[0]*k+k/2,vx:0,vy:0,rotation:0},w.current.goal={x:r.end[1]*k+k/2,y:r.end[0]*k+k/2,rotation:0},w.current.gameState="playing",w.current.lastTime=0,m("playing")},[h,k]);r.useEffect(()=>{L()},[L]),r.useEffect(()=>{if(!s.current)return;const r=s.current,t=window.devicePixelRatio||1;r.width=v*t,r.height=C*t;const e=r.getContext("2d");e&&e.scale(t,t)},[v,C]),r.useEffect(()=>{if(!f||"playing"!==d||!s.current)return;const r=s.current,t=r.getContext("2d",{alpha:!0});if(!t)return;let e;const o={},a=r=>{o[r.key.toLowerCase()]=!0},i=r=>{o[r.key.toLowerCase()]=!1};window.addEventListener("keydown",a),window.addEventListener("keyup",i);const l=a=>{e=requestAnimationFrame(l);const i=w.current.lastTime?(a-w.current.lastTime)/16.67:1;w.current.lastTime=a;const c=t=>{if(t.startsWith("var(")){const e=t.slice(4,-1);return getComputedStyle(r).getPropertyValue(e).trim()||"#ffffff"}return t},s=c(n.text.primary),u=c(n.primary.main),p=c(n.primary.dark),g=c(n.primary.main),d=k/100*1.2*i,h=Math.pow(.88,i),x=(o.d||o.arrowright?1:0)-(o.a||o.arrowleft?1:0),b=(o.s||o.arrowdown?1:0)-(o.w||o.arrowup?1:0);let j=0,Y=0;X.current.isDown&&(j=Math.max(-1,Math.min(1,(X.current.currentX-X.current.startX)/80)),Y=Math.max(-1,Math.min(1,(X.current.currentY-X.current.startY)/80)));const P=x+j,R=b+Y;w.current.player.vx+=P*d,w.current.player.vy+=R*d,w.current.player.vx*=h,w.current.player.vy*=h;const A=(r,t)=>{const e=T+2,n=Math.floor(r/k),o=Math.floor(t/k);if(o<0||o>=y||n<0||n>=y)return!0;const a=f.grid[o]?.[n];if(!a)return!0;const i=n*k,l=(n+1)*k,c=o*k,s=(o+1)*k;return!!(a.walls.left&&r-e<i)||(!!(a.walls.right&&r+e>l)||(!!(a.walls.top&&t-e<c)||!!(a.walls.bottom&&t+e>s)))},D=w.current.player.x+w.current.player.vx*i;if(A(D,w.current.player.y)){const r=w.current.player.x-Math.sign(w.current.player.vx)*S;A(r,w.current.player.y)||(w.current.player.x=r),w.current.player.vx*=-.8}else w.current.player.x=D;const q=w.current.player.y+w.current.player.vy*i;if(A(w.current.player.x,q)){const r=w.current.player.y-Math.sign(w.current.player.vy)*S;A(w.current.player.x,r)||(w.current.player.y=r),w.current.player.vy*=-.8}else w.current.player.y=q;const W=Math.sqrt(w.current.player.vx**2+w.current.player.vy**2);w.current.player.rotation+=.05*W*i,W>.1&&w.current.trail.push({x:w.current.player.x,y:w.current.player.y});const B=w.current.trail;B.length>(W>.1?15:0)&&B.shift();const _=1-Math.pow(.9,i);w.current.camera.x+=(w.current.player.x-w.current.camera.x)*_,w.current.camera.y+=(w.current.player.y-w.current.camera.y)*_;Math.sqrt(Math.pow(w.current.player.x-w.current.goal.x,2)+Math.pow(w.current.player.y-w.current.goal.y,2))<30&&"playing"===w.current.gameState&&(w.current.gameState="won",m("won"),setTimeout(()=>{L()},1500)),t.clearRect(0,0,v,C),t.save(),t.translate(v/2-w.current.camera.x,C/2-w.current.camera.y);const F=k/2,G=w.current.camera.x-v/2,H=w.current.camera.x+v/2,$=w.current.camera.y-C/2,z=w.current.camera.y+C/2;t.beginPath(),t.strokeStyle=g,t.lineWidth=1,t.globalAlpha=.03;for(let r=Math.floor(G/F)*F;r<=H;r+=F)t.moveTo(r,$),t.lineTo(r,z);for(let r=Math.floor($/F)*F;r<=z;r+=F)t.moveTo(G,r),t.lineTo(H,r);t.stroke(),t.globalAlpha=1,t.strokeStyle=u,t.lineWidth=M,t.lineCap="round",t.shadowColor=u,t.shadowBlur=0,t.beginPath();for(let r=0;r<=y;r++)for(let e=0;e<=y;e++){const n=e*k,o=r*k,a=r>0&&(e<y?f.grid[r-1]?.[e]?.walls.left??!1:f.grid[r-1]?.[e-1]?.walls.right??!1),i=r<y&&(e<y?f.grid[r]?.[e]?.walls.left??!1:f.grid[r]?.[e-1]?.walls.right??!1),l=e>0&&(r<y?f.grid[r]?.[e-1]?.walls.top??!1:f.grid[r-1]?.[e-1]?.walls.bottom??!1),c=e<y&&(r<y?f.grid[r]?.[e]?.walls.top??!1:f.grid[r-1]?.[e]?.walls.bottom??!1),s=(a?1:0)+(i?1:0)+(l?1:0)+(c?1:0);if(2===s&&(a&&c&&!i&&!l?(t.moveTo(n,o-E),t.arcTo(n,o,n+E,o,E)):c&&i&&!l&&!a?(t.moveTo(n+E,o),t.arcTo(n,o,n,o+E,E)):i&&l&&!a&&!c?(t.moveTo(n,o+E),t.arcTo(n,o,n-E,o,E)):l&&a&&!c&&!i&&(t.moveTo(n-E,o),t.arcTo(n,o,n,o-E,E))),i){const a=2===s&&(l||c)?o+E:o,i=r+1,u=i<y&&(e<y?f.grid[i]?.[e]?.walls.left??!1:f.grid[i]?.[e-1]?.walls.right??!1),p=e>0&&(i<y?f.grid[i]?.[e-1]?.walls.top??!1:f.grid[i-1]?.[e-1]?.walls.bottom??!1),g=e<y&&(i<y?f.grid[i]?.[e]?.walls.top??!1:f.grid[i-1]?.[e]?.walls.bottom??!1),d=2===1+(u?1:0)+(p?1:0)+(g?1:0)&&(p||g)?(r+1)*k-E:(r+1)*k;t.moveTo(n,a),t.lineTo(n,d)}if(c){const l=2===s&&(a||i)?n+E:n,c=e+1,u=r>0&&(c<y?f.grid[r-1]?.[c]?.walls.left??!1:f.grid[r-1]?.[c-1]?.walls.right??!1),p=r<y&&(c<y?f.grid[r]?.[c]?.walls.left??!1:f.grid[r]?.[c-1]?.walls.right??!1),g=c<y&&(r<y?f.grid[r]?.[c]?.walls.top??!1:f.grid[r-1]?.[c]?.walls.bottom??!1),d=c*k-(2===1+(u?1:0)+(p?1:0)+(g?1:0)&&(u||p)?E:0);t.moveTo(l,o),t.lineTo(d,o)}}t.stroke(),t.shadowBlur=0;const I=w.current.goal;I.rotation+=.02*i,t.save(),t.translate(I.x,I.y),t.rotate(I.rotation),t.fillStyle=p,t.shadowColor=p,t.shadowBlur=0,t.beginPath(),t.rect(-10,-10,20,20),t.fill(),t.restore();const J=w.current.trail,V=J.length;if(V>2){t.save(),t.beginPath(),t.strokeStyle=s,t.lineWidth=T,t.lineCap="round",t.lineJoin="round";const r=J[0];if(r){t.moveTo(r.x,r.y);for(let r=1;r<V-1;r++){const e=J[r],n=J[r+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;t.globalAlpha=r/V*.15,t.quadraticCurveTo(e.x,e.y,o,a),t.stroke(),t.beginPath(),t.moveTo(o,a)}}}t.restore()}else if(V>1){const r=J[0],e=J[1];r&&e&&(t.save(),t.beginPath(),t.strokeStyle=s,t.lineWidth=T,t.lineCap="round",t.globalAlpha=.15,t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())}const K=w.current.player;t.save(),t.translate(K.x,K.y),t.fillStyle=s,t.beginPath(),t.arc(0,0,T,0,2*Math.PI),t.fill(),t.restore(),t.restore()};return requestAnimationFrame(l),()=>{cancelAnimationFrame(e),window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}},[f,d,v,C,b,L,k,S,E,T,M]);const R=r=>{X.current.isDown&&(X.current.currentX=r.clientX,X.current.currentY=r.clientY,P(t=>{if(!t.originConfig)return t;const e=r.clientX-t.originConfig.x,n=r.clientY-t.originConfig.y,o=Math.sqrt(e*e+n*n);let a=r.clientX,i=r.clientY;if(o>50){const r=50/o;a=t.originConfig.x+e*r,i=t.originConfig.y+n*r}return{...t,currentConfig:{x:a,y:i}}}))},A=()=>{X.current.isDown=!1,P({active:!1,originConfig:null,currentConfig:null})};return r.useEffect(()=>(window.addEventListener("pointermove",R),window.addEventListener("pointerup",A),()=>{window.removeEventListener("pointermove",R),window.removeEventListener("pointerup",A)}),[]),r.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),t.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[t.jsx(e,{showHome:!0}),t.jsx(l,{ref:u,onPointerDown:r=>{"playing"===d&&(X.current.isDown=!0,X.current.startX=r.clientX,X.current.startY=r.clientY,X.current.currentX=r.clientX,X.current.currentY=r.clientY,P({active:!0,originConfig:{x:r.clientX,y:r.clientY},currentConfig:{x:r.clientX,y:r.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:t.jsx("canvas",{ref:s,style:{display:"block",width:"100%",height:"100%"}})}),Y.active&&Y.originConfig&&Y.currentConfig&&t.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[t.jsx(l,{sx:{position:"absolute",left:Y.originConfig.x,top:Y.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),t.jsx(l,{sx:{position:"absolute",left:Y.currentConfig.x,top:Y.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{f as default};
