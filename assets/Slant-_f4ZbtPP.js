import{j as e,a as n,r}from"./vendor_react-De-BR_RD.js";import{B as t,l as o,g as s,d as l,G as i,u as a,b as c,m as u,T as d,n as f,L as p,o as g,e as h,c as y,a as m,h as x,f as b,i as S,j as v,k as A}from"./useBaseGame-DOfYD9oq.js";import{T as w}from"./PageLayout-CPo_NzFf.js";import{d as C,T as k,B as j}from"./vendor_mui_core-hUAqgBQf.js";import{c as I,D as N,d as E,e as M,P as R,f as T,N as O,g as P,h as z,T as L,i as $,j as D}from"./vendor_mui_icons-CZLxzKXb.js";import{C as B,L as H,A as _,S as W,F as G,t as Y,P as q}from"./index-7gOcs3fT.js";import{E as U,u as K}from"./lazyNamed-BJSKuIqR.js";import{E as V}from"./ErrorState-Ch5oqtXB.js";function F({onCopy:n,onClear:r,onClose:t,onApply:o}){return e.jsxs(C,{sx:{display:"flex",justifyContent:"center",gap:2,pointerEvents:"auto",zIndex:H.zIndex.base+5,width:"100%",paddingBottom:2,position:"absolute",top:"calc(100% + 32px)",left:0},children:[e.jsx(w,{title:"Copy Board",Icon:I,onClick:n,sx:{backgroundColor:B.interactive.selected,color:B.primary.main,"&:hover":{backgroundColor:B.interactive.focus}}}),e.jsx(w,{title:"Clear Analysis",Icon:N,onClick:r,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:B.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(w,{title:"Apply to Game",Icon:E,onClick:o,sx:{backgroundColor:"rgba(76, 175, 80, 0.1)",color:B.data.green,"&:hover":{backgroundColor:"rgba(76, 175, 80, 0.2)"}}}),e.jsx(w,{title:"Close Analysis",Icon:M,onClick:t,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:B.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const J=.4,X=100,Q=1e3,Z=100,ee=.8,ne={...o("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},re=0,te=8,oe=5,se={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:t.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:"\n            @keyframes slant-pop-in {\n                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }\n                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }\n                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }\n            }\n        ",POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},le=1,ie=2,ae=n.memo(function({value:n,color:r,size:t}){const o=`${String(Math.max(2,t))}px`;return e.jsxs(C,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===le&&e.jsx(C,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:W.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:se.SHADOWS.LINE,transition:_.transition,animation:se.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),n===ie&&e.jsx(C,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:W.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:se.SHADOWS.LINE,transition:_.transition,animation:se.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),ce=n.memo(function({value:n,hasConflict:r,isSatisfied:t,numberSize:o}){return e.jsx(C,{sx:{width:`${String(o)}rem`,height:`${String(o)}rem`,borderRadius:"50%",backgroundColor:r?B.data.red:se.ANALYSIS.HINT_BG,border:null==n?"none":`2px solid ${r?B.data.red:t?"transparent":se.ANALYSIS.HINT_BORDER}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:r?se.COLORS.WHITE:t?B.interactive.disabledText:se.ANALYSIS.HINT_TEXT,boxShadow:t&&!r?"none":se.SHADOWS.HINT,opacity:null==n?0:t?.6:1,zIndex:5,position:"relative",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)"},children:n??""})});class ue{constructor(e){this.parent=Array.from({length:e},(e,n)=>n)}find(e){const n=this.parent[e];if(void 0===n)throw new Error(`DSU: Index ${String(e)} out of bounds`);n!==e&&(this.parent[e]=this.find(n));const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return r}union(e,n){const r=this.find(e),t=this.find(n);return r!==t&&(this.parent[r]=t,!0)}connected(e,n){return this.find(e)===this.find(n)}}function de(e,n,r){return e*(r+1)+n}function fe(e,n,r){const t=new Map,o=new Set;for(let s=0;s<n;s++)for(let n=0;n<r;n++){const o=e[s]?.[n];if(!o||0===o)continue;const l=de(s,o===le?n+1:n,r),i=de(s+1,o===le?n:n+1,r);t.has(l)||t.set(l,[]),t.has(i)||t.set(i,[]),t.get(l)?.push({node:i,r:s,c:n}),t.get(i)?.push({node:l,r:s,c:n})}const l=new Set,i=new Set,a=[],c=(e,n)=>{l.add(e),i.add(e);const r=t.get(e)??[];for(const{node:t,r:u,c:d}of r)if(t!==n)if(i.has(t)){o.add(s(u,d));for(let e=a.length-1;e>=0;e--){const n=a[e];if(!n)break;if(o.add(s(n.r,n.c)),n.u===t||n.v===t)break}}else l.has(t)||(a.push({r:u,c:d,u:e,v:t}),c(t,e),a.pop());i.delete(e)};for(const s of t.keys())l.has(s)||c(s,-1);return o}function pe({rows:e,cols:n,numbers:t,userMoves:o}){const[l,i]=r.useState(new Map),[a,c]=r.useState([]),[u,d]=r.useState(new Set),f=r.useRef(null),[p,g]=r.useState("probing");return r.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=n;const r=setTimeout(()=>{e||(g("broken"),f.current=null,n.terminate())},2e3);return n.onmessage=n=>{if(e)return;const t=n.data;"RESULT"===t.type&&g(e=>{if("probing"===e)return clearTimeout(r),"healthy";const{gridState:n,conflicts:o,cycleCells:s}=t.payload;return i(n),c(o),d(s),e})},n.onerror=()=>{clearTimeout(r),g("broken"),f.current=null,n.terminate()},n.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(r),n.terminate()}},[]),r.useEffect(()=>{if("healthy"===p&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:n,numbers:t,userMoves:o}});else if("broken"===p){const r=function(e,n,r,t){const o=new Map,l=[],i=[];t.forEach((e,n)=>{o.set(n,{state:e,source:"user"});const[r,t]=n.split(",").map(Number);void 0!==r&&void 0!==t&&l.push({r:r,c:t})});const a=(r,t)=>{if(r<0||r>=e||t<0||t>=n)return 0;const l=s(r,t);return o.get(l)?.state??0},c=(e,n,r,t)=>{const a=s(e,n),c=o.get(a);c?c.state!==r&&i.push({type:"cell",r:e,c:n}):(o.set(a,{state:r,source:t}),l.push({r:e,c:n}))},u=(r,t)=>[{r:r-1,c:t-1,required:ie},{r:r-1,c:t,required:le},{r:r,c:t-1,required:le},{r:r,c:t,required:ie}].filter(r=>r.r>=0&&r.r<e&&r.c>=0&&r.c<n);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:n,c:t}=e,f=[{r:n,c:t},{r:n,c:t+1},{r:n+1,c:t},{r:n+1,c:t+1}];for(const l of f){const e=r[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const p=[];for(const n of d){const e=a(n.r,n.c);0===e?p.push(n):e===n.required&&f++}if(f>e)i.push({type:"node",r:l.r,c:l.c});else if(f+p.length<e)i.push({type:"node",r:l.r,c:l.c});else if("user"===o.get(s(n,t))?.source)if(f===e&&p.length>0)for(const n of p){const e=n.required===le?ie:le;c(n.r,n.c,e,"propagated")}else if(f+p.length===e&&p.length>0)for(const n of p)c(n.r,n.c,n.required,"propagated")}}const f=Array.from({length:e},()=>new Array(n).fill(0));for(const[s,g]of o.entries()){const[e,n]=s.split(",").map(Number);void 0!==e&&void 0!==n&&f[e]&&(f[e][n]=g.state)}const p=fe(f,e,n);return{gridState:o,conflicts:i,cycleCells:p}}(e,n,t,o);i(r.gridState),c(r.conflicts),d(r.cycleCells)}},[o,t,e,n,p]),{gridState:l,conflicts:a,cycleCells:u}}function ge({rows:n,cols:o,numbers:u,size:d,initialMoves:f,onMove:p,onCopy:g,onClear:h,onClose:y,onApply:m}){const x=f,{getDragProps:b}=l({onToggle:(e,n,r,t,o)=>{const l=s(e,n);if(!o)return void p(l,t);const i=x.get(l);let a;return a=r?i===le?ie:i===ie?void 0:le:i===ie?le:i===le?void 0:ie,p(l,a),a},touchTimeout:i.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:S}=a({rows:n,cols:o}),v=r.useCallback(e=>{const n=b(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),S(e)}}},[b,S]),{gridState:A,conflicts:w,cycleCells:k}=pe({rows:n,cols:o,numbers:u,userMoves:x}),j=d*J,I=r.useMemo(()=>new Set(w.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[w]),N=r.useMemo(()=>new Set(w.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[w]),E=r.useCallback((n,r)=>function({r:n,c:r,gridState:t,conflictSet:o,cycleCells:l,getDragProps:i,size:a}){const c=s(n,r),u=t.get(c),d=u?.state??0,f=u?.source,p=o.has(c),g=l.has(c),h=i(c);let y=B.text.primary;return p?y=B.data.red:g?y="user"===f?B.data.red:B.data.orange:"user"===f?y=B.primary.main:"propagated"===f&&(y=B.data.green),{...h,"data-pos":c,"data-type":"cell",sx:{...h.sx,cursor:"pointer",outline:"none",border:`2px solid ${B.border.subtle}`,position:"relative",backgroundColor:se.ANALYSIS.BG_SUBTLE,"&:hover":{backgroundColor:se.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${B.primary.main}`,outlineOffset:"-3px",backgroundColor:se.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${B.interactive.focus}`}},children:e.jsx(ae,{value:d,color:y,size:a})}}({r:n,c:r,gridState:A,conflictSet:I,cycleCells:k,getDragProps:v,size:d}),[A,I,k,v,d]),M=r.useCallback(()=>{if(!m)return;const e=new Map;A.forEach((n,r)=>{0!==n.state&&e.set(r,n.state)}),m(e)},[m,A]),R=r.useCallback((r,t)=>function({r:n,c:r,numbers:t,gridState:o,rows:l,cols:i,nodeConflictSet:a,numberSize:c}){const u=t[n]?.[r],d=a.has(s(n,r));let f=0,p=0;const g=[{r:n-1,c:r-1,required:ie},{r:n-1,c:r,required:le},{r:n,c:r-1,required:le},{r:n,c:r,required:ie}];for(const e of g)if(e.r>=0&&e.r<l&&e.c>=0&&e.c<i){const n=o.get(s(e.r,e.c));n&&0!==n.state&&(p++,n.state===e.required&&f++)}const h=null!=u&&f===u&&p>0;return{"data-pos":s(n,r),"data-type":"hint",children:e.jsx(ce,{value:u??null,hasConflict:d,isSatisfied:h,numberSize:c}),sx:{pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"}}}({r:r,c:t,numbers:u,gridState:A,rows:n,cols:o,nodeConflictSet:N,numberSize:j}),[u,A,n,o,N,j]);return e.jsxs(C,{sx:{position:"relative",userSelect:"none"},onContextMenu:e=>{e.preventDefault()},children:[e.jsx("style",{children:se.ANIMATIONS.POP_IN}),e.jsx(C,{sx:{position:"relative",border:`2px dashed ${se.ANALYSIS.DASHED_BORDER}`,borderRadius:t.BORDER_RADIUS},children:e.jsx(c,{size:d,rows:n+1,cols:o+1,cellRows:n,cellCols:o,space:.125,overlayProps:R,cellProps:E,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})}),e.jsx(F,{onCopy:g,onClear:h,onClose:y,onApply:M})]})}function he({size:n,rows:t,cols:o}){const s=r.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),l=r.useCallback(()=>({}),[]);return e.jsx(C,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:e.jsx(c,{size:n,rows:t+1,cols:o+1,cellRows:t,cellCols:o,overlayProps:l,cellProps:s,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}function ye({isAnalysisMode:n,generating:r,dimensionsMismatch:t,rows:o,cols:s,state:l,size:i,analysisMoves:a,onAnalysisMove:d,onAnalysisCopy:f,onAnalysisClear:p,onAnalysisClose:g,onAnalysisApply:h,cellProps:y,overlayProps:m}){return n?e.jsx(U,{fallback:e.jsx(V,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:e.jsx(ge,{rows:o,cols:s,numbers:l.numbers,size:i,initialMoves:a,onMove:d,onCopy:f,onClear:p,onClose:g,onApply:h})}):r||t?e.jsx(he,{size:i,rows:o,cols:s}):e.jsxs(U,{FallbackComponent:G,fallbackProps:{title:u.errors.boardTitle,resetLabel:u.errors.boardReset},children:[e.jsx("style",{children:se.ANIMATIONS.POP_IN}),e.jsx(c,{size:i,rows:o+1,cols:s+1,cellRows:o,cellCols:s,space:.125,overlayProps:m,cellProps:y,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})]})}const me=[{title:"Corner 0",description:'A "0" in a corner forces the line to point away from that corner.',rows:3,cols:3,numbers:[[0,null,null],[null,null,null],[null,null,null]],grid:[[le,0],[0,0]]},{title:"Corner 1",description:'A "1" in a corner forces the line to connect directly to that corner.',rows:3,cols:3,numbers:[[1,null,null],[null,null,null],[null,null,null]],grid:[[ie,0],[0,0]]},{title:"Edge 0",description:'A "0" on the edge forces all surrounding lines to point away from it.',rows:3,cols:3,numbers:[[null,0,null],[null,null,null],[null,null,null]],grid:[[ie,le],[0,0]]},{title:"Edge 1",description:'A "1" on the edge forces the two surrounding lines into the same orientation.',rows:3,cols:3,numbers:[[null,1,null],[null,null,null],[null,null,null]],grid:[[le,le],[0,0]]},{title:"Edge 2",description:'A "2" on the edge forces both surrounding lines to connect to it.',rows:3,cols:3,numbers:[[null,2,null],[null,null,null],[null,null,null]],grid:[[le,ie],[0,0]]},{title:"Middle 4",description:'A "4" must catch lines from all four surrounding cells.',rows:3,cols:3,numbers:[[null,null,null],[null,4,null],[null,null,null]],grid:[[ie,le],[le,ie]]}];function xe(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:B.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:se.SHADOWS.LINE,pointerEvents:"none"}}function be(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{border:`2px solid ${B.border.subtle}`,position:"relative",backgroundColor:se.ANALYSIS.BG_SUBTLE},children:e.jsxs(C,{sx:{width:"100%",height:"100%",position:"relative"},children:[s===le&&e.jsx(C,{sx:xe("-45deg",r)}),s===ie&&e.jsx(C,{sx:xe("45deg",r)})]})}}}function Se(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{pointerEvents:"none"},children:e.jsx(C,{sx:{borderRadius:"50%",backgroundColor:B.surface.background,border:null==s?"none":`2px solid ${B.border.subtle}`,fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:B.text.primary,boxShadow:null==s?"none":se.SHADOWS.HINT,zIndex:5,opacity:null==s?0:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0.05rem",lineHeight:1,width:`${String(r)}rem`,height:`${String(r)}rem`},children:s??""})}}}const ve={display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.5em",height:"1.5em",borderRadius:"50%",backgroundColor:B.surface.background,border:`1px solid ${B.border.subtle}`,fontSize:"0.85em",fontWeight:"bold",mx:.4,verticalAlign:"middle",lineHeight:1,pt:"0.05em",boxShadow:se.SHADOWS.HINT,position:"relative",top:"-0.1em"};function Ae({text:n}){const r=n.split(/"(\d+)"/g);return e.jsx(k,{variant:"body2",sx:{color:B.text.secondary},children:r.map((n,r)=>r%2==1?e.jsx(C,{component:"span",sx:ve,children:n},`${String(r)}-${n}`):n)})}const we={display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4,width:"100%",py:2,pr:4},Ce={display:"flex",flexDirection:"row",alignItems:"center",gap:0,width:"100%"},ke={width:"180px",display:"flex",justifyContent:"center",flexShrink:0},je={display:"flex",flexDirection:"column",gap:1,flex:1,minWidth:0};function Ie(){return e.jsx(C,{sx:we,children:me.map(n=>e.jsxs(C,{sx:Ce,children:[e.jsx(C,{sx:ke,children:e.jsx(c,{size:3,rows:n.rows,cols:n.cols,cellRows:n.rows-1,cellCols:n.cols-1,space:.125,overlayProps:Se(n.numbers,1.2000000000000002),cellProps:be(n.grid,3),overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})}),e.jsxs(C,{sx:je,children:[e.jsx(k,{variant:"subtitle1",sx:{fontWeight:"bold",color:B.text.primary},children:n.title}),e.jsx(Ae,{text:n.description})]})]},n.title))})}const Ne={display:"flex",flexDirection:{xs:"column",sm:"row"},justifyContent:"center",alignItems:"center",gap:{xs:2,sm:4},width:"100%",flex:1},Ee={display:"grid",gridTemplateColumns:{xs:"repeat(2, 1fr)",sm:"1fr"},gap:1.5,justifyContent:"center",justifyItems:"center",alignItems:"center",mt:{xs:2,sm:0},width:{xs:"100%",sm:"auto"},maxWidth:{xs:"320px",sm:"none"}},Me={borderColor:B.border.subtle,color:B.text.secondary,width:{xs:"140px",sm:"180px"},px:1,"& .MuiButton-startIcon":{mr:{xs:.5,sm:1}}},Re=[[ie,le,ie],[le,le,ie],[ie,le,ie]],Te=[[1,0,2,null],[null,null,null,1],[2,null,null,null],[null,2,0,1]],Oe=[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[2,0],[1,0],[1,1]];function Pe(e,n,r){const t=Array.from({length:n+1},()=>new Array(r+1).fill(0));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const r=n[e];if(r===le){const n=t[o];if(n){const r=n[e+1];void 0!==r&&(n[e+1]=r+1)}const r=t[o+1];if(r){const n=r[e];void 0!==n&&(r[e]=n+1)}}else if(r===ie){const n=t[o];if(n){const r=n[e];void 0!==r&&(n[e]=r+1)}const r=t[o+1];if(r){const n=r[e+1];void 0!==n&&(r[e+1]=n+1)}}}}return t}function ze(e,n,r,t){const o=new Set,l=Pe(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;if((l[i]?.[a]??0)===c){let n=!1;const l=[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}];for(const{gr:o,gc:s}of l)if(o>=0&&o<r&&s>=0&&s<t&&0!==e[o]?.[s]){n=!0;break}n&&o.add(s(i,a))}}return o}function Le(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:B.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:se.SHADOWS.LINE,transition:_.transition,animation:se.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}function $e({size:n,handleOpenAnalysis:t}){const o=r.useMemo(()=>function(){const e=[],n=Array.from({length:3},()=>new Array(3).fill(0));e.push(n);let r=n.map(e=>[...e]);for(const[t,o]of Oe){r=r.map(e=>[...e]);const n=Re[t]?.[o];if(void 0!==n){const e=r[t];e&&(e[o]=n)}e.push(r)}return e}(),[]),[l,i]=r.useState(0),[a,u]=r.useState(!0);r.useEffect(()=>{if(!a)return;const e=setInterval(()=>{i(e=>(e+1)%o.length)},1500);return()=>{clearInterval(e)}},[o.length,a]);const f=r.useMemo(()=>o[l]??o[0]??[],[o,l]),p=l>0&&l<=Oe.length?(()=>{const e=Oe[l-1];return e?s(e[0],e[1]):null})():null,g=r.useMemo(()=>ze(f,Te,3,3),[f]),h=n*J,y=l>=Oe.length&&f.every(e=>e.every(e=>0!==e)),m=r.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l)===t;return{sx:{border:`2px solid ${B.border.subtle}`,position:"relative",transition:_.transition,backgroundColor:se.ANALYSIS.BG_SUBTLE,...a?{backgroundColor:B.interactive.hover}:{}},children:e.jsxs(C,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===le&&e.jsx(C,{sx:Le("-45deg",r)}),i===ie&&e.jsx(C,{sx:Le("45deg",r)})]})}}}(f,n,p),[f,n,p]),x=r.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l),c=r.has(a);return{sx:{pointerEvents:"none"},children:e.jsx(C,{sx:{borderRadius:"50%",backgroundColor:B.surface.background,border:null==i?"none":`2px solid ${c?"transparent":B.border.subtle}`,fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:c?B.interactive.disabledText:B.text.primary,boxShadow:c?"none":se.SHADOWS.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:c?"scale(0.95)":"scale(1)",paddingTop:"0.05rem",lineHeight:1,width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}}}(Te,g,h),[g,h]);return e.jsxs(C,{sx:Ne,children:[e.jsxs(C,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx("style",{children:se.ANIMATIONS.POP_IN}),e.jsx(c,{size:n,rows:4,cols:4,cellRows:3,cellCols:3,space:.125,overlayProps:x,cellProps:m,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0}),e.jsx(d,{show:y&&a,size:n,iconSizeRatio:1,primaryColor:B.primary.main,showLabel:!1})]}),e.jsxs(C,{sx:Ee,children:[e.jsx(j,{variant:"outlined",startIcon:a?e.jsx(R,{}):e.jsx(T,{}),onClick:()=>{u(e=>!e)},sx:Me,children:a?"Pause":"Play"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(O,{}),onClick:()=>{u(!1),i(e=>(e-1+o.length)%o.length)},sx:Me,children:"Step Back"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(P,{}),onClick:()=>{u(!1),i(e=>(e+1)%o.length)},sx:Me,children:"Step Next"}),e.jsx(j,{variant:"outlined",startIcon:e.jsx(z,{}),onClick:t,sx:Me,children:"Analysis"})]})]})}const De={display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"primary.main",fontSize:"1em",borderRadius:1,px:.6,lineHeight:1,verticalAlign:"baseline"},Be=["Slant Rules","Example","Common Patterns"],He=[{Icon:L,title:"Fill with Slashes",text:e.jsxs(e.Fragment,{children:["Place a forward"," ",e.jsx(C,{component:"span",sx:De,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"9",x2:"9",y2:"1"})})})," ","or backward"," ",e.jsx(C,{component:"span",sx:De,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"1",x2:"9",y2:"9"})})})," ","slash in every cell of the grid."]})},{Icon:$,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:D,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],_e={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},We=e=>[...Y(f()),e<2?{overflowY:"hidden"}:{}];function Ge(e){return{storageKey:"slant",grid:{defaultSize:oe,maxSize:te,gridPadding:{x:e?48:80,y:120},widthLimit:Q,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:X}),...e?{boardSizeFactor:.92}:{},maxCellSize:Z,rowOffset:1,colOffset:1}}}function Ye({open:n,toggleOpen:r,handleOpenAnalysis:t}){const o=K("sm");return e.jsx(p,{open:n,toggleOpen:r,titles:Be,instructions:He,exampleContent:e.jsx($e,{size:o?4:4.5,handleOpenAnalysis:t}),cardSx:_e,contentSxOverride:We,persistenceKey:"slant_info_step",extraSteps:[e.jsx(Ie,{},"patterns")]})}function qe(e,n){return`${ne.STATE}-${String(e)}x${String(n)}`}function Ue(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function Ke({rows:e,cols:n,isAnalysisMode:t,requestGeneration:o,cancelGeneration:s}){const l=r.useRef(`${String(e)},${String(n)}`);r.useEffect(()=>{const r=`${String(e)},${String(n)}`;r!==l.current&&(l.current=r,t||!function(e,n){const r=qe(e,n),t=localStorage.getItem(r);if(!t)return!1;try{const e=JSON.parse(t);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,n)?o(e,n):s())},[e,n,o,s,t])}function Ve(e,n,r,t){return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:e,cols:n,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Fe({getInitialState:e,dispatchRef:n,dimsRef:t,onStaleResult:o}){const[s,l]=r.useState(!1),i=r.useRef(null),a=r.useRef("probing"),c=r.useRef(0),u=r.useRef(0),d=r.useRef(null),f=r.useRef(0),p=r.useRef(o);p.current=o;const g=r.useRef(!1),h=r.useRef(null),y=r.useRef(!1),m=r.useCallback(()=>{if(h.current){const e=h.current;p.current?.(e,e.rows,e.cols)}g.current=!1,h.current=null,y.current=!1},[]),x=r.useCallback((r,t)=>{n.current?.({type:"hydrate",state:e(r,t)}),l(!1)},[n,e]),b=r.useCallback((e,n)=>{m(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const r=++c.current;"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:n}})):u.current=requestAnimationFrame(()=>{c.current===r&&x(e,n)})},250)},[x,m]),S=r.useCallback((n,r)=>{g.current||(g.current=!0,h.current=null,y.current=!1,"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:n,cols:r}})):requestAnimationFrame(()=>{g.current&&(h.current=e(n,r))}))},[e]),v=r.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),m(),l(!1)},[m]),A=r.useCallback(()=>{if(h.current){const e=h.current;return h.current=null,n.current?.({type:"hydrate",state:e}),m(),void l(!1)}if(g.current)return y.current=!0,void l(!0);b(t.current.rows,t.current.cols)},[b,t,n,m]);return r.useEffect(()=>{let e=!1;const r=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});i.current=r;const o=setTimeout(()=>{e||"probing"!==a.current||(a.current="broken",f.current=0,i.current=null,r.terminate())},2e3);return r.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(o),a.current="broken",f.current=0,i.current=null,void r.terminate();if("RESULT"===s.data.type){if("probing"===a.current)return clearTimeout(o),void(a.current="healthy");f.current--;const{rows:e,cols:r,numbers:i,solution:c}=s.data.payload,u=t.current;if(e!==u.rows||r!==u.cols)return p.current?.(Ve(e,r,i,c),e,r),void(f.current<=0&&l(!1));if(f.current>0)return;const d=Ve(e,r,i,c);if(g.current)return h.current=d,void(y.current&&(n.current?.({type:"hydrate",state:d}),g.current=!1,h.current=null,y.current=!1,l(!1)));n.current?.({type:"hydrate",state:d}),l(!1)}}},r.onerror=()=>{clearTimeout(o),a.current="broken",f.current=0,i.current=null,r.terminate()},r.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(o),null!==d.current&&clearTimeout(d.current),r.terminate()}},[n,t]),{generating:s,requestGeneration:b,handleNextAsync:A,prefetch:S,cancelGeneration:v}}function Je(e,n,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:r?B.data.red:B.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:se.SHADOWS.LINE,transition:_.transition,animation:se.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const Xe={border:`2px solid ${B.border.subtle}`,position:"relative",backgroundColor:se.ANALYSIS.BG_SUBTLE},Qe={width:"100%",height:"100%",position:"relative"},Ze={pointerEvents:"none"},en={cursor:"pointer",outline:"none","&:hover":{backgroundColor:B.interactive.hover},"&:focus-visible":{outline:`3px solid ${B.primary.main}`,outlineOffset:"-3px",backgroundColor:B.interactive.hover,boxShadow:`inset 0 0 15px ${B.interactive.focus}`}};function nn(e){const{numberSize:n,hasError:r,isSatisfied:t,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:r?B.data.red:B.surface.background,border:o?`2px solid ${r?B.data.red:t?"transparent":B.border.subtle}`:"none",fontSize:`${String(.5*n)}rem`,fontWeight:"800",color:r?se.COLORS.WHITE:t?B.interactive.disabledText:B.text.primary,boxShadow:t&&!r?"none":se.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)",width:`${String(n)}rem`,height:`${String(n)}rem`}}const rn=(n,r,t)=>{const o=function(n,r){return(t,o)=>{const l=n.grid[t]?.[o],i=s(t,o),a=n.cycleCells.has(i),c=[{v:n.numbers[t]?.[o],p:s(t,o)},{v:n.numbers[t]?.[o+1],p:s(t,o+1)},{v:n.numbers[t+1]?.[o],p:s(t+1,o)},{v:n.numbers[t+1]?.[o+1],p:s(t+1,o+1)}].map(({v:e,p:r})=>{if(null==e)return"-";const t=n.errorNodes.has(r)?"Error":n.satisfiedNodes.has(r)?"Ok":"Pending";return`${String(e)} (${t})`});return{"aria-label":`Cell ${String(t+1)}, ${String(o+1)}. Clues: ${c.join(", ")}. ${0===l?"Empty":l===le?"Forward Slash":"Backward Slash"}${a?", Loop Error":""}`,sx:Xe,children:e.jsxs(C,{sx:Qe,children:[l===le&&e.jsx(C,{sx:Je("-45deg",r,a)}),l===ie&&e.jsx(C,{sx:Je("45deg",r,a)})]})}}}(r,t);return(e,r)=>{const t=o(e,r),l=s(e,r),i=n(l);return{...i,...t,sx:{...i.sx,...t.sx,...en}}}};function tn({game:{state:n,rows:t,cols:o,size:l,mobile:i,isAnalysisMode:a,generating:c,handleNextAsync:u},analysis:{analysisMoves:d,handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:g,handleAnalysisClose:y,handleAnalysisApply:m,handleBoxClick:x,handleOpenAnalysis:b,boardSx:S},info:{infoOpen:v,toggleInfo:A},controls:w,getDragProps:k}){const j=l*J,I=h(rn,k,[n,l]),N=r.useMemo(()=>((n,r)=>(t,o)=>{const l=n.numbers[t]?.[o],i=s(t,o),a=n.errorNodes.has(i),c=n.satisfiedNodes.has(i);return{sx:Ze,children:e.jsx(C,{sx:nn({numberSize:r,hasError:a,isSatisfied:c,isVisible:null!=l}),children:l??""})}})(n,j),[n,j]),E=r.useMemo(()=>(e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"}))(i),[i]);return{boardProps:{isAnalysisMode:a,generating:c,dimensionsMismatch:t!==n.rows||o!==n.cols,rows:t,cols:o,state:n,size:l,analysisMoves:d,onAnalysisMove:f,onAnalysisCopy:p,onAnalysisClear:g,onAnalysisClose:y,onAnalysisApply:m,cellProps:I,overlayProps:N},controlsProps:{...w,onRefresh:u,disabled:c,onOpenInfo:A,hidden:a},layoutProps:{boardSx:S,contentSx:E,iconSizeRatio:ee},infoProps:{open:v,toggleOpen:A,handleOpenAnalysis:b,handleBoxClick:x},trophyProps:{show:!a&&n.solved,onReset:u,size:l,iconSizeRatio:ee}}}function on(e,n,r,t,o,s){const l=e[r];if(!l)return!1;l[t]=o;const i=de(r,o===le?t+1:t,s),a=de(r+1,o===le?t:t+1,s);return!n.connected(i,a)&&(n.union(i,a),!0)}function sn(e,n,r){const t=Array.from({length:n},()=>new Array(r).fill(0)),o=new ue((n+1)*(r+1)),s=function(e,n,r,t,o){let s=!0;for(;s;){s=!1;for(let l=0;l<=r;l++)for(let i=0;i<=t;i++){const a=n[l]?.[i];if(null==a)continue;const c=[{gr:l-1,gc:i-1,pt:ie},{gr:l-1,gc:i,pt:le},{gr:l,gc:i-1,pt:le},{gr:l,gc:i,pt:ie}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let u=0;const d=[];for(const n of c){const r=e[n.gr]?.[n.gc];0===r?d.push(n):r===n.pt&&u++}if(u>a)return"contradiction";if(u+d.length<a)return"contradiction";if(u===a&&d.length>0){for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!on(e,o,n,r,l===le?ie:le,t))return"contradiction";s=!0}}else if(u+d.length===a&&d.length>0)for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!on(e,o,n,r,l,t))return"contradiction";s=!0}}if(!s){for(let n=0;n<r;n++)for(let r=0;r<t;r++){const l=e[n];if(0!==l?.[r])continue;const i=de(n,r+1,t),a=de(n+1,r,t),c=o.connected(i,a),u=de(n,r,t),d=de(n+1,r+1,t),f=o.connected(u,d);if(c&&f)return"contradiction";c?(l[r]=ie,s=!0,o.union(u,d)):f&&(l[r]=le,s=!0,o.union(i,a))}if(!s)for(let l=0;l<r;l++)for(let i=0;i<t;i++){const a=e[l];if(0!==a?.[i])continue;let c=!1,u=!1;const d=[{nr:l,nc:i,touchedBy:ie},{nr:l,nc:i+1,touchedBy:le},{nr:l+1,nc:i,touchedBy:le},{nr:l+1,nc:i+1,touchedBy:ie}];for(const{nr:o,nc:s,touchedBy:l}of d){const i=n[o]?.[s];if(null==i)continue;const a=[{gr:o-1,gc:s-1,pt:ie},{gr:o-1,gc:s,pt:le},{gr:o,gc:s-1,pt:le},{gr:o,gc:s,pt:ie}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let d=0,f=0;for(const n of a){const r=e[n.gr]?.[n.gc];0===r?f++:r===n.pt&&d++}l===le?(d+1>i&&(c=!0),d+(f-1)<i&&(u=!0)):(d+1>i&&(u=!0),d+(f-1)<i&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!on(e,o,l,i,ie,t))return"contradiction";s=!0}else if(u){if(!on(e,o,l,i,le,t))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(t,e,n,r,o);return"contradiction"!==s&&("solved"===s&&function(e,n,r,t){const o=Pe(e,r,t);for(let s=0;s<=r;s++)for(let e=0;e<=t;e++){const r=n[s]?.[e];if(null!=r&&o[s]?.[e]!==r)return!1}return!0}(t,e,n,r))}function ln(e,n){let r=[],t=!1;for(let s=0;s<50&&!t;s++){r=Array.from({length:e},()=>new Array(n).fill(0));const o=new ue((e+1)*(n+1)),s=[];for(let r=0;r<e;r++)for(let e=0;e<n;e++)s.push({r:r,c:e});for(let e=s.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1)),r=s[e],t=s[n];r&&t&&(s[e]=t,s[n]=r)}let l=!1;for(const{r:e,c:t}of s){const s=de(e,t+1,n),i=de(e+1,t,n),a=o.connected(s,i),c=de(e,t,n),u=de(e+1,t+1,n),d=o.connected(c,u);if(a&&d){l=!0;break}const f=r[e];f&&(a?(f[t]=ie,o.union(c,u)):d||Math.random()<.5?(f[t]=le,o.union(s,i)):(f[t]=ie,o.union(c,u)))}l||(t=!0)}t||(r=Array.from({length:e},(e,r)=>new Array(n).fill(r%2==0?le:ie)));const o=function(e,n,r,t){const o=e.map(e=>[...e]),s=[];for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)s.push({r:a,c:e});for(let a=s.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1)),n=s[a],r=s[e];n&&r&&(s[a]=r,s[e]=n)}const l=Math.floor((n+1)*(r+1)*t);let i=0;for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)null!==o[a]?.[e]&&i++;for(const{r:a,c:c}of s){if(i<=l)break;const e=o[a];if(!e)continue;const t=e[c];null!=t&&(e[c]=null,sn(o,n,r)?i--:e[c]=t)}return o}(Pe(r,e,n).map(e=>e.map(e=>e)),e,n,re);return{numbers:o,solution:r}}const an=y({getInitialState:un,customHandler:(e,n)=>{if("reset"===n.type)return{...e,grid:Array.from({length:e.rows},()=>new Array(e.cols).fill(0)),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set};if("applyAnalysis"===n.type){if(!n.moves)return e;const r=Array.from({length:e.rows},()=>new Array(e.cols).fill(0));return n.moves.forEach((e,n)=>{const[t,o]=n.split(",").map(Number);if(void 0!==t&&void 0!==o){const n=r[t];void 0!==n&&(n[o]=e)}}),{...e,...cn(r,e.numbers,e.rows,e.cols),grid:r}}if("toggle"!==n.type)return null;if(e.solved)return e;const{row:r,col:t}=n;if(void 0===r||void 0===t)return e;const o=e.grid.map(e=>[...e]),s=o[r];if(!s)return e;const l=s[t];return void 0===l?e:(n.reverse?s[t]=0===l?le:l===le?ie:0:s[t]=0===l?ie:l===ie?le:0,{...e,...cn(o,e.numbers,e.rows,e.cols),grid:o})}});function cn(e,n,r,t){let o=!1;if(e.every(e=>e.every(e=>0!==e))){const s=Pe(e,r,t);n.every((e,n)=>e.every((e,r)=>null==e||e===s[n]?.[r]))&&!function(e,n,r){const t=new ue((n+1)*(r+1));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const s=n[e];if(void 0===s||0===s)continue;const l=de(o,s===le?e+1:e,r),i=de(o+1,s===le?e:e+1,r);if(!t.union(l,i))return!0}}return!1}(e,r,t)&&(o=!0)}const l=function(e,n,r,t){const o=new Set,l=Pe(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;const u=l[i]?.[a]??0;u>c?o.add(s(i,a)):u+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:n,gc:o})=>n>=0&&n<r&&o>=0&&o<t&&0===e[n]?.[o]).length<c&&o.add(s(i,a))}return o}(e,n,r,t);return{solved:o,errorNodes:l,cycleCells:fe(e,r,t),satisfiedNodes:ze(e,n,r,t)}}function un(e,n){const{numbers:r,solution:t}=ln(e,n);return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:m(e),cols:m(n),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function dn(){const e=K("sm"),[t,o]=n.useState(!1),{isOpen:c,toggle:u}=x(),d=r.useRef(null),f=r.useRef({rows:0,cols:0}),p=r.useCallback((e,n,r)=>{t||function(e,n,r){const t=qe(n,r);try{localStorage.setItem(t,JSON.stringify(Ue(e)))}catch{}}(e,n,r)},[t]),{generating:h,requestGeneration:y,handleNextAsync:m,prefetch:v,cancelGeneration:A}=Fe({getInitialState:un,dispatchRef:d,dimsRef:f,onStaleResult:p}),{rows:w,cols:C,state:k,dispatch:j,size:I,controlsProps:N}=b({...Ge(e),logic:{reducer:an,getInitialState:(e,n)=>un(e,n),onNext:m,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!t,serialize:Ue,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const n=e;return Array.isArray(n.grid)&&Array.isArray(n.numbers)&&Array.isArray(n.solution)&&"number"==typeof n.rows&&"number"==typeof n.cols&&"boolean"==typeof n.solved&&Array.isArray(n.errorNodes)&&Array.isArray(n.cycleCells)&&Array.isArray(n.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});d.current=j,f.current={rows:w,cols:C};const{analysisMoves:E,boardSx:M,handleAnalysisMove:R,handleAnalysisCopy:T,handleAnalysisClear:O,handleAnalysisClose:P,handleAnalysisApply:z,handleBoxClick:L,handleOpenAnalysis:$}=function({isAnalysisMode:e,setIsAnalysisMode:n,state:t,rows:o,cols:l,storageKey:i,toggleInfo:a,dispatch:c}){const[u,d]=r.useState(new Map);g({storageKey:i,rows:o,cols:l,state:u,onRestore:e=>{d(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const f=r.useRef("");r.useEffect(()=>{const e=JSON.stringify(t.numbers);f.current&&f.current!==e&&d(new Map),f.current=e},[t.numbers,t.rows,t.cols]);const p=r.useCallback((e,n)=>{d(r=>{const t=new Map(r);return void 0===n?t.delete(e):t.set(e,n),t})},[]),h=r.useCallback(()=>{const e=new Map;t.grid.forEach((n,r)=>{n.forEach((n,t)=>{0!==n&&e.set(s(r,t),n)})}),d(e)},[t.grid]),y=r.useCallback(()=>{d(new Map)},[]),m=r.useCallback(()=>{n(!1)},[n]),x=r.useCallback(e=>{c({type:"applyAnalysis",moves:e??u}),m()},[c,u,m]),b=r.useCallback(e=>{e.stopPropagation()},[]),S=r.useMemo(()=>e?{padding:{xs:0,sm:0},border:"none"}:void 0,[e]),v=r.useCallback(()=>{a(),n(!0)},[a,n]);return{analysisMoves:u,boardSx:S,handleAnalysisMove:p,handleAnalysisCopy:h,handleAnalysisClear:y,handleAnalysisClose:m,handleAnalysisApply:x,handleBoxClick:b,handleOpenAnalysis:v}}({isAnalysisMode:t,setIsAnalysisMode:o,state:k,rows:w,cols:C,storageKey:ne.ANALYSIS_MOVES,toggleInfo:u,dispatch:j});Ke({rows:w,cols:C,isAnalysisMode:t,requestGeneration:y,cancelGeneration:A}),r.useEffect(()=>{k.solved&&!t&&v(w,C)},[k.solved,t,w,C,v]);const{handleKeyDown:D}=a({rows:w,cols:C}),{getDragProps:B}=l({onToggle:(e,n,r)=>{j({type:"toggle",row:S(e),col:S(n),reverse:r})},checkEnabled:()=>!k.solved,touchTimeout:i.timing.touchHoldDelay}),H=r.useCallback(e=>{const n=B(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),D(e)}}},[B,D]);return tn({game:{state:k,rows:w,cols:C,size:I,mobile:e,isAnalysisMode:t,generating:h,handleNextAsync:m},analysis:{analysisMoves:E,handleAnalysisMove:R,handleAnalysisCopy:T,handleAnalysisClear:O,handleAnalysisClose:P,handleAnalysisApply:z,handleBoxClick:L,handleOpenAnalysis:$,boardSx:M},info:{infoOpen:c,toggleInfo:u},controls:N,getDragProps:H})}function fn(){const{boardProps:n,controlsProps:r,layoutProps:t,infoProps:o,trophyProps:s}=dn();return e.jsxs(v,{title:q.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",controls:e.jsx(A,{...r}),trophyProps:s,layout:{paddingBottom:{xs:"120px",md:"150px"},contentSx:t.contentSx,boardSx:t.boardSx},onClick:n.isAnalysisMode?n.onAnalysisClose:void 0,children:[e.jsx(C,{onClick:o.handleBoxClick,children:e.jsx(ye,{...n})}),e.jsx(Ye,{...o})]})}export{fn as Slant};
