import{a as e,j as t,r as o}from"./vendor_react-DdkxgTu-.js";import{u as r,e as n,g as s,j as i,C as a,c as l,a as c,d,l as u,f,G as p,h as g,k as h,i as m,B as b}from"./types-BjjN_AMF.js";import{B as x}from"./vendor_mui_core-BDo3HO1u.js";import{A as v,S as w,e as y,C as S,L as C,d as k}from"./index-B8Z8jcR1.js";import{k as E,D as j,f as z,P as I}from"./vendor_mui_icons-D_gaIqb2.js";import"./PageLayout-DcK0FnR8.js";const R="30px",N="36px",M="130%",T="6px",$="24px",B=100,D=1e3,H=1200,_=.94,O=100,A=16,L=.8,P="slant-size",W="slant-state",U="slant-ghost-moves",G=0,V=3,F=8,K=5,X={WHITE:"#fff"},J={LINE:"0 2px 4px rgba(0,0,0,0.2)",HINT:"0 4px 8px rgba(0,0,0,0.1)"},q={BORDER:"var(--slant-ghost-border)",BG_SUBTLE:"var(--slant-ghost-bg-subtle)",BG_HOVER:"var(--slant-ghost-bg-hover)",DASHED_BORDER:"var(--slant-ghost-dashed-border)",HINT_BG:"var(--slant-ghost-hint-bg)",HINT_BORDER:"var(--slant-ghost-hint-border)",HINT_TEXT:"var(--slant-ghost-hint-text)"},Q=1,Y=2,Z=e.memo(function({value:e,color:o}){return t.jsxs(x,{sx:{width:"100%",height:"100%",position:"relative"},children:[e===Q&&t.jsx(x,{sx:{position:"absolute",width:M,height:T,backgroundColor:o,borderRadius:w.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:J.LINE,transition:v.transition,pointerEvents:"none"}}),e===Y&&t.jsx(x,{sx:{position:"absolute",width:M,height:T,backgroundColor:o,borderRadius:w.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:J.LINE,transition:v.transition,pointerEvents:"none"}})]})}),ee=({onCopy:e,onClear:o,onClose:r})=>t.jsxs(x,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:C.zIndex.base+5,paddingBottom:2},children:[t.jsx(y,{title:"Copy Board",Icon:E,onClick:e,sx:{backgroundColor:S.interactive.selected,color:S.primary.main,"&:hover":{backgroundColor:S.interactive.focus}}}),t.jsx(y,{title:"Clear Calculator",Icon:j,onClick:o,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:S.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),t.jsx(y,{title:"Close Calculator",Icon:z,onClick:r,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:S.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]}),te=e.memo(function({value:e,hasConflict:o,numberSize:r}){return t.jsx(x,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:o?X.WHITE:q.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:o?"scale(1.1)":"scale(1)"},children:e??""})});const oe=({rows:l,cols:c,numbers:d,size:u,initialMoves:f,onMove:p,onCopy:g,onClear:h,onClose:m})=>{const b=r("sm"),v=f,{getDragProps:w}=n({onToggle:(e,t,o,r,n)=>{const i=s(e,t);if(!n)return void p(i,r);const a=v.get(i);let l;return l=o?a===Q?Y:a===Y?void 0:Q:a===Y?Q:a===Q?void 0:Y,p(i,l),l},touchTimeout:i.timing.touchHoldDelay,checkEnabled:()=>!0}),[y,k]=o.useState(new Map),[E,j]=o.useState([]),[z,I]=o.useState(new Set),M=e.useRef(null);o.useEffect(()=>{const e=new Worker(new URL("/assets/solverWorker-DIt_r7Wi.js",import.meta.url),{type:"module"});return M.current=e,e.onmessage=e=>{const t=e.data;if("RESULT"===t.type){const{gridState:e,conflicts:o,cycleCells:r}=t.payload;k(e),j(o),I(r)}},()=>{e.terminate()}},[]),o.useEffect(()=>{M.current&&M.current.postMessage({type:"SOLVE",payload:{rows:l,cols:c,numbers:d,userMoves:v}})},[v,d,l,c]);const T=.4*u,B=u-T,D=o.useMemo(()=>new Set(E.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[E]),H=o.useMemo(()=>new Set(E.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[E]),_=o.useCallback((e,o)=>{const r=s(e,o),n=y.get(r),i=n?.state??0,a=n?.source,l=D.has(r),c=z.has(r),d=w(r);let u=S.text.primary;return l?u=S.data.red:c?u="user"===a?S.data.red:"#ff9800":"user"===a?u=S.primary.main:"propagated"===a&&(u=S.data.green),{...d,"data-pos":r,"data-type":"cell",sx:{...d.sx,cursor:"pointer",border:`1px solid ${q.BORDER}`,position:"relative",backgroundColor:q.BG_SUBTLE,"&:hover":{backgroundColor:q.BG_HOVER}},children:t.jsx(Z,{value:i,color:u})}},[y,D,z,w]),O=o.useCallback((e,o)=>{const r=d[e]?.[o],n=H.has(s(e,o));return{"data-pos":s(e,o),"data-type":"hint",children:t.jsx(te,{value:r??null,hasConflict:n,numberSize:T}),sx:{borderRadius:"50%",backgroundColor:n?S.data.red:q.HINT_BG,border:null==r?"none":`2px solid ${n?S.data.red:q.HINT_BORDER}`,zIndex:5,opacity:null==r?0:1,position:"relative",pointerEvents:"none"}}},[d,H,T]);return t.jsxs(x,{sx:{position:"relative",userSelect:"none"},children:[t.jsxs(x,{sx:{position:"relative",padding:b?R:N,border:`2px dashed ${q.DASHED_BORDER}`,borderRadius:$},children:[t.jsx(x,{sx:{position:"relative",zIndex:C.zIndex.base+1},children:t.jsx(a,{size:u,rows:l,cols:c,cellProps:_,space:0,sx:{width:"fit-content"}})}),t.jsx(x,{sx:{position:"absolute",top:b?R:N,left:b?R:N,transform:`translate(-${String(T/2)}rem, -${String(T/2)}rem)`,zIndex:C.zIndex.base+2,pointerEvents:"none"},children:t.jsx(a,{size:T,rows:l+1,cols:c+1,cellProps:O,space:B,sx:{width:"fit-content"}})})]}),t.jsx(ee,{onCopy:g,onClear:h,onClose:m})]})};class re{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error(`DSU: Index ${String(e)} out of bounds`);t!==e&&(this.parent[e]=this.find(t));const o=this.parent[e];if(void 0===o)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return o}union(e,t){const o=this.find(e),r=this.find(t);return o!==r&&(this.parent[o]=r,!0)}connected(e,t){return this.find(e)===this.find(t)}}function ne(e,t,o){return e*(o+1)+t}function se(e,t,o){const r=Array.from({length:t+1},()=>new Array(o+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const o=t[e];if(o===Q){const t=r[n];if(t){const o=t[e+1];void 0!==o&&(t[e+1]=o+1)}const o=r[n+1];if(o){const t=o[e];void 0!==t&&(o[e]=t+1)}}else if(o===Y){const t=r[n];if(t){const o=t[e];void 0!==o&&(t[e]=o+1)}const o=r[n+1];if(o){const t=o[e+1];void 0!==t&&(o[e+1]=t+1)}}}}return r}function ie(e,t,o){const r=Array.from({length:t},()=>new Array(o).fill(0)),n=new re((t+1)*(o+1));let s=!0;for(;s;){s=!1;for(let i=0;i<=t;i++)for(let a=0;a<=o;a++){const l=e[i]?.[a];if(null==l)continue;const c=[{gr:i-1,gc:a-1,pt:Y},{gr:i-1,gc:a,pt:Q},{gr:i,gc:a-1,pt:Q},{gr:i,gc:a,pt:Y}].filter(({gr:e,gc:r})=>e>=0&&e<t&&r>=0&&r<o);let d=0;const u=[];for(const e of c){const t=r[e.gr]?.[e.gc];0===t?u.push(e):t===e.pt&&d++}if(d===l&&u.length>0)for(const{gr:e,gc:t,pt:i}of u){const a=r[e];if(0===a?.[t]){const r=i===Q?Y:Q;a[t]=r,s=!0;const l=ne(e,r===Q?t+1:t,o),c=ne(e+1,r===Q?t:t+1,o);if(n.connected(l,c))return!1;n.union(l,c)}}else if(d+u.length===l&&u.length>0)for(const{gr:e,gc:t,pt:i}of u){const a=r[e];if(0===a?.[t]){a[t]=i,s=!0;const r=ne(e,i===Q?t+1:t,o),l=ne(e+1,i===Q?t:t+1,o);if(n.connected(r,l))return!1;n.union(r,l)}}}if(!s)for(let e=0;e<t;e++)for(let t=0;t<o;t++){const i=r[e];if(0!==i?.[t])continue;const a=ne(e,t+1,o),l=ne(e+1,t,o),c=n.connected(a,l),d=ne(e,t,o),u=ne(e+1,t+1,o),f=n.connected(d,u);if(c&&f)return!1;c?(i[t]=Y,s=!0,n.union(d,u)):f&&(i[t]=Q,s=!0,n.union(a,l))}}if(!r.every(e=>e.every(e=>0!==e)))return!1;const i=se(r,t,o);for(let a=0;a<=t;a++)for(let t=0;t<=o;t++){const o=e[a]?.[t];if(null!=o&&i[a]?.[t]!==o)return!1}return!0}function ae(e,t){let o=[],r=!1;for(let s=0;s<50&&!r;s++){o=Array.from({length:e},()=>new Array(t).fill(0));const n=new re((e+1)*(t+1)),s=[];for(let o=0;o<e;o++)for(let e=0;e<t;e++)s.push({r:o,c:e});for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1)),o=s[e],r=s[t];o&&r&&(s[e]=r,s[t]=o)}let i=!1;for(const{r:e,c:r}of s){const s=ne(e,r+1,t),a=ne(e+1,r,t),l=n.connected(s,a),c=ne(e,r,t),d=ne(e+1,r+1,t),u=n.connected(c,d);if(l&&u){i=!0;break}const f=o[e];f&&(l?(f[r]=Y,n.union(c,d)):u||Math.random()<.5?(f[r]=Q,n.union(s,a)):(f[r]=Y,n.union(c,d)))}i||(r=!0)}r||(o=Array.from({length:e},(e,o)=>new Array(t).fill(o%2==0?Q:Y)));const n=function(e,t,o,r){const n=e.map(e=>[...e]),s=[];for(let l=0;l<=t;l++)for(let e=0;e<=o;e++)s.push({r:l,c:e});for(let l=s.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1)),t=s[l],o=s[e];t&&o&&(s[l]=o,s[e]=t)}const i=Math.floor((t+1)*(o+1)*r);let a=0;for(let l=0;l<=t;l++)for(let e=0;e<=o;e++)null!==n[l]?.[e]&&a++;for(const{r:l,c:c}of s){if(a<=i)break;const e=n[l];if(!e)continue;const r=e[c];null!=r&&(e[c]=null,ie(n,t,o)?a--:e[c]=r)}return n}(se(o,e,t).map(e=>e.map(e=>e)),e,t,G);return{numbers:n,solution:o}}const le=l({getInitialState:ce,customHandler:(e,t)=>{if("toggle"===t.type){if(e.solved)return e;const{row:o,col:r}=t,n=e.grid.map(e=>[...e]),i=n[o];if(!i)return e;const a=i[r];if(void 0===a)return e;t.reverse?i[r]=0===a?Q:a===Q?Y:0:i[r]=0===a?Y:a===Y?Q:0;let l=!1;if(n.every(e=>e.every(e=>0!==e))){const t=se(n,e.rows,e.cols);e.numbers.every((e,o)=>e.every((e,r)=>null==e||e===t[o]?.[r]))&&!function(e,t,o){const r=new re((t+1)*(o+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<o;e++){const s=t[e];if(void 0===s||0===s)continue;const i=ne(n,s===Q?e+1:e,o),a=ne(n+1,s===Q?e:e+1,o);if(!r.union(i,a))return!0}}return!1}(n,e.rows,e.cols)&&(l=!0)}const c=function(e,t,o,r){const n=new Set,i=se(e,o,r);for(let a=0;a<=o;a++)for(let l=0;l<=r;l++){const c=t[a]?.[l];if(null==c)continue;const d=i[a]?.[l]??0;d>c?n.add(s(a,l)):d+[{gr:a-1,gc:l-1},{gr:a-1,gc:l},{gr:a,gc:l-1},{gr:a,gc:l}].filter(({gr:t,gc:n})=>t>=0&&t<o&&n>=0&&n<r&&0===e[t]?.[n]).length<c&&n.add(s(a,l))}return n}(n,e.numbers,e.rows,e.cols),d=function(e,t,o){const r=new Map,n=new Set;for(let s=0;s<t;s++)for(let t=0;t<o;t++){const n=e[s]?.[t];if(!n||0===n)continue;const i=ne(s,n===Q?t+1:t,o),a=ne(s+1,n===Q?t:t+1,o);r.has(i)||r.set(i,[]),r.has(a)||r.set(a,[]),r.get(i)?.push({node:a,r:s,c:t}),r.get(a)?.push({node:i,r:s,c:t})}const i=new Set,a=new Set,l=[],c=(e,t)=>{i.add(e),a.add(e);const o=r.get(e)??[];for(const{node:r,r:d,c:u}of o)if(r!==t)if(a.has(r)){n.add(s(d,u));for(let e=l.length-1;e>=0;e--){const t=l[e];if(!t)break;if(n.add(s(t.r,t.c)),t.u===r||t.v===r)break}}else i.has(r)||(l.push({r:d,c:u,u:e,v:r}),c(r,e),l.pop());a.delete(e)};for(const s of r.keys())i.has(s)||c(s,-1);return n}(n,e.rows,e.cols),u=function(e,t,o,r){const n=new Set,i=se(e,o,r);for(let a=0;a<=o;a++)for(let e=0;e<=r;e++){const o=t[a]?.[e];null!=o&&((i[a]?.[e]??0)===o&&n.add(s(a,e)))}return n}(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:l,errorNodes:c,cycleCells:d,satisfiedNodes:u}}return e}});function ce(e,t){const{numbers:o,solution:r}=ae(e,t);return{grid:Array.from({length:e},()=>new Array(t).fill(0)),numbers:o,solution:r,rows:c(e),cols:c(t),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}const de=(e,o,r)=>(n,i)=>{const a=o.grid[n]?.[i],l=s(n,i),c=o.cycleCells.has(l),d=e(l),u=[{v:o.numbers[n]?.[i],p:s(n,i)},{v:o.numbers[n]?.[i+1],p:s(n,i+1)},{v:o.numbers[n+1]?.[i],p:s(n+1,i)},{v:o.numbers[n+1]?.[i+1],p:s(n+1,i+1)}].map(({v:e,p:t})=>{if(null==e)return"-";const r=o.errorNodes.has(t)?"Error":o.satisfiedNodes.has(t)?"Ok":"Pending";return`${String(e)} (${r})`});return{...d,"aria-label":`Cell ${String(n+1)}, ${String(i+1)}. Clues: ${u.join(", ")}. ${0===a?"Empty":a===Q?"Forward Slash":"Backward Slash"}${c?", Loop Error":""}`,sx:{...d.sx,cursor:"pointer",border:`1px solid ${S.border.subtle}`,position:"relative","&:hover":{backgroundColor:S.interactive.hover}},children:t.jsxs(x,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===Q&&t.jsx(x,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:c?S.data.red:S.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:J.LINE,transition:v.transition,pointerEvents:"none"}}),a===Y&&t.jsx(x,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:c?S.data.red:S.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:J.LINE,transition:v.transition,pointerEvents:"none"}})]})}};function ue(){const e=r("sm"),[a,l]=o.useState(!1),{rows:c,cols:v,state:w,dispatch:C,size:E,handleNext:j,controlsProps:z}=d({storageKeys:{size:P,state:W},pageTitle:k.slant,gridConfig:{defaultSize:K,minSize:V,maxSize:F,headerOffset:i.layout.headerHeight,paddingOffset:{x:e?48:80,y:120},widthLimit:D,cellSizeReference:4,mobileRowOffset:2},boardConfig:{paddingOffset:e=>({x:e?48:80,y:B}),boardMaxWidth:H,boardSizeFactor:e?.92:_,maxCellSize:O,remBase:A,rowOffset:1,colOffset:1},reducer:le,getInitialState:(e,t)=>ce(e,t),winAnimationDelay:i.timing.winAnimationDelay,isSolved:e=>e.solved,persistence:{enabled:!a,serialize:e=>({...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}),deserialize:e=>{const t=e;return{...t,errorNodes:new Set(t.errorNodes),cycleCells:new Set(t.cycleCells),satisfiedNodes:new Set(t.satisfiedNodes)}}}}),[M,T]=o.useState(new Map);u({storageKey:U,rows:c,cols:v,state:M,onRestore:e=>{T(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const G=o.useRef("");o.useEffect(()=>{const e=JSON.stringify(w.numbers);G.current&&G.current!==e&&T(new Map),G.current=e},[w.numbers,w.rows,w.cols]);const q=j,{getDragProps:Q}=n({onToggle:(e,t,o)=>{C({type:"toggle",row:h(e),col:h(t),reverse:o})},checkEnabled:()=>!w.solved,touchTimeout:i.timing.touchHoldDelay}),Y=.4*E,Z=f(de,Q,[w,E]),ee=o.useMemo(()=>((e,o)=>(r,n)=>{const i=e.numbers[r]?.[n],a=s(r,n),l=e.errorNodes.has(a),c=e.satisfiedNodes.has(a);return{sx:{pointerEvents:"none"},children:t.jsx(x,{sx:{borderRadius:"50%",backgroundColor:l?S.data.red:S.surface.background,border:null==i?"none":`2px solid ${l?S.data.red:c?"transparent":S.border.subtle}`,fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:l?X.WHITE:c?S.interactive.disabledText:S.text.primary,boxShadow:c&&!l?"none":J.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:l?"scale(1.1)":"scale(1)",width:`${String(o)}rem`,height:`${String(o)}rem`},children:i??""})}})(w,Y),[w,Y]),te=o.useCallback((e,t)=>{T(o=>{const r=new Map(o);return void 0===t?r.delete(e):r.set(e,t),r})},[]),re=o.useCallback(()=>{const e=new Map;w.grid.forEach((t,o)=>{t.forEach((t,r)=>{0!==t&&e.set(s(o,r),t)})}),T(e)},[w.grid]),ne=o.useCallback(()=>{T(new Map)},[]),se=o.useCallback(()=>{l(!1)},[]),ie=o.useCallback(e=>{e.stopPropagation()},[]),ae=o.useMemo(()=>({padding:e?"1rem":"2rem"}),[e]),ue=o.useMemo(()=>({userSelect:"none",padding:a?0:e?R:N,border:"2px solid transparent",borderRadius:$}),[e,a]),fe=a?null:t.jsx(m,{...z,disabled:a,children:t.jsx(y,{title:"Open Calculator",Icon:I,onClick:()=>{l(!a)},sx:{color:"default"}})}),pe=a?t.jsx(oe,{rows:c,cols:v,numbers:w.numbers,size:E,initialMoves:M,onMove:te,onCopy:re,onClear:ne,onClose:se}):t.jsx(b,{size:E,rows:c+1,cols:v+1,frontProps:ee,backProps:Z,frontLayerSx:{pointerEvents:"none"}});return t.jsx(p,{children:t.jsx(g,{title:k.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"120px",md:"150px"},controls:fe,contentSx:ae,showTrophy:!a&&w.solved,onReset:q,boardSize:E,iconSizeRatio:L,primaryColor:S.primary.main,secondaryColor:S.primary.main,boardSx:ue,onClick:()=>{a&&l(!1)},children:t.jsx(x,{onClick:ie,children:pe})})})}export{ue as default};
