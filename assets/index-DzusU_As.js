import{r as e,a as t,j as o}from"./vendor_react-WaSaIrII.js";import{d as r,a as s,C as n,e as a,f as i,L as l}from"./index-PgVqZJ7R.js";import{g as c,a as u,u as f,C as h,G as d}from"./CustomGrid-Bwc_yz7i.js";import{u as m,G as p}from"./gameConfig-CQ15qQC4.js";import{G as g}from"./GlobalHeader-9uzj782c.js";import{u as b,a as w}from"./useTimer-DNifX3C9.js";import{F as y}from"./vendor_mui_icons-3bcSiizW.js";import{G as k,k as v}from"./vendor_mui_core-nu70VYgB.js";function x(e){return Math.floor(Math.random()*e)}function j(e,t){const o={};for(const r in e){const s=e[r];s+t>0?o[r]=s+t:s<0&&(o[r]=s)}return o}function S(e,t,o){const r=t*o,s=x(r);let n=x(r);return s===n&&(n=++n%r),{...e,rows:t,cols:o,head:s,board:{[s]:e.length,[n]:-1}}}function M(e){let{board:t,length:o,head:r,velocity:s,buffer:n}=e;const{rows:a,cols:i}=e,l=a*i;t=j(t,-1);const c=u(r,s,a,i);if(t[c]&&t[c]>0){const e=[-2,2,-1,1],o=[];for(const n of e){if(n===-s||n===s)continue;const e=u(r,n,a,i);(void 0===t[e]||t[e]<0)&&o.push(n)}o.length>0&&(s=o[Math.floor(Math.random()*o.length)])}if(r=u(r,s,a,i),r in t){const e=t[r];t[r]=o,e>0?t=j(t,-e):(t=j(t,1),t=function(e,t){let o=x(e);for(;o in t;)++o>=e&&(o=0);return{...t,[o]:-1}}(l,t)),o=t[r]}else t[r]=o;if(n.length){const[e,...t]=n;n=t,s+e&&(s=e)}return{...e,length:o,board:t,head:r,velocity:s,buffer:n}}function C(e,t){switch(t.type){case"resize":{const{rows:o,cols:r}=t.payload;return S(e,o,r)}case"steer":{const{payload:o}=t,r=c(o.key);let{buffer:s}=e;if(["NorthWest","NorthEast","SouthWest","SouthEast"].includes(o.key)){const t=o.key,r=-2,n=2,a=-1,i=1;let l=0,c=0;"NorthWest"===t?(l=r,c=a):"NorthEast"===t?(l=r,c=i):"SouthWest"===t?(l=n,c=a):"SouthEast"===t&&(l=n,c=i);const u=s.length>0?s[s.length-1]:e.velocity;2===Math.abs(u)?(u===l||u===-l)&&(s=[...s,c,l]):(u===c||u===-c)&&(s=[...s,l,c]),0===u&&(s=[...s,l])}else r&&(s=[...s,r]);return{...e,buffer:s}}case"move":return M(e);default:return e}}const E=v`
  0% { transform: scale(0.8) rotate(0deg); }
  50% { transform: scale(1.1) rotate(180deg); }
  100% { transform: scale(0.8) rotate(360deg); }
`;function z(){const{create:c}=b(0),{create:v}=w(),x=f("sm"),{height:j,width:M}=m(),z=p.snake.initialLength,_=x?p.gridSizes.mobile:p.gridSizes.desktop,{rows:G,cols:N}=e.useMemo(()=>{const e=x?l.headerHeight.xs:l.headerHeight.md,t=j-e,o=_*d.calculation.pixelMultiplier;return{rows:Math.floor(t/o),cols:Math.floor(M/o)}},[_,j,M,x]),W=e.useMemo(()=>({velocity:p.snake.initialVelocity,buffer:[],length:z,rows:0,cols:0,head:0,board:{}}),[z]),[A,H]=e.useReducer(C,S(W,G,N)),D=e.useCallback(e=>{const{clientX:t,clientY:o}=e,r=t-M/2,s=o-j/2,n=A.buffer.length>0?A.buffer[A.buffer.length-1]:A.velocity;let a="";a=2===Math.abs(n)?r>0?"right":"left":s>0?"down":"up";const i=p.controls.arrowPrefix+a;H({type:"steer",payload:{key:i}})},[H,A.velocity,A.buffer,M,j]),[L,P]=t.useState(!1),R=e.useCallback(e=>()=>{H({type:"steer",payload:{key:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight","up-left":"NorthWest","up-right":"NorthEast","down-left":"SouthWest","down-right":"SouthEast"}[e]||""}})},[H]),U=e.useCallback((e,t)=>{const r=e*N+t,n=A.board;let a="inherit";r in n&&(a=n[r]>0?s.primary.main:s.primary.dark);const i=u(r,-2,G,N),l=u(r,2,G,N),c=u(r,-1,G,N),f=u(r,1,G,N),h=n[r],m=e=>{const t=n[e];return void 0!==t&&-1!==t&&1===Math.abs(t-h)},p=m(i),g=m(l),b=m(c),w=m(f),k=h===A.length||1===h,v=_/d.cellSize.divisor+"rem",x=_/2.5+"rem";if("inherit"===a)return{backgroundColor:a};if(-1===h)return{backgroundColor:"transparent",children:o.jsx(y,{sx:{color:a,fontSize:.7*_+"rem",animation:`${E} 2s infinite ease-in-out`}})};const j=[0,0,0,0];p||b||(j[0]=1),p||w||(j[1]=1),g||w||(j[2]=1),g||b||(j[3]=1);const S=j.map(e=>e?k?x:v:"0").join(" ");return{backgroundColor:a,boxShadow:`0 0 1.25rem ${a.replace("hsl","hsla").replace(")",", 0.25)")}`,borderRadius:S}},[A,G,N,_]);return e.useEffect(()=>{c({repeat:()=>{H({type:"move"})},speed:100}),v(e=>H({type:"steer",payload:e}))},[c,v]),e.useEffect(()=>{H({type:"resize",payload:{rows:G,cols:N}})},[G,N,H]),e.useEffect(()=>{document.title=r.snake},[]),o.jsxs(k,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:s.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[o.jsx(g,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),o.jsx(k,{flex:1,onPointerDown:D,sx:{...n.flexCenter,zIndex:1},children:o.jsx(h,{size:_,rows:G,cols:N,space:0,cellProps:(e,t)=>({...U(e,t),transition:!1})})}),o.jsx(a,{children:o.jsx(i,{show:L,setShow:P,handler:R,diagonals:!0})})]})}export{z as default};
