import{r as t,j as e,a as n}from"./vendor_react-WaSaIrII.js";import{a as o,T as s,d as r,e as i,g as l,L as c}from"./index-BUeESl4T.js";import{C as a,u,c as f}from"./CustomGrid-Dmp51-vl.js";import{B as d,G as x,d as p,M as h,h as m,I as g,e as j}from"./vendor_mui_core-3PJY_Tg4.js";import{u as y,G as b}from"./gameConfig-Bl_NC4gL.js";import{G as w}from"./GlassCard-Cv4Q1jWy.js";import{i as k,C,j as z,k as v,l as I,R as S,N as P,m as A,I as $}from"./vendor_mui_icons-GFlgYi_M.js";import{G as R}from"./GlobalHeader-CpcF8oju.js";function B(t){const{frontProps:n,backProps:o,size:s,rows:r,cols:i}=t;return e.jsxs(d,{sx:{display:"grid",placeItems:"center"},children:[e.jsx(d,{sx:{gridArea:"1/1"},children:e.jsx(a,{space:0,size:s,rows:r-1,cols:i-1,cellProps:o})}),e.jsx(d,{sx:{gridArea:"1/1",zIndex:1},children:e.jsx(a,{space:0,size:s,rows:r,cols:i,cellProps:n})})]})}function D(e,n){const o=t.useCallback((t,o)=>{const s=e(t,o);return{front:s?n.primary:n.secondary,back:s?n.secondary:n.primary}},[e,n]),s=t.useCallback((t,n)=>function(t,e,n){const o=n(t,e),s={},r=o===n(t-1,e),i=o===n(t+1,e),l=o===n(t,e-1),c=o===n(t,e+1);return(r||l)&&(s.borderTopLeftRadius=0),(r||c)&&(s.borderTopRightRadius=0),(i||l)&&(s.borderBottomLeftRadius=0),(i||c)&&(s.borderBottomRightRadius=0),s}(t,n,e),[e]),r=t.useCallback((t,o)=>{const s=function(t,e,n){const o=n(t,e),s=n(t,e+1),r=n(t+1,e),i=n(t+1,e+1);let l=!0;const c=Number(o)+Number(s)+Number(r)+Number(i);return o&&i||!(c<3)||(l=!1),l}(t,o,e);return s?n.primary:n.secondary},[e,n]);return{getColor:o,getBorder:s,getFiller:r}}function W(e,n){const{grid:o,rows:s,cols:r}=e;return D(t.useCallback((t,e)=>t<0||e<0||t>=s||e>=r?-1:o[t][e],[o,s,r]),n)}function E(t,e){return[...Array(t)].map(()=>Array(e).fill(0))}function H(t,e,n){const o=n[0].length,s=n.length,r=n.map(t=>[...t]);return r[t][e]^=1,t>0&&(r[t-1][e]^=1),t<s-1&&(r[t+1][e]^=1),e>0&&(r[t][e-1]^=1),e<o-1&&(r[t][e+1]^=1),r}function M(t){const e=t.flat();return!e.includes(1)||!e.includes(0)}function T(t,e){let n=E(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++){Math.random()>.5&&(n=H(o,t,n))}return n}const _={};function F(t){const e=t.length,n=t[0].length;for(let s=0;s<e-1;s++)for(let e=0;e<n;e++)if(1===t[s][e])return[{row:s+1,col:e}];const o=t[e-1];if(o.some(t=>1===t)){const t=function(t,e,n){const o=`${t},${e}`;if(!_[o]){const n={},s=1<<e;for(let o=0;o<s;o++){let s=E(t,e);const r=[];for(let t=0;t<e;t++)o>>t&1&&(s=H(0,t,s),r.push(t));for(let n=0;n<t-1;n++)for(let t=0;t<e;t++)1===s[n][t]&&(s=H(n+1,t,s));const i=s[t-1].join("");n[i]||(n[i]=r)}_[o]=n}const s=n.join("");return _[o][s]||null}(e,n,o);if(t&&t.length>0)return t.map(t=>({row:0,col:t}))}return null}function G(t,e){const{type:n,row:o,col:s,moves:r}=e;let{grid:i,score:l,rows:c,cols:a,auto:u}=t;switch(n){case"auto":u=!u;break;case"adjacent":void 0!==o&&void 0!==s&&(i=H(o,s,i),M(i)&&(i=T(c,a),l+=1));break;case"multi_adjacent":r&&(r.forEach(t=>{i=H(t.row,t.col,i)}),M(i)&&(i=T(c,a),l+=1));break;case"random":case"randomize":i=T(c,a),u=!1;break;case"resize":{const{newRows:t,newCols:n}=e;void 0!==t&&void 0!==n&&(c=t,a=n,i=T(c,a),u=!1);break}case"reset":i=E(c,a),l=0,u=!1}return{grid:i,score:l,rows:c,cols:a,auto:u}}function N(t){let e=0;for(;t;)t&=t-1,e++;return e}function L(t,e){const n=t.length,o=[];for(let s=0;s<n;s++){const r=t[s];let i=0;for(let t=0;t<n;t++){i<<=1,i+=1&N(r&e[t])}o.push(i)}return o}function O(t){const e=Array(t).fill(1);for(let n=0;n<t;n++)e[n]<<=t-n-1;return e}function Y(t,e){let n=O(t.length);for(let o=0;o<e;o++)n=L(n,t);return n}function U(t,e){const n=t.length,o=[];for(let s=0;s<n;s++){const n=t[s]^e[s];o.push(n)}return o}function q(t,e){const n=t.length,o=[...Array(n).keys()].sort((e,n)=>t[n]-t[e]);return[o.map(e=>t[e]),o.map(t=>e[t])]}const J={};function K(t,e,n){const o=`${e},${n}`;if(!J[o]){const t=function(t){const e=[7<<t-2];for(let n=1;n<t;n++){const t=e[n-1]>>1;e.push(t)}return e[0]-=2**t,e}(n),s=function(t,e){const n=t.length;let o=Array(n).fill(0),s=0;for(;e;)1&e&&(o=U(o,Y(t,s))),e>>=1,s++;return o}(t,function(t){const e=[0,1];for(let n=1;n<t;n++){const t=e[n],o=e[n-1],s=t<<1;e.push(s^o)}return e[t]}(e+1));J[o]=function(t){const e=t.length;let n=t,o=O(e);for(let s=0;s<e;s++){const t=1<<e-s-1;[n,o]=q(n,o);for(let r=0;r<e;r++){const e=n[r];r!==s&&e&t&&(n[r]^=n[s],o[r]^=o[s])}}return o}(s)}const s=J[o],r=parseInt(t.join(""),2);return s.map(t=>1&N(t&r))}function Q(t,e){const n=[...t];let o=t.at(-1);if(!o)return n;for(let s=1;s<e;s++)for(let t=0;t<e;t++){if(!o[s-1][t])continue;const e=H(s,t,o);n.push(e),o=e}return n}function V(t,e){const n=t.at(-1);if(!n)return t;const o=[...t];for(;o.length<e;)o.push([...n]);return o}function X(t,e){let n=E(e,e);for(const x of t){n=H(Math.floor(x/e),x%e,n)}const o=Q([n],e),s=o.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const r=s.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:l}=function(t,e){const n=Array(e).fill(0),o=[n],s=[n],r=[...n];for(let i=0;i<e;i++){if(!t[i])continue;r[i]=1;const n=[...r],l=K(n,e,e);o.push(n),s.push(l)}return{input:o,output:s}}(r,e),c=o.length+i.length+1,a=l.at(-1);if(!a)return{boardStates:[],inputStates:[],outputStates:[]};let u=[...s];for(let x=0;x<c-o.length;x++)o.push([...s]);for(let x=0;x<c-i.length;x++)i.unshift([...i[0]]);for(let x=0;x<c-l.length;x++)l.unshift([...l[0]]);for(let x=0;x<e;x++)a[x]&&(u=H(0,x,u),o.push([...u]));const f=Q(o,e),d=f.length;return{boardStates:f,inputStates:V(i,d),outputStates:V(l,d)}}function Z({getColor:t,getBorder:e}){return(n,o)=>{const{front:s}=t(n,o);return{backgroundColor:s,style:e(n,o),transition:"all 200ms ease"}}}function tt(e,n,o){return D(t.useCallback((t,o)=>0!==t||o<0||o>=n?-1:e[o],[e,n]),o)}function et(t,n,o,s){return(r,i)=>{const l=function(t,e,n,o,s){const r=t.length,i={};for(let l=0;l<r+1;l++){const c=100*l/r,a=Math.floor(c);let u=0,f=s.secondary;const d=l>0&&l<=r?t[l-1]:null,x=l>0&&l<r?t[l]:null;if(d&&x){const t=H(e,n,d);let r=!0;t:for(let e=0;e<o;e++)for(let n=0;n<o;n++)if(t[e][n]!==x[e][n]){r=!1;break t}r&&(u=1,f=1===d[e][n]?s.secondary:s.primary)}i[`${a}%`]={opacity:u,color:f}}return i}(t,r,i,n,s),c=t.length,a=`${o}-icon-${r}-${i}`,u=`@keyframes ${a}`,f=`\n            ${a}\n            ${2*c}s\n            steps(1, start)\n            infinite\n        `;return{children:e.jsx(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",[u]:l,animation:f,fontSize:"120%"},children:e.jsx(k,{sx:{fontSize:"inherit"}})})}}}function nt({start:n=[],dims:s=3,size:r,palette:i,getFrontProps:l,getBackProps:c}){const[u,f]=t.useState(0);t.useEffect(()=>{const t=setInterval(()=>{f(t=>t+1)},2e3);return()=>clearInterval(t)},[]);const h=X(n,s),m=r,{boardStates:g,inputStates:j,outputStates:y}=h,b=u%j.length,w=W({grid:g[b],rows:s,cols:s},i),C=l(w),z=c(w),v=et(g,s,"board",i),I=tt(j[b],s,i),S=tt(y[b],s,i),P=Z(I),A=Z(S),$=function(t,n,o,s){return(n,r)=>{const i=t.length,l={};for(let e=0;e<i+1;e++){const n=100*e/i,o=Math.floor(n);let c=0,a=s.secondary;const u=e>0&&e<=i?t[e-1]:null,f=e>0&&e<i?t[e]:null;u&&f&&u[r]!==f[r]&&(c=1,a=1===u[r]?s.secondary:s.primary),l[`${o}%`]={opacity:c,color:a}}const c=`${o}-icon-${n}-${r}`,a=`@keyframes ${c}`,u=`\n            ${c}\n            ${2*i}s\n            steps(1, start)\n            infinite\n        `;return{children:e.jsx(d,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",[a]:l,animation:u,fontSize:"120%"},children:e.jsx(k,{sx:{fontSize:"inherit"}})})}}}(j,0,"input",i);return e.jsx(x,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:e.jsxs(x,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%"},children:[e.jsx(x,{size:6,sx:{display:"flex",justifyContent:"center"},children:e.jsx(B,{size:m,rows:s,cols:s,frontProps:(t,e)=>({...C(t,e),...v(t,e)}),backProps:z})}),e.jsxs(x,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{mb:2,textAlign:"center"},children:[e.jsx(p,{variant:"subtitle2",sx:{mb:1,color:o.text.secondary},children:"Input"}),e.jsx(a,{rows:1,cols:s,size:m,cellProps:(t,e)=>({...P(t,e),...$(t,e)}),space:0})]}),e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(a,{rows:1,cols:s,size:m,cellProps:A,space:0}),e.jsx(p,{variant:"subtitle2",sx:{mt:1,color:o.text.secondary},children:"Result"})]})]})]})})}const ot=({children:t})=>e.jsx(p,{variant:"h5",sx:{color:o.text.primary,fontWeight:s.fontWeight.bold,textAlign:"left",fontSize:s.fontSize.h2},children:t}),st=({Icon:t,title:n,text:r})=>e.jsxs(d,{sx:{px:2},children:[e.jsxs(p,{variant:"h6",sx:{color:o.text.primary,fontWeight:s.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:s.fontSize.subheading},children:[e.jsx(t,{sx:{mr:2,color:o.primary.main,fontSize:"1.75rem"}}),n]}),e.jsx(p,{variant:"body1",sx:{color:o.text.secondary,lineHeight:1.6,fontSize:s.fontSize.body,ml:6},children:r})]}),rt=["Chasing Lights","How It Works","Calculator"],it=w;function lt(n){const{rows:s,cols:r,size:i,open:l,palette:c,toggleOpen:f,getFrontProps:x,getBackProps:y}=n,b=u("md"),[w,$]=t.useState(0),[R,B]=t.useState(Array(r).fill(0));t.useEffect(()=>{B(Array(r).fill(0))},[r,c]);const D=K(R,s,r),W=tt(R,r,c),E=tt(D,r,c),H=function(t,n){const{getColor:o,getBorder:s}=t;return(t,r)=>{const{front:i,back:l}=o(t,r);return{backgroundColor:i,style:s(t,r),onClick:n(r),sx:{"&:hover":{cursor:"pointer",color:l},transition:"all 200ms ease"},color:i,children:e.jsx(k,{})}}}(W,t=>e=>{e.stopPropagation();const n=[...R];n[t]^=1,B(n)}),M=Z(E),T=()=>{f()};return e.jsx(h,{open:l,onClose:T,slots:{backdrop:m},slotProps:{backdrop:{sx:{backgroundColor:t=>"dark"===t.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)"}}},sx:{zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(d,{sx:{outline:"none",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsxs(it,{onClick:t=>t.stopPropagation(),sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[e.jsxs(d,{sx:{flex:1,overflowY:"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsx(ot,{children:rt[w]}),e.jsx(g,{onClick:T,size:"small",sx:{color:o.text.secondary},children:e.jsx(C,{})})]}),0===w&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[e.jsx(st,{Icon:z,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),e.jsx(st,{Icon:v,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),e.jsx(st,{Icon:I,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===w&&e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(nt,{dims:3,size:.7*i,start:[1,3,8],palette:c,getFrontProps:x,getBackProps:y})})}),2===w&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Input"," ",e.jsx(d,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),e.jsx(a,{space:0,rows:1,cols:r,size:i*(b?.9:.8),cellProps:H})]}),e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Solution"," ",e.jsx(d,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),e.jsx(a,{space:0,rows:1,cols:r,size:i*(b?.9:.8),cellProps:M})]}),e.jsx(d,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(j,{variant:"outlined",size:"small",startIcon:e.jsx(S,{}),onClick:()=>{B(Array(r).fill(0))},sx:{borderColor:o.border.subtle,color:o.text.secondary},children:"Clear Pattern"})})]})})]}),e.jsxs(d,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(j,{onClick:()=>{w>0&&$(w-1)},disabled:0===w,startIcon:e.jsx(P,{}),sx:{visibility:0===w?"hidden":"visible",color:o.text.primary},children:"Back"}),e.jsx(d,{sx:{display:"flex",gap:1},children:[0,1,2].map(t=>e.jsx(d,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:w===t?o.primary.main:o.interactive.disabled,transition:"background-color 0.3s"}},t))}),e.jsx(j,{onClick:()=>{w<2?$(w+1):f()},disabled:2===w,endIcon:e.jsx(A,{}),sx:{visibility:2===w?"hidden":"visible",color:o.text.primary},children:"Next"})]})]}),e.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})})}function ct(t,n){const{getColor:o,getBorder:s}=t;return(t,r)=>{const i=s(t,r),{front:l,back:c}=o(t,r);return{onClick:()=>((t,e)=>{n({type:"adjacent",row:t,col:e})})(t,r),children:e.jsx(k,{}),backgroundColor:l,color:l,style:i,sx:{"&:hover":{cursor:"pointer",color:c}}}}}function at(t){return(e,n)=>({backgroundColor:t.getFiller(e,n)})}function ut(t){const e=ct(t,()=>{});return(t,n)=>({...e(t,n),onClick:void 0,sx:void 0})}function ft(){const{height:s,width:a}=y(),p=u("sm"),h=p?b.gridSizes.mobile:b.gridSizes.desktop;let{rows:m,cols:g}=t.useMemo(()=>{const t=p?c.headerHeight.xs:c.headerHeight.md;return f(h,s-t,Math.min(a,1300))},[h,s,a,p]);m-=1,g-=1,p&&(m-=2);const j={grid:E(m,g),score:0,rows:m,cols:g,auto:!1},[w,k]=t.useReducer(G,j),[C,z]=t.useReducer(t=>!t,!1),v=t.useMemo(()=>({primary:o.primary.main,secondary:o.primary.dark}),[]);t.useEffect(()=>{document.title=r.lightsOut},[]),t.useEffect(()=>{k({type:"resize",newRows:m,newCols:g})},[m,g]);const[I,S]=n.useState([]);t.useEffect(()=>{if(!w.auto)return void(I.length>0&&S([]));const t=setTimeout(()=>{if(I.length>0){const[t,...e]=I;k({type:"adjacent",row:t.row,col:t.col}),S(e)}else{const t=F(w.grid);t&&t.length>0?1===t.length?k({type:"adjacent",row:t[0].row,col:t[0].col}):S(t):k({type:"auto"})}},300);return()=>clearTimeout(t)},[w.auto,w.grid,I]);const P=W(w,v),A=ct(P,t=>k(t)),D=at(P);return e.jsxs(x,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:o.surface.background,position:"relative"},children:[e.jsx(R,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),e.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",paddingTop:6},children:e.jsx(B,{size:h,rows:m,cols:g,frontProps:A,backProps:D})}),e.jsx(i,{handler:()=>()=>{},onAutoPlay:()=>k({type:"auto"}),autoPlayEnabled:w.auto,children:e.jsx(l,{title:"Info",Icon:$,onClick:z})}),e.jsx(lt,{rows:m,cols:g,size:h,open:C,palette:v,toggleOpen:z,getFrontProps:ut,getBackProps:at})]})}export{ft as default};
