function t(t){let n=0,o=t;if(o<0n)throw new Error("countBits called on negative bigint");for(;o>0n;)o&=o-1n,n++;return n}function n(t,n){const o=t.length,e=[];for(let i=0;i<o;i++){const r=t[i];let s=0n;if(void 0!==r)for(let t=0;t<o;t++)if(r&1n<<BigInt(o-1-t)){const o=n[t];void 0!==o&&(s^=o)}e.push(s)}return e}function o(t){const n=Array(t).fill(1n);for(let o=0;o<t;o++){const e=n[o];void 0!==e&&(n[o]=e<<BigInt(t-o-1))}return n}function e(t,e,i){let r=o(t.length),s=[...t],l=e;for(;l>0;)l%2==1&&(r=n(r,s)),s=n(s,s),l=Math.floor(l/2);return r}function i(t,n){const o=t.length,e=[];for(let i=0;i<o;i++){const o=t[i],r=n[i];if(void 0!==o&&void 0!==r){const t=o^r;e.push(t)}}return e}function r(t,n){const e=[...t],i=o(n);let r=0;for(let o=0;o<n&&r<e.length;o++){const t=1n<<BigInt(n-1-o);let s=r;for(;s<e.length;){const n=e[s];if(void 0!==n&&n&t)break;s++}if(s<e.length){const n=e[s],o=i[s],l=e[r],c=i[r];if(void 0!==n&&void 0!==o&&void 0!==l&&void 0!==c){e[r]=n,e[s]=l,i[r]=o,i[s]=c;const f=e[r]??0n,g=i[r]??0n;for(let n=0;n<e.length;n++){const o=e[n],s=i[n];n!==r&&void 0!==o&&void 0!==s&&o&t&&(e[n]=o^f,i[n]=s^g)}}r++}}const s=[];for(let o=r;o<e.length;o++){const t=i[o];void 0!==t&&s.push(t)}return s}function s(n,e,i){const s=[...n],l=o(i);let c=0;const f=[];for(let t=0;t<i&&c<s.length;t++){const n=1n<<BigInt(i-1-t);let o=c;for(;o<s.length;){const t=s[o];if(void 0!==t&&t&n)break;o++}if(o<s.length){const e=s[o],i=l[o],r=s[c],g=l[c];if(void 0!==e&&void 0!==i&&void 0!==r&&void 0!==g){s[c]=e,s[o]=r,l[c]=i,l[o]=g;const t=s[c]??0n,f=l[c]??0n;for(let o=0;o<s.length;o++){const e=s[o],i=l[o];o!==c&&void 0!==e&&void 0!==i&&e&n&&(s[o]=e^t,l[o]=i^f)}}f[c]=t,c++}}let g=0n,a=e;for(let t=0;t<c;t++){const n=f[t];if(void 0===n)continue;if(a&1n<<BigInt(i-1-n)){const n=s[t],o=l[t];void 0!==n&&void 0!==o&&(a^=n,g^=o)}}if(0n!==a)return-1n;const d=r(n,i);if(d.length>20)return g;let u=g,v=t(g);for(let o=1;o<1<<d.length;o++){let n=g;for(let t=0;t<d.length;t++)if(o>>t&1){const o=d[t];void 0!==o&&(n^=o)}const e=t(n);e<v&&(v=e,u=n)}return u}self.onmessage=t=>{const{n:n}=t.data;try{const t=n,l=n,c=function(t){if(1===t)return[1n];const n=[7n<<BigInt(t-2)];for(let e=1;e<t;e++){const t=n[e-1];if(void 0!==t){const o=t>>1n;n.push(o)}}const o=n[0];return void 0!==o&&(n[0]=o-(1n<<BigInt(t))),n}(l),f=function(t,n){const o=t.length;let r=Array(o).fill(0n),s=0,l=n;for(;l>0n;)1n&l&&(r=i(r,e(t,s))),l>>=1n,s++;return r}(c,function(t){const n=[0n,1n];for(let o=1;o<t;o++){const t=n[o],e=n[o-1];if(void 0!==t&&void 0!==e){const o=t<<1n;n.push(o^e)}}return n[t]??0n}(t+1)),g=r(f,l),a=g.length,d=l-a,u=t*l,v=u-a,h=t=>{if(t<50){return(1n<<BigInt(t)).toLocaleString()}return`2^${t.toString()}`},p=function(t,n){const e=[...t],i=o(n);let r=0;for(let o=0;o<n&&r<e.length;o++){const t=1n<<BigInt(n-1-o);let s=r;for(;s<e.length;){const n=e[s];if(void 0!==n&&n&t)break;s++}if(s<e.length){const n=e[s],o=i[s],l=e[r],c=i[r];if(void 0!==n&&void 0!==o&&void 0!==l&&void 0!==c){e[r]=n,e[s]=l,i[r]=o,i[s]=c;const f=e[r]??0n,g=i[r]??0n;for(let n=0;n<e.length;n++){const o=e[n],s=i[n];n!==r&&void 0!==o&&void 0!==s&&o&t&&(e[n]=o^f,i[n]=s^g)}}r++}}const s=[];for(let o=0;o<r;o++){const t=e[o],n=i[o];void 0!==t&&void 0!==n&&s.push({state:t,toggle:n})}return s}(f,l),S=p.length,B=S<=6&&S>0,I=[];if(B){const t=1<<S;for(let n=1;n<t;n++){let t=0n;for(let e=0;e<S;e++)if(n>>e&1){const n=p[e];n&&(t^=n.state)}const o=s(f,t,l);I.push({state:t.toString(2).padStart(l,"0"),toggle:o.toString(2).padStart(l,"0")})}I.sort((t,n)=>t.state.localeCompare(n.state))}else p.forEach(t=>{const n=s(f,t.state,l);I.push({state:t.state.toString(2).padStart(l,"0"),toggle:n.toString(2).padStart(l,"0")})});const b={rank:d,nullity:a,gridRank:v,solvablePercent:(1/Math.pow(2,a)*100).toFixed(0===a?0:2),quietPatterns:g.map(t=>t.toString(2).padStart(l,"0")),totalStates:h(u),reachableStates:h(v),imageMapping:I,isFullSubspace:B};self.postMessage({success:!0,result:b})}catch(l){self.postMessage({success:!1,error:l instanceof Error?l.message:"Unknown error occurred in worker"})}};
