import{r as e,j as t,a as n}from"./vendor_react-De-BR_RD.js";import{g as o,G as r,T as i,a as s,L as a,S as l,c,A as d,R as u,b as f,d as m,C as h,u as g}from"./index-dEupKYvb.js";import{B as p,P as x,G as b,T as S}from"./vendor_mui_core-CNzb-YrG.js";import{f as w,A as z,M as y,E as v}from"./vendor_mui_icons-B5ml2Me4.js";import{P as O,t as M}from"./PageLayout-Co0wSs8J.js";import{a as R,u as D}from"./lazyNamed-Cw3Cbi_x.js";const j=e.memo(function({size:n,children:o,...a}){const l=`${n.toString()}rem`,c=`${(n/r.cellSize.divisor).toString()}rem`,{backgroundColor:d,color:u,boxShadow:f,border:m,opacity:h,transition:g=!0,sx:x,...b}=a,S=!1===g?"none":"string"==typeof g?g:"background-color 200ms ease, color 200ms ease, opacity 200ms ease, transform 200ms ease, border-radius 200ms ease",w=e.useMemo(()=>({...s.flexCenter,borderRadius:c,height:l,width:l,fontSize:`${(n*r.cellSize.fontSizeMultiplier).toString()}rem`,fontWeight:i.fontWeight.semibold,fontFamily:"monospace"}),[c,l,n]);return t.jsx(p,{role:"gridcell",...w,...b,sx:{backgroundColor:d,color:u,boxShadow:f,border:m,opacity:h,transition:S,...x},children:o})}),E=e.memo(function({cols:n,size:o,index:r,spacing:i,cellProps:s}){return t.jsx(p,{role:"row",sx:{display:"flex",gap:i,justifyContent:"center"},children:Array.from({length:n},(t,n)=>e.createElement(j,{...s(r,n),key:`${r.toString()}_${n.toString()}`,size:o}))})}),C=e.memo(function({size:e,rows:n,cols:r,cellProps:i,space:s,sx:a,...l}){const c=o(e),d=`${(s??c).toString()}rem`;return t.jsx(p,{role:"grid","aria-label":`Grid with ${n.toString()} rows and ${r.toString()} columns`,sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:d,...a},...l,children:Array.from({length:n},(n,o)=>t.jsx(E,{index:o,cols:r,size:e,spacing:d,cellProps:i},`row_${o.toString()}`))})}),I=n.memo(function(e){const{overlayProps:n,cellProps:o,size:r,rows:i,cols:s,cellRows:l=i,cellCols:c=s,overlayLayerSx:d,cellLayerSx:u}=e,f=null!=d&&"object"==typeof d&&!Array.isArray(d)&&"pointerEvents"in d&&"none"===d.pointerEvents,m=null!=u&&"object"==typeof u&&!Array.isArray(u)&&"pointerEvents"in u&&"none"===u.pointerEvents;return t.jsxs(p,{sx:{display:"grid",placeItems:"center"},children:[t.jsx(p,{sx:{gridArea:"1/1",...u},children:t.jsx(C,{space:0,size:r,rows:l,cols:c,cellProps:o,...m?{role:"presentation","aria-hidden":!0}:{}})}),t.jsx(p,{sx:{gridArea:"1/1",zIndex:a.zIndex.base+1,...d},children:t.jsx(C,{space:0,size:r,rows:i,cols:s,cellProps:n,...f?{role:"presentation","aria-hidden":!0}:{}})})]})});function k({children:e,...n}){return t.jsx(x,{elevation:0,component:"nav",role:"navigation","aria-label":"Game controls navigation",onClick:e=>{e.stopPropagation()},sx:{transform:"translateX(-50%)",position:"absolute",bottom:l.padding.xl,left:"50%",zIndex:a.zIndex.navigation,...d.presets.glass,borderRadius:l.borderRadius.lg,boxShadow:c.lg,padding:`${l.padding.sm} ${l.padding.lg}`,...n},children:t.jsx(b,{container:!0,spacing:2,sx:{...s.flexCenter,flexWrap:"nowrap",minWidth:0},children:e})})}const P=n.memo(function({rows:e,cols:n,dynamicSize:o,minSize:r,maxSize:i,handlePlus:s,handleMinus:a,onRefresh:l,disabled:c=!1,onOpenInfo:d,hidden:m=!1,children:h}){if(m)return null;const g=Math.min(e,n)<=r,p=Math.min(e,n)>=i||Math.min(e,n)>=Math.min(o.rows,o.cols);return t.jsxs(k,{children:[t.jsx(u,{onClick:l}),t.jsx(f,{title:"Decrease Size",Icon:w,onClick:a,disabled:c||g}),t.jsx(f,{title:"Increase Size",Icon:z,onClick:s,disabled:c||p}),d&&t.jsx(f,{title:"How to Play",Icon:y,onClick:d}),h]})});function T({show:e=!1,onReset:n,size:o=0,iconSizeRatio:r=1,primaryColor:i=h.primary.main,secondaryColor:s=h.primary.main,useSecondary:a=!1,showLabel:c=!0}){const d=a?s:i;return t.jsx(p,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:e?1:0,transform:e?"scale(1)":"scale(0.5)",visibility:e?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",zIndex:10,backgroundColor:"transparent",pointerEvents:"none"},children:o>0&&t.jsxs(m,{padding:l.padding.md,sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:1.5,height:"auto",width:"auto",maxWidth:"80%"},children:[t.jsx(v,{sx:{fontSize:`${(o*r*.6).toString()}rem`,color:d,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.1))"}}),c&&t.jsx(S,{variant:"h6",sx:{color:h.text.primary,fontWeight:600,letterSpacing:"0.02em"},children:"Solved!"})]})})}const A={gridSizes:{mobile:2.5,desktop:4},timing:{winAnimationDelay:2e3,interactionDelay:500,touchHoldDelay:500},layout:{headerHeight:{mobile:64,desktop:80}}},L={PADDING:{MOBILE:"30px",DESKTOP:"36px"},BORDER_RADIUS:"24px",BORDER:"2px solid transparent",SHADOW:"0 2px 4px rgba(0,0,0,0.2)",DROP_SHADOW:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"};function $(e){return{SIZE:`${e}-size`,STATE:`${e}-state`}}const B={paddingOffset:0,boardMaxWidth:1200,boardSizeFactor:.94,maxCellSize:80,remBase:16},N={defaultSize:null,minSize:3,maxSize:10,mobileRowOffset:2,headerOffset:A.layout.headerHeight,paddingOffset:0,widthLimit:1300,cellSizeReference:{mobile:A.gridSizes.mobile,desktop:A.gridSizes.desktop}};function W({children:e,controls:n,infoUrl:o,title:r,background:i=h.surface.background,paddingBottom:s={xs:"80px",md:"120px"},contentSx:a={},trophyProps:l={},boardSx:c,onClick:d}){return t.jsxs(O,{title:r,infoUrl:o,background:i,containerSx:{height:"100vh",transition:"background 0.5s ease-in-out",cursor:d?"pointer":"inherit"},sx:{justifyContent:"center",alignItems:"center"},onClick:d,children:[t.jsx(p,{sx:[{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden",pb:s},...M(a)],children:t.jsxs(p,{sx:[{position:"relative",width:"fit-content",userSelect:"none",padding:{xs:L.PADDING.MOBILE,sm:L.PADDING.DESKTOP},borderRadius:L.BORDER_RADIUS,border:L.BORDER},...M(c)],children:[e,t.jsx(T,{...l})]})}),n]})}function _(e,t){return`${e.toString()},${t.toString()}`}function G(e){return(t,n)=>{if(e.customHandler){const o=e.customHandler(t,n);if(o!==t)return o}switch(n.type){case"resize":if("newRows"in n||"rows"in n||"cols"in n){const o=n.newRows??n.rows??t.rows,r=n.newCols??n.cols??t.cols;return o===t.rows&&r===t.cols?t:e.getInitialState(o,r)}return t;case"new":case"next":case"reset":return e.getInitialState(t.rows,t.cols);case"restore":case"hydrate":return"state"in n?n.state:t;default:return t}}}function H(t,n,o){return e.useMemo(()=>t(n,...o),[t,n,o])}const K=e=>{if(e<1||e>100)throw new Error("Invalid grid size: must be between 1 and 100");return e},F=e=>{if(e<0)throw new Error("Invalid cell index: cannot be negative");return e};function U(t){const n=e.useRef(t);return n.current=t,e.useCallback((...e)=>n.current(...e),[])}function J({checkEnabled:t=()=>!0,touchTimeout:n=500,posAttribute:o="data-pos",preventDefault:r=!0,transition:i="all 0.2s",...s}){const a=e.useRef(void 0),l=e.useRef(s.onToggle);l.current=s.onToggle;const c=void 0!==s.onToggle,d=s.onAction,u=e.useMemo(()=>!c&&d?d:(e,n,o)=>{if(!t())return;const r=l.current;if(!r)return;const[i,s]=e.split(",").map(Number);void 0!==i&&void 0!==s&&(o?a.current=r(i,s,n,void 0,!0):r(i,s,n,a.current,!1))},[c,d,t]),[f,m]=e.useState(null),h=e.useRef(new Set),g=e.useRef(0),p=e.useCallback(()=>{m(null),h.current.clear()},[]),x=e.useCallback(e=>{if(null===f)return;const t=e.touches[0];if(!t)return;const n=document.elementFromPoint(t.clientX,t.clientY);if(!n)return;const r=n.closest(`[${o}]`);if(r){const e=r.getAttribute(o);e&&!h.current.has(e)&&(u(e,2===f,!1),h.current.add(e))}},[f,u,o]);e.useEffect(()=>(globalThis.addEventListener("mouseup",p),globalThis.addEventListener("touchend",p),globalThis.addEventListener("touchcancel",p),globalThis.addEventListener("touchmove",x,{passive:!1}),()=>{globalThis.removeEventListener("mouseup",p),globalThis.removeEventListener("touchend",p),globalThis.removeEventListener("touchcancel",p),globalThis.removeEventListener("touchmove",x)}),[p,x]);const b=e.useCallback(e=>({onMouseDown:o=>{t()&&(0!==o.button&&2!==o.button||Date.now()-g.current<n||(r&&o.preventDefault(),m(o.button),u(e,2===o.button,!0),h.current.add(e)))},onMouseEnter:()=>{null!==f&&!h.current.has(e)&&t()&&(u(e,2===f,!1),h.current.add(e))},onTouchStart:n=>{t()&&(n.cancelable&&r&&n.preventDefault(),g.current=Date.now(),m(0),u(e,!1,!0),h.current.add(e))},onKeyDown:n=>{t()&&("Enter"!==n.key&&" "!==n.key||(n.preventDefault(),u(e,!1,!0)))},onContextMenu:e=>{r&&e.preventDefault()},[o]:e,role:"button",tabIndex:0,sx:{touchAction:"none",transition:i}}),[u,t,f,n,o,r,i]);return{isDragging:null!==f,draggingButton:f,getDragProps:b,lastTouchTime:g}}function X({rows:t,cols:n,width:o,height:r,mobile:i,headerOffset:s,boardConfig:a}){return e.useMemo(()=>{const e="function"==typeof a.paddingOffset?a.paddingOffset(i):a.paddingOffset;return function({rows:e,cols:t,width:n,height:o,mobile:r,headerOffset:i,paddingOffset:s,boardMaxWidth:a,boardSizeFactor:l,maxCellSize:c,remBase:d}){const u=r?i.mobile:i.desktop,f="number"==typeof s?0:s.x,m="number"==typeof s?s:s.y,h=(Math.min(n,a)-f)*l,g=(o-u-m)*l;return Math.min(h/t,g/e,c)/d}({rows:t+(a.rowOffset??0),cols:n+(a.colOffset??0),width:o,height:r,mobile:i,headerOffset:s,...a,paddingOffset:e})},[t,n,o,r,i,s,a])}function Z({storageKey:t,rows:n,cols:o,state:r,onRestore:i,serialize:s,deserialize:a,enabled:l=!0,saveDebounceMs:c=300}){const d=`${t}-${String(n)}x${String(o)}`,u=U(i),f=U(s??(e=>e)),m=U(a??(e=>e));var h,g,p;e.useEffect(()=>{if(!l)return;const e=localStorage.getItem(d);if(e)try{const t=JSON.parse(e);u(m(t))}catch{localStorage.removeItem(d)}},[d,l,u,m]),h=()=>{if(!l)return;const e=f(r);localStorage.setItem(d,JSON.stringify(e))},g=c,p=[d,r,l,f],e.useEffect(()=>{const e=setTimeout(h,g);return()=>{clearTimeout(e)}},[...p,g])}function Y({storageKey:t,defaultSize:n,minSize:o=2,maxSize:r=10,headerOffset:i,paddingOffset:s=0,widthLimit:a=1300,cellSizeReference:l,mobileRowOffset:c=0}){const{height:d,width:u}=R(),f=D("sm"),[m,h]=g(t,n,{serialize:String,deserialize:e=>{if("null"===e)return null;const t=Number.parseInt(e,10);return Number.isNaN(t)?void 0:t}}),p=e.useMemo(()=>{const e=f?i.mobile:i.desktop,t="number"==typeof l?l:f?l.mobile:l.desktop,n="number"==typeof s?0:s.x,r="number"==typeof s?s:s.y,m=function(e,t,n){const o=16*e;return{rows:Math.floor(t/o),cols:Math.floor(n/o)}}(t,d-e-r,Math.min(u,a)-n);let h=m.rows-1;const g=m.cols-1;return f&&(h+=c),{rows:Math.max(o,h),cols:Math.max(o,g)}},[l,d,u,f,i,s,a,o,c]),{rows:x,cols:b}=e.useMemo(()=>{if(null===m)return p;const e=f?Math.max(0,c+1):0;return{rows:Math.min(m+e,p.rows),cols:Math.min(m,p.cols)}},[m,p,f,c]);return{rows:x,cols:b,dynamicSize:p,handlePlus:()=>{const e=Math.min(x,b);null!==m&&e<Math.min(p.rows,p.cols)&&e<r&&h(e+1)},handleMinus:()=>{const e=Math.min(x,b);if(null===m){const e=Math.min(p.rows,p.cols);p.rows===p.cols?h(Math.max(o,e-1)):h(e)}else e>o&&h(e-1)},desiredSize:m,setDesiredSize:h,mobile:f,width:u,height:d,minSize:o,maxSize:r}}function q({storageKey:t,grid:n={},board:o={},logic:r}){const i=$(t),{defaultSize:s=null,minSize:a,maxSize:l,headerOffset:c,gridPadding:d,widthLimit:u,cellSizeReference:f,mobileRowOffset:m}=n,{boardPadding:h,boardMaxWidth:g,boardSizeFactor:p,maxCellSize:x,remBase:b,rowOffset:S,colOffset:w}=o,{reducer:z,getInitialState:y,isSolved:v,winAnimationDelay:O=A.timing.winAnimationDelay,persistence:M,manualResize:R=!1,onNext:D}=r,j={...N,defaultSize:s,minSize:a??N.minSize,maxSize:l??N.maxSize,headerOffset:c??N.headerOffset,paddingOffset:d??N.paddingOffset,widthLimit:u??N.widthLimit,cellSizeReference:f??N.cellSizeReference,mobileRowOffset:m??N.mobileRowOffset},E=e.useMemo(()=>({...B,paddingOffset:h??B.paddingOffset,boardMaxWidth:g??B.boardMaxWidth,boardSizeFactor:p??B.boardSizeFactor,maxCellSize:x??B.maxCellSize,remBase:b??B.remBase,rowOffset:S,colOffset:w}),[h,g,p,x,b,S,w]),{rows:C,cols:I,dynamicSize:k,handlePlus:P,handleMinus:T,mobile:L,width:W,height:_,minSize:G,maxSize:H}=Y({storageKey:i.SIZE,...j}),K=e.useRef(null);null===K.current&&(K.current=y(C,I));const[F,J]=e.useReducer(z,K.current),q=e.useMemo(()=>v(F),[F,v]),Q=e.useCallback(()=>{J({type:"new"})},[J]),V=D??Q;Z({storageKey:i.STATE,rows:C,cols:I,state:F,onRestore:e=>{J({type:"hydrate",state:e})},...M}),function(t,n,o=2e3){const r=U(n);e.useEffect(()=>{if(t){const e=setTimeout(()=>{r()},o);return()=>{clearTimeout(e)}}},[t,o,r])}(q,V,O),e.useEffect(()=>{R||J({type:"resize",rows:C,cols:I,newRows:C,newCols:I})},[C,I,J,R]);const ee=X({rows:C,cols:I,width:W,height:_,mobile:L,headerOffset:j.headerOffset,boardConfig:E});return{rows:C,cols:I,state:F,dispatch:J,size:ee,mobile:L,solved:q,handleNext:V,controlsProps:{rows:C,cols:I,dynamicSize:k,minSize:G,maxSize:H,handlePlus:P,handleMinus:T,onRefresh:V}}}export{L as B,C,A as G,T,K as a,I as b,G as c,q as d,H as e,F as f,_ as g,W as h,P as i,$ as j,Z as k,J as u};
