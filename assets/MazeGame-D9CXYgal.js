import{r,j as t}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-DtLCKPwf.js";import{a as n}from"./index-BKaRSxyQ.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-xseej50x.js";import{G as i,B as l,T as s,I as c}from"./vendor_mui_core-xr9lkZHO.js";import{V as u}from"./vendor_mui_icons-D-xc5S0s.js";const d=(r,t)=>{const e=[];for(let n=0;n<r;n++){const r=[];for(let e=0;e<t;e++)r.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(r)}return e},f=(r,t,e,n,o=!1)=>{const a=[],{row:i,col:l}=r;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([r,i])=>{if(void 0!==r&&void 0!==i&&r>=0&&r<e&&i>=0&&i<n&&t[r]?.[i]?.visited===o){const e=t[r][i];a.push(e)}}),a},y=(r,t)=>{const e=r.row-t.row,n=r.col-t.col;1===e?(r.walls.top=!1,t.walls.bottom=!1):-1===e?(r.walls.bottom=!1,t.walls.top=!1):1===n?(r.walls.left=!1,t.walls.right=!1):-1===n&&(r.walls.right=!1,t.walls.left=!1)};const g={backtracker:function(r,t,e){const n=[],o=r[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=f(o,r,t,e,!1);if(a.length>0){const r=a[Math.floor(Math.random()*a.length)];r&&(y(o,r),r.visited=!0,n.push(r))}else n.pop()}},prims:function(r,t,e){const n=r[0]?.[0];if(!n)return;n.visited=!0;const o=f(n,r,t,e,!1).map(r=>({parent:n,cell:r}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,y(i,l);f(l,r,t,e,!1).forEach(r=>{o.push({parent:l,cell:r})})}}}};const p=21;function m(){const f=r.useRef(null),y=r.useRef(null),[m,h]=r.useState(null),[w,x]=r.useState("start"),[v]=r.useState("backtracker"),{dx:b,dy:C,requestPermission:k,stopListening:M,isActive:T}=function(){const[t,e]=r.useState({dx:0,dy:0,isActive:!1,error:null}),n=r.useRef(!1),o=r.useCallback(r=>{if(!n.current)return;const{beta:t,gamma:o}=r;if(null===t||null===o)return;let a=0,i=0;Math.abs(o)>2&&(a=Math.max(-1,Math.min(1,.05*(o-2*Math.sign(o))))),Math.abs(t)>2&&(i=Math.max(-1,Math.min(1,.05*(t-2*Math.sign(t))))),e(r=>({...r,dx:a,dy:i,isActive:!0}))},[]),a=()=>{n.current=!0,window.addEventListener("deviceorientation",o),e(r=>({...r,isActive:!0,error:null}))},i=r.useCallback(()=>{n.current=!1,window.removeEventListener("deviceorientation",o),e({dx:0,dy:0,isActive:!1,error:null})},[o]);return r.useEffect(()=>()=>{i()},[i]),{...t,requestPermission:async()=>{const r=DeviceOrientationEvent;if("function"!=typeof r.requestPermission)return a(),!0;try{return"granted"===await r.requestPermission()?(a(),!0):(e(r=>({...r,error:"Permission denied",isActive:!1})),!1)}catch(t){return e(r=>({...r,error:"Permission request failed",isActive:!1})),!1}},stopListening:i}}(),E=r.useRef({gdx:0,gdy:0,active:!1});r.useEffect(()=>{E.current={gdx:b,gdy:C,active:T}},[b,C,T]);const j=r.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:S,width:P}=o(),A=a("sm"),L=S-(A?56:80),X=Math.max(60,Math.min(120,P/7)),Y=.12*X,D=Math.max(2,.04*X),q=.12*X,R=.02*X,W=r.useRef(X);r.useEffect(()=>{if(W.current!==X){const r=X/W.current;j.current.player.x*=r,j.current.player.y*=r,j.current.player.vx*=r,j.current.player.vy*=r,j.current.goal.x*=r,j.current.goal.y*=r,j.current.trail=j.current.trail.map(t=>({x:t.x*r,y:t.y*r})),W.current=X}},[X]);const B=r.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[G,_]=r.useState({active:!1,originConfig:null,currentConfig:null}),I=r.useCallback(()=>{const r=function(r,t,e="backtracker"){const n=d(r,t);return(0,g[e])(n,r,t),{grid:n,rows:r,cols:t,start:[0,0],end:[r-1,t-1]}}(p,p,v);h(r),j.current.player={x:r.start[1]*X+X/2,y:r.start[0]*X+X/2,vx:0,vy:0,rotation:0},j.current.goal={x:r.end[1]*X+X/2,y:r.end[0]*X+X/2,rotation:0},j.current.gameState="playing",j.current.lastTime=0,x("playing")},[v,X]);r.useEffect(()=>{I()},[I]),r.useEffect(()=>{if(!f.current)return;const r=f.current,t=window.devicePixelRatio||1;r.width=P*t,r.height=L*t;const e=r.getContext("2d");e&&e.scale(t,t)},[P,L]),r.useEffect(()=>{if(!m||"playing"!==w||!f.current)return;const r=f.current,t=r.getContext("2d",{alpha:!0});if(!t)return;let e;const o={},a=r=>{o[r.key.toLowerCase()]=!0},i=r=>{o[r.key.toLowerCase()]=!1};window.addEventListener("keydown",a),window.addEventListener("keyup",i);const l=a=>{e=requestAnimationFrame(l);const i=j.current.lastTime?(a-j.current.lastTime)/16.67:1;j.current.lastTime=a;const s=t=>{if(t.startsWith("var(")){const e=t.slice(4,-1);return getComputedStyle(r).getPropertyValue(e).trim()||"#ffffff"}return t},c=s(n.text.primary),u=s(n.primary.main),d=s(n.primary.dark),f=s(n.primary.main),y=X/100*1.2*i,g=Math.pow(.88,i),h=(o.d||o.arrowright?1:0)-(o.a||o.arrowleft?1:0),w=(o.s||o.arrowdown?1:0)-(o.w||o.arrowup?1:0);let v=0,b=0;B.current.isDown&&(v=Math.max(-1,Math.min(1,(B.current.currentX-B.current.startX)/80)),b=Math.max(-1,Math.min(1,(B.current.currentY-B.current.startY)/80)));const C=h+(B.current.isDown?v:E.current.active?E.current.gdx:0),k=w+(B.current.isDown?b:E.current.active?E.current.gdy:0);j.current.player.vx+=C*y,j.current.player.vy+=k*y,j.current.player.vx*=g,j.current.player.vy*=g;const M=(r,t)=>{const e=Y+2,n=Math.floor(r/X),o=Math.floor(t/X);if(o<0||o>=p||n<0||n>=p)return!0;const a=m.grid[o]?.[n];if(!a)return!0;const i=n*X,l=(n+1)*X,s=o*X,c=(o+1)*X;return!!(a.walls.left&&r-e<i)||(!!(a.walls.right&&r+e>l)||(!!(a.walls.top&&t-e<s)||!!(a.walls.bottom&&t+e>c)))},T=j.current.player.x+j.current.player.vx*i;if(M(T,j.current.player.y)){const r=j.current.player.x-Math.sign(j.current.player.vx)*R;M(r,j.current.player.y)||(j.current.player.x=r),j.current.player.vx*=-.8}else j.current.player.x=T;const S=j.current.player.y+j.current.player.vy*i;if(M(j.current.player.x,S)){const r=j.current.player.y-Math.sign(j.current.player.vy)*R;M(j.current.player.x,r)||(j.current.player.y=r),j.current.player.vy*=-.8}else j.current.player.y=S;const A=Math.sqrt(j.current.player.vx**2+j.current.player.vy**2);j.current.player.rotation+=.05*A*i,A>.1&&j.current.trail.push({x:j.current.player.x,y:j.current.player.y});const W=j.current.trail;W.length>(A>.1?15:0)&&W.shift();const G=1-Math.pow(.9,i);j.current.camera.x+=(j.current.player.x-j.current.camera.x)*G,j.current.camera.y+=(j.current.player.y-j.current.camera.y)*G;Math.sqrt(Math.pow(j.current.player.x-j.current.goal.x,2)+Math.pow(j.current.player.y-j.current.goal.y,2))<30&&"playing"===j.current.gameState&&(j.current.gameState="won",x("won"),setTimeout(()=>{I()},1500)),t.clearRect(0,0,P,L),t.save(),t.translate(P/2-j.current.camera.x,L/2-j.current.camera.y);const _=X/2,$=j.current.camera.x-P/2,z=j.current.camera.x+P/2,F=j.current.camera.y-L/2,H=j.current.camera.y+L/2;t.beginPath(),t.strokeStyle=f,t.lineWidth=1,t.globalAlpha=.03;for(let r=Math.floor($/_)*_;r<=z;r+=_)t.moveTo(r,F),t.lineTo(r,H);for(let r=Math.floor(F/_)*_;r<=H;r+=_)t.moveTo($,r),t.lineTo(z,r);t.stroke(),t.globalAlpha=1,t.strokeStyle=u,t.lineWidth=D,t.lineCap="round",t.shadowColor=u,t.shadowBlur=0,t.beginPath();for(let r=0;r<=p;r++)for(let e=0;e<=p;e++){const n=e*X,o=r*X,a=r>0&&(e<p?m.grid[r-1]?.[e]?.walls.left??!1:m.grid[r-1]?.[e-1]?.walls.right??!1),i=r<p&&(e<p?m.grid[r]?.[e]?.walls.left??!1:m.grid[r]?.[e-1]?.walls.right??!1),l=e>0&&(r<p?m.grid[r]?.[e-1]?.walls.top??!1:m.grid[r-1]?.[e-1]?.walls.bottom??!1),s=e<p&&(r<p?m.grid[r]?.[e]?.walls.top??!1:m.grid[r-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(t.moveTo(n,o-q),t.arcTo(n,o,n+q,o,q)):s&&i&&!l&&!a?(t.moveTo(n+q,o),t.arcTo(n,o,n,o+q,q)):i&&l&&!a&&!s?(t.moveTo(n,o+q),t.arcTo(n,o,n-q,o,q)):l&&a&&!s&&!i&&(t.moveTo(n-q,o),t.arcTo(n,o,n,o-q,q))),i){const a=2===c&&(l||s)?o+q:o,i=r+1,u=i<p&&(e<p?m.grid[i]?.[e]?.walls.left??!1:m.grid[i]?.[e-1]?.walls.right??!1),d=e>0&&(i<p?m.grid[i]?.[e-1]?.walls.top??!1:m.grid[i-1]?.[e-1]?.walls.bottom??!1),f=e<p&&(i<p?m.grid[i]?.[e]?.walls.top??!1:m.grid[i-1]?.[e]?.walls.bottom??!1),y=2===1+(u?1:0)+(d?1:0)+(f?1:0)&&(d||f)?(r+1)*X-q:(r+1)*X;t.moveTo(n,a),t.lineTo(n,y)}if(s){const l=2===c&&(a||i)?n+q:n,s=e+1,u=r>0&&(s<p?m.grid[r-1]?.[s]?.walls.left??!1:m.grid[r-1]?.[s-1]?.walls.right??!1),d=r<p&&(s<p?m.grid[r]?.[s]?.walls.left??!1:m.grid[r]?.[s-1]?.walls.right??!1),f=s<p&&(r<p?m.grid[r]?.[s]?.walls.top??!1:m.grid[r-1]?.[s]?.walls.bottom??!1),y=s*X-(2===1+(u?1:0)+(d?1:0)+(f?1:0)&&(u||d)?q:0);t.moveTo(l,o),t.lineTo(y,o)}}t.stroke(),t.shadowBlur=0;const V=j.current.goal;V.rotation+=.02*i,t.save(),t.translate(V.x,V.y),t.rotate(V.rotation),t.fillStyle=d,t.shadowColor=d,t.shadowBlur=0,t.beginPath(),t.rect(-10,-10,20,20),t.fill(),t.restore();const J=j.current.trail,O=J.length;if(O>2){t.save(),t.beginPath(),t.strokeStyle=c,t.lineWidth=Y,t.lineCap="round",t.lineJoin="round";const r=J[0];if(r){t.moveTo(r.x,r.y);for(let r=1;r<O-1;r++){const e=J[r],n=J[r+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;t.globalAlpha=r/O*.15,t.quadraticCurveTo(e.x,e.y,o,a),t.stroke(),t.beginPath(),t.moveTo(o,a)}}}t.restore()}else if(O>1){const r=J[0],e=J[1];r&&e&&(t.save(),t.beginPath(),t.strokeStyle=c,t.lineWidth=Y,t.lineCap="round",t.globalAlpha=.15,t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())}const K=j.current.player;t.save(),t.translate(K.x,K.y),t.fillStyle=c,t.beginPath(),t.arc(0,0,Y,0,2*Math.PI),t.fill(),t.restore(),t.restore()};return requestAnimationFrame(l),()=>{cancelAnimationFrame(e),window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}},[m,w,P,L,A,I,X,R,q,Y,D]);const $=r=>{B.current.isDown&&(B.current.currentX=r.clientX,B.current.currentY=r.clientY,_(t=>{if(!t.originConfig)return t;const e=r.clientX-t.originConfig.x,n=r.clientY-t.originConfig.y,o=Math.sqrt(e*e+n*n);let a=r.clientX,i=r.clientY;if(o>50){const r=50/o;a=t.originConfig.x+e*r,i=t.originConfig.y+n*r}return{...t,currentConfig:{x:a,y:i}}}))},z=()=>{B.current.isDown=!1,_({active:!1,originConfig:null,currentConfig:null})};return r.useEffect(()=>(window.addEventListener("pointermove",$),window.addEventListener("pointerup",z),()=>{window.removeEventListener("pointermove",$),window.removeEventListener("pointerup",z)}),[]),r.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),t.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[t.jsx(e,{showHome:!0}),t.jsxs(l,{ref:y,onPointerDown:r=>{"playing"===w&&(B.current.isDown=!0,B.current.startX=r.clientX,B.current.startY=r.clientY,B.current.currentX=r.clientX,B.current.currentY=r.clientY,_({active:!0,originConfig:{x:r.clientX,y:r.clientY},currentConfig:{x:r.clientX,y:r.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:[A&&t.jsx(l,{sx:{position:"absolute",top:16,right:16,zIndex:10},children:t.jsx(s,{title:T?"Disable Gyro":"Enable Gyro",children:t.jsx(c,{onClick:()=>{(async()=>{T?M():await k()})()},sx:{backgroundColor:T?n.primary.main:"rgba(255, 255, 255, 0.1)",color:T?"#000":"#fff","&:hover":{backgroundColor:T?n.primary.dark:"rgba(255, 255, 255, 0.2)"},boxShadow:T?`0 0 10px ${n.primary.main}`:"none",transition:"all 0.2s ease"},children:t.jsx(u,{})})})}),t.jsx("canvas",{ref:f,style:{display:"block",width:"100%",height:"100%"}})]}),G.active&&G.originConfig&&G.currentConfig&&t.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[t.jsx(l,{sx:{position:"absolute",left:G.originConfig.x,top:G.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),t.jsx(l,{sx:{position:"absolute",left:G.currentConfig.x,top:G.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{m as default};
