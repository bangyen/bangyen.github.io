import{r as t,j as r}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-Cyk0gX23.js";import{a as n}from"./index-D9lexAkF.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(t,r)=>{const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(t)}return e},c=(t,r,e,n,o=!1)=>{const a=[],{row:i,col:l}=t;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([t,i])=>{if(void 0!==t&&void 0!==i&&t>=0&&t<e&&i>=0&&i<n&&r[t]?.[i]?.visited===o){const e=r[t][i];a.push(e)}}),a},u=(t,r)=>{const e=t.row-r.row,n=t.col-r.col;1===e?(t.walls.top=!1,r.walls.bottom=!1):-1===e?(t.walls.bottom=!1,r.walls.top=!1):1===n?(t.walls.left=!1,r.walls.right=!1):-1===n&&(t.walls.right=!1,r.walls.left=!1)};const d={backtracker:function(t,r,e){const n=[],o=t[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,t,r,e,!1);if(a.length>0){const t=a[Math.floor(Math.random()*a.length)];t&&(u(o,t),t.visited=!0,n.push(t))}else n.pop()}},prims:function(t,r,e){const n=t[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,t,r,e,!1).map(t=>({parent:n,cell:t}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,t,r,e,!1).forEach(t=>{o.push({parent:l,cell:t})})}}}};const g=21,p=100,f=12;function h(){const c=t.useRef(null),u=t.useRef(null),[h,m]=t.useState(null),[y,w]=t.useState("start"),[v]=t.useState("backtracker"),x=t.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:b,width:C}=o(),k=a("sm"),T=b-(k?56:80),M=t.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[S,E]=t.useState({active:!1,originConfig:null,currentConfig:null}),j=t.useCallback(()=>{const t=function(t,r,e="backtracker"){const n=s(t,r);return(0,d[e])(n,t,r),{grid:n,rows:t,cols:r,start:[0,0],end:[t-1,r-1]}}(g,g,v);m(t),x.current.player={x:t.start[1]*p+50,y:t.start[0]*p+50,vx:0,vy:0,rotation:0},x.current.goal={x:t.end[1]*p+50,y:t.end[0]*p+50,rotation:0},x.current.gameState="playing",x.current.lastTime=0,w("playing")},[v]);t.useEffect(()=>{j()},[j]),t.useEffect(()=>{if(!c.current)return;const t=c.current,r=window.devicePixelRatio||1;t.width=C*r,t.height=T*r;const e=t.getContext("2d");e&&e.scale(r,r)},[C,T]),t.useEffect(()=>{if(!h||"playing"!==y||!c.current)return;const t=c.current.getContext("2d",{alpha:!0});if(!t)return;let r;const e={},o=t=>{e[t.key.toLowerCase()]=!0},a=t=>{e[t.key.toLowerCase()]=!1};window.addEventListener("keydown",o),window.addEventListener("keyup",a);const i=o=>{r=requestAnimationFrame(i);const a=x.current.lastTime?(o-x.current.lastTime)/16.67:1;x.current.lastTime=o;const l=1.2*a,s=Math.pow(.88,a),c=(e.d||e.arrowright?1:0)-(e.a||e.arrowleft?1:0),u=(e.s||e.arrowdown?1:0)-(e.w||e.arrowup?1:0);let d=0,m=0;M.current.isDown&&(d=Math.max(-1,Math.min(1,(M.current.currentX-M.current.startX)/80)),m=Math.max(-1,Math.min(1,(M.current.currentY-M.current.startY)/80)));const y=c+d,v=u+m;x.current.player.vx+=y*l,x.current.player.vy+=v*l,x.current.player.vx*=s,x.current.player.vy*=s;const b=(t,r)=>{const e=Math.floor(t/p),n=Math.floor(r/p);if(n<0||n>=g||e<0||e>=g)return!0;const o=h.grid[n]?.[e];if(!o)return!0;const a=e*p,i=(e+1)*p,l=n*p,s=(n+1)*p;return!!(o.walls.left&&t-14<a)||(!!(o.walls.right&&t+14>i)||(!!(o.walls.top&&r-14<l)||!!(o.walls.bottom&&r+14>s)))},k=x.current.player.x+x.current.player.vx*a;b(k,x.current.player.y)?x.current.player.vx*=-.5:x.current.player.x=k;const S=x.current.player.y+x.current.player.vy*a;b(x.current.player.x,S)?x.current.player.vy*=-.5:x.current.player.y=S;const E=Math.sqrt(x.current.player.vx**2+x.current.player.vy**2);x.current.player.rotation+=.05*E*a,E>.1&&x.current.trail.push({x:x.current.player.x,y:x.current.player.y});const X=x.current.trail;X.length>(E>.1?15:0)&&X.shift();const Y=1-Math.pow(.9,a);x.current.camera.x+=(x.current.player.x-x.current.camera.x)*Y,x.current.camera.y+=(x.current.player.y-x.current.camera.y)*Y;Math.sqrt(Math.pow(x.current.player.x-x.current.goal.x,2)+Math.pow(x.current.player.y-x.current.goal.y,2))<30&&"playing"===x.current.gameState&&(x.current.gameState="won",w("won"),setTimeout(()=>{j()},1500)),t.clearRect(0,0,C,T),t.save(),t.translate(C/2-x.current.camera.x,T/2-x.current.camera.y);const P=50,A=x.current.camera.x-C/2,L=x.current.camera.x+C/2,R=x.current.camera.y-T/2,D=x.current.camera.y+T/2;t.beginPath(),t.strokeStyle=n.primary.main,t.globalAlpha=.03,t.lineWidth=1;for(let r=Math.floor(A/P)*P;r<=L;r+=P)t.moveTo(r,R),t.lineTo(r,D);for(let r=Math.floor(R/P)*P;r<=D;r+=P)t.moveTo(A,r),t.lineTo(L,r);t.stroke(),t.globalAlpha=1,t.strokeStyle=n.primary.main,t.lineWidth=4,t.lineCap="round",t.shadowColor=n.primary.main,t.shadowBlur=0;const q=12;t.beginPath();for(let r=0;r<=g;r++)for(let e=0;e<=g;e++){const n=e*p,o=r*p,a=r>0&&(e<g?h.grid[r-1]?.[e]?.walls.left??!1:h.grid[r-1]?.[e-1]?.walls.right??!1),i=r<g&&(e<g?h.grid[r]?.[e]?.walls.left??!1:h.grid[r]?.[e-1]?.walls.right??!1),l=e>0&&(r<g?h.grid[r]?.[e-1]?.walls.top??!1:h.grid[r-1]?.[e-1]?.walls.bottom??!1),s=e<g&&(r<g?h.grid[r]?.[e]?.walls.top??!1:h.grid[r-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(t.moveTo(n,o-q),t.arcTo(n,o,n+q,o,q)):s&&i&&!l&&!a?(t.moveTo(n+q,o),t.arcTo(n,o,n,o+q,q)):i&&l&&!a&&!s?(t.moveTo(n,o+q),t.arcTo(n,o,n-q,o,q)):l&&a&&!s&&!i&&(t.moveTo(n-q,o),t.arcTo(n,o,n,o-q,q))),i){const a=2===c&&(l||s)?o+q:o,i=r+1,u=i<g&&(e<g?h.grid[i]?.[e]?.walls.left??!1:h.grid[i]?.[e-1]?.walls.right??!1),d=e>0&&(i<g?h.grid[i]?.[e-1]?.walls.top??!1:h.grid[i-1]?.[e-1]?.walls.bottom??!1),f=e<g&&(i<g?h.grid[i]?.[e]?.walls.top??!1:h.grid[i-1]?.[e]?.walls.bottom??!1),m=2===1+(u?1:0)+(d?1:0)+(f?1:0)&&(d||f)?(r+1)*p-q:(r+1)*p;t.moveTo(n,a),t.lineTo(n,m)}if(s){const l=2===c&&(a||i)?n+q:n,s=e+1,u=r>0&&(s<g?h.grid[r-1]?.[s]?.walls.left??!1:h.grid[r-1]?.[s-1]?.walls.right??!1),d=r<g&&(s<g?h.grid[r]?.[s]?.walls.left??!1:h.grid[r]?.[s-1]?.walls.right??!1),f=s<g&&(r<g?h.grid[r]?.[s]?.walls.top??!1:h.grid[r-1]?.[s]?.walls.bottom??!1),m=s*p-(2===1+(u?1:0)+(d?1:0)+(f?1:0)&&(u||d)?q:0);t.moveTo(l,o),t.lineTo(m,o)}}t.stroke(),t.shadowBlur=0;const W=x.current.goal;W.rotation+=.02*a,t.save(),t.translate(W.x,W.y),t.rotate(W.rotation),t.fillStyle=n.data.green,t.shadowColor=n.data.green,t.shadowBlur=0,t.beginPath(),t.rect(-10,-10,20,20),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=2,t.stroke(),t.restore();const B=x.current.trail,_=B.length;if(_>2){t.save(),t.beginPath(),t.strokeStyle=n.data.amber,t.lineWidth=f,t.lineCap="round",t.lineJoin="round";const r=B[0];if(r){t.moveTo(r.x,r.y);for(let r=1;r<_-1;r++){const e=B[r],n=B[r+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;t.globalAlpha=r/_*.15,t.quadraticCurveTo(e.x,e.y,o,a),t.stroke(),t.beginPath(),t.moveTo(o,a)}}}t.restore()}else if(_>1){const r=B[0],e=B[1];r&&e&&(t.save(),t.beginPath(),t.strokeStyle=n.data.amber,t.lineWidth=f,t.lineCap="round",t.globalAlpha=.15,t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())}const G=x.current.player;t.save(),t.translate(G.x,G.y);const F=t.createRadialGradient(0,0,0,0,0,24);F.addColorStop(0,n.data.amber),F.addColorStop(1,"transparent"),t.fillStyle=F,t.globalAlpha=.2+.1*Math.sin(.005*o),t.beginPath(),t.arc(0,0,24,0,2*Math.PI),t.fill(),t.globalAlpha=1,t.fillStyle=n.data.amber,t.beginPath(),t.arc(0,0,f,0,2*Math.PI),t.fill(),t.restore(),t.restore()};return requestAnimationFrame(i),()=>{cancelAnimationFrame(r),window.removeEventListener("keydown",o),window.removeEventListener("keyup",a)}},[h,y,C,T,k,j]);const X=t=>{M.current.isDown&&(M.current.currentX=t.clientX,M.current.currentY=t.clientY,E(r=>{if(!r.originConfig)return r;const e=t.clientX-r.originConfig.x,n=t.clientY-r.originConfig.y,o=Math.sqrt(e*e+n*n);let a=t.clientX,i=t.clientY;if(o>50){const t=50/o;a=r.originConfig.x+e*t,i=r.originConfig.y+n*t}return{...r,currentConfig:{x:a,y:i}}}))},Y=()=>{M.current.isDown=!1,E({active:!1,originConfig:null,currentConfig:null})};return t.useEffect(()=>(window.addEventListener("pointermove",X),window.addEventListener("pointerup",Y),()=>{window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",Y)}),[]),t.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),r.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[r.jsx(e,{showHome:!0}),r.jsx(l,{ref:u,onPointerDown:t=>{"playing"===y&&(M.current.isDown=!0,M.current.startX=t.clientX,M.current.startY=t.clientY,M.current.currentX=t.clientX,M.current.currentY=t.clientY,E({active:!0,originConfig:{x:t.clientX,y:t.clientY},currentConfig:{x:t.clientX,y:t.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:r.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),S.active&&S.originConfig&&S.currentConfig&&r.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[r.jsx(l,{sx:{position:"absolute",left:S.originConfig.x,top:S.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),r.jsx(l,{sx:{position:"absolute",left:S.currentConfig.x,top:S.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{h as default};
