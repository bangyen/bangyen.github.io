import{j as e,a as r,r as n}from"./vendor_react-De-BR_RD.js";import{B as t,k as o,g as s,u as l,G as i,C as a,b as c,l as u,T as d,m as f,L as p,n as g,d as h,c as y,a as m,f as b,e as x,h as S,i as v,j as w}from"./useBaseGame-BMhRJ2Jg.js";import{b as A,C,L as k,A as E,S as R,F as I,P as M}from"./index-CEfa95Pq.js";import{B as N,d as j}from"./vendor_mui_core-K-vIj0S5.js";import{c as O,D as z,d as D,T,e as P,N as L,P as B}from"./vendor_mui_icons-D2L4zTna.js";import{u as $,E as H,a as G}from"./lazyNamed-CjwPSRp1.js";import{t as W}from"./PageLayout-wIOqYraC.js";function _({onCopy:r,onClear:n,onClose:t}){return e.jsxs(N,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:k.zIndex.base+5,paddingBottom:2},children:[e.jsx(A,{title:"Copy Board",Icon:O,onClick:r,sx:{backgroundColor:C.interactive.selected,color:C.primary.main,"&:hover":{backgroundColor:C.interactive.focus}}}),e.jsx(A,{title:"Clear Analysis",Icon:z,onClick:n,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:C.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(A,{title:"Close Analysis",Icon:D,onClick:t,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:C.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const q="130%",U="6px",Y=100,F=1e3,V=100,K=.8,J={...o("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},X=0,Q=8,Z=5,ee={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:t.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BORDER:"var(--slant-analysis-border)",BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"}},re=1,ne=2,te=r.memo(function({value:r,color:n}){return e.jsxs(N,{sx:{width:"100%",height:"100%",position:"relative"},children:[r===re&&e.jsx(N,{sx:{position:"absolute",width:q,height:U,backgroundColor:n,borderRadius:R.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:ee.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}),r===ne&&e.jsx(N,{sx:{position:"absolute",width:q,height:U,backgroundColor:n,borderRadius:R.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:ee.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}})]})}),oe=r.memo(function({value:r,hasConflict:n,numberSize:t}){return e.jsx(N,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:n?ee.COLORS.WHITE:ee.ANALYSIS.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:n?"scale(1.1)":"scale(1)"},children:r??""})});class se{constructor(e){this.parent=Array.from({length:e},(e,r)=>r)}find(e){const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Index ${String(e)} out of bounds`);r!==e&&(this.parent[e]=this.find(r));const n=this.parent[e];if(void 0===n)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return n}union(e,r){const n=this.find(e),t=this.find(r);return n!==t&&(this.parent[n]=t,!0)}connected(e,r){return this.find(e)===this.find(r)}}function le(e,r,n){return e*(n+1)+r}function ie(e,r,n){const t=new Map,o=new Set;for(let s=0;s<r;s++)for(let r=0;r<n;r++){const o=e[s]?.[r];if(!o||0===o)continue;const l=le(s,o===re?r+1:r,n),i=le(s+1,o===re?r:r+1,n);t.has(l)||t.set(l,[]),t.has(i)||t.set(i,[]),t.get(l)?.push({node:i,r:s,c:r}),t.get(i)?.push({node:l,r:s,c:r})}const l=new Set,i=new Set,a=[],c=(e,r)=>{l.add(e),i.add(e);const n=t.get(e)??[];for(const{node:t,r:u,c:d}of n)if(t!==r)if(i.has(t)){o.add(s(u,d));for(let e=a.length-1;e>=0;e--){const r=a[e];if(!r)break;if(o.add(s(r.r,r.c)),r.u===t||r.v===t)break}}else l.has(t)||(a.push({r:u,c:d,u:e,v:t}),c(t,e),a.pop());i.delete(e)};for(const s of t.keys())l.has(s)||c(s,-1);return o}function ae({rows:e,cols:r,numbers:t,userMoves:o}){const[l,i]=n.useState(new Map),[a,c]=n.useState([]),[u,d]=n.useState(new Set),f=n.useRef(null),[p,g]=n.useState("probing");return n.useEffect(()=>{let e=!1;const r=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=r;const n=setTimeout(()=>{e||(g("broken"),f.current=null,r.terminate())},2e3);return r.onmessage=r=>{if(e)return;const t=r.data;"RESULT"===t.type&&g(e=>{if("probing"===e)return clearTimeout(n),"healthy";const{gridState:r,conflicts:o,cycleCells:s}=t.payload;return i(r),c(o),d(s),e})},r.onerror=()=>{clearTimeout(n),g("broken"),f.current=null,r.terminate()},r.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(n),r.terminate()}},[]),n.useEffect(()=>{if("healthy"===p&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:r,numbers:t,userMoves:o}});else if("broken"===p){const n=function(e,r,n,t){const o=new Map,l=[],i=[];t.forEach((e,r)=>{o.set(r,{state:e,source:"user"});const[n,t]=r.split(",").map(Number);void 0!==n&&void 0!==t&&l.push({r:n,c:t})});const a=(n,t)=>{if(n<0||n>=e||t<0||t>=r)return 0;const l=s(n,t);return o.get(l)?.state??0},c=(e,r,n,t)=>{const a=s(e,r),c=o.get(a);c?c.state!==n&&i.push({type:"cell",r:e,c:r}):(o.set(a,{state:n,source:t}),l.push({r:e,c:r}))},u=(n,t)=>[{r:n-1,c:t-1,required:ne},{r:n-1,c:t,required:re},{r:n,c:t-1,required:re},{r:n,c:t,required:ne}].filter(n=>n.r>=0&&n.r<e&&n.c>=0&&n.c<r);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:r,c:t}=e,f=[{r:r,c:t},{r:r,c:t+1},{r:r+1,c:t},{r:r+1,c:t+1}];for(const l of f){const e=n[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const p=[];for(const r of d){const e=a(r.r,r.c);0===e?p.push(r):e===r.required&&f++}if(f>e)i.push({type:"node",r:l.r,c:l.c});else if(f+p.length<e)i.push({type:"node",r:l.r,c:l.c});else if("user"===o.get(s(r,t))?.source)if(f===e&&p.length>0)for(const r of p){const e=r.required===re?ne:re;c(r.r,r.c,e,"propagated")}else if(f+p.length===e&&p.length>0)for(const r of p)c(r.r,r.c,r.required,"propagated")}}const f=Array.from({length:e},()=>new Array(r).fill(0));for(const[s,g]of o.entries()){const[e,r]=s.split(",").map(Number);void 0!==e&&void 0!==r&&f[e]&&(f[e][r]=g.state)}const p=ie(f,e,r);return{gridState:o,conflicts:i,cycleCells:p}}(e,r,t,o);i(n.gridState),c(n.conflicts),d(n.cycleCells)}},[o,t,e,r,p]),{gridState:l,conflicts:a,cycleCells:u}}function ce({rows:r,cols:o,numbers:c,size:u,initialMoves:d,onMove:f,onCopy:p,onClear:g,onClose:h}){const y=$("sm"),m=d,{getDragProps:b}=l({onToggle:(e,r,n,t,o)=>{const l=s(e,r);if(!o)return void f(l,t);const i=m.get(l);let a;return a=n?i===re?ne:i===ne?void 0:re:i===ne?re:i===re?void 0:ne,f(l,a),a},touchTimeout:i.timing.touchHoldDelay,checkEnabled:()=>!0}),{gridState:x,conflicts:S,cycleCells:v}=ae({rows:r,cols:o,numbers:c,userMoves:m}),w=.4*u,A=u-w,E=n.useMemo(()=>new Set(S.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[S]),R=n.useMemo(()=>new Set(S.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[S]),I=n.useCallback((r,n)=>function({r:r,c:n,gridState:t,conflictSet:o,cycleCells:l,getDragProps:i}){const a=s(r,n),c=t.get(a),u=c?.state??0,d=c?.source,f=o.has(a),p=l.has(a),g=i(a);let h=C.text.primary;return f?h=C.data.red:p?h="user"===d?C.data.red:C.data.orange:"user"===d?h=C.primary.main:"propagated"===d&&(h=C.data.green),{...g,"data-pos":a,"data-type":"cell",sx:{...g.sx,cursor:"pointer",border:`1px solid ${ee.ANALYSIS.BORDER}`,position:"relative",backgroundColor:ee.ANALYSIS.BG_SUBTLE,"&:hover":{backgroundColor:ee.ANALYSIS.BG_HOVER}},children:e.jsx(te,{value:u,color:h})}}({r:r,c:n,gridState:x,conflictSet:E,cycleCells:v,getDragProps:b}),[x,E,v,b]),M=n.useCallback((r,n)=>function({r:r,c:n,numbers:t,nodeConflictSet:o,numberSize:l}){const i=t[r]?.[n],a=o.has(s(r,n));return{"data-pos":s(r,n),"data-type":"hint",children:e.jsx(oe,{value:i??null,hasConflict:a,numberSize:l}),sx:{borderRadius:"50%",backgroundColor:a?C.data.red:ee.ANALYSIS.HINT_BG,border:null==i?"none":`2px solid ${a?C.data.red:ee.ANALYSIS.HINT_BORDER}`,zIndex:5,opacity:null==i?0:1,position:"relative",pointerEvents:"none"}}}({r:r,c:n,numbers:c,nodeConflictSet:R,numberSize:w}),[c,R,w]);return e.jsxs(N,{sx:{position:"relative",userSelect:"none"},onContextMenu:e=>{e.preventDefault()},children:[e.jsxs(N,{sx:{position:"relative",padding:y?t.PADDING.MOBILE:t.PADDING.DESKTOP,border:`2px dashed ${ee.ANALYSIS.DASHED_BORDER}`,borderRadius:t.BORDER_RADIUS},children:[e.jsx(N,{sx:{position:"relative",zIndex:k.zIndex.base+1},children:e.jsx(a,{size:u,rows:r,cols:o,cellProps:I,space:0,sx:{width:"fit-content"}})}),e.jsx(N,{sx:{position:"absolute",top:y?t.PADDING.MOBILE:t.PADDING.DESKTOP,left:y?t.PADDING.MOBILE:t.PADDING.DESKTOP,transform:`translate(-${String(w/2)}rem, -${String(w/2)}rem)`,zIndex:k.zIndex.base+2,pointerEvents:"none"},children:e.jsx(a,{size:w,rows:r+1,cols:o+1,cellProps:M,space:A,sx:{width:"fit-content"}})})]}),e.jsx(_,{onCopy:p,onClear:g,onClose:h})]})}function ue({size:r,rows:t,cols:o}){const s=n.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),l=n.useCallback(()=>({}),[]);return e.jsx(N,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:e.jsx(c,{size:r,rows:t+1,cols:o+1,cellRows:t,cellCols:o,overlayProps:l,cellProps:s,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}function de({isAnalysisMode:r,generating:n,dimensionsMismatch:t,rows:o,cols:s,state:l,size:i,analysisMoves:a,onAnalysisMove:d,onAnalysisCopy:f,onAnalysisClear:p,onAnalysisClose:g,cellProps:h,overlayProps:y}){return r?e.jsx(H,{fallback:e.jsx(G,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:e.jsx(ce,{rows:o,cols:s,numbers:l.numbers,size:i,initialMoves:a,onMove:d,onCopy:f,onClear:p,onClose:g})}):n||t?e.jsx(ue,{size:i,rows:o,cols:s}):e.jsx(H,{FallbackComponent:I,fallbackProps:{title:u.errors.boardTitle,resetLabel:u.errors.boardReset},children:e.jsx(c,{size:i,rows:o+1,cols:s+1,cellRows:o,cellCols:s,space:.125,overlayProps:y,cellProps:h,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0})})}const fe=[[ne,re,ne],[ne,re,ne],[ne,re,ne]],pe=[[1,0,2,0],[1,2,2,1],[1,2,2,1],[0,2,0,1]],ge=[[0,0],[2,2],[0,2],[2,0],[0,1],[2,1],[1,0],[1,1],[1,2]];function he(e,r,n){const t=Array.from({length:r+1},()=>new Array(n+1).fill(0));for(let o=0;o<r;o++){const r=e[o];if(r)for(let e=0;e<n;e++){const n=r[e];if(n===re){const r=t[o];if(r){const n=r[e+1];void 0!==n&&(r[e+1]=n+1)}const n=t[o+1];if(n){const r=n[e];void 0!==r&&(n[e]=r+1)}}else if(n===ne){const r=t[o];if(r){const n=r[e];void 0!==n&&(r[e]=n+1)}const n=t[o+1];if(n){const r=n[e+1];void 0!==r&&(n[e+1]=r+1)}}}}return t}function ye(e,r,n,t){const o=new Set,l=he(e,n,t);for(let i=0;i<=n;i++)for(let e=0;e<=t;e++){const n=r[i]?.[e];if(null==n)continue;(l[i]?.[e]??0)===n&&o.add(s(i,e))}return o}function me(e,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:C.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:ee.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}function be({size:r}){const t=n.useMemo(()=>function(){const e=[],r=Array.from({length:3},()=>new Array(3).fill(0));e.push(r);let n=r.map(e=>[...e]);for(const[t,o]of ge){n=n.map(e=>[...e]);const r=fe[t]?.[o];if(void 0!==r){const e=n[t];e&&(e[o]=r)}e.push(n)}return e.push(n.map(e=>[...e])),e}(),[]),[o,l]=n.useState(0);n.useEffect(()=>{const e=setInterval(()=>{l(e=>(e+1)%t.length)},1500);return()=>{clearInterval(e)}},[t.length]);const i=n.useMemo(()=>t[o]??t[0]??[],[t,o]),a=o>0&&o<=ge.length?(()=>{const e=ge[o-1];return e?s(e[0],e[1]):null})():null,u=n.useMemo(()=>ye(i,pe,3,3),[i]),f=.4*r,p=o>=ge.length&&i.every(e=>e.every(e=>0!==e)),g=n.useMemo(()=>function(r,n,t){return(o,l)=>{const i=r[o]?.[l],a=s(o,l)===t;return{sx:{border:`1px solid ${C.border.subtle}`,position:"relative",transition:E.transition,...a?{backgroundColor:C.interactive.hover}:{}},children:e.jsxs(N,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===re&&e.jsx(N,{sx:me("-45deg",n)}),i===ne&&e.jsx(N,{sx:me("45deg",n)})]})}}}(i,r,a),[i,r,a]),h=n.useMemo(()=>function(r,n,t){return(o,l)=>{const i=r[o]?.[l],a=s(o,l),c=n.has(a);return{sx:{pointerEvents:"none"},children:e.jsx(N,{sx:{borderRadius:"50%",backgroundColor:C.surface.background,border:null==i?"none":`2px solid ${c?"transparent":C.border.subtle}`,fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:c?C.interactive.disabledText:C.text.primary,boxShadow:c?"none":ee.SHADOWS.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}}}(pe,u,f),[u,f]);return e.jsx(N,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:e.jsxs(N,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(c,{size:r,rows:4,cols:4,cellRows:3,cellCols:3,overlayProps:h,cellProps:g,overlayLayerSx:{pointerEvents:"none"},overlayDecorative:!0}),e.jsx(d,{show:p,size:r,iconSizeRatio:1,primaryColor:C.primary.main,showLabel:!1})]})})}const xe={display:"flex",px:2,ml:{xs:5,sm:4},pt:{xs:0,sm:3},mt:{xs:-2,sm:0}},Se={borderColor:C.border.subtle,color:C.text.secondary},ve=["Slant Rules","Example"],we=[{Icon:T,title:"Fill with Slashes",text:String.raw`Place a forward (/) or backward (\) slash in every cell of the grid.`},{Icon:P,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:L,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],Ae={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},Ce=e=>[...W(f(e)),{overflowY:"hidden"}];function ke(e){return{storageKey:"slant",grid:{defaultSize:Z,maxSize:Q,gridPadding:{x:e?48:80,y:120},widthLimit:F,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:Y}),...e?{boardSizeFactor:.92}:{},maxCellSize:V,rowOffset:1,colOffset:1}}}function Ee({open:r,toggleOpen:n,handleOpenAnalysis:t}){const o=$("sm");return e.jsx(p,{open:r,toggleOpen:n,titles:ve,instructions:we,instructionsFooter:e.jsx(N,{sx:xe,children:e.jsx(j,{variant:"outlined",startIcon:e.jsx(B,{}),onClick:t,sx:Se,children:"Open Analysis"})}),exampleContent:e.jsx(be,{size:o?4:5}),cardSx:Ae,contentSxOverride:Ce})}function Re(e,r){return`${J.STATE}-${String(e)}x${String(r)}`}function Ie(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function Me({rows:e,cols:r,isAnalysisMode:t,requestGeneration:o,cancelGeneration:s}){const l=n.useRef(`${String(e)},${String(r)}`);n.useEffect(()=>{const n=`${String(e)},${String(r)}`;n!==l.current&&(l.current=n,t||!function(e,r){const n=Re(e,r),t=localStorage.getItem(n);if(!t)return!1;try{const e=JSON.parse(t);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,r)?o(e,r):s())},[e,r,o,s,t])}function Ne(e,r,n,t){return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:n,solution:t,rows:e,cols:r,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function je({getInitialState:e,dispatchRef:r,dimsRef:t,onStaleResult:o}){const[s,l]=n.useState(!1),i=n.useRef(null),a=n.useRef("probing"),c=n.useRef(0),u=n.useRef(0),d=n.useRef(null),f=n.useRef(0),p=n.useRef(o);p.current=o;const g=n.useRef(!1),h=n.useRef(null),y=n.useRef(!1),m=n.useCallback(()=>{if(h.current){const e=h.current;p.current?.(e,e.rows,e.cols)}g.current=!1,h.current=null,y.current=!1},[]),b=n.useCallback((n,t)=>{r.current?.({type:"hydrate",state:e(n,t)}),l(!1)},[r,e]),x=n.useCallback((e,r)=>{m(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const n=++c.current;"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:r}})):u.current=requestAnimationFrame(()=>{c.current===n&&b(e,r)})},250)},[b,m]),S=n.useCallback((r,n)=>{g.current||(g.current=!0,h.current=null,y.current=!1,"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:r,cols:n}})):requestAnimationFrame(()=>{g.current&&(h.current=e(r,n))}))},[e]),v=n.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),m(),l(!1)},[m]),w=n.useCallback(()=>{if(h.current){const e=h.current;return h.current=null,r.current?.({type:"hydrate",state:e}),m(),void l(!1)}if(g.current)return y.current=!0,void l(!0);x(t.current.rows,t.current.cols)},[x,t,r,m]);return n.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});i.current=n;const o=setTimeout(()=>{e||"probing"!==a.current||(a.current="broken",f.current=0,i.current=null,n.terminate())},2e3);return n.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(o),a.current="broken",f.current=0,i.current=null,void n.terminate();if("RESULT"===s.data.type){if("probing"===a.current)return clearTimeout(o),void(a.current="healthy");f.current--;const{rows:e,cols:n,numbers:i,solution:c}=s.data.payload,u=t.current;if(e!==u.rows||n!==u.cols)return p.current?.(Ne(e,n,i,c),e,n),void(f.current<=0&&l(!1));if(f.current>0)return;const d=Ne(e,n,i,c);if(g.current)return h.current=d,void(y.current&&(r.current?.({type:"hydrate",state:d}),g.current=!1,h.current=null,y.current=!1,l(!1)));r.current?.({type:"hydrate",state:d}),l(!1)}}},n.onerror=()=>{clearTimeout(o),a.current="broken",f.current=0,i.current=null,n.terminate()},n.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(o),null!==d.current&&clearTimeout(d.current),n.terminate()}},[r,t]),{generating:s,requestGeneration:x,handleNextAsync:w,prefetch:S,cancelGeneration:v}}function Oe(e,r,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:n?C.data.red:C.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:ee.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}const ze={border:`2px solid ${C.border.subtle}`,position:"relative"},De={width:"100%",height:"100%",position:"relative"},Te={pointerEvents:"none"},Pe={cursor:"pointer","&:hover":{backgroundColor:C.interactive.hover}};function Le(e){const{numberSize:r,hasError:n,isSatisfied:t,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:n?C.data.red:C.surface.background,border:o?`2px solid ${n?C.data.red:t?"transparent":C.border.subtle}`:"none",fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:n?ee.COLORS.WHITE:t?C.interactive.disabledText:C.text.primary,boxShadow:t&&!n?"none":ee.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:n?"scale(1.1)":"scale(1)",width:`${String(r)}rem`,height:`${String(r)}rem`}}const Be=(r,n,t)=>{const o=function(r,n){return(t,o)=>{const l=r.grid[t]?.[o],i=s(t,o),a=r.cycleCells.has(i),c=[{v:r.numbers[t]?.[o],p:s(t,o)},{v:r.numbers[t]?.[o+1],p:s(t,o+1)},{v:r.numbers[t+1]?.[o],p:s(t+1,o)},{v:r.numbers[t+1]?.[o+1],p:s(t+1,o+1)}].map(({v:e,p:n})=>{if(null==e)return"-";const t=r.errorNodes.has(n)?"Error":r.satisfiedNodes.has(n)?"Ok":"Pending";return`${String(e)} (${t})`});return{"aria-label":`Cell ${String(t+1)}, ${String(o+1)}. Clues: ${c.join(", ")}. ${0===l?"Empty":l===re?"Forward Slash":"Backward Slash"}${a?", Loop Error":""}`,sx:ze,children:e.jsxs(N,{sx:De,children:[l===re&&e.jsx(N,{sx:Oe("-45deg",n,a)}),l===ne&&e.jsx(N,{sx:Oe("45deg",n,a)})]})}}}(n,t);return(e,n)=>{const t=o(e,n),l=s(e,n),i=r(l);return{...i,...t,sx:{...i.sx,...t.sx,...Pe}}}};function $e({game:{state:r,rows:t,cols:o,size:l,mobile:i,isAnalysisMode:a,generating:c,handleNextAsync:u},analysis:{analysisMoves:d,handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:g,handleAnalysisClose:y,handleBoxClick:m,handleOpenAnalysis:b,boardSx:x},info:{infoOpen:S,toggleInfo:v},controls:w,getDragProps:A}){const C=.4*l,k=h(Be,A,[r,l]),E=n.useMemo(()=>((r,n)=>(t,o)=>{const l=r.numbers[t]?.[o],i=s(t,o),a=r.errorNodes.has(i),c=r.satisfiedNodes.has(i);return{sx:Te,children:e.jsx(N,{sx:Le({numberSize:n,hasError:a,isSatisfied:c,isVisible:null!=l}),children:l??""})}})(r,C),[r,C]),R=n.useMemo(()=>(e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"}))(i),[i]);return{boardProps:{isAnalysisMode:a,generating:c,dimensionsMismatch:t!==r.rows||o!==r.cols,rows:t,cols:o,state:r,size:l,analysisMoves:d,onAnalysisMove:f,onAnalysisCopy:p,onAnalysisClear:g,onAnalysisClose:y,cellProps:k,overlayProps:E},controlsProps:{...w,onRefresh:u,disabled:c,onOpenInfo:v,hidden:a},layoutProps:{boardSx:x,contentSx:R,iconSizeRatio:K},infoProps:{open:S,toggleOpen:v,handleOpenAnalysis:b,handleBoxClick:m},trophyProps:{show:!a&&r.solved,onReset:u,size:l,iconSizeRatio:K}}}function He(e,r,n,t,o,s){const l=e[n];if(!l)return!1;l[t]=o;const i=le(n,o===re?t+1:t,s),a=le(n+1,o===re?t:t+1,s);return!r.connected(i,a)&&(r.union(i,a),!0)}function Ge(e,r,n){const t=Array.from({length:r},()=>new Array(n).fill(0)),o=new se((r+1)*(n+1)),s=function(e,r,n,t,o){let s=!0;for(;s;){s=!1;for(let l=0;l<=n;l++)for(let i=0;i<=t;i++){const a=r[l]?.[i];if(null==a)continue;const c=[{gr:l-1,gc:i-1,pt:ne},{gr:l-1,gc:i,pt:re},{gr:l,gc:i-1,pt:re},{gr:l,gc:i,pt:ne}].filter(({gr:e,gc:r})=>e>=0&&e<n&&r>=0&&r<t);let u=0;const d=[];for(const r of c){const n=e[r.gr]?.[r.gc];0===n?d.push(r):n===r.pt&&u++}if(u>a)return"contradiction";if(u+d.length<a)return"contradiction";if(u===a&&d.length>0){for(const{gr:r,gc:n,pt:l}of d)if(0===e[r]?.[n]){if(!He(e,o,r,n,l===re?ne:re,t))return"contradiction";s=!0}}else if(u+d.length===a&&d.length>0)for(const{gr:r,gc:n,pt:l}of d)if(0===e[r]?.[n]){if(!He(e,o,r,n,l,t))return"contradiction";s=!0}}if(!s){for(let r=0;r<n;r++)for(let n=0;n<t;n++){const l=e[r];if(0!==l?.[n])continue;const i=le(r,n+1,t),a=le(r+1,n,t),c=o.connected(i,a),u=le(r,n,t),d=le(r+1,n+1,t),f=o.connected(u,d);if(c&&f)return"contradiction";c?(l[n]=ne,s=!0,o.union(u,d)):f&&(l[n]=re,s=!0,o.union(i,a))}if(!s)for(let l=0;l<n;l++)for(let i=0;i<t;i++){const a=e[l];if(0!==a?.[i])continue;let c=!1,u=!1;const d=[{nr:l,nc:i,touchedBy:ne},{nr:l,nc:i+1,touchedBy:re},{nr:l+1,nc:i,touchedBy:re},{nr:l+1,nc:i+1,touchedBy:ne}];for(const{nr:o,nc:s,touchedBy:l}of d){const i=r[o]?.[s];if(null==i)continue;const a=[{gr:o-1,gc:s-1,pt:ne},{gr:o-1,gc:s,pt:re},{gr:o,gc:s-1,pt:re},{gr:o,gc:s,pt:ne}].filter(({gr:e,gc:r})=>e>=0&&e<n&&r>=0&&r<t);let d=0,f=0;for(const r of a){const n=e[r.gr]?.[r.gc];0===n?f++:n===r.pt&&d++}l===re?(d+1>i&&(c=!0),d+(f-1)<i&&(u=!0)):(d+1>i&&(u=!0),d+(f-1)<i&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!He(e,o,l,i,ne,t))return"contradiction";s=!0}else if(u){if(!He(e,o,l,i,re,t))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(t,e,r,n,o);return"contradiction"!==s&&("solved"===s&&function(e,r,n,t){const o=he(e,n,t);for(let s=0;s<=n;s++)for(let e=0;e<=t;e++){const n=r[s]?.[e];if(null!=n&&o[s]?.[e]!==n)return!1}return!0}(t,e,r,n))}function We(e,r){let n=[],t=!1;for(let s=0;s<50&&!t;s++){n=Array.from({length:e},()=>new Array(r).fill(0));const o=new se((e+1)*(r+1)),s=[];for(let n=0;n<e;n++)for(let e=0;e<r;e++)s.push({r:n,c:e});for(let e=s.length-1;e>0;e--){const r=Math.floor(Math.random()*(e+1)),n=s[e],t=s[r];n&&t&&(s[e]=t,s[r]=n)}let l=!1;for(const{r:e,c:t}of s){const s=le(e,t+1,r),i=le(e+1,t,r),a=o.connected(s,i),c=le(e,t,r),u=le(e+1,t+1,r),d=o.connected(c,u);if(a&&d){l=!0;break}const f=n[e];f&&(a?(f[t]=ne,o.union(c,u)):d||Math.random()<.5?(f[t]=re,o.union(s,i)):(f[t]=ne,o.union(c,u)))}l||(t=!0)}t||(n=Array.from({length:e},(e,n)=>new Array(r).fill(n%2==0?re:ne)));const o=function(e,r,n,t){const o=e.map(e=>[...e]),s=[];for(let a=0;a<=r;a++)for(let e=0;e<=n;e++)s.push({r:a,c:e});for(let a=s.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1)),r=s[a],n=s[e];r&&n&&(s[a]=n,s[e]=r)}const l=Math.floor((r+1)*(n+1)*t);let i=0;for(let a=0;a<=r;a++)for(let e=0;e<=n;e++)null!==o[a]?.[e]&&i++;for(const{r:a,c:c}of s){if(i<=l)break;const e=o[a];if(!e)continue;const t=e[c];null!=t&&(e[c]=null,Ge(o,r,n)?i--:e[c]=t)}return o}(he(n,e,r).map(e=>e.map(e=>e)),e,r,X);return{numbers:o,solution:n}}const _e=y({getInitialState:qe,customHandler:(e,r)=>{if("toggle"!==r.type)return null;if(e.solved)return e;const{row:n,col:t}=r,o=e.grid.map(e=>[...e]),l=o[n];if(!l)return e;const i=l[t];if(void 0===i)return e;r.reverse?l[t]=0===i?re:i===re?ne:0:l[t]=0===i?ne:i===ne?re:0;let a=!1;if(o.every(e=>e.every(e=>0!==e))){const r=he(o,e.rows,e.cols);e.numbers.every((e,n)=>e.every((e,t)=>null==e||e===r[n]?.[t]))&&!function(e,r,n){const t=new se((r+1)*(n+1));for(let o=0;o<r;o++){const r=e[o];if(r)for(let e=0;e<n;e++){const s=r[e];if(void 0===s||0===s)continue;const l=le(o,s===re?e+1:e,n),i=le(o+1,s===re?e:e+1,n);if(!t.union(l,i))return!0}}return!1}(o,e.rows,e.cols)&&(a=!0)}const c=function(e,r,n,t){const o=new Set,l=he(e,n,t);for(let i=0;i<=n;i++)for(let a=0;a<=t;a++){const c=r[i]?.[a];if(null==c)continue;const u=l[i]?.[a]??0;u>c?o.add(s(i,a)):u+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:r,gc:o})=>r>=0&&r<n&&o>=0&&o<t&&0===e[r]?.[o]).length<c&&o.add(s(i,a))}return o}(o,e.numbers,e.rows,e.cols),u=ie(o,e.rows,e.cols),d=ye(o,e.numbers,e.rows,e.cols);return{...e,grid:o,solved:a,errorNodes:c,cycleCells:u,satisfiedNodes:d}}});function qe(e,r){const{numbers:n,solution:t}=We(e,r);return{grid:Array.from({length:e},()=>new Array(r).fill(0)),numbers:n,solution:t,rows:m(e),cols:m(r),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Ue(){const e=$("sm"),[t,o]=r.useState(!1),{isOpen:a,toggle:c}=b(),u=n.useRef(null),d=n.useRef({rows:0,cols:0}),f=n.useCallback((e,r,n)=>{t||function(e,r,n){const t=Re(r,n);try{localStorage.setItem(t,JSON.stringify(Ie(e)))}catch{}}(e,r,n)},[t]),{generating:p,requestGeneration:h,handleNextAsync:y,prefetch:m,cancelGeneration:v}=je({getInitialState:qe,dispatchRef:u,dimsRef:d,onStaleResult:f}),{rows:w,cols:A,state:C,dispatch:k,size:E,controlsProps:R}=x({...ke(e),logic:{reducer:_e,getInitialState:(e,r)=>qe(e,r),onNext:y,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!t,serialize:Ie,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const r=e;return Array.isArray(r.grid)&&Array.isArray(r.numbers)&&Array.isArray(r.solution)&&"number"==typeof r.rows&&"number"==typeof r.cols&&"boolean"==typeof r.solved&&Array.isArray(r.errorNodes)&&Array.isArray(r.cycleCells)&&Array.isArray(r.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});u.current=k,d.current={rows:w,cols:A};const{analysisMoves:I,boardSx:M,handleAnalysisMove:N,handleAnalysisCopy:j,handleAnalysisClear:O,handleAnalysisClose:z,handleBoxClick:D,handleOpenAnalysis:T}=function({isAnalysisMode:e,setIsAnalysisMode:r,state:t,rows:o,cols:l,storageKey:i,toggleInfo:a}){const[c,u]=n.useState(new Map);g({storageKey:i,rows:o,cols:l,state:c,onRestore:e=>{u(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const d=n.useRef("");n.useEffect(()=>{const e=JSON.stringify(t.numbers);d.current&&d.current!==e&&u(new Map),d.current=e},[t.numbers,t.rows,t.cols]);const f=n.useCallback((e,r)=>{u(n=>{const t=new Map(n);return void 0===r?t.delete(e):t.set(e,r),t})},[]),p=n.useCallback(()=>{const e=new Map;t.grid.forEach((r,n)=>{r.forEach((r,t)=>{0!==r&&e.set(s(n,t),r)})}),u(e)},[t.grid]),h=n.useCallback(()=>{u(new Map)},[]),y=n.useCallback(()=>{r(!1)},[r]),m=n.useCallback(e=>{e.stopPropagation()},[]);return{analysisMoves:c,boardSx:n.useMemo(()=>e?{padding:{xs:0,sm:0}}:void 0,[e]),handleAnalysisMove:f,handleAnalysisCopy:p,handleAnalysisClear:h,handleAnalysisClose:y,handleBoxClick:m,handleOpenAnalysis:n.useCallback(()=>{a(),r(!0)},[a,r])}}({isAnalysisMode:t,setIsAnalysisMode:o,state:C,rows:w,cols:A,storageKey:J.ANALYSIS_MOVES,toggleInfo:c});Me({rows:w,cols:A,isAnalysisMode:t,requestGeneration:h,cancelGeneration:v}),n.useEffect(()=>{C.solved&&!t&&m(w,A)},[C.solved,t,w,A,m]);const{getDragProps:P}=l({onToggle:(e,r,n)=>{k({type:"toggle",row:S(e),col:S(r),reverse:n})},checkEnabled:()=>!C.solved,touchTimeout:i.timing.touchHoldDelay});return $e({game:{state:C,rows:w,cols:A,size:E,mobile:e,isAnalysisMode:t,generating:p,handleNextAsync:y},analysis:{analysisMoves:I,handleAnalysisMove:N,handleAnalysisCopy:j,handleAnalysisClear:O,handleAnalysisClose:z,handleBoxClick:D,handleOpenAnalysis:T,boardSx:M},info:{infoOpen:a,toggleInfo:c},controls:R,getDragProps:P})}function Ye(){const{boardProps:r,controlsProps:n,layoutProps:t,infoProps:o,trophyProps:s}=Ue();return e.jsxs(v,{title:M.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",controls:e.jsx(w,{...n}),trophyProps:s,layout:{paddingBottom:{xs:"120px",md:"150px"},contentSx:t.contentSx,boardSx:t.boardSx},onClick:r.isAnalysisMode?r.onAnalysisClose:void 0,children:[e.jsx(N,{onClick:o.handleBoxClick,children:e.jsx(de,{...r})}),e.jsx(Ee,{...o})]})}export{Ye as Slant};
