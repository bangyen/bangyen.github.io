import{r as t,j as r}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-DtMIusvS.js";import{a as n}from"./index-D8hKsJFF.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(t,r)=>{const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(t)}return e},c=(t,r,e,n,o=!1)=>{const a=[],{row:i,col:l}=t;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([t,i])=>{if(void 0!==t&&void 0!==i&&t>=0&&t<e&&i>=0&&i<n&&r[t]?.[i]?.visited===o){const e=r[t][i];a.push(e)}}),a},u=(t,r)=>{const e=t.row-r.row,n=t.col-r.col;1===e?(t.walls.top=!1,r.walls.bottom=!1):-1===e?(t.walls.bottom=!1,r.walls.top=!1):1===n?(t.walls.left=!1,r.walls.right=!1):-1===n&&(t.walls.right=!1,r.walls.left=!1)};const f={backtracker:function(t,r,e){const n=[],o=t[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,t,r,e,!1);if(a.length>0){const t=a[Math.floor(Math.random()*a.length)];t&&(u(o,t),t.visited=!0,n.push(t))}else n.pop()}},prims:function(t,r,e){const n=t[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,t,r,e,!1).map(t=>({parent:n,cell:t}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,t,r,e,!1).forEach(t=>{o.push({parent:l,cell:t})})}}}};const g=21,d=100;function p(){const c=t.useRef(null),u=t.useRef(null),[p,m]=t.useState(null),[y,h]=t.useState("start"),[w]=t.useState("backtracker"),v=t.useRef({player:{x:0,y:0,vx:0,vy:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:x,width:b}=o(),C=a("sm"),k=x-(C?56:80),T=t.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[M,E]=t.useState({active:!1,originConfig:null,currentConfig:null}),S=t.useCallback(()=>{const t=function(t,r,e="backtracker"){const n=s(t,r);return(0,f[e])(n,t,r),{grid:n,rows:t,cols:r,start:[0,0],end:[t-1,r-1]}}(g,g,w);m(t),v.current.player={x:t.start[1]*d+50,y:t.start[0]*d+50,vx:0,vy:0,rotation:0},v.current.goal={x:t.end[1]*d+50,y:t.end[0]*d+50,rotation:0},v.current.gameState="playing",v.current.lastTime=0,h("playing")},[w]);t.useEffect(()=>{S()},[S]),t.useEffect(()=>{if(!c.current)return;const t=c.current,r=window.devicePixelRatio||1;t.width=b*r,t.height=k*r;const e=t.getContext("2d");e&&e.scale(r,r)},[b,k]),t.useEffect(()=>{if(!p||"playing"!==y||!c.current)return;const t=c.current,r=t.getContext("2d",{alpha:!0});if(!r)return;let e;const o={},a=t=>{o[t.key.toLowerCase()]=!0},i=t=>{o[t.key.toLowerCase()]=!1};window.addEventListener("keydown",a),window.addEventListener("keyup",i);const l=a=>{e=requestAnimationFrame(l);const i=v.current.lastTime?(a-v.current.lastTime)/16.67:1;v.current.lastTime=a;const s=r=>{if(r.startsWith("var(")){const e=r.slice(4,-1);return getComputedStyle(t).getPropertyValue(e).trim()||"#ffffff"}return r},c=s(n.text.primary),u=s(n.primary.main),f=s(n.primary.dark),m=s(n.primary.main),y=1.2*i,w=Math.pow(.88,i),x=(o.d||o.arrowright?1:0)-(o.a||o.arrowleft?1:0),C=(o.s||o.arrowdown?1:0)-(o.w||o.arrowup?1:0);let M=0,E=0;T.current.isDown&&(M=Math.max(-1,Math.min(1,(T.current.currentX-T.current.startX)/80)),E=Math.max(-1,Math.min(1,(T.current.currentY-T.current.startY)/80)));const j=x+M,X=C+E;v.current.player.vx+=j*y,v.current.player.vy+=X*y,v.current.player.vx*=w,v.current.player.vy*=w;const Y=(t,r)=>{const e=Math.floor(t/d),n=Math.floor(r/d);if(n<0||n>=g||e<0||e>=g)return!0;const o=p.grid[n]?.[e];if(!o)return!0;const a=e*d,i=(e+1)*d,l=n*d,s=(n+1)*d;return!!(o.walls.left&&t-14<a)||(!!(o.walls.right&&t+14>i)||(!!(o.walls.top&&r-14<l)||!!(o.walls.bottom&&r+14>s)))},P=v.current.player.x+v.current.player.vx*i;Y(P,v.current.player.y)?v.current.player.vx*=-.8:v.current.player.x=P;const L=v.current.player.y+v.current.player.vy*i;Y(v.current.player.x,L)?v.current.player.vy*=-.8:v.current.player.y=L;const A=Math.sqrt(v.current.player.vx**2+v.current.player.vy**2);v.current.player.rotation+=.05*A*i,A>.1&&v.current.trail.push({x:v.current.player.x,y:v.current.player.y});const D=v.current.trail;D.length>(A>.1?15:0)&&D.shift();const R=1-Math.pow(.9,i);v.current.camera.x+=(v.current.player.x-v.current.camera.x)*R,v.current.camera.y+=(v.current.player.y-v.current.camera.y)*R;Math.sqrt(Math.pow(v.current.player.x-v.current.goal.x,2)+Math.pow(v.current.player.y-v.current.goal.y,2))<30&&"playing"===v.current.gameState&&(v.current.gameState="won",h("won"),setTimeout(()=>{S()},1500)),r.clearRect(0,0,b,k),r.save(),r.translate(b/2-v.current.camera.x,k/2-v.current.camera.y);const q=50,W=v.current.camera.x-b/2,B=v.current.camera.x+b/2,_=v.current.camera.y-k/2,F=v.current.camera.y+k/2;r.beginPath(),r.strokeStyle=m,r.lineWidth=1,r.globalAlpha=.03;for(let t=Math.floor(W/q)*q;t<=B;t+=q)r.moveTo(t,_),r.lineTo(t,F);for(let t=Math.floor(_/q)*q;t<=F;t+=q)r.moveTo(W,t),r.lineTo(B,t);r.stroke(),r.globalAlpha=1,r.strokeStyle=u,r.lineWidth=4,r.lineCap="round",r.shadowColor=u,r.shadowBlur=0;const G=12;r.beginPath();for(let t=0;t<=g;t++)for(let e=0;e<=g;e++){const n=e*d,o=t*d,a=t>0&&(e<g?p.grid[t-1]?.[e]?.walls.left??!1:p.grid[t-1]?.[e-1]?.walls.right??!1),i=t<g&&(e<g?p.grid[t]?.[e]?.walls.left??!1:p.grid[t]?.[e-1]?.walls.right??!1),l=e>0&&(t<g?p.grid[t]?.[e-1]?.walls.top??!1:p.grid[t-1]?.[e-1]?.walls.bottom??!1),s=e<g&&(t<g?p.grid[t]?.[e]?.walls.top??!1:p.grid[t-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(r.moveTo(n,o-G),r.arcTo(n,o,n+G,o,G)):s&&i&&!l&&!a?(r.moveTo(n+G,o),r.arcTo(n,o,n,o+G,G)):i&&l&&!a&&!s?(r.moveTo(n,o+G),r.arcTo(n,o,n-G,o,G)):l&&a&&!s&&!i&&(r.moveTo(n-G,o),r.arcTo(n,o,n,o-G,G))),i){const a=2===c&&(l||s)?o+G:o,i=t+1,u=i<g&&(e<g?p.grid[i]?.[e]?.walls.left??!1:p.grid[i]?.[e-1]?.walls.right??!1),f=e>0&&(i<g?p.grid[i]?.[e-1]?.walls.top??!1:p.grid[i-1]?.[e-1]?.walls.bottom??!1),m=e<g&&(i<g?p.grid[i]?.[e]?.walls.top??!1:p.grid[i-1]?.[e]?.walls.bottom??!1),y=2===1+(u?1:0)+(f?1:0)+(m?1:0)&&(f||m)?(t+1)*d-G:(t+1)*d;r.moveTo(n,a),r.lineTo(n,y)}if(s){const l=2===c&&(a||i)?n+G:n,s=e+1,u=t>0&&(s<g?p.grid[t-1]?.[s]?.walls.left??!1:p.grid[t-1]?.[s-1]?.walls.right??!1),f=t<g&&(s<g?p.grid[t]?.[s]?.walls.left??!1:p.grid[t]?.[s-1]?.walls.right??!1),m=s<g&&(t<g?p.grid[t]?.[s]?.walls.top??!1:p.grid[t-1]?.[s]?.walls.bottom??!1),y=s*d-(2===1+(u?1:0)+(f?1:0)+(m?1:0)&&(u||f)?G:0);r.moveTo(l,o),r.lineTo(y,o)}}r.stroke(),r.shadowBlur=0;const H=v.current.goal;H.rotation+=.02*i,r.save(),r.translate(H.x,H.y),r.rotate(H.rotation),r.fillStyle=f,r.shadowColor=f,r.shadowBlur=0,r.beginPath(),r.rect(-10,-10,20,20),r.fill(),r.restore();const $=v.current.trail,z=$.length;if(z>2){r.save(),r.beginPath(),r.strokeStyle=c,r.lineWidth=12,r.lineCap="round",r.lineJoin="round";const t=$[0];if(t){r.moveTo(t.x,t.y);for(let t=1;t<z-1;t++){const e=$[t],n=$[t+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;r.globalAlpha=t/z*.15,r.quadraticCurveTo(e.x,e.y,o,a),r.stroke(),r.beginPath(),r.moveTo(o,a)}}}r.restore()}else if(z>1){const t=$[0],e=$[1];t&&e&&(r.save(),r.beginPath(),r.strokeStyle=c,r.lineWidth=12,r.lineCap="round",r.globalAlpha=.15,r.moveTo(t.x,t.y),r.lineTo(e.x,e.y),r.stroke(),r.restore())}const I=v.current.player;r.save(),r.translate(I.x,I.y),r.fillStyle=c,r.beginPath(),r.arc(0,0,12,0,2*Math.PI),r.fill(),r.restore(),r.restore()};return requestAnimationFrame(l),()=>{cancelAnimationFrame(e),window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}},[p,y,b,k,C,S]);const j=t=>{T.current.isDown&&(T.current.currentX=t.clientX,T.current.currentY=t.clientY,E(r=>{if(!r.originConfig)return r;const e=t.clientX-r.originConfig.x,n=t.clientY-r.originConfig.y,o=Math.sqrt(e*e+n*n);let a=t.clientX,i=t.clientY;if(o>50){const t=50/o;a=r.originConfig.x+e*t,i=r.originConfig.y+n*t}return{...r,currentConfig:{x:a,y:i}}}))},X=()=>{T.current.isDown=!1,E({active:!1,originConfig:null,currentConfig:null})};return t.useEffect(()=>(window.addEventListener("pointermove",j),window.addEventListener("pointerup",X),()=>{window.removeEventListener("pointermove",j),window.removeEventListener("pointerup",X)}),[]),t.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),r.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[r.jsx(e,{showHome:!0}),r.jsx(l,{ref:u,onPointerDown:t=>{"playing"===y&&(T.current.isDown=!0,T.current.startX=t.clientX,T.current.startY=t.clientY,T.current.currentX=t.clientX,T.current.currentY=t.clientY,E({active:!0,originConfig:{x:t.clientX,y:t.clientY},currentConfig:{x:t.clientX,y:t.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:r.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),M.active&&M.originConfig&&M.currentConfig&&r.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[r.jsx(l,{sx:{position:"absolute",left:M.originConfig.x,top:M.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),r.jsx(l,{sx:{position:"absolute",left:M.currentConfig.x,top:M.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{p as default};
