import{r as t,j as e,a as n}from"./vendor_react-WaSaIrII.js";import{a as o,L as r,T as s,R as i,d as c,e as a,g as l}from"./index-3zWJHZC5.js";import{C as d,u,c as f}from"./CustomGrid-B70c30cf.js";import{B as p,G as m,d as x,M as h,h as g,I as y,e as j}from"./vendor_mui_core-D4-4kcvK.js";import{G as b}from"./gameConfig-nraIanc0.js";import{G as v}from"./GlassCard-UZaaRbrk.js";import{k as w,l as S,C as k,K as C,m as z,n as I,R as $,o as E,p as P,q as A,r as M,s as D,M as L}from"./vendor_mui_icons-urSXftat.js";import{G as R}from"./GlobalHeader-CHP0jEOK.js";import{u as B}from"./useWindow-BCvkQ8_7.js";function T(t){const{frontProps:n,backProps:o,size:s,rows:i,cols:c}=t;return e.jsxs(p,{sx:{display:"grid",placeItems:"center"},children:[e.jsx(p,{sx:{gridArea:"1/1"},children:e.jsx(d,{space:0,size:s,rows:i-1,cols:c-1,cellProps:o})}),e.jsx(p,{sx:{gridArea:"1/1",zIndex:r.zIndex.base+1},children:e.jsx(d,{space:0,size:s,rows:i,cols:c,cellProps:n})})]})}function F(e,n){const o=t.useCallback((t,o)=>{const r=e(t,o);return{front:r?n.primary:n.secondary,back:r?n.secondary:n.primary}},[e,n]),r=t.useCallback((t,n)=>function(t,e,n){const o=n(t,e),r={},s=o===n(t-1,e),i=o===n(t+1,e),c=o===n(t,e-1),a=o===n(t,e+1);return(s||c)&&(r.borderTopLeftRadius=0),(s||a)&&(r.borderTopRightRadius=0),(i||c)&&(r.borderBottomLeftRadius=0),(i||a)&&(r.borderBottomRightRadius=0),r}(t,n,e),[e]),s=t.useCallback((t,o)=>{const r=function(t,e,n){const o=n(t,e),r=n(t,e+1),s=n(t+1,e),i=n(t+1,e+1);let c=!0;const a=Number(o)+Number(r)+Number(s)+Number(i);return o&&i||!(a<3)||(c=!1),c}(t,o,e);return r?n.primary:n.secondary},[e,n]);return{getColor:o,getBorder:r,getFiller:s}}function O(e,n){const{grid:o,rows:r,cols:s}=e;return F(t.useCallback((t,e)=>t<0||e<0||t>=r||e>=s?-1:o[t]?.[e]??-1,[o,r,s]),n)}function W(t,e){const n=t.length,o=[];for(let r=0;r<n;r++){const s=t[r];let i=0n;if(void 0!==s)for(let t=0;t<n;t++)if(s&1n<<BigInt(n-1-t)){const n=e[t];void 0!==n&&(i^=n)}o.push(i)}return o}function H(t){const e=Array(t).fill(1n);for(let n=0;n<t;n++){const o=e[n];void 0!==o&&(e[n]=o<<BigInt(t-n-1))}return e}function N(t,e,n){let o=H(t.length),r=[...t],s=e;for(;s>0;)s%2==1&&(o=W(o,r)),r=W(r,r),s=Math.floor(s/2);return o}function _(t,e){const n=t.length,o=[];for(let r=0;r<n;r++){const n=t[r],s=e[r];if(void 0!==n&&void 0!==s){const t=n^s;o.push(t)}}return o}function G(t,e){const n=t.length,o=[...Array(n).keys()].sort((e,n)=>{const o=t[n],r=t[e];return void 0===o||void 0===r?0:o>r?1:o<r?-1:0});return[o.map(e=>t[e]??0n),o.map(t=>e[t]??0n)]}const U={};function Y(t,e,n){const o=`${e.toString()},${n.toString()}`;if(!U[o]){const t=function(t){if(1===t)return[1n];const e=[7n<<BigInt(t-2)];for(let o=1;o<t;o++){const t=e[o-1];if(void 0!==t){const n=t>>1n;e.push(n)}}const n=e[0];return void 0!==n&&(e[0]=n-(1n<<BigInt(t))),e}(n),r=function(t,e){const n=t.length;let o=Array(n).fill(0n),r=0,s=e;for(;s>0n;)1n&s&&(o=_(o,N(t,r))),s>>=1n,r++;return o}(t,function(t){const e=[0n,1n];for(let n=1;n<t;n++){const t=e[n],o=e[n-1];if(void 0!==t&&void 0!==o){const n=t<<1n;e.push(n^o)}}return e[t]??0n}(e+1));U[o]=function(t){const e=t.length;let n=t,o=H(e);for(let r=0;r<e;r++){const t=1n<<BigInt(e-r-1);[n,o]=G(n,o);for(let s=0;s<e;s++){const e=n[s];if(void 0!==e&&s!==r&&e&t){const t=n[r],e=o[r];if(void 0!==t){const e=n[s];void 0!==e&&(n[s]=e^t)}if(void 0!==e){const t=o[s];void 0!==t&&(o[s]=t^e)}}}}return o}(r)}const r=U[o],s=t.join(""),i=s?BigInt("0b"+s):0n;return r.map(t=>1&function(t){let e=0,n=t;if(n<0n)throw new Error("countBits called on negative bigint");for(;n>0n;)n&=n-1n,e++;return e}(t&i))}function K(t,e){return Array.from({length:t},()=>Array(e).fill(0))}function X(t,e,n){const o=n.length,r=n.map(t=>[...t]),s=r[t];if(s&&e>=0&&e<s.length){const t=s[e];void 0!==t&&(s[e]=1^t)}if(t>0){const n=r[t-1];if(n&&e>=0&&e<n.length){const t=n[e];void 0!==t&&(n[e]=1^t)}}if(t<o-1){const n=r[t+1];if(n&&e>=0&&e<n.length){const t=n[e];void 0!==t&&(n[e]=1^t)}}if(s){if(e>0){const t=s[e-1];void 0!==t&&(s[e-1]=1^t)}if(e<s.length-1){const t=s[e+1];void 0!==t&&(s[e+1]=1^t)}}return r}function q(t,e){const n=K(t,e);for(let o=0;o<t;o++)for(let r=0;r<e;r++)if(Math.random()>.5){const s=[[o,r],[o-1,r],[o+1,r],[o,r-1],[o,r+1]];for(const o of s){const r=o[0],s=o[1];if(void 0!==r&&void 0!==s&&r>=0&&r<t&&s>=0&&s<e){const t=n[r];if(t&&s>=0&&s<t.length){const e=t[s];void 0!==e&&(t[s]=1^e)}}}}return n}function Z(t){const e=t.length,n=t[0],o=n?n.length:0;for(let s=0;s<e-1;s++){const e=t[s];if(e)for(let t=0;t<o;t++)if(1===e[t])return[{row:s+1,col:t}]}const r=t[e-1];if(r?.some(t=>1===t)){const t=function(t,e,n){const o=Y(n,t,e),r=[];return o.forEach((t,e)=>{1===t&&r.push(e)}),r.length>0?r:null}(e,o,r);if(t&&t.length>0)return t.map(t=>({row:0,col:t}))}return null}function J(t,e){const{type:n,row:o,col:r,moves:s}=e;let{grid:i,score:c,rows:a,cols:l,auto:d,initialized:u}=t;switch(n){case"auto":d=!d;break;case"adjacent":void 0!==o&&void 0!==r&&(i=X(o,r,i));break;case"multi_adjacent":s&&s.forEach(t=>{i=X(t.row,t.col,i)});break;case"random":case"randomize":i=q(a,l),d=!1;break;case"resize":{const{newRows:t,newCols:n}=e;void 0!==t&&void 0!==n&&(a=t,l=n,i=q(a,l),d=!1,u=!0);break}case"reset":i=K(a,l),c=0,d=!1;break;case"next":i=q(a,l),c+=1}return{grid:i,score:c,rows:a,cols:l,auto:d,initialized:u||!1}}function Q(t,e){const n=[...t];let o=t.at(-1);if(!o)return n;for(let r=1;r<e;r++)for(let t=0;t<e;t++){if(!o[r-1]?.[t])continue;const e=X(r,t,o);n.push(e),o=e}return n}function V(t,e){const n=t.at(-1);if(!n)return t;const o=[...t];for(;o.length<e;)o.push([...n]);return o}function tt(t,e){let n=K(e,e);for(const x of t){n=X(Math.floor(x/e),x%e,n)}const o=Q([n],e),r=o.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const s=r.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:c}=function(t,e){const n=Array(e).fill(0),o=[n],r=[n],s=[...n];for(let i=0;i<e;i++){if(!t[i])continue;s[i]=1;const n=[...s],c=Y(n,e,e);o.push(n),r.push(c)}return{input:o,output:r}}(s,e),a=o.length+i.length+1,l=c.at(-1);if(!l)return{boardStates:[],inputStates:[],outputStates:[]};let d=[...r];for(let x=0;x<a-o.length;x++)o.push([...r]);const u=i[0];for(let x=0;x<a-i.length;x++)u&&i.unshift([...u]);const f=c[0];for(let x=0;x<a-c.length;x++)f&&c.unshift([...f]);for(let x=0;x<e;x++)l[x]&&(d=X(0,x,d),o.push([...d]));const p=Q(o,e),m=p.length;return{boardStates:p,inputStates:V(i,m),outputStates:V(c,m)}}const et={FAST:"all 100ms ease-in-out",DEFAULT:"all 200ms ease"},nt={DROP:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))"},ot=500,rt=2e3,st=300,it=1.25,ct={MOBILE:-28,DESKTOP:-40},at="lights-out-size";function lt({getColor:t,getBorder:n}){return(o,r)=>{const{front:s}=t(o,r);return{backgroundColor:s,color:s,children:e.jsx(w,{}),style:n(o,r),sx:{transition:et.DEFAULT}}}}function dt(e,n,o){return F(t.useCallback((t,o)=>0!==t||o<0||o>=n?-1:e[o],[e,n]),o)}function ut(t,e,n,o,r,s=1){const i=t.length,c={},a=100/i;for(let l=0;l<i;l++){const d=l*a,u=(l+1)*a;let f=r.secondary,p=!1,m="";const x=t[l],h=l+1<i?t[l+1]:null;if(x&&h){const t=X(e,n,x);p=!0;for(let e=0;e<o;e++){const n=t[e],r=h[e];if(!n||!r){p=!1;break}for(let t=0;t<o;t++)if(n[t]!==r[t]){p=!1;break}if(!p)break}if(p){f=1===x[e]?.[n]?r.secondary:r.primary,m=`"${String(l+1)}"`}}p?(c[`${String(d)}%`]={opacity:0,content:m,color:f,transform:"scale(0.5)"},c[`${String(d+a*(.1/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1.2)"},c[`${String(d+a*(.2/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1)"},c[`${String(u-a*(.1/s))}%`]={opacity:1,content:m,color:f,transform:"scale(1)"},c[`${String(u)}%`]={opacity:0,content:m,color:f,transform:"scale(0.5)"}):(c[`${String(d)}%`]={opacity:0,content:'""',color:f,transform:"scale(0.5)"},c[`${String(u)}%`]={opacity:0,content:'""',color:f,transform:"scale(0.5)"})}return c}function ft({start:n=[],dims:r=3,size:s,palette:i,getFrontProps:c,getBackProps:a}){const[l,u]=t.useState(0);t.useEffect(()=>{const t=setInterval(()=>{u(t=>t+1)},2e3);return()=>{clearInterval(t)}},[]);const f=tt(n,r),h=s,{boardStates:g,inputStates:y,outputStates:j}=f,b=l%y.length,v=b===y.length-1,w=O({grid:g[b]??g[0]??[],rows:r,cols:r},i),k=c(w),C=a(w),z=function(t,n,o,r){return(s,i)=>{const c=ut(t,s,i,n,r),a=t.length,l=`${o}-board-icon-${String(s)}-${String(i)}`;return{icon:e.jsx(p,{sx:{width:"100%",height:"100%",position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2,"&::after":{content:'""',fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:nt.DROP,paddingTop:{xs:"0.08rem",sm:"0.15rem"},animation:`${l} ${String(2*a)}s linear infinite`}}}),keyframes:c,keyframeName:l}}}(g,r,"example",i),I=dt(y[b]??[],r,i),$=dt(j[b]??[],r,i),E=lt(I),P=lt($),A=function(t,n,o,r){return(n,s)=>{const i=t.length,c={},a=100/i;for(let e=0;e<i;e++){const n=e*a,o=(e+1)*a;let l=r.secondary,d=!1,u="";const f=t[e],p=e+1<i?t[e+1]:null;f&&p&&f[s]!==p[s]&&(d=!0,l=1===f[s]?r.secondary:r.primary,u=`"${String(e+1)}"`),d?(c[`${String(n)}%`]={opacity:0,content:u,color:l,transform:"scale(0.5)"},c[`${String(n+.05*a)}%`]={opacity:1,content:u,color:l,transform:"scale(1.2)"},c[`${String(n+.1*a)}%`]={opacity:1,content:u,color:l,transform:"scale(1)"},c[`${String(o-.05*a)}%`]={opacity:1,content:u,color:l,transform:"scale(1)"},c[`${String(o)}%`]={opacity:0,content:u,color:l,transform:"scale(0.5)"}):(c[`${String(n)}%`]={opacity:0,content:'""',color:l,transform:"scale(0.5)"},c[`${String(o)}%`]={opacity:0,content:'""',color:l,transform:"scale(0.5)"})}const l=`${o}-input-icon-${String(n)}-${String(s)}`;return{icon:e.jsx(p,{sx:{width:"100%",height:"100%",position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",zIndex:2,"&::after":{content:'""',fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:nt.DROP,paddingTop:{xs:"0.08rem",sm:"0.15rem"},animation:`${l} ${String(2*i)}s linear infinite`}}}),keyframes:c,keyframeName:l}}}(y,0,"example",i);return e.jsx(pt,{boardStates:g,inputStates:y,dims:r,id:"example",palette:i,children:e.jsx(m,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:e.jsxs(m,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%",overflow:"hidden"},children:[e.jsx(m,{size:6,sx:{display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:e.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(T,{size:h,rows:r,cols:r,frontProps:(t,n)=>{const o=k(t,n),r=z(t,n);return{...o,children:e.jsxs(e.Fragment,{children:[o.children,r.icon]}),sx:{...o.sx,position:"relative"}}},backProps:C}),e.jsx(p,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:v?1:0,transform:v?"scale(1)":"scale(0.5)",visibility:v?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",pointerEvents:"none",zIndex:10},children:(()=>{const t=g[y.length-1],n=t?.flat().every(t=>1===t);return e.jsx(S,{sx:{fontSize:{xs:"2.5rem",sm:"4rem"},color:n?i.secondary:i.primary}})})()})]})}),e.jsxs(m,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs(p,{sx:{mb:2,textAlign:"center"},children:[e.jsx(x,{variant:"subtitle2",sx:{mb:1,color:o.text.secondary},children:"Input"}),e.jsx(d,{rows:1,cols:r,size:h,cellProps:(t,n)=>{const o=E(t,n),r=A(t,n);return{...o,children:e.jsxs(e.Fragment,{children:[o.children,r.icon]}),sx:{...o.sx,position:"relative"}}},space:0})]}),e.jsxs(p,{sx:{textAlign:"center"},children:[e.jsx(d,{rows:1,cols:r,size:h,cellProps:P,space:0}),e.jsx(x,{variant:"subtitle2",sx:{mt:1,color:o.text.secondary},children:"Result"})]})]})]})})})}function pt({boardStates:n,inputStates:o,dims:r,id:s,palette:i,children:c}){const a=t.useMemo(()=>[...n.flatMap((t,e)=>Array.from({length:r},(t,o)=>({name:`${s}-board-icon-${String(e)}-${String(o)}`,frames:ut(n,e,o,r,i)}))),...o.flatMap((t,e)=>{const n=`${s}-input-icon-0-${String(e)}`,r={},c=o.length,a=100/c;for(let s=0;s<c;s++){const t=s*a,n=(s+1)*a;let l=!1,d=i.secondary,u="";const f=o[s],p=s+1<c?o[s+1]:null;f&&p&&f[e]!==p[e]&&(l=!0,u=`"${String(s+1)}"`,d=1===f[e]?i.secondary:i.primary),l?(r[`${String(t)}%`]={opacity:0,content:u,color:d,transform:"scale(0.5)"},r[`${String(t+.05*a)}%`]={opacity:1,content:u,color:d,transform:"scale(1.2)"},r[`${String(t+.1*a)}%`]={opacity:1,content:u,color:d,transform:"scale(1)"},r[`${String(n-.05*a)}%`]={opacity:1,content:u,color:d,transform:"scale(1)"},r[`${String(n)}%`]={opacity:0,content:u,color:d,transform:"scale(0.5)"}):(r[`${String(t)}%`]={opacity:0,content:'""',color:d},r[`${String(n)}%`]={opacity:0,content:'""',color:d})}return{name:n,frames:r}})],[n,o,r,s,i]);return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:a.map(t=>`\n                @keyframes ${t.name} {\n                    ${Object.entries(t.frames).map(([t,e])=>`\n                        ${t} {\n                            ${Object.entries(e).map(([t,e])=>`${t.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}: ${e};`).join(" ")}\n                        }\n                    `).join("")}\n                }\n            `).join("")}),c]})}const mt=({children:t})=>e.jsx(x,{variant:"h5",sx:{color:o.text.primary,fontWeight:s.fontWeight.bold,textAlign:"left",fontSize:s.fontSize.h2},children:t}),xt=({Icon:t,title:n,text:r})=>e.jsxs(p,{sx:{px:2},children:[e.jsxs(x,{variant:"h6",sx:{color:o.text.primary,fontWeight:s.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:s.fontSize.subheading},children:[e.jsx(t,{sx:{mr:2,color:o.primary.main,fontSize:"1.75rem"}}),n]}),e.jsx(x,{variant:"body1",sx:{color:o.text.secondary,lineHeight:1.6,fontSize:s.fontSize.body,ml:6},children:r})]}),ht=["Chasing Lights","How It Works","Calculator"],gt=v;function yt(n){const{rows:r,cols:s,size:c,open:a,palette:l,toggleOpen:f,getFrontProps:m,getBackProps:b}=n,v=u("md"),[S,M]=t.useState(0),[D,L]=t.useState(Array(s).fill(0)),[R,B]=t.useState(!1),T=t.useRef(new Set),F=t.useRef(0);t.useEffect(()=>{L(Array(s).fill(0))},[s,l]);const O=t.useCallback(t=>{const e=[...D];void 0!==e[t]&&(e[t]^=1),L(e)},[D]),W=Y(D,r,s);t.useEffect(()=>{const t=()=>{B(!1),T.current.clear()},e=t=>{if(!R||2!==S)return;const e=t.touches[0];if(!e)return;const n=document.elementFromPoint(e.clientX,e.clientY);if(!n)return;const o=n.closest("[data-col]");if(o){const t=o.getAttribute("data-col");if(null!==t){const e=parseInt(t,10);T.current.has(e)||(O(e),T.current.add(e))}}};return window.addEventListener("mouseup",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t),window.addEventListener("touchmove",e,{passive:!1}),()=>{window.removeEventListener("mouseup",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t),window.removeEventListener("touchmove",e)}},[R,S,O]);const H=t.useCallback(t=>{T.current.add(t)},[]),N=dt(D,s,l),_=dt(W,s,l),G=function(t,n,o=!1,r=()=>{},s,i=()=>{},c){const{getColor:a,getBorder:l}=t;return(t,d)=>{const{front:u,back:f}=a(t,d);return{backgroundColor:u,style:l(t,d),onMouseDown:t=>{0===t.button&&(Date.now()-c.current<ot||(r(!0),n(d),i(d)))},onMouseEnter:()=>{o&&!s.current.has(d)&&(n(d),i(d))},onTouchStart:t=>{t.cancelable&&t.preventDefault(),c.current=Date.now(),r(!0),n(d),i(d)},"data-col":d.toString(),sx:{"&:hover":{cursor:"pointer",color:f},touchAction:"none",transition:et.DEFAULT},color:u,children:e.jsx(w,{})}}}(N,O,R,B,T,H,F),U=lt(_),K=()=>{f()},X=`#${i.pages.LightsOutResearch}`;let q;return q=v?e.jsx(y,{component:"a",href:X,size:"small",sx:{color:o.text.secondary},children:e.jsx(A,{})}):e.jsx(j,{component:"a",href:X,variant:"outlined",size:"small",startIcon:e.jsx(A,{}),sx:{borderColor:o.border.subtle,color:o.text.secondary,fontSize:"0.75rem",py:.75,px:1.5,"&:hover":{borderColor:o.primary.main,color:o.primary.main,backgroundColor:o.interactive.hover}},children:"Analysis"}),e.jsx(h,{open:a,onClose:K,slots:{backdrop:g},slotProps:{backdrop:{sx:{backgroundColor:t=>"dark"===t.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)",transition:"all 0.3s ease-in-out !important"}}},sx:{zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(p,{sx:{outline:"none",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsxs(gt,{onClick:t=>{t.stopPropagation()},sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[e.jsxs(p,{sx:{flex:1,overflowY:1===S?"hidden":"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsx(mt,{children:ht[S]}),e.jsxs(p,{sx:{display:"flex",gap:2,alignItems:"center"},children:[q,e.jsx(y,{onClick:K,size:"small",sx:{color:o.text.secondary},children:e.jsx(k,{})})]})]}),0===S&&e.jsx(p,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[e.jsx(xt,{Icon:C,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),e.jsx(xt,{Icon:z,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),e.jsx(xt,{Icon:I,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===S&&e.jsx(p,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:e.jsx(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(ft,{dims:3,size:.7*c,start:[1,3,8],palette:l,getFrontProps:m,getBackProps:b})})}),2===S&&e.jsx(p,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[e.jsxs(p,{children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Input"," ",e.jsx(p,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),e.jsx(d,{space:0,rows:1,cols:s,size:c*(v?.9:.8),cellProps:G})]}),e.jsxs(p,{children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:o.text.primary,fontWeight:"bold"},children:["Solution"," ",e.jsx(p,{component:"span",sx:{color:o.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),e.jsx(d,{space:0,rows:1,cols:s,size:c*(v?.9:.8),cellProps:U})]}),e.jsx(p,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(j,{variant:"outlined",size:"small",startIcon:e.jsx($,{}),onClick:()=>{L(Array(s).fill(0))},sx:{borderColor:o.border.subtle,color:o.text.secondary},children:"Clear Pattern"})})]})})]}),e.jsxs(p,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(j,{onClick:()=>{S>0&&M(S-1)},disabled:0===S,startIcon:e.jsx(E,{}),sx:{visibility:0===S?"hidden":"visible",color:o.text.primary},children:"Back"}),e.jsx(p,{sx:{display:"flex",gap:1},children:[0,1,2].map(t=>e.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:S===t?o.primary.main:o.interactive.disabled,transition:"background-color 0.3s"}},t))}),e.jsx(j,{onClick:()=>{S<2?M(S+1):f()},disabled:2===S,endIcon:e.jsx(P,{}),sx:{visibility:2===S?"hidden":"visible",color:o.text.primary},children:"Next"})]})]}),e.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})})}function jt(t,n,o=!1,r=()=>{},s,i=()=>{},c){const{getColor:a,getBorder:l}=t,d=(t,e)=>{n({type:"adjacent",row:t,col:e})};return(t,n)=>{const u=l(t,n),{front:f,back:p}=a(t,n),m=`${t.toString()},${n.toString()}`;return{onMouseDown:e=>{0===e.button&&(Date.now()-c.current<ot||(r(!0),d(t,n),i(m)))},onMouseEnter:()=>{o&&!s.current.has(m)&&(d(t,n),i(m))},onTouchStart:e=>{e.cancelable&&e.preventDefault(),c.current=Date.now(),r(!0),d(t,n),i(m)},"data-pos":m,children:e.jsx(w,{}),backgroundColor:f,color:f,style:u,sx:{"&:hover":{cursor:"pointer",color:p},touchAction:"none",transition:et.FAST}}}}function bt(t){return(e,n)=>({backgroundColor:t.getFiller(e,n)})}function vt(t){const e=jt(t,()=>{},!1,()=>{},{current:new Set},()=>{},{current:0});return(t,n)=>({...e(t,n),onMouseDown:void 0,onMouseEnter:void 0,sx:void 0})}function wt(){const{height:s,width:i}=B(),d=u("sm"),x=d?b.gridSizes.mobile:b.gridSizes.desktop,[h,g]=t.useState(()=>{const t=localStorage.getItem(at);return t&&"null"!==t?parseInt(t,10):null}),y=t.useMemo(()=>{const t=d?r.headerHeight.xs:r.headerHeight.md,e=f(x,s-t,Math.min(i,1300));let n=e.rows-1;const o=e.cols-1;return d&&(n-=2),{rows:Math.max(2,n),cols:Math.max(2,o)}},[x,s,i,d]),{rows:j,cols:v}=t.useMemo(()=>null===h?y:{rows:Math.min(h,y.rows),cols:Math.min(h,y.cols)},[h,y]);t.useEffect(()=>{localStorage.setItem(at,String(h))},[h]);const w=t.useMemo(()=>({grid:K(j,v),score:0,rows:j,cols:v,auto:!1,initialized:!1}),[j,v]),[k,C]=t.useReducer(J,w),[z,I]=t.useReducer(t=>!t,!1),[$,E]=t.useState(!1),P=t.useRef(new Set),A=t.useRef(0),F=t.useCallback(t=>{P.current.add(t)},[]);t.useEffect(()=>{const t=()=>{E(!1),P.current.clear()},e=t=>{if(!$)return;const e=t.touches[0];if(!e)return;const n=document.elementFromPoint(e.clientX,e.clientY);if(!n)return;const o=n.closest("[data-pos]");if(o){const t=o.getAttribute("data-pos");if(t&&!P.current.has(t)){const[e,n]=t.split(",").map(Number);void 0!==e&&void 0!==n&&(C({type:"adjacent",row:e,col:n}),F(t))}}};return window.addEventListener("mouseup",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t),window.addEventListener("touchmove",e,{passive:!1}),()=>{window.removeEventListener("mouseup",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t),window.removeEventListener("touchmove",e)}},[$,P,F,C]);const W=t.useMemo(()=>({primary:o.primary.main,secondary:o.primary.dark}),[]),H=t.useMemo(()=>k.initialized&&function(t){const e=t.flat();return!e.includes(1)||!e.includes(0)}(k.grid),[k.initialized,k.grid]),N=t.useMemo(()=>k.initialized&&k.grid.flat().every(t=>1===t),[k.initialized,k.grid]),_=t.useCallback(()=>{C({type:"next"})},[]);t.useEffect(()=>{if(H){const t=setTimeout(()=>{_()},rt);return()=>{clearTimeout(t)}}},[H,_]),t.useEffect(()=>{document.title=c.lightsOut},[]),t.useEffect(()=>{C({type:"resize",newRows:j,newCols:v})},[j,v]);const[G,U]=n.useState([]);t.useEffect(()=>{if(!k.auto)return void(G.length>0&&U([]));const t=setTimeout(()=>{if(G.length>0){const t=G[0];t&&(C({type:"adjacent",row:t.row,col:t.col}),U(G.slice(1)))}else{const t=Z(k.grid);if(t&&t.length>0){const e=t[0];1===t.length&&e?C({type:"adjacent",row:e.row,col:e.col}):U(t)}else C({type:"auto"})}},st);return()=>{clearTimeout(t)}},[k.auto,k.grid,G]);const Y=O(k,W),X=jt(Y,t=>{H||C(t)},$,E,P,F,A),q=bt(Y);return e.jsxs(m,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:o.surface.background,position:"relative",overflow:"hidden",height:"100vh"},children:[e.jsx(R,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),e.jsx(p,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:e.jsxs(p,{sx:{position:"relative",marginTop:d?`${String(ct.MOBILE)}px`:`${String(ct.DESKTOP)}px`},children:[e.jsx(T,{size:x,rows:j,cols:v,frontProps:X,backProps:q}),e.jsx(p,{onClick:_,sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:H?1:0,transform:H?"scale(1)":"scale(0.5)",visibility:H?"visible":"hidden",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:"pointer",zIndex:10,backgroundColor:"transparent"},children:e.jsx(S,{sx:{fontSize:`${(x*it).toString()}rem`,color:N?W.secondary:W.primary}})})]})}),e.jsxs(a,{handler:()=>()=>{},onAutoPlay:()=>{C({type:"auto"})},autoPlayEnabled:k.auto,children:[e.jsx(l,{title:"Decrease Size",Icon:M,onClick:()=>{const t=Math.min(j,v);j!==v?g(t):t>2&&g(t-1)},disabled:j<=2&&v<=2}),e.jsx(l,{title:"Increase Size",Icon:D,onClick:()=>{const t=Math.min(y.rows,y.cols),e=Math.min(j,v);j===v&&g(e<t?e+1:null)},disabled:j===y.rows&&v===y.cols}),e.jsx(l,{title:"How to Play",Icon:L,onClick:I})]}),z&&e.jsx(yt,{rows:j,cols:v,size:x,open:z,palette:W,toggleOpen:I,getFrontProps:vt,getBackProps:bt})]})}export{wt as default};
