import{j as f,r as S,a as D}from"./vendor_react-BjoZPjhv.js";import{B as be,i as We,g as R,a as Ce,j as Fe,k as ze,m as Ue,b as Ae,G as ve,u as we,l as ce,T as ke,n as Ye,L as qe,o as Ke,d as Ve,v as ue,c as Xe,e as Ze,f as re,h as z}from"./useBaseGame-CRpFzYqU.js";import{T as X}from"./PageLayout-D1Wab0D7.js";import{d as N,s as ne,T as Ee,B as Je}from"./vendor_mui_core-Bzt2vl7i.js";import{c as Qe,D as en,d as nn,e as tn,P as rn,f as on,g as sn,N as ln,h as an,T as cn,i as un,j as dn}from"./vendor_mui_icons-DjGsc_25.js";import{C as A,L as fn,A as U,S as de,F as pn,P as gn}from"./index-BuQIIwSz.js";import{E as fe,u as hn}from"./layout-CZ02KrYv.js";import{E as mn}from"./ErrorState-CJQeQyMU.js";const Ne=S.createContext(void 0);function Sn({children:e,value:n}){return f.jsx(Ne.Provider,{value:n,children:e})}function yn(){const e=S.useContext(Ne);if(e===void 0)throw new Error("useAnalysisContext must be used within an AnalysisProvider");return e}function xn(){const{onCopy:e,onClear:n,onClose:t,onApply:r}=yn();return f.jsxs(N,{sx:{display:"flex",justifyContent:"center",gap:2,pointerEvents:"auto",zIndex:fn.zIndex.base+5,width:"100%",paddingBottom:2,position:"absolute",top:"calc(100% + 32px)",left:0},children:[f.jsx(X,{title:"Copy Board",Icon:Qe,onClick:e,sx:{backgroundColor:A.interactive.selected,color:A.primary.main,"&:hover":{backgroundColor:A.interactive.focus}}}),f.jsx(X,{title:"Clear Analysis",Icon:en,onClick:n,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:A.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),f.jsx(X,{title:"Apply to Game",Icon:nn,onClick:r,sx:{backgroundColor:"rgba(76, 175, 80, 0.1)",color:A.data.green,"&:hover":{backgroundColor:"rgba(76, 175, 80, 0.2)"}}}),f.jsx(X,{title:"Close Analysis",Icon:tn,onClick:t,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:A.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}const ie=.4;function Ie(e){return{numberSize:e*ie}}const Q={PADDING_OFFSET:100,WIDTH_LIMIT:1e3,MAX_CELL_SIZE:100,ICON_SIZE_RATIO:.8},Te={...We("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},oe={HINT_DENSITY:0,MAX_SIZE:8,DEFAULT_SIZE:5},P={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:be.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:`
            @keyframes slant-pop-in {
                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }
                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }
                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }
            }
        `,POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},k=0,C=1,E=2,bn=D.memo(function({value:n,color:t,size:r}){const o=`${String(Math.max(2,r))}px`;return f.jsxs(N,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===C&&f.jsx(N,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:t,borderRadius:de.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:P.SHADOWS.LINE,transition:U.transition,animation:P.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),n===E&&f.jsx(N,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:t,borderRadius:de.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:P.SHADOWS.LINE,transition:U.transition,animation:P.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),Cn=D.memo(function({r:n,c:t,value:r,source:o,isConflict:l,isCycle:i,size:s,pos:a,getDragProps:u}){const c=u(a);let d=A.text.primary;return l?d=A.data.red:i?d=o==="user"?A.data.red:A.data.orange:o==="user"?d=A.primary.main:o==="propagated"&&(d=A.data.green),f.jsx(N,{"data-pos":a,"data-type":"cell",...c,sx:{...c.sx,cursor:"pointer",outline:"none",border:`2px solid ${A.border.subtle}`,position:"relative",width:"100%",height:"100%",boxSizing:"border-box",borderRadius:"inherit",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:P.ANALYSIS.BG_SUBTLE,transition:"background-color 0.2s, outline 0.2s, box-shadow 0.2s","&:hover":{backgroundColor:P.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${A.primary.main}`,outlineOffset:"-3px",backgroundColor:P.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${A.interactive.focus}`}},children:f.jsx(bn,{value:r,color:d,size:s})})}),An=D.memo(function({value:n,hasConflict:t,isSatisfied:r,numberSize:o}){return f.jsx(N,{sx:{width:`${String(o)}rem`,height:`${String(o)}rem`,borderRadius:"50%",backgroundColor:t?A.data.red:P.ANALYSIS.HINT_BG,border:n==null?"none":`2px solid ${t?A.data.red:r?"transparent":P.ANALYSIS.HINT_BORDER}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(o*.5)}rem`,fontWeight:"800",color:t?P.COLORS.WHITE:r?A.interactive.disabledText:P.ANALYSIS.HINT_TEXT,boxShadow:r&&!t?"none":P.SHADOWS.HINT,opacity:n==null?0:r?.6:1,zIndex:5,position:"relative",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:t?"scale(1.15)":r?"scale(0.95)":"scale(1)"},children:n??""})}),vn=D.memo(function({r:n,c:t,value:r,hasConflict:o,isSatisfied:l,numberSize:i}){return f.jsx("div",{"data-pos":R(n,t),"data-type":"hint",style:{pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:f.jsx(An,{value:r,hasConflict:o,isSatisfied:l,numberSize:i})})});function pe(e,n,t){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:t?A.data.red:A.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:P.SHADOWS.LINE,transition:U.transition,animation:P.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const je={border:`2px solid ${A.border.subtle}`,position:"relative",backgroundColor:P.ANALYSIS.BG_SUBTLE},wn={width:"100%",height:"100%",position:"relative"},Re={pointerEvents:"none"},Pe={cursor:"pointer",outline:"none","&:hover":{backgroundColor:A.interactive.hover},"&:focus-visible":{outline:`3px solid ${A.primary.main}`,outlineOffset:"-3px",backgroundColor:A.interactive.hover,boxShadow:`inset 0 0 15px ${A.interactive.focus}`}};function kn(e){const{numberSize:n,hasError:t,isSatisfied:r,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:t?A.data.red:A.surface.background,border:o?`2px solid ${t?A.data.red:r?"transparent":A.border.subtle}`:"none",fontSize:`${String(n*.5)}rem`,fontWeight:"800",color:t?P.COLORS.WHITE:r?A.interactive.disabledText:A.text.primary,boxShadow:r&&!t?"none":P.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:t?"scale(1.15)":r?"scale(0.95)":"scale(1)",width:`${String(n)}rem`,height:`${String(n)}rem`}}function Oe(e,n){return(t,r)=>{const o=e.grid[t]?.[r],l=R(t,r),i=e.cycleCells.has(l),s=[{v:e.numbers[t]?.[r],p:R(t,r)},{v:e.numbers[t]?.[r+1],p:R(t,r+1)},{v:e.numbers[t+1]?.[r],p:R(t+1,r)},{v:e.numbers[t+1]?.[r+1],p:R(t+1,r+1)}].map(({v:a,p:u})=>{if(a==null)return"-";const c=e.errorNodes.has(u)?"Error":e.satisfiedNodes.has(u)?"Ok":"Pending";return`${String(a)} (${c})`});return{"aria-label":`Cell ${String(t+1)}, ${String(r+1)}. Clues: ${s.join(", ")}. ${o===k?"Empty":o===C?"Forward Slash":"Backward Slash"}${i?", Loop Error":""}`,sx:je,children:f.jsxs(N,{sx:wn,children:[o===C&&f.jsx(N,{sx:pe("-45deg",n,i)}),o===E&&f.jsx(N,{sx:pe("45deg",n,i)})]})}}}const En=(e,n,t)=>{const r=Oe(n,t);return(o,l)=>{const i=r(o,l),s=R(o,l),a=e(s);return{...a,...i,sx:{...a.sx,...i.sx,...Pe}}}},Me=(e,n)=>(t,r)=>{const o=e.numbers[t]?.[r],l=R(t,r),i=e.errorNodes.has(l),s=e.satisfiedNodes.has(l);return{sx:Re,children:f.jsx(N,{sx:kn({numberSize:n,hasError:i,isSatisfied:s,isVisible:o!=null}),children:o??""})}},Nn=S.memo(function({row:n,col:t,size:r,state:o,isInteractive:l=!1,...i}){if(!o)return f.jsx(N,{...i,sx:je});const s=Oe(o,r)(n,t),a={...s.sx,...l?Pe:{},...i.sx};return f.jsx(N,{...i,"aria-label":s["aria-label"],sx:a,children:s.children})},(e,n)=>{if(e.row!==n.row||e.col!==n.col||e.size!==n.size||e.isInteractive!==n.isInteractive)return!1;if(!e.state||!n.state)return e.state===n.state;const t=R(e.row,e.col);if(e.state.grid[e.row]?.[e.col]!==n.state.grid[n.row]?.[n.col]||e.state.cycleCells.has(t)!==n.state.cycleCells.has(t))return!1;const r=[[0,0],[0,1],[1,0],[1,1]];for(const[o,l]of r){const i=e.row+o,s=e.col+l,a=R(i,s);if(e.state.numbers[i]?.[s]!==n.state.numbers[i]?.[s]||e.state.errorNodes.has(a)!==n.state.errorNodes.has(a)||e.state.satisfiedNodes.has(a)!==n.state.satisfiedNodes.has(a))return!1}return!0}),In=S.memo(function({row:n,col:t,size:r,state:o,...l}){if(!o)return f.jsx(N,{...l,sx:Re});const i=r*.4,s=Me(o,i)(n,t),a={...s.sx,...l.sx};return f.jsx(N,{...l,sx:a,children:s.children})},(e,n)=>{if(e.row!==n.row||e.col!==n.col||e.size!==n.size)return!1;if(!e.state||!n.state)return e.state===n.state;const t=R(e.row,e.col);return!(e.state.numbers[e.row]?.[e.col]!==n.state.numbers[n.row]?.[n.col]||e.state.errorNodes.has(t)!==n.state.errorNodes.has(t)||e.state.satisfiedNodes.has(t)!==n.state.satisfiedNodes.has(t))});function te({state:e,size:n,rows:t,cols:r,CellComponent:o=Nn,OverlayComponent:l=In,cellProps:i,renderCell:s,overlayProps:a,renderOverlay:u}){const c=S.useMemo(()=>[{rows:t,cols:r,cellProps:(d,m)=>({state:e,size:n,isInteractive:!0,row:d,col:m,...i?.(d,m)}),renderCell:s,CellComponent:o},{rows:t+1,cols:r+1,cellProps:(d,m)=>({state:e,size:n,row:d,col:m,...a?.(d,m)}),renderCell:u,CellComponent:l,layerSx:{pointerEvents:"none"},decorative:!0}],[e,n,t,r,o,l,i,s,a,u]);return f.jsx(Ce,{size:n,layers:c,space:.125})}const _e=ne(Ue.div)({willChange:"transform, opacity"}),Be={...ze,transition:Fe};class le{constructor(n){this.parent=Array.from({length:n},(t,r)=>r)}find(n){const t=this.parent[n];if(t===void 0)throw new Error(`DSU: Index ${String(n)} out of bounds`);t!==n&&(this.parent[n]=this.find(t));const r=this.parent[n];if(r===void 0)throw new Error(`DSU: Parent of ${String(n)} became undefined`);return r}union(n,t){const r=this.find(n),o=this.find(t);return r!==o?(this.parent[r]=o,!0):!1}connected(n,t){return this.find(n)===this.find(t)}}function O(e,n,t){return e*(t+1)+n}function Le(e,n,t){const r=new Map,o=new Set;for(let u=0;u<n;u++)for(let c=0;c<t;c++){const d=e[u]?.[c];if(!d||d===k)continue;const m=d===C?O(u,c+1,t):O(u,c,t),p=d===C?O(u+1,c,t):O(u+1,c+1,t);r.has(m)||r.set(m,[]),r.has(p)||r.set(p,[]),r.get(m)?.push({node:p,r:u,c}),r.get(p)?.push({node:m,r:u,c})}const l=new Set,i=new Set,s=[],a=(u,c)=>{l.add(u),i.add(u);const d=r.get(u)??[];for(const{node:m,r:p,c:g}of d)if(m!==c)if(i.has(m)){o.add(R(p,g));for(let h=s.length-1;h>=0;h--){const b=s[h];if(!b||(o.add(R(b.r,b.c)),b.u===m||b.v===m))break}}else l.has(m)||(s.push({r:p,c:g,u,v:m}),a(m,u),s.pop());i.delete(u)};for(const u of r.keys())l.has(u)||a(u,-1);return o}function Tn(e,n,t){const r=new le((n+1)*(t+1));for(let o=0;o<n;o++){const l=e[o];if(l)for(let i=0;i<t;i++){const s=l[i];if(s===void 0||s===k)continue;const a=s===C?O(o,i+1,t):O(o,i,t),u=s===C?O(o+1,i,t):O(o+1,i+1,t);if(!r.union(a,u))return!0}}return!1}function jn(e,n,t,r,o,l){if(t==null)return!1;let i=0,s=0;const a=[{r:e-1,c:n-1,required:E},{r:e-1,c:n,required:C},{r:e,c:n-1,required:C},{r:e,c:n,required:E}];for(const u of a)if(u.r>=0&&u.r<o&&u.c>=0&&u.c<l){const c=r.get(R(u.r,u.c));c&&c.state!==k&&(s++,c.state===u.required&&i++)}return i===t&&s>0}function Rn(e,n,t,r){const o=new Map,l=[],i=[];r.forEach((p,g)=>{o.set(g,{state:p,source:"user"});const[h,b]=g.split(",").map(Number);h!==void 0&&b!==void 0&&l.push({r:h,c:b})});const s=(p,g)=>{if(p<0||p>=e||g<0||g>=n)return k;const h=R(p,g);return o.get(h)?.state??k},a=(p,g,h,b)=>{const y=R(p,g),x=o.get(y);if(x){x.state!==h&&i.push({type:"cell",r:p,c:g});return}o.set(y,{state:h,source:b}),l.push({r:p,c:g})},u=(p,g)=>[{r:p-1,c:g-1,required:E},{r:p-1,c:g,required:C},{r:p,c:g-1,required:C},{r:p,c:g,required:E}].filter(h=>h.r>=0&&h.r<e&&h.c>=0&&h.c<n);let c=0;for(;c<l.length;){const p=l[c++];if(!p)break;const{r:g,c:h}=p,b=[{r:g,c:h},{r:g,c:h+1},{r:g+1,c:h},{r:g+1,c:h+1}];for(const y of b){const x=t[y.r]?.[y.c];if(x==null)continue;const w=u(y.r,y.c);let I=0;const j=[];for(const v of w){const T=s(v.r,v.c);T===k?j.push(v):T===v.required&&I++}if(I>x){i.push({type:"node",r:y.r,c:y.c});continue}if(I+j.length<x){i.push({type:"node",r:y.r,c:y.c});continue}if(o.get(R(g,h))?.source==="user"){if(I===x&&j.length>0)for(const v of j){const T=v.required===C?E:C;a(v.r,v.c,T,"propagated")}else if(I+j.length===x&&j.length>0)for(const v of j)a(v.r,v.c,v.required,"propagated")}}}const d=Array.from({length:e},()=>new Array(n).fill(k));for(const[p,g]of o.entries()){const[h,b]=p.split(",").map(Number);h!==void 0&&b!==void 0&&d[h]&&(d[h][b]=g.state)}const m=Le(d,e,n);return{gridState:o,conflicts:i,cycleCells:m}}function Pn(e,n){return n?e===C?E:e===E?void 0:C:e===E?C:e===C?void 0:E}function On(e){const n=new Map;return e.forEach((t,r)=>{t.state!==k&&n.set(r,t.state)}),n}function Mn(){return new Worker(new URL("/assets/solverWorker-BcKx8EgH.js",import.meta.url),{type:"module"})}function _n(){return new Worker(new URL("/assets/generationWorker-aFEp-8-v.js",import.meta.url),{type:"module"})}const Bn=2e3;function Ln({rows:e,cols:n,numbers:t,userMoves:r}){const[o,l]=S.useState(new Map),[i,s]=S.useState([]),[a,u]=S.useState(new Set),c=S.useRef(null),[d,m]=S.useState("probing");S.useEffect(()=>{let h=!1;const b=Mn();c.current=b;const y=setTimeout(()=>{h||(m("broken"),c.current=null,b.terminate())},Bn);return b.onmessage=x=>{if(h)return;const w=x.data;w.type==="RESULT"&&m(I=>{if(I==="probing")return clearTimeout(y),"healthy";const{gridState:j,conflicts:v,cycleCells:T}=w.payload;return l(j),s(v),u(T),I})},b.onerror=()=>{clearTimeout(y),m("broken"),c.current=null,b.terminate()},b.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{h=!0,clearTimeout(y),b.terminate()}},[]),S.useEffect(()=>{if(d==="healthy"&&c.current)c.current.postMessage({type:"SOLVE",payload:{rows:e,cols:n,numbers:t,userMoves:r}});else if(d==="broken"){const h=Rn(e,n,t,r);l(h.gridState),s(h.conflicts),u(h.cycleCells)}},[r,t,e,n,d]);const p=S.useMemo(()=>new Set(i.filter(h=>h.type==="cell").map(h=>R(h.r,h.c))),[i]),g=S.useMemo(()=>new Set(i.filter(h=>h.type==="node").map(h=>R(h.r,h.c))),[i]);return{gridState:o,conflicts:i,cycleCells:a,conflictSet:p,nodeConflictSet:g}}function Dn({rows:e,cols:n,numbers:t,size:r,initialMoves:o,onMove:l,onApply:i}){const s=o,{getDragProps:a}=Ae({onToggle:(y,x,w,I,j)=>{const v=R(y,x);if(!j){l(v,I);return}const T=s.get(v),_=Pn(T,w);return l(v,_),_},touchTimeout:ve.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:u}=we({rows:e,cols:n}),c=S.useCallback(y=>{const x=a(y);return{...x,onKeyDown:w=>{x.onKeyDown(w),u(w)}}},[a,u]),{gridState:d,cycleCells:m,conflictSet:p,nodeConflictSet:g}=Ln({rows:e,cols:n,numbers:t,userMoves:s}),{numberSize:h}=Ie(r),b=S.useCallback(()=>{i&&i(On(d))},[i,d]);return{gridState:d,conflictSet:p,cycleCells:m,nodeConflictSet:g,numberSize:h,getEnhancedDragProps:c,handleApply:b}}function $n({rows:e,cols:n,numbers:t,size:r,initialMoves:o,onMove:l,onCopy:i,onClear:s,onClose:a,onApply:u}){const{gridState:c,conflictSet:d,cycleCells:m,nodeConflictSet:p,numberSize:g,getEnhancedDragProps:h,handleApply:b}=Dn({rows:e,cols:n,numbers:t,size:r,initialMoves:o,onMove:l,onApply:u});return f.jsx(Sn,{value:{onCopy:i,onClear:s,onClose:a,onApply:b},children:f.jsxs(_e,{...Be,sx:{position:"relative",userSelect:"none"},onContextMenu:y=>{y.preventDefault()},children:[f.jsx(N,{sx:{position:"relative",border:`2px dashed ${P.ANALYSIS.DASHED_BORDER}`,borderRadius:be.BORDER_RADIUS},children:f.jsx(te,{size:r,rows:e,cols:n,renderCell:(y,x)=>{const w=R(y,x),I=c.get(w);return f.jsx(Cn,{r:y,c:x,value:I?.state??k,source:I?.source,isConflict:d.has(w),isCycle:m.has(w),size:r,pos:w,getDragProps:h})},renderOverlay:(y,x)=>{const w=t[y]?.[x]??null,I=p.has(R(y,x)),j=jn(y,x,w,c,e,n);return f.jsx(vn,{r:y,c:x,value:w,hasConflict:I,isSatisfied:j,numberSize:g})}})}),f.jsx(xn,{})]})})}function Gn({size:e,rows:n,cols:t}){const r=S.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),o=S.useCallback(()=>({}),[]);return f.jsx(N,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:f.jsx(te,{size:e,rows:n,cols:t,cellProps:r,overlayProps:o})})}function Hn({isAnalysisMode:e,generating:n,dimensionsMismatch:t,rows:r,cols:o,state:l,size:i,analysis:s,cellProps:a,overlayProps:u}){return e?f.jsx(fe,{fallback:f.jsx(mn,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:f.jsx($n,{rows:r,cols:o,numbers:l.numbers,size:i,initialMoves:s.moves,onMove:s.onMove,onCopy:s.onCopy,onClear:s.onClear,onClose:s.onClose,onApply:s.onApply})}):n||t?f.jsx(Gn,{size:i,rows:r,cols:o}):f.jsx(fe,{FallbackComponent:pn,fallbackProps:{title:ce.errors.boardTitle,resetLabel:ce.errors.boardReset},children:f.jsx(_e,{...Be,children:f.jsx(te,{state:l,size:i,rows:r,cols:o,cellProps:a,overlayProps:u})})})}const Wn=[{title:"Corner 0",description:'A "0" in a corner forces the line to point away from that corner.',rows:3,cols:3,numbers:[[0,null,null],[null,null,null],[null,null,null]],grid:[[C,k],[k,k]]},{title:"Corner 1",description:'A "1" in a corner forces the line to connect directly to that corner.',rows:3,cols:3,numbers:[[1,null,null],[null,null,null],[null,null,null]],grid:[[E,k],[k,k]]},{title:"Edge 0",description:'A "0" on the edge forces all surrounding lines to point away from it.',rows:3,cols:3,numbers:[[null,0,null],[null,null,null],[null,null,null]],grid:[[E,C],[k,k]]},{title:"Edge 1",description:'A "1" on the edge forces the two surrounding lines into the same orientation.',rows:3,cols:3,numbers:[[null,1,null],[null,null,null],[null,null,null]],grid:[[C,C],[k,k]]},{title:"Edge 2",description:'A "2" on the edge forces both surrounding lines to connect to it.',rows:3,cols:3,numbers:[[null,2,null],[null,null,null],[null,null,null]],grid:[[C,E],[k,k]]},{title:"Middle 4",description:'A "4" must catch lines from all four surrounding cells.',rows:3,cols:3,numbers:[[null,null,null],[null,4,null],[null,null,null]],grid:[[E,C],[C,E]]}];function ge(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:A.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:P.SHADOWS.LINE,pointerEvents:"none"}}function Fn(e,n){return(t,r)=>{const o=e[t]?.[r];return{sx:{border:`2px solid ${A.border.subtle}`,position:"relative",backgroundColor:P.ANALYSIS.BG_SUBTLE},children:f.jsxs(N,{sx:{width:"100%",height:"100%",position:"relative"},children:[o===C&&f.jsx(N,{sx:ge("-45deg",n)}),o===E&&f.jsx(N,{sx:ge("45deg",n)})]})}}}function zn(e,n){return(t,r)=>{const o=e[t]?.[r];return{sx:{pointerEvents:"none"},children:f.jsx(N,{sx:{borderRadius:"50%",backgroundColor:A.surface.background,border:o==null?"none":`2px solid ${A.border.subtle}`,fontSize:`${String(n*.5)}rem`,fontWeight:"800",color:A.text.primary,boxShadow:o==null?"none":P.SHADOWS.HINT,zIndex:5,opacity:o==null?0:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0.05rem",lineHeight:1,width:`${String(n)}rem`,height:`${String(n)}rem`},children:o??""})}}}function Un({children:e,sx:n={}}){return f.jsx(N,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.5em",height:"1.5em",borderRadius:"50%",backgroundColor:A.surface.background,border:`1px solid ${A.border.subtle}`,fontSize:"0.85em",fontWeight:"bold",mx:.4,verticalAlign:"middle",lineHeight:1,pt:"0.05em",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",position:"relative",top:"-0.1em",...n},children:e})}function Yn({text:e}){const n=e.split(/"(\d+)"/g);return f.jsx(Ee,{variant:"body2",sx:{color:A.text.secondary},children:n.map((t,r)=>r%2===1?f.jsx(Un,{children:t},`${String(r)}-${t}`):t)})}const qn={display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4,width:"100%",py:2,pr:4},Kn={display:"flex",flexDirection:"row",alignItems:"center",gap:0,width:"100%"},Vn={width:"180px",display:"flex",justifyContent:"center",flexShrink:0},Xn={display:"flex",flexDirection:"column",gap:1,flex:1,minWidth:0};function Zn(){const{numberSize:n}=Ie(3);return f.jsx(N,{sx:qn,children:Wn.map(t=>f.jsxs(N,{sx:Kn,children:[f.jsx(N,{sx:Vn,children:f.jsx(te,{size:3,rows:t.rows-1,cols:t.cols-1,cellProps:Fn(t.grid,3),overlayProps:zn(t.numbers,n)})}),f.jsxs(N,{sx:Xn,children:[f.jsx(Ee,{variant:"subtitle1",sx:{fontWeight:"bold",color:A.text.primary},children:t.title}),f.jsx(Yn,{text:t.description})]})]},t.title))})}const L=3,Jn=[[E,C,E],[C,C,E],[E,C,E]],he=[[1,0,2,null],[null,null,null,1],[2,null,null,null],[null,2,0,1]],ee=[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[2,0],[1,0],[1,1]];function Qn(){const e=[],n=Array.from({length:L},()=>new Array(L).fill(k));e.push(n);let t=n.map(r=>[...r]);for(const[r,o]of ee){t=t.map(i=>[...i]);const l=Jn[r]?.[o];if(l!==void 0){const i=t[r];i&&(i[o]=l)}e.push(t)}return e}function Y(e,n,t){const r=Array.from({length:n+1},()=>new Array(t+1).fill(0));for(let o=0;o<n;o++){const l=e[o];if(l)for(let i=0;i<t;i++){const s=l[i];if(s===C){const a=r[o];if(a){const c=a[i+1];c!==void 0&&(a[i+1]=c+1)}const u=r[o+1];if(u){const c=u[i];c!==void 0&&(u[i]=c+1)}}else if(s===E){const a=r[o];if(a){const c=a[i];c!==void 0&&(a[i]=c+1)}const u=r[o+1];if(u){const c=u[i+1];c!==void 0&&(u[i+1]=c+1)}}}}return r}function et(e,n,t,r){const o=new Set,l=Y(e,t,r);for(let i=0;i<=t;i++)for(let s=0;s<=r;s++){const a=n[i]?.[s];if(a==null)continue;const u=l[i]?.[s]??0;if(u>a){o.add(R(i,s));continue}const c=[{gr:i-1,gc:s-1},{gr:i-1,gc:s},{gr:i,gc:s-1},{gr:i,gc:s}].filter(({gr:d,gc:m})=>d>=0&&d<t&&m>=0&&m<r&&e[d]?.[m]===k).length;u+c<a&&o.add(R(i,s))}return o}function De(e,n,t,r){const o=new Set,l=Y(e,t,r);for(let i=0;i<=t;i++)for(let s=0;s<=r;s++){const a=n[i]?.[s];if(a==null)continue;if((l[i]?.[s]??0)===a){let c=!1;const d=[{gr:i-1,gc:s-1},{gr:i-1,gc:s},{gr:i,gc:s-1},{gr:i,gc:s}];for(const{gr:m,gc:p}of d)if(m>=0&&m<t&&p>=0&&p<r&&e[m]?.[p]!==k){c=!0;break}c&&o.add(R(i,s))}}return o}const nt=1500;function me(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:A.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:P.SHADOWS.LINE,transition:U.transition,animation:P.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}function tt(e,n,t){return(r,o)=>{const l=e[r]?.[o],s=R(r,o)===t;return{sx:{border:`2px solid ${A.border.subtle}`,position:"relative",transition:U.transition,backgroundColor:P.ANALYSIS.BG_SUBTLE,...s?{backgroundColor:A.interactive.hover}:{}},children:f.jsxs(N,{sx:{width:"100%",height:"100%",position:"relative"},children:[l===C&&f.jsx(N,{sx:me("-45deg",n)}),l===E&&f.jsx(N,{sx:me("45deg",n)})]})}}}function rt(e,n,t){return(r,o)=>{const l=e[r]?.[o],i=R(r,o),s=n.has(i);return{sx:{pointerEvents:"none"},children:f.jsx(N,{sx:{borderRadius:"50%",backgroundColor:A.surface.background,border:l==null?"none":`2px solid ${s?"transparent":A.border.subtle}`,fontSize:`${String(t*.5)}rem`,fontWeight:"800",color:s?A.interactive.disabledText:A.text.primary,boxShadow:s?"none":P.SHADOWS.HINT,zIndex:5,opacity:l==null?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:s?"scale(0.95)":"scale(1)",paddingTop:"0.05rem",lineHeight:1,width:`${String(t)}rem`,height:`${String(t)}rem`},children:l??""})}}}const ot=ne(N)(({theme:e})=>({display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",gap:e.spacing(4)},justifyContent:"center",alignItems:"center",gap:e.spacing(2),width:"100%",flex:1})),st=ne(N)(({theme:e})=>({display:"grid",gridTemplateColumns:"repeat(2, 1fr)",[e.breakpoints.up("sm")]:{gridTemplateColumns:"1fr",marginTop:0,width:"auto",maxWidth:"none"},gap:e.spacing(1.5),justifyContent:"center",justifyItems:"center",alignItems:"center",marginTop:e.spacing(2),width:"100%",maxWidth:"320px"})),Z=ne(Je)(({theme:e})=>({borderColor:A.border.subtle,color:A.text.secondary,width:"140px",[e.breakpoints.up("sm")]:{width:"180px"},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),"& .MuiButton-startIcon":{marginRight:e.spacing(.5),[e.breakpoints.up("sm")]:{marginRight:e.spacing(1)}}}));function it({size:e,handleOpenAnalysis:n}){const t=S.useMemo(()=>Qn(),[]),[r,o]=S.useState(0),[l,i]=S.useState(!0);S.useEffect(()=>{if(!l)return;const y=setInterval(()=>{o(x=>(x+1)%t.length)},nt);return()=>{clearInterval(y)}},[t.length,l]);const s=()=>{i(y=>!y)},a=()=>{i(!1),o(y=>(y+1)%t.length)},u=()=>{i(!1),o(y=>(y-1+t.length)%t.length)},c=S.useMemo(()=>t[r]??t[0]??[],[t,r]),d=r>0&&r<=ee.length?(()=>{const y=ee[r-1];return y?R(y[0],y[1]):null})():null,m=S.useMemo(()=>De(c,he,L,L),[c]),p=e*ie,g=r>=ee.length&&c.every(y=>y.every(x=>x!==k)),h=S.useMemo(()=>tt(c,e,d),[c,e,d]),b=S.useMemo(()=>rt(he,m,p),[m,p]);return f.jsxs(ot,{children:[f.jsxs(N,{sx:{position:"relative",display:"inline-flex"},children:[f.jsx("style",{children:P.ANIMATIONS.POP_IN}),f.jsx(Ce,{size:e,layers:[{rows:L,cols:L,cellProps:h},{rows:L+1,cols:L+1,cellProps:b,layerSx:{pointerEvents:"none"},decorative:!0}],space:.125}),f.jsx(ke,{show:g&&l,sizeVariant:"small",showLabel:!1})]}),f.jsxs(st,{children:[f.jsx(Z,{variant:"outlined",startIcon:l?f.jsx(rn,{}):f.jsx(on,{}),onClick:s,children:l?"Pause":"Play"}),f.jsx(Z,{variant:"outlined",startIcon:f.jsx(sn,{}),onClick:n,children:"Analysis"}),f.jsx(Z,{variant:"outlined",startIcon:f.jsx(ln,{}),onClick:u,children:"Step Back"}),f.jsx(Z,{variant:"outlined",startIcon:f.jsx(an,{}),onClick:a,children:"Step Next"})]})]})}const Se={display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"primary.main",fontSize:"1em",borderRadius:1,px:.6,lineHeight:1,verticalAlign:"baseline"},lt=["Slant Rules","Example","Common Patterns"],at=[{Icon:cn,title:"Fill with Slashes",text:f.jsxs(f.Fragment,{children:["Place a forward"," ",f.jsx(N,{component:"span",sx:Se,children:f.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:f.jsx("line",{x1:"1",y1:"9",x2:"9",y2:"1"})})})," ","or backward"," ",f.jsx(N,{component:"span",sx:Se,children:f.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:f.jsx("line",{x1:"1",y1:"1",x2:"9",y2:"9"})})})," ","slash in every cell of the grid."]})},{Icon:un,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:dn,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],ct={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},ut=e=>[Ye(),e<2?{overflowY:"hidden"}:{}];function dt(){return{storageKey:"slant",grid:{defaultSize:oe.DEFAULT_SIZE,maxSize:oe.MAX_SIZE,gridPadding:{x:80,y:120},widthLimit:Q.WIDTH_LIMIT,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:Q.PADDING_OFFSET}),maxCellSize:Q.MAX_CELL_SIZE,rowOffset:1,colOffset:1}}}function ft({open:e,toggleOpen:n,handleOpenAnalysis:t}){const r=hn("sm");return f.jsx(qe,{open:e,toggleOpen:n,titles:lt,instructions:at,exampleContent:f.jsx(it,{size:r?4:4.5,handleOpenAnalysis:t}),cardSx:ct,contentSxOverride:ut,persistenceKey:"slant_info_step",extraSteps:[f.jsx(Zn,{},"patterns")]})}function pt({isAnalysisMode:e,setIsAnalysisMode:n,state:t,rows:r,cols:o,storageKey:l,toggleInfo:i,dispatch:s}){const[a,u]=S.useState(new Map);Ke({storageKey:l,rows:r,cols:o,state:a,onRestore:w=>{u(w)},serialize:w=>[...w.entries()],deserialize:w=>new Map(w)});const c=S.useRef("");S.useEffect(()=>{const w=JSON.stringify(t.numbers);c.current&&c.current!==w&&u(new Map),c.current=w},[t.numbers,t.rows,t.cols]);const d=S.useCallback((w,I)=>{u(j=>{const v=new Map(j);return I===void 0?v.delete(w):v.set(w,I),v})},[]),m=S.useCallback(()=>{const w=new Map;t.grid.forEach((I,j)=>{I.forEach((v,T)=>{v!==k&&w.set(R(j,T),v)})}),u(w)},[t.grid]),p=S.useCallback(()=>{u(new Map)},[]),g=S.useCallback(()=>{n(!1)},[n]),h=S.useCallback(w=>{s({type:"applyAnalysis",moves:w??a}),g()},[s,a,g]),b=S.useCallback(w=>{w.stopPropagation()},[]),y=S.useMemo(()=>e?{padding:{xs:0,sm:0},border:"none"}:void 0,[e]),x=S.useCallback(()=>{i(),n(!0)},[i,n]);return{analysisMoves:a,boardSx:y,handleAnalysisMove:d,handleAnalysisCopy:m,handleAnalysisClear:p,handleAnalysisClose:g,handleAnalysisApply:h,handleBoxClick:b,handleOpenAnalysis:x}}function $e(e,n){return`${Te.STATE}-${String(e)}x${String(n)}`}function Ge(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function gt(e){if(typeof e!="object"||e===null)return!1;const n=e;return Array.isArray(n.grid)&&Array.isArray(n.numbers)&&Array.isArray(n.solution)&&typeof n.rows=="number"&&typeof n.cols=="number"&&typeof n.solved=="boolean"&&Array.isArray(n.errorNodes)&&Array.isArray(n.cycleCells)&&Array.isArray(n.satisfiedNodes)}function ht(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}function mt(e,n,t){const r=$e(n,t);try{localStorage.setItem(r,JSON.stringify(Ge(e)))}catch{}}function St(e,n){const t=$e(e,n),r=localStorage.getItem(t);if(!r)return!1;try{const o=JSON.parse(r);return typeof o!="object"||o===null?!1:o.solved===!1}catch{return!1}}function yt({rows:e,cols:n,isAnalysisMode:t,requestGeneration:r,cancelGeneration:o}){const l=S.useRef(`${String(e)},${String(n)}`);S.useEffect(()=>{const i=`${String(e)},${String(n)}`;if(i!==l.current){if(l.current=i,!t&&St(e,n)){o();return}r(e,n)}},[e,n,r,o,t])}const xt=2e3,bt=250;function ye(e,n,t,r){return{grid:Array.from({length:e},()=>new Array(n).fill(k)),numbers:t,solution:r,rows:e,cols:n,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Ct({getInitialState:e,dispatchRef:n,dimsRef:t,onStaleResult:r}){const[o,l]=S.useState(!1),i=S.useRef(null),s=S.useRef("probing"),a=S.useRef(0),u=S.useRef(0),c=S.useRef(null),d=S.useRef(0),m=S.useRef(r);m.current=r;const p=S.useRef(!1),g=S.useRef(null),h=S.useRef(!1),b=S.useCallback(()=>{if(g.current){const v=g.current;m.current?.(v,v.rows,v.cols)}p.current=!1,g.current=null,h.current=!1},[]),y=S.useCallback((v,T)=>{n.current?.({type:"hydrate",state:e(v,T)}),l(!1)},[n,e]),x=S.useCallback((v,T)=>{b(),l(!0),c.current!==null&&clearTimeout(c.current),cancelAnimationFrame(u.current),c.current=setTimeout(()=>{c.current=null;const _=++a.current;s.current==="healthy"&&i.current?(d.current++,i.current.postMessage({type:"GENERATE",payload:{rows:v,cols:T}})):u.current=requestAnimationFrame(()=>{a.current===_&&y(v,T)})},bt)},[y,b]),w=S.useCallback((v,T)=>{p.current||(p.current=!0,g.current=null,h.current=!1,s.current==="healthy"&&i.current?(d.current++,i.current.postMessage({type:"GENERATE",payload:{rows:v,cols:T}})):requestAnimationFrame(()=>{p.current&&(g.current=e(v,T))}))},[e]),I=S.useCallback(()=>{c.current!==null&&(clearTimeout(c.current),c.current=null),cancelAnimationFrame(u.current),b(),l(!1)},[b]),j=S.useCallback(()=>{if(g.current){const v=g.current;g.current=null,n.current?.({type:"hydrate",state:v}),b(),l(!1);return}if(p.current){h.current=!0,l(!0);return}x(t.current.rows,t.current.cols)},[x,t,n,b]);return S.useEffect(()=>{let v=!1;const T=_n();i.current=T;const _=setTimeout(()=>{!v&&s.current==="probing"&&(console.warn("[Slant] generation worker probe timed out"),s.current="broken",d.current=0,i.current=null,T.terminate())},xt);return T.onmessage=$=>{if(!v){if($.data.type==="ERROR"){console.warn(`[Slant] generation worker error: ${String($.data.payload.message)}`),clearTimeout(_),s.current="broken",d.current=0,i.current=null,T.terminate();return}if($.data.type==="RESULT"){if(s.current==="probing"){clearTimeout(_),s.current="healthy";return}d.current--;const{rows:G,cols:H,numbers:q,solution:K}=$.data.payload,V=t.current;if(G!==V.rows||H!==V.cols){m.current?.(ye(G,H,q,K),G,H),d.current<=0&&l(!1);return}if(d.current>0)return;const W=ye(G,H,q,K);if(p.current){g.current=W,h.current&&(n.current?.({type:"hydrate",state:W}),p.current=!1,g.current=null,h.current=!1,l(!1));return}n.current?.({type:"hydrate",state:W}),l(!1)}}},T.onerror=()=>{console.warn("[Slant] generation worker script error"),clearTimeout(_),s.current="broken",d.current=0,i.current=null,T.terminate()},T.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{v=!0,clearTimeout(_),c.current!==null&&clearTimeout(c.current),T.terminate()}},[n,t]),{generating:o,requestGeneration:x,handleNextAsync:j,prefetch:w,cancelGeneration:I}}function At({state:e,size:n,getDragProps:t}){const r=n*ie,o=Ve(En,t,[e,n]),l=S.useMemo(()=>Me(e,r),[e,r]);return{cellProps:o,overlayProps:l}}const vt=e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"});function wt({game:{state:e,rows:n,cols:t,size:r,mobile:o,isAnalysisMode:l,generating:i,scaling:s},analysis:{analysisMoves:a,handleAnalysisMove:u,handleAnalysisCopy:c,handleAnalysisClear:d,handleAnalysisClose:m,handleAnalysisApply:p,handleBoxClick:g,handleOpenAnalysis:h,boardSx:b},info:{infoOpen:y,toggleInfo:x},getDragProps:w}){const{cellProps:I,overlayProps:j}=At({state:e,size:r,getDragProps:w}),v=S.useMemo(()=>vt(o),[o]),T=n!==e.rows||t!==e.cols,_=S.useMemo(()=>({scaling:s}),[s]);return{boardProps:{isAnalysisMode:l,generating:i,dimensionsMismatch:T,rows:n,cols:t,state:e,size:r,analysis:{moves:a,onMove:u,onCopy:c,onClear:d,onClose:m,onApply:p},cellProps:I,overlayProps:j},layoutProps:{boardSx:b,contentSx:v,iconSizeRatio:Q.ICON_SIZE_RATIO},infoProps:{open:y,toggleOpen:x,handleOpenAnalysis:h,handleBoxClick:g},trophyProps:_}}function kt(e,n,t,r){const o=Y(e,t,r);for(let l=0;l<=t;l++)for(let i=0;i<=r;i++){const s=n[l]?.[i];if(s!=null&&o[l]?.[i]!==s)return!1}return!0}function J(e,n,t,r,o,l){const i=e[t];if(!i)return!1;i[r]=o;const s=o===C?O(t,r+1,l):O(t,r,l),a=o===C?O(t+1,r,l):O(t+1,r+1,l);return n.connected(s,a)?!1:(n.union(s,a),!0)}function Et(e,n,t,r,o){let l=!0;for(;l;){l=!1;for(let s=0;s<=t;s++)for(let a=0;a<=r;a++){const u=n[s]?.[a];if(u==null)continue;const c=[{gr:s-1,gc:a-1,pt:E},{gr:s-1,gc:a,pt:C},{gr:s,gc:a-1,pt:C},{gr:s,gc:a,pt:E}].filter(({gr:p,gc:g})=>p>=0&&p<t&&g>=0&&g<r);let d=0;const m=[];for(const p of c){const g=e[p.gr]?.[p.gc];g===k?m.push(p):g===p.pt&&d++}if(d>u||d+m.length<u)return"contradiction";if(d===u&&m.length>0){for(const{gr:p,gc:g,pt:h}of m)if(e[p]?.[g]===k){if(!J(e,o,p,g,h===C?E:C,r))return"contradiction";l=!0}}else if(d+m.length===u&&m.length>0){for(const{gr:p,gc:g,pt:h}of m)if(e[p]?.[g]===k){if(!J(e,o,p,g,h,r))return"contradiction";l=!0}}}if(!l){for(let s=0;s<t;s++)for(let a=0;a<r;a++){const u=e[s];if(u?.[a]!==k)continue;const c=O(s,a+1,r),d=O(s+1,a,r),m=o.connected(c,d),p=O(s,a,r),g=O(s+1,a+1,r),h=o.connected(p,g);if(m&&h)return"contradiction";m?(u[a]=E,l=!0,o.union(p,g)):h&&(u[a]=C,l=!0,o.union(c,d))}if(!l)for(let s=0;s<t;s++)for(let a=0;a<r;a++){if(e[s]?.[a]!==k)continue;let c=!1,d=!1;const m=[{nr:s,nc:a,touchedBy:E},{nr:s,nc:a+1,touchedBy:C},{nr:s+1,nc:a,touchedBy:C},{nr:s+1,nc:a+1,touchedBy:E}];for(const{nr:p,nc:g,touchedBy:h}of m){const b=n[p]?.[g];if(b==null)continue;const y=[{gr:p-1,gc:g-1,pt:E},{gr:p-1,gc:g,pt:C},{gr:p,gc:g-1,pt:C},{gr:p,gc:g,pt:E}].filter(({gr:I,gc:j})=>I>=0&&I<t&&j>=0&&j<r);let x=0,w=0;for(const I of y){const j=e[I.gr]?.[I.gc];j===k?w++:j===I.pt&&x++}h===C?(x+1>b&&(c=!0),x+(w-1)<b&&(d=!0)):(x+1>b&&(d=!0),x+(w-1)<b&&(c=!0))}if(c&&d)return"contradiction";if(c){if(!J(e,o,s,a,E,r))return"contradiction";l=!0}else if(d){if(!J(e,o,s,a,C,r))return"contradiction";l=!0}}}}return e.every(s=>s.every(a=>a!==k))?"solved":"stuck"}function Nt(e,n,t){const r=Array.from({length:n},()=>new Array(t).fill(k)),o=new le((n+1)*(t+1)),l=Et(r,e,n,t,o);return l==="contradiction"||l!=="solved"?!1:kt(r,e,n,t)}function It(e,n,t,r){const o=e.map(a=>[...a]),l=[];for(let a=0;a<=n;a++)for(let u=0;u<=t;u++)l.push({r:a,c:u});for(let a=l.length-1;a>0;a--){const u=Math.floor(Math.random()*(a+1)),c=l[a],d=l[u];c&&d&&(l[a]=d,l[u]=c)}const i=Math.floor((n+1)*(t+1)*r);let s=0;for(let a=0;a<=n;a++)for(let u=0;u<=t;u++)o[a]?.[u]!==null&&s++;for(const{r:a,c:u}of l){if(s<=i)break;const c=o[a];if(!c)continue;const d=c[u];d!=null&&(c[u]=null,Nt(o,n,t)?s--:c[u]=d)}return o}function Tt(e,n){let t=[],r=!1;for(let i=0;i<50&&!r;i++){t=Array.from({length:e},()=>new Array(n).fill(k));const s=new le((e+1)*(n+1)),a=[];for(let c=0;c<e;c++)for(let d=0;d<n;d++)a.push({r:c,c:d});for(let c=a.length-1;c>0;c--){const d=Math.floor(Math.random()*(c+1)),m=a[c],p=a[d];m&&p&&(a[c]=p,a[d]=m)}let u=!1;for(const{r:c,c:d}of a){const m=O(c,d+1,n),p=O(c+1,d,n),g=s.connected(m,p),h=O(c,d,n),b=O(c+1,d+1,n),y=s.connected(h,b);if(g&&y){u=!0;break}const x=t[c];x&&(g?(x[d]=E,s.union(h,b)):y||Math.random()<.5?(x[d]=C,s.union(m,p)):(x[d]=E,s.union(h,b)))}u||(r=!0)}r||(t=Array.from({length:e},(i,s)=>new Array(n).fill(s%2===0?C:E)));const o=Y(t,e,n);return{numbers:It(o.map(i=>i.map(s=>s)),e,n,oe.HINT_DENSITY),solution:t}}const jt=Xe({getInitialState:se,customHandler:(e,n)=>{if(n.type==="reset")return{...e,grid:Array.from({length:e.rows},()=>new Array(e.cols).fill(k)),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set};if(n.type==="applyAnalysis"){if(!n.moves)return e;const s=Array.from({length:e.rows},()=>new Array(e.cols).fill(k));return n.moves.forEach((a,u)=>{const[c,d]=u.split(",").map(Number);if(c!==void 0&&d!==void 0){const m=s[c];m!==void 0&&(m[d]=a)}}),{...e,...xe(s,e.numbers,e.rows,e.cols),grid:s}}if(n.type!=="toggle")return null;if(e.solved)return e;const{row:t,col:r}=n;if(t===void 0||r===void 0)return e;const o=e.grid.map(s=>[...s]),l=o[t];if(!l)return e;const i=l[r];return i===void 0?e:(n.reverse?l[r]=i===k?C:i===C?E:k:l[r]=i===k?E:i===E?C:k,{...e,...xe(o,e.numbers,e.rows,e.cols),grid:o})}});function xe(e,n,t,r){const o=e.every(u=>u.every(c=>c!==k));let l=!1;if(o){const u=Y(e,t,r);n.every((d,m)=>d.every((p,g)=>p==null||p===u[m]?.[g]))&&!Tn(e,t,r)&&(l=!0)}const i=et(e,n,t,r),s=Le(e,t,r),a=De(e,n,t,r);return{solved:l,errorNodes:i,cycleCells:s,satisfiedNodes:a}}function se(e,n){ue(e),ue(n);const{numbers:t,solution:r}=Tt(e,n);return{grid:Array.from({length:e},()=>new Array(n).fill(k)),numbers:t,solution:r,rows:e,cols:n,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Rt(){const[e,n]=D.useState(!1),[t,r]=D.useState(!1),o=D.useCallback(()=>{r(M=>!M)},[]),l=S.useRef(null),i=S.useRef({rows:0,cols:0}),s=S.useCallback((M,B,F)=>{e||mt(M,B,F)},[e]),{generating:a,requestGeneration:u,handleNextAsync:c,prefetch:d,cancelGeneration:m}=Ct({getInitialState:se,dispatchRef:l,dimsRef:i,onStaleResult:s}),p=Ze({...dt(),logic:{reducer:jt,getInitialState:(M,B)=>se(M,B),onNext:c,isSolved:M=>M.solved,manualResize:!0,persistence:{enabled:!e,serialize:Ge,deserialize:M=>{if(!gt(M))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(M).slice(0,100)}`);return ht(M)}}}}),{state:g,dispatch:h,layout:b}=p,{rows:y,cols:x,size:w,mobile:I,scaling:j}=b;l.current=h,i.current={rows:y,cols:x};const{analysisMoves:v,boardSx:T,handleAnalysisMove:_,handleAnalysisCopy:$,handleAnalysisClear:G,handleAnalysisClose:H,handleAnalysisApply:q,handleBoxClick:K,handleOpenAnalysis:V}=pt({isAnalysisMode:e,setIsAnalysisMode:n,state:g,rows:y,cols:x,storageKey:Te.ANALYSIS_MOVES,toggleInfo:o,dispatch:h});yt({rows:y,cols:x,isAnalysisMode:e,requestGeneration:u,cancelGeneration:m}),S.useEffect(()=>{g.solved&&!e&&d(y,x)},[g.solved,e,y,x,d]);const{handleKeyDown:W}=we({rows:y,cols:x}),{getDragProps:ae}=Ae({onToggle:(M,B,F)=>{h({type:"toggle",row:M,col:B,reverse:F})},checkEnabled:()=>!g.solved,touchTimeout:ve.timing.touchHoldDelay}),He=S.useCallback(M=>{const B=ae(M);return{...B,onKeyDown:F=>{B.onKeyDown(F),W(F)}}},[ae,W]);return{...wt({game:{state:g,rows:y,cols:x,size:w,mobile:I,isAnalysisMode:e,generating:a,scaling:j},analysis:{analysisMoves:v,handleAnalysisMove:_,handleAnalysisCopy:$,handleAnalysisClear:G,handleAnalysisClose:H,handleAnalysisApply:q,handleBoxClick:K,handleOpenAnalysis:V,boardSx:T},info:{infoOpen:t,toggleInfo:o},getDragProps:He}),gameState:{...p,solved:g.solved,handleNext:c}}}function Gt(){const{boardProps:e,layoutProps:n,infoProps:t,gameState:r,trophyProps:o}=Rt();return f.jsxs(f.Fragment,{children:[f.jsxs(re,{title:gn.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",onClick:e.isAnalysisMode?e.analysis.onClose:void 0,children:[f.jsx(re.Content,{paddingBottom:{xs:"120px",md:"150px"},sx:n.contentSx,children:f.jsxs(re.BoardContainer,{sx:n.boardSx,children:[f.jsx(N,{onClick:t.handleBoxClick,children:f.jsx(Hn,{...e})}),f.jsx(ke,{show:!e.isAnalysisMode&&e.state.solved,...o})]})}),f.jsxs(z,{...r.controlsProps,onRefresh:r.handleNext,disabled:e.generating,hidden:e.isAnalysisMode,children:[f.jsx(z.Refresh,{}),f.jsx(z.ResizeMinus,{}),f.jsx(z.ResizePlus,{}),f.jsx(z.Info,{onClick:t.toggleOpen})]})]}),f.jsx(ft,{...t})]})}export{Gt as Slant};
