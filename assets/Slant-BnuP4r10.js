import{j as e,r as o,a as t}from"./vendor_react-DdkxgTu-.js";import{u as r,e as n,g as s,j as i,C as a,c as l,a as c,d,l as u,f,G as p,h as g,k as h,i as m,B as b}from"./types-CYpJ1Zkn.js";import{B as x}from"./vendor_mui_core-CQ3K-gFd.js";import{A as v,S as y,e as w,C as S,L as C,d as k}from"./index-cDAMucTj.js";import{l as E,D as j,f as z,P as I}from"./vendor_mui_icons-BOQsY4SM.js";import"./PageLayout-PpC1tA3C.js";const R="30px",N="36px",M="130%",T="6px",$="24px",B=100,A=1e3,D=1200,H=.98,O=100,_=16,L=.8,P="slant-size",U="slant-state",W="slant-ghost-moves",G=0,V=3,F=5,K={WHITE:"#fff"},X={LINE:"0 2px 4px rgba(0,0,0,0.2)",HINT:"0 4px 8px rgba(0,0,0,0.1)"},J={BORDER:"var(--slant-ghost-border)",BG_SUBTLE:"var(--slant-ghost-bg-subtle)",BG_HOVER:"var(--slant-ghost-bg-hover)",DASHED_BORDER:"var(--slant-ghost-dashed-border)",HINT_BG:"var(--slant-ghost-hint-bg)",HINT_BORDER:"var(--slant-ghost-hint-border)",HINT_TEXT:"var(--slant-ghost-hint-text)"},Q=1,q=2,Y=({value:o,color:t})=>e.jsxs(x,{sx:{width:"100%",height:"100%",position:"relative"},children:[o===Q&&e.jsx(x,{sx:{position:"absolute",width:M,height:T,backgroundColor:t,borderRadius:y.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:X.LINE,transition:v.transition,pointerEvents:"none"}}),o===q&&e.jsx(x,{sx:{position:"absolute",width:M,height:T,backgroundColor:t,borderRadius:y.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:X.LINE,transition:v.transition,pointerEvents:"none"}})]}),Z=({onCopy:o,onClear:t,onClose:r})=>e.jsxs(x,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:C.zIndex.base+5,paddingBottom:2},children:[e.jsx(w,{title:"Copy Board",Icon:E,onClick:o,sx:{backgroundColor:S.interactive.selected,color:S.primary.main,"&:hover":{backgroundColor:S.interactive.focus}}}),e.jsx(w,{title:"Clear Calculator",Icon:j,onClick:t,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:S.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(w,{title:"Close Calculator",Icon:z,onClick:r,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:S.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]}),ee=({value:o,hasConflict:t,numberSize:r})=>e.jsx(x,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:t?K.WHITE:J.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:t?"scale(1.1)":"scale(1)"},children:o??""});const oe=({rows:l,cols:c,numbers:d,size:u,initialMoves:f,onMove:p,onCopy:g,onClear:h,onClose:m})=>{const b=r("sm"),v=f,{getDragProps:y}=n({onToggle:(e,o,t,r,n)=>{const i=s(e,o);if(!n)return void p(i,r);const a=v.get(i);let l;return l=t?a===Q?q:a===q?void 0:Q:a===q?Q:a===Q?void 0:q,p(i,l),l},touchTimeout:i.timing.touchHoldDelay,checkEnabled:()=>!0}),[w,k]=o.useState(new Map),[E,j]=o.useState([]),[z,I]=o.useState(new Set),M=t.useRef(null);o.useEffect(()=>{const e=new Worker(new URL("/assets/solverWorker-DxfUx-HQ.js",import.meta.url),{type:"module"});return M.current=e,e.onmessage=e=>{const o=e.data;if("RESULT"===o.type){const{gridState:e,conflicts:t,cycleCells:r}=o.payload;k(e),j(t),I(r)}},()=>{e.terminate()}},[]),o.useEffect(()=>{M.current&&M.current.postMessage({type:"SOLVE",payload:{rows:l,cols:c,numbers:d,userMoves:v}})},[v,d,l,c]);const T=.4*u,B=u-T,A=o.useMemo(()=>new Set(E.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[E]),D=o.useMemo(()=>new Set(E.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[E]),H=o.useCallback((o,t)=>{const r=s(o,t),n=w.get(r),i=n?.state??0,a=n?.source,l=A.has(r),c=z.has(r),d=y(r);let u=S.text.primary;return l?u=S.data.red:c?u="user"===a?S.data.red:"#ff9800":"user"===a?u=S.primary.main:"propagated"===a&&(u=S.data.green),{...d,"data-pos":r,"data-type":"cell",sx:{...d.sx,cursor:"pointer",border:`1px solid ${J.BORDER}`,position:"relative",backgroundColor:J.BG_SUBTLE,"&:hover":{backgroundColor:J.BG_HOVER}},children:e.jsx(Y,{value:i,color:u})}},[w,A,z,y]),O=o.useCallback((o,t)=>{const r=d[o]?.[t],n=D.has(s(o,t));return{"data-pos":s(o,t),"data-type":"hint",children:e.jsx(ee,{value:r??null,hasConflict:n,numberSize:T}),sx:{borderRadius:"50%",backgroundColor:n?S.data.red:J.HINT_BG,border:null!=r?`2px solid ${n?S.data.red:J.HINT_BORDER}`:"none",zIndex:5,opacity:null!=r?1:0,position:"relative",pointerEvents:"none"}}},[d,D,T]);return e.jsxs(x,{sx:{position:"relative",userSelect:"none"},children:[e.jsxs(x,{sx:{position:"relative",padding:b?R:N,border:`2px dashed ${J.DASHED_BORDER}`,borderRadius:$},children:[e.jsx(x,{sx:{position:"relative",zIndex:C.zIndex.base+1},children:e.jsx(a,{size:u,rows:l,cols:c,cellProps:H,space:0,sx:{width:"fit-content"}})}),e.jsx(x,{sx:{position:"absolute",top:b?R:N,left:b?R:N,transform:`translate(-${String(T/2)}rem, -${String(T/2)}rem)`,zIndex:C.zIndex.base+2,pointerEvents:"none"},children:e.jsx(a,{size:T,rows:l+1,cols:c+1,cellProps:O,space:B,sx:{width:"fit-content"}})})]}),e.jsx(Z,{onCopy:g,onClear:h,onClose:m})]})};class te{constructor(e){this.parent=Array.from({length:e},(e,o)=>o)}find(e){const o=this.parent[e];if(void 0===o)throw new Error(`DSU: Index ${String(e)} out of bounds`);o!==e&&(this.parent[e]=this.find(o));const t=this.parent[e];if(void 0===t)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return t}union(e,o){const t=this.find(e),r=this.find(o);return t!==r&&(this.parent[t]=r,!0)}connected(e,o){return this.find(e)===this.find(o)}}function re(e,o,t){return e*(t+1)+o}function ne(e,o,t){const r=Array.from({length:o+1},()=>Array(t+1).fill(0));for(let n=0;n<o;n++){const o=e[n];if(o)for(let e=0;e<t;e++){const t=o[e];if(t===Q){const o=r[n];if(o){const t=o[e+1];void 0!==t&&(o[e+1]=t+1)}const t=r[n+1];if(t){const o=t[e];void 0!==o&&(t[e]=o+1)}}else if(t===q){const o=r[n];if(o){const t=o[e];void 0!==t&&(o[e]=t+1)}const t=r[n+1];if(t){const o=t[e+1];void 0!==o&&(t[e+1]=o+1)}}}}return r}function se(e,o,t){const r=Array.from({length:o},()=>Array(t).fill(0)),n=new te((o+1)*(t+1));let s=!0;for(;s;){s=!1;for(let i=0;i<=o;i++)for(let a=0;a<=t;a++){const l=e[i]?.[a];if(null==l)continue;const c=[{gr:i-1,gc:a-1,pt:q},{gr:i-1,gc:a,pt:Q},{gr:i,gc:a-1,pt:Q},{gr:i,gc:a,pt:q}].filter(({gr:e,gc:r})=>e>=0&&e<o&&r>=0&&r<t);let d=0;const u=[];for(const e of c){const o=r[e.gr]?.[e.gc];0===o?u.push(e):o===e.pt&&d++}if(d===l&&u.length>0)for(const{gr:e,gc:o,pt:i}of u){const a=r[e];if(0===a?.[o]){const r=i===Q?q:Q;a[o]=r,s=!0;const l=re(e,r===Q?o+1:o,t),c=re(e+1,r===Q?o:o+1,t);if(n.connected(l,c))return!1;n.union(l,c)}}else if(d+u.length===l&&u.length>0)for(const{gr:e,gc:o,pt:i}of u){const a=r[e];if(0===a?.[o]){a[o]=i,s=!0;const r=re(e,i===Q?o+1:o,t),l=re(e+1,i===Q?o:o+1,t);if(n.connected(r,l))return!1;n.union(r,l)}}}if(!s)for(let e=0;e<o;e++)for(let o=0;o<t;o++){const i=r[e];if(0!==i?.[o])continue;const a=re(e,o+1,t),l=re(e+1,o,t),c=n.connected(a,l),d=re(e,o,t),u=re(e+1,o+1,t),f=n.connected(d,u);if(c&&f)return!1;c?(i[o]=q,s=!0,n.union(d,u)):f&&(i[o]=Q,s=!0,n.union(a,l))}}if(!r.every(e=>e.every(e=>0!==e)))return!1;const i=ne(r,o,t);for(let a=0;a<=o;a++)for(let o=0;o<=t;o++){const t=e[a]?.[o];if(null!=t&&i[a]?.[o]!==t)return!1}return!0}function ie(e,o){let t=[],r=!1;for(let s=0;s<50&&!r;s++){t=Array.from({length:e},()=>Array(o).fill(0));const n=new te((e+1)*(o+1)),s=[];for(let t=0;t<e;t++)for(let e=0;e<o;e++)s.push({r:t,c:e});for(let e=s.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1)),t=s[e],r=s[o];t&&r&&(s[e]=r,s[o]=t)}let i=!1;for(const{r:e,c:r}of s){const s=re(e,r+1,o),a=re(e+1,r,o),l=n.connected(s,a),c=re(e,r,o),d=re(e+1,r+1,o),u=n.connected(c,d);if(l&&u){i=!0;break}const f=t[e];f&&(l?(f[r]=q,n.union(c,d)):u||Math.random()<.5?(f[r]=Q,n.union(s,a)):(f[r]=q,n.union(c,d)))}i||(r=!0)}r||(t=Array.from({length:e},(e,t)=>Array(o).fill(t%2==0?Q:q)));const n=function(e,o,t,r){const n=e.map(e=>[...e]),s=[];for(let l=0;l<=o;l++)for(let e=0;e<=t;e++)s.push({r:l,c:e});for(let l=s.length-1;l>0;l--){const e=Math.floor(Math.random()*(l+1)),o=s[l],t=s[e];o&&t&&(s[l]=t,s[e]=o)}const i=Math.floor((o+1)*(t+1)*r);let a=0;for(let l=0;l<=o;l++)for(let e=0;e<=t;e++)null!==n[l]?.[e]&&a++;for(const{r:l,c:c}of s){if(a<=i)break;const e=n[l];if(!e)continue;const r=e[c];null!=r&&(e[c]=null,se(n,o,t)?a--:e[c]=r)}return n}(ne(t,e,o).map(e=>e.map(e=>e)),e,o,G);return{numbers:n,solution:t}}const ae=l({getInitialState:le,customHandler:(e,o)=>{if("toggle"===o.type){if(e.solved)return e;const{row:t,col:r}=o,n=e.grid.map(e=>[...e]),i=n[t];if(!i)return e;const a=i[r];if(void 0===a)return e;o.reverse?i[r]=0===a?Q:a===Q?q:0:i[r]=0===a?q:a===q?Q:0;let l=!1;if(n.every(e=>e.every(e=>0!==e))){const o=ne(n,e.rows,e.cols);e.numbers.every((e,t)=>e.every((e,r)=>null==e||e===o[t]?.[r]))&&!function(e,o,t){const r=new te((o+1)*(t+1));for(let n=0;n<o;n++){const o=e[n];if(o)for(let e=0;e<t;e++){const s=o[e];if(void 0===s||0===s)continue;const i=re(n,s===Q?e+1:e,t),a=re(n+1,s===Q?e:e+1,t);if(!r.union(i,a))return!0}}return!1}(n,e.rows,e.cols)&&(l=!0)}const c=function(e,o,t,r){const n=new Set,i=ne(e,t,r);for(let a=0;a<=t;a++)for(let l=0;l<=r;l++){const c=o[a]?.[l];if(null==c)continue;const d=i[a]?.[l]??0;d>c?n.add(s(a,l)):d+[{gr:a-1,gc:l-1},{gr:a-1,gc:l},{gr:a,gc:l-1},{gr:a,gc:l}].filter(({gr:o,gc:n})=>o>=0&&o<t&&n>=0&&n<r&&0===e[o]?.[n]).length<c&&n.add(s(a,l))}return n}(n,e.numbers,e.rows,e.cols),d=function(e,o,t){const r=new Map,n=new Set;for(let s=0;s<o;s++)for(let o=0;o<t;o++){const n=e[s]?.[o];if(!n||0===n)continue;const i=re(s,n===Q?o+1:o,t),a=re(s+1,n===Q?o:o+1,t);r.has(i)||r.set(i,[]),r.has(a)||r.set(a,[]),r.get(i)?.push({node:a,r:s,c:o}),r.get(a)?.push({node:i,r:s,c:o})}const i=new Set,a=new Set,l=[],c=(e,o)=>{i.add(e),a.add(e);const t=r.get(e)??[];for(const{node:r,r:d,c:u}of t)if(r!==o)if(a.has(r)){n.add(s(d,u));for(let e=l.length-1;e>=0;e--){const o=l[e];if(!o)break;if(n.add(s(o.r,o.c)),o.u===r||o.v===r)break}}else i.has(r)||(l.push({r:d,c:u,u:e,v:r}),c(r,e),l.pop());a.delete(e)};for(const s of r.keys())i.has(s)||c(s,-1);return n}(n,e.rows,e.cols),u=function(e,o,t,r){const n=new Set,i=ne(e,t,r);for(let a=0;a<=t;a++)for(let e=0;e<=r;e++){const t=o[a]?.[e];null!=t&&((i[a]?.[e]??0)===t&&n.add(s(a,e)))}return n}(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:l,errorNodes:c,cycleCells:d,satisfiedNodes:u}}return e}});function le(e,o){const{numbers:t,solution:r}=ie(e,o);return{grid:Array.from({length:e},()=>Array(o).fill(0)),numbers:t,solution:r,rows:c(e),cols:c(o),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}const ce=(o,t,r)=>(n,i)=>{const a=t.grid[n]?.[i],l=s(n,i),c=t.cycleCells.has(l),d=o(l),u=[{v:t.numbers[n]?.[i],p:s(n,i)},{v:t.numbers[n]?.[i+1],p:s(n,i+1)},{v:t.numbers[n+1]?.[i],p:s(n+1,i)},{v:t.numbers[n+1]?.[i+1],p:s(n+1,i+1)}].map(({v:e,p:o})=>{if(null==e)return"-";const r=t.errorNodes.has(o)?"Error":t.satisfiedNodes.has(o)?"Ok":"Pending";return`${String(e)} (${r})`});return{...d,"aria-label":`Cell ${String(n+1)}, ${String(i+1)}. Clues: ${u.join(", ")}. ${0===a?"Empty":a===Q?"Forward Slash":"Backward Slash"}${c?", Loop Error":""}`,sx:{...d.sx,cursor:"pointer",border:`1px solid ${S.border.subtle}`,position:"relative","&:hover":{backgroundColor:S.interactive.hover}},children:e.jsxs(x,{sx:{width:"100%",height:"100%",position:"relative"},children:[a===Q&&e.jsx(x,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:c?S.data.red:S.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:X.LINE,transition:v.transition,pointerEvents:"none"}}),a===q&&e.jsx(x,{sx:{position:"absolute",width:"115%",height:`${String(Math.max(2,r))}px`,backgroundColor:c?S.data.red:S.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:X.LINE,transition:v.transition,pointerEvents:"none"}})]})}};function de(){const t=r("sm"),[a,l]=o.useState(!1),{rows:c,cols:v,state:y,dispatch:C,size:E,handleNext:j,controlsProps:z}=d({storageKeys:{size:P,state:U},pageTitle:k.slant,gridConfig:{defaultSize:F,minSize:V,headerOffset:i.layout.headerHeight,paddingOffset:{x:t?48:80,y:120},widthLimit:A,cellSizeReference:4,mobileRowOffset:2},boardConfig:{paddingOffset:e=>({x:e?48:80,y:B}),boardMaxWidth:D,boardSizeFactor:t?.92:H,maxCellSize:O,remBase:_,rowOffset:1,colOffset:1},reducer:ae,getInitialState:(e,o)=>le(e,o),winAnimationDelay:i.timing.winAnimationDelay,isSolved:e=>e.solved,persistence:{enabled:!a,serialize:e=>({...e,errorNodes:Array.from(e.errorNodes),cycleCells:Array.from(e.cycleCells),satisfiedNodes:Array.from(e.satisfiedNodes)}),deserialize:e=>{const o=e;return{...o,errorNodes:new Set(o.errorNodes),cycleCells:new Set(o.cycleCells),satisfiedNodes:new Set(o.satisfiedNodes)}}}}),[M,T]=o.useState(new Map);u({storageKey:W,rows:c,cols:v,state:M,onRestore:e=>{T(e)},serialize:e=>Array.from(e.entries()),deserialize:e=>new Map(e)});const G=o.useRef("");o.useEffect(()=>{const e=JSON.stringify(y.numbers);G.current&&G.current!==e&&T(new Map),G.current=e},[y.numbers,y.rows,y.cols]);const J=j,{getDragProps:Q}=n({onToggle:(e,o,t)=>{C({type:"toggle",row:h(e),col:h(o),reverse:t})},checkEnabled:()=>!y.solved,touchTimeout:i.timing.touchHoldDelay}),q=.4*E,Y=f(ce,Q,[y,E]),Z=o.useMemo(()=>((o,t)=>(r,n)=>{const i=o.numbers[r]?.[n],a=s(r,n),l=o.errorNodes.has(a),c=o.satisfiedNodes.has(a);return{sx:{pointerEvents:"none"},children:e.jsx(x,{sx:{borderRadius:"50%",backgroundColor:l?S.data.red:S.surface.background,border:null!=i?`2px solid ${l?S.data.red:c?"transparent":S.border.subtle}`:"none",fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:l?K.WHITE:c?S.interactive.disabledText:S.text.primary,boxShadow:c&&!l?"none":X.HINT,zIndex:5,opacity:null!=i?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:l?"scale(1.1)":"scale(1)",width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}})(y,q),[y,q]),ee=o.useCallback((e,o)=>{T(t=>{const r=new Map(t);return void 0===o?r.delete(e):r.set(e,o),r})},[]),te=o.useCallback(()=>{const e=new Map;y.grid.forEach((o,t)=>{o.forEach((o,r)=>{0!==o&&e.set(s(t,r),o)})}),T(e)},[y.grid]),re=o.useCallback(()=>{T(new Map)},[]),ne=o.useCallback(()=>{l(!1)},[]),se=o.useCallback(e=>{e.stopPropagation()},[]),ie=o.useMemo(()=>({padding:t?"1rem":"2rem"}),[t]),de=o.useMemo(()=>({userSelect:"none",padding:a?0:t?R:N,border:"2px solid transparent",borderRadius:$}),[t,a]),ue=a?null:e.jsx(m,{...z,disabled:a,children:e.jsx(w,{title:"Open Calculator",Icon:I,onClick:()=>{l(!a)},sx:{color:"default"}})}),fe=a?e.jsx(oe,{rows:c,cols:v,numbers:y.numbers,size:E,initialMoves:M,onMove:ee,onCopy:te,onClear:re,onClose:ne}):e.jsx(b,{size:E,rows:c+1,cols:v+1,frontProps:Z,backProps:Y,frontLayerSx:{pointerEvents:"none"}});return e.jsx(p,{children:e.jsx(g,{title:k.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"120px",md:"150px"},controls:ue,contentSx:ie,showTrophy:!a&&y.solved,onReset:J,boardSize:E,iconSizeRatio:L,primaryColor:S.primary.main,secondaryColor:S.primary.main,boardSx:de,onClick:()=>{a&&l(!1)},children:e.jsx(x,{onClick:se,children:fe})})})}export{de as default};
