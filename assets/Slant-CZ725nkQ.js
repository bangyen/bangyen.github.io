import{r as e,j as t,a as r}from"./vendor_react-CPTKWKBb.js";import{m as o,B as n,g as s,e as l,T as i,d as c,a,l as u,C as d,n as f,o as h,b as p,c as g,u as m,h as x,j as b,G as S,k as y,i as v}from"./GameInfo-DlsvuFLe.js";import{B as w,e as C}from"./vendor_mui_core-CC-Vzdtj.js";import{C as k,A as E,S as R,e as I,L as T,d as j}from"./index-Di-8lv-r.js";import{c as M,D as N,j as O,k as G,l as A,N as z,P as D}from"./vendor_mui_icons-Dxxzao0W.js";import{t as $}from"./PageLayout-BhLrZQpp.js";import"./FeatureErrorFallback-DnyGN_Ht.js";const H="130%",B="6px",P=100,L=1e3,W=100,_=.8,U={...o("slant"),GHOST_MOVES:"slant-ghost-moves"},q=0,F=8,K=5,V={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:n.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},GHOST:{BORDER:"var(--slant-ghost-border)",BG_SUBTLE:"var(--slant-ghost-bg-subtle)",BG_HOVER:"var(--slant-ghost-bg-hover)",DASHED_BORDER:"var(--slant-ghost-dashed-border)",HINT_BG:"var(--slant-ghost-hint-bg)",HINT_BORDER:"var(--slant-ghost-hint-border)",HINT_TEXT:"var(--slant-ghost-hint-text)"}},J=1,X=2,Y=[[X,J,X],[X,J,X],[X,J,X]],Q=[[1,0,2,0],[1,2,2,1],[1,2,2,1],[0,2,0,1]],Z=[[0,0],[2,2],[0,2],[2,0],[0,1],[2,1],[1,0],[1,1],[1,2]];function ee(e,t,r){const o=Array.from({length:t+1},()=>new Array(r+1).fill(0));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<r;e++){const r=t[e];if(r===J){const t=o[n];if(t){const r=t[e+1];void 0!==r&&(t[e+1]=r+1)}const r=o[n+1];if(r){const t=r[e];void 0!==t&&(r[e]=t+1)}}else if(r===X){const t=o[n];if(t){const r=t[e];void 0!==r&&(t[e]=r+1)}const r=o[n+1];if(r){const t=r[e+1];void 0!==t&&(r[e+1]=t+1)}}}}return o}function te(e,t,r,o){const n=new Set,l=ee(e,r,o);for(let i=0;i<=r;i++)for(let e=0;e<=o;e++){const r=t[i]?.[e];if(null==r)continue;(l[i]?.[e]??0)===r&&n.add(s(i,e))}return n}function re(e,t){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:k.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:V.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}function oe({size:r}){const o=e.useMemo(()=>function(){const e=[],t=Array.from({length:3},()=>new Array(3).fill(0));e.push(t);let r=t.map(e=>[...e]);for(const[o,n]of Z){r=r.map(e=>[...e]);const t=Y[o]?.[n];if(void 0!==t){const e=r[o];e&&(e[n]=t)}e.push(r)}return e.push(r.map(e=>[...e])),e}(),[]),[n,c]=e.useState(0);e.useEffect(()=>{const e=setInterval(()=>{c(e=>(e+1)%o.length)},1500);return()=>{clearInterval(e)}},[o.length]);const a=e.useMemo(()=>o[n]??o[0]??[],[o,n]),u=n>0&&n<=Z.length?(()=>{const e=Z[n-1];return e?s(e[0],e[1]):null})():null,d=e.useMemo(()=>te(a,Q,3,3),[a]),f=.4*r,h=n>=Z.length&&a.every(e=>e.every(e=>0!==e)),p=e.useMemo(()=>function(e,r,o){return(n,l)=>{const i=e[n]?.[l],c=s(n,l)===o;return{sx:{border:`1px solid ${k.border.subtle}`,position:"relative",transition:E.transition,...c?{backgroundColor:k.interactive.hover}:{}},children:t.jsxs(w,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===J&&t.jsx(w,{sx:re("-45deg",r)}),i===X&&t.jsx(w,{sx:re("45deg",r)})]})}}}(a,r,u),[a,r,u]),g=e.useMemo(()=>function(e,r,o){return(n,l)=>{const i=e[n]?.[l],c=s(n,l),a=r.has(c);return{sx:{pointerEvents:"none"},children:t.jsx(w,{sx:{borderRadius:"50%",backgroundColor:k.surface.background,border:null==i?"none":`2px solid ${a?"transparent":k.border.subtle}`,fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:a?k.interactive.disabledText:k.text.primary,boxShadow:a?"none":V.SHADOWS.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",width:`${String(o)}rem`,height:`${String(o)}rem`},children:i??""})}}}(Q,d,f),[d,f]);return t.jsx(w,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flex:1},children:t.jsxs(w,{sx:{position:"relative",display:"inline-flex"},children:[t.jsx(l,{size:r,rows:4,cols:4,cellRows:3,cellCols:3,overlayProps:g,cellProps:p,overlayLayerSx:{pointerEvents:"none"}}),t.jsx(i,{show:h,size:r,iconSizeRatio:1,primaryColor:k.primary.main,showLabel:!1})]})})}const ne=r.memo(function({value:e,color:r}){return t.jsxs(w,{sx:{width:"100%",height:"100%",position:"relative"},children:[e===J&&t.jsx(w,{sx:{position:"absolute",width:H,height:B,backgroundColor:r,borderRadius:R.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",boxShadow:V.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}),e===X&&t.jsx(w,{sx:{position:"absolute",width:H,height:B,backgroundColor:r,borderRadius:R.borderRadius.full,top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(45deg)",boxShadow:V.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}})]})}),se=({onCopy:e,onClear:r,onClose:o})=>t.jsxs(w,{sx:{display:"flex",justifyContent:"center",gap:2,position:"absolute",bottom:-90,left:0,right:0,pointerEvents:"auto",zIndex:T.zIndex.base+5,paddingBottom:2},children:[t.jsx(I,{title:"Copy Board",Icon:M,onClick:e,sx:{backgroundColor:k.interactive.selected,color:k.primary.main,"&:hover":{backgroundColor:k.interactive.focus}}}),t.jsx(I,{title:"Clear Calculator",Icon:N,onClick:r,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:k.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),t.jsx(I,{title:"Close Calculator",Icon:O,onClick:o,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:k.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]}),le=r.memo(function({value:e,hasConflict:r,numberSize:o}){return t.jsx(w,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:r?V.COLORS.WHITE:V.GHOST.HINT_TEXT,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:r?"scale(1.1)":"scale(1)"},children:e??""})});class ie{constructor(e){this.parent=Array.from({length:e},(e,t)=>t)}find(e){const t=this.parent[e];if(void 0===t)throw new Error(`DSU: Index ${String(e)} out of bounds`);t!==e&&(this.parent[e]=this.find(t));const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return r}union(e,t){const r=this.find(e),o=this.find(t);return r!==o&&(this.parent[r]=o,!0)}connected(e,t){return this.find(e)===this.find(t)}}function ce(e,t,r){return e*(r+1)+t}function ae(e,t,r){const o=new Map,n=new Set;for(let s=0;s<t;s++)for(let t=0;t<r;t++){const n=e[s]?.[t];if(!n||0===n)continue;const l=ce(s,n===J?t+1:t,r),i=ce(s+1,n===J?t:t+1,r);o.has(l)||o.set(l,[]),o.has(i)||o.set(i,[]),o.get(l)?.push({node:i,r:s,c:t}),o.get(i)?.push({node:l,r:s,c:t})}const l=new Set,i=new Set,c=[],a=(e,t)=>{l.add(e),i.add(e);const r=o.get(e)??[];for(const{node:o,r:u,c:d}of r)if(o!==t)if(i.has(o)){n.add(s(u,d));for(let e=c.length-1;e>=0;e--){const t=c[e];if(!t)break;if(n.add(s(t.r,t.c)),t.u===o||t.v===o)break}}else l.has(o)||(c.push({r:u,c:d,u:e,v:o}),a(o,e),c.pop());i.delete(e)};for(const s of o.keys())l.has(s)||a(s,-1);return n}const ue=({rows:r,cols:o,numbers:l,size:i,initialMoves:f,onMove:h,onCopy:p,onClear:g,onClose:m})=>{const x=c("sm"),b=f,{getDragProps:S}=a({onToggle:(e,t,r,o,n)=>{const l=s(e,t);if(!n)return void h(l,o);const i=b.get(l);let c;return c=r?i===J?X:i===X?void 0:J:i===X?J:i===J?void 0:X,h(l,c),c},touchTimeout:u.timing.touchHoldDelay,checkEnabled:()=>!0}),[y,v]=e.useState(new Map),[C,E]=e.useState([]),[R,I]=e.useState(new Set),j=e.useRef(null),[M,N]=e.useState("probing");e.useEffect(()=>{let e=!1;const t=new Worker(new URL("/assets/solverWorker-Dugk-xAa.js",import.meta.url),{type:"module"});j.current=t;const r=setTimeout(()=>{e||(N("broken"),j.current=null,t.terminate())},2e3);return t.onmessage=t=>{if(e)return;const o=t.data;"RESULT"===o.type&&N(e=>{if("probing"===e)return clearTimeout(r),"healthy";const{gridState:t,conflicts:n,cycleCells:s}=o.payload;return v(t),E(n),I(s),e})},t.onerror=()=>{clearTimeout(r),N("broken"),j.current=null,t.terminate()},t.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(r),t.terminate()}},[]),e.useEffect(()=>{if("healthy"===M&&j.current)j.current.postMessage({type:"SOLVE",payload:{rows:r,cols:o,numbers:l,userMoves:b}});else if("broken"===M){const e=function(e,t,r,o){const n=new Map,l=[],i=[];o.forEach((e,t)=>{n.set(t,{state:e,source:"user"});const[r,o]=t.split(",").map(Number);void 0!==r&&void 0!==o&&l.push({r:r,c:o})});const c=(r,o)=>{if(r<0||r>=e||o<0||o>=t)return 0;const l=s(r,o);return n.get(l)?.state??0},a=(e,t,r,o)=>{const c=s(e,t),a=n.get(c);a?a.state!==r&&i.push({type:"cell",r:e,c:t}):(n.set(c,{state:r,source:o}),l.push({r:e,c:t}))},u=(r,o)=>[{r:r-1,c:o-1,required:X},{r:r-1,c:o,required:J},{r:r,c:o-1,required:J},{r:r,c:o,required:X}].filter(r=>r.r>=0&&r.r<e&&r.c>=0&&r.c<t);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:t,c:o}=e,f=[{r:t,c:o},{r:t,c:o+1},{r:t+1,c:o},{r:t+1,c:o+1}];for(const l of f){const e=r[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const h=[];for(const t of d){const e=c(t.r,t.c);0===e?h.push(t):e===t.required&&f++}if(f>e)i.push({type:"node",r:l.r,c:l.c});else if(f+h.length<e)i.push({type:"node",r:l.r,c:l.c});else if("user"===n.get(s(t,o))?.source)if(f===e&&h.length>0)for(const t of h){const e=t.required===J?X:J;a(t.r,t.c,e,"propagated")}else if(f+h.length===e&&h.length>0)for(const t of h)a(t.r,t.c,t.required,"propagated")}}const f=Array.from({length:e},()=>new Array(t).fill(0));for(const[s,p]of n.entries()){const[e,t]=s.split(",").map(Number);void 0!==e&&void 0!==t&&f[e]&&(f[e][t]=p.state)}const h=ae(f,e,t);return{gridState:n,conflicts:i,cycleCells:h}}(r,o,l,b);v(e.gridState),E(e.conflicts),I(e.cycleCells)}},[b,l,r,o,M]);const O=.4*i,G=i-O,A=e.useMemo(()=>new Set(C.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[C]),z=e.useMemo(()=>new Set(C.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[C]),D=e.useCallback((e,r)=>{const o=s(e,r),n=y.get(o),l=n?.state??0,i=n?.source,c=A.has(o),a=R.has(o),u=S(o);let d=k.text.primary;return c?d=k.data.red:a?d="user"===i?k.data.red:"#ff9800":"user"===i?d=k.primary.main:"propagated"===i&&(d=k.data.green),{...u,"data-pos":o,"data-type":"cell",sx:{...u.sx,cursor:"pointer",border:`1px solid ${V.GHOST.BORDER}`,position:"relative",backgroundColor:V.GHOST.BG_SUBTLE,"&:hover":{backgroundColor:V.GHOST.BG_HOVER}},children:t.jsx(ne,{value:l,color:d})}},[y,A,R,S]),$=e.useCallback((e,r)=>{const o=l[e]?.[r],n=z.has(s(e,r));return{"data-pos":s(e,r),"data-type":"hint",children:t.jsx(le,{value:o??null,hasConflict:n,numberSize:O}),sx:{borderRadius:"50%",backgroundColor:n?k.data.red:V.GHOST.HINT_BG,border:null==o?"none":`2px solid ${n?k.data.red:V.GHOST.HINT_BORDER}`,zIndex:5,opacity:null==o?0:1,position:"relative",pointerEvents:"none"}}},[l,z,O]);return t.jsxs(w,{sx:{position:"relative",userSelect:"none"},children:[t.jsxs(w,{sx:{position:"relative",padding:x?n.PADDING.MOBILE:n.PADDING.DESKTOP,border:`2px dashed ${V.GHOST.DASHED_BORDER}`,borderRadius:n.BORDER_RADIUS},children:[t.jsx(w,{sx:{position:"relative",zIndex:T.zIndex.base+1},children:t.jsx(d,{size:i,rows:r,cols:o,cellProps:D,space:0,sx:{width:"fit-content"}})}),t.jsx(w,{sx:{position:"absolute",top:x?n.PADDING.MOBILE:n.PADDING.DESKTOP,left:x?n.PADDING.MOBILE:n.PADDING.DESKTOP,transform:`translate(-${String(O/2)}rem, -${String(O/2)}rem)`,zIndex:T.zIndex.base+2,pointerEvents:"none"},children:t.jsx(d,{size:O,rows:r+1,cols:o+1,cellProps:$,space:G,sx:{width:"fit-content"}})})]}),t.jsx(se,{onCopy:p,onClear:g,onClose:m})]})};function de({size:r,rows:o,cols:n}){const s=e.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),i=e.useCallback(()=>({}),[]);return t.jsx(w,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:t.jsx(l,{size:r,rows:o+1,cols:n+1,cellRows:o,cellCols:n,overlayProps:i,cellProps:s,overlayLayerSx:{pointerEvents:"none"}})})}function fe({isGhostMode:e,generating:r,dimensionsMismatch:o,rows:n,cols:s,state:i,size:c,ghostMoves:a,onGhostMove:u,onGhostCopy:d,onGhostClear:f,onGhostClose:h,cellProps:p,overlayProps:g}){return e?t.jsx(ue,{rows:n,cols:s,numbers:i.numbers,size:c,initialMoves:a,onMove:u,onCopy:d,onClear:f,onClose:h}):r||o?t.jsx(de,{size:c,rows:n,cols:s}):t.jsx(l,{size:c,rows:n+1,cols:s+1,cellRows:n,cellCols:s,overlayProps:g,cellProps:p,overlayLayerSx:{pointerEvents:"none"}})}const he=["Slant Rules","Example"],pe=[{Icon:G,title:"Fill with Slashes",text:String.raw`Place a forward (/) or backward (\) slash in every cell of the grid.`},{Icon:A,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:z,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],ge={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},me=e=>[...$(f(e)),{overflowY:"hidden"}];function xe(e){return{storageKey:"slant",pageTitle:j.slant,defaultSize:K,maxSize:F,gridPadding:{x:e?48:80,y:120},widthLimit:L,cellSizeReference:4,boardPadding:e=>({x:e?48:80,y:P}),...e?{boardSizeFactor:.92}:{},maxCellSize:W,rowOffset:1,colOffset:1,manualResize:!0}}function be(e,t,r,o){return{grid:Array.from({length:e},()=>new Array(t).fill(0)),numbers:r,solution:o,rows:e,cols:t,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Se({getInitialState:t,dispatchRef:r,dimsRef:o,onStaleResult:n}){const[s,l]=e.useState(!1),i=e.useRef(null),c=e.useRef("probing"),a=e.useRef(0),u=e.useRef(0),d=e.useRef(null),f=e.useRef(0),h=e.useRef(n);h.current=n;const p=e.useRef(!1),g=e.useRef(null),m=e.useRef(!1),x=e.useCallback(()=>{if(g.current){const e=g.current;h.current?.(e,e.rows,e.cols)}p.current=!1,g.current=null,m.current=!1},[]),b=e.useCallback((e,o)=>{r.current?.({type:"hydrate",state:t(e,o)}),l(!1)},[r,t]),S=e.useCallback((e,t)=>{x(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const r=++a.current;"healthy"===c.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:t}})):u.current=requestAnimationFrame(()=>{a.current===r&&b(e,t)})},250)},[b,x]),y=e.useCallback((e,r)=>{p.current||(p.current=!0,g.current=null,m.current=!1,"healthy"===c.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:r}})):requestAnimationFrame(()=>{p.current&&(g.current=t(e,r))}))},[t]),v=e.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),x(),l(!1)},[x]),w=e.useCallback(()=>{if(g.current){const e=g.current;return g.current=null,r.current?.({type:"hydrate",state:e}),x(),void l(!1)}if(p.current)return m.current=!0,void l(!0);S(o.current.rows,o.current.cols)},[S,o,r,x]);return e.useEffect(()=>{let e=!1;const t=new Worker(new URL("/assets/generationWorker-BcsDYRLk.js",import.meta.url),{type:"module"});i.current=t;const n=setTimeout(()=>{e||"probing"!==c.current||(c.current="broken",f.current=0,i.current=null,t.terminate())},2e3);return t.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(n),c.current="broken",f.current=0,i.current=null,void t.terminate();if("RESULT"===s.data.type){if("probing"===c.current)return clearTimeout(n),void(c.current="healthy");f.current--;const{rows:e,cols:t,numbers:i,solution:a}=s.data.payload,u=o.current;if(e!==u.rows||t!==u.cols)return h.current?.(be(e,t,i,a),e,t),void(f.current<=0&&l(!1));if(f.current>0)return;const d=be(e,t,i,a);if(p.current)return g.current=d,void(m.current&&(r.current?.({type:"hydrate",state:d}),p.current=!1,g.current=null,m.current=!1,l(!1)));r.current?.({type:"hydrate",state:d}),l(!1)}}},t.onerror=()=>{clearTimeout(n),c.current="broken",f.current=0,i.current=null,t.terminate()},t.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(n),null!==d.current&&clearTimeout(d.current),t.terminate()}},[r,o]),{generating:s,requestGeneration:S,handleNextAsync:w,prefetch:y,cancelGeneration:v}}function ye(e,t,r,o,n,s){const l=e[r];if(!l)return!1;l[o]=n;const i=ce(r,n===J?o+1:o,s),c=ce(r+1,n===J?o:o+1,s);return!t.connected(i,c)&&(t.union(i,c),!0)}function ve(e,t,r){const o=Array.from({length:t},()=>new Array(r).fill(0)),n=new ie((t+1)*(r+1)),s=function(e,t,r,o,n){let s=!0;for(;s;){s=!1;for(let l=0;l<=r;l++)for(let i=0;i<=o;i++){const c=t[l]?.[i];if(null==c)continue;const a=[{gr:l-1,gc:i-1,pt:X},{gr:l-1,gc:i,pt:J},{gr:l,gc:i-1,pt:J},{gr:l,gc:i,pt:X}].filter(({gr:e,gc:t})=>e>=0&&e<r&&t>=0&&t<o);let u=0;const d=[];for(const t of a){const r=e[t.gr]?.[t.gc];0===r?d.push(t):r===t.pt&&u++}if(u>c)return"contradiction";if(u+d.length<c)return"contradiction";if(u===c&&d.length>0){for(const{gr:t,gc:r,pt:l}of d)if(0===e[t]?.[r]){if(!ye(e,n,t,r,l===J?X:J,o))return"contradiction";s=!0}}else if(u+d.length===c&&d.length>0)for(const{gr:t,gc:r,pt:l}of d)if(0===e[t]?.[r]){if(!ye(e,n,t,r,l,o))return"contradiction";s=!0}}if(!s){for(let t=0;t<r;t++)for(let r=0;r<o;r++){const l=e[t];if(0!==l?.[r])continue;const i=ce(t,r+1,o),c=ce(t+1,r,o),a=n.connected(i,c),u=ce(t,r,o),d=ce(t+1,r+1,o),f=n.connected(u,d);if(a&&f)return"contradiction";a?(l[r]=X,s=!0,n.union(u,d)):f&&(l[r]=J,s=!0,n.union(i,c))}if(!s)for(let l=0;l<r;l++)for(let i=0;i<o;i++){const c=e[l];if(0!==c?.[i])continue;let a=!1,u=!1;const d=[{nr:l,nc:i,touchedBy:X},{nr:l,nc:i+1,touchedBy:J},{nr:l+1,nc:i,touchedBy:J},{nr:l+1,nc:i+1,touchedBy:X}];for(const{nr:n,nc:s,touchedBy:l}of d){const i=t[n]?.[s];if(null==i)continue;const c=[{gr:n-1,gc:s-1,pt:X},{gr:n-1,gc:s,pt:J},{gr:n,gc:s-1,pt:J},{gr:n,gc:s,pt:X}].filter(({gr:e,gc:t})=>e>=0&&e<r&&t>=0&&t<o);let d=0,f=0;for(const t of c){const r=e[t.gr]?.[t.gc];0===r?f++:r===t.pt&&d++}l===J?(d+1>i&&(a=!0),d+(f-1)<i&&(u=!0)):(d+1>i&&(u=!0),d+(f-1)<i&&(a=!0))}if(a&&u)return"contradiction";if(a){if(!ye(e,n,l,i,X,o))return"contradiction";s=!0}else if(u){if(!ye(e,n,l,i,J,o))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(o,e,t,r,n);return"contradiction"!==s&&("solved"===s&&function(e,t,r,o){const n=ee(e,r,o);for(let s=0;s<=r;s++)for(let e=0;e<=o;e++){const r=t[s]?.[e];if(null!=r&&n[s]?.[e]!==r)return!1}return!0}(o,e,t,r))}function we(e,t){let r=[],o=!1;for(let s=0;s<50&&!o;s++){r=Array.from({length:e},()=>new Array(t).fill(0));const n=new ie((e+1)*(t+1)),s=[];for(let r=0;r<e;r++)for(let e=0;e<t;e++)s.push({r:r,c:e});for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1)),r=s[e],o=s[t];r&&o&&(s[e]=o,s[t]=r)}let l=!1;for(const{r:e,c:o}of s){const s=ce(e,o+1,t),i=ce(e+1,o,t),c=n.connected(s,i),a=ce(e,o,t),u=ce(e+1,o+1,t),d=n.connected(a,u);if(c&&d){l=!0;break}const f=r[e];f&&(c?(f[o]=X,n.union(a,u)):d||Math.random()<.5?(f[o]=J,n.union(s,i)):(f[o]=X,n.union(a,u)))}l||(o=!0)}o||(r=Array.from({length:e},(e,r)=>new Array(t).fill(r%2==0?J:X)));const n=function(e,t,r,o){const n=e.map(e=>[...e]),s=[];for(let c=0;c<=t;c++)for(let e=0;e<=r;e++)s.push({r:c,c:e});for(let c=s.length-1;c>0;c--){const e=Math.floor(Math.random()*(c+1)),t=s[c],r=s[e];t&&r&&(s[c]=r,s[e]=t)}const l=Math.floor((t+1)*(r+1)*o);let i=0;for(let c=0;c<=t;c++)for(let e=0;e<=r;e++)null!==n[c]?.[e]&&i++;for(const{r:c,c:a}of s){if(i<=l)break;const e=n[c];if(!e)continue;const o=e[a];null!=o&&(e[a]=null,ve(n,t,r)?i--:e[a]=o)}return n}(ee(r,e,t).map(e=>e.map(e=>e)),e,t,q);return{numbers:n,solution:r}}const Ce=p({getInitialState:ke,customHandler:(e,t)=>{if("toggle"===t.type){if(e.solved)return e;const{row:r,col:o}=t,n=e.grid.map(e=>[...e]),l=n[r];if(!l)return e;const i=l[o];if(void 0===i)return e;t.reverse?l[o]=0===i?J:i===J?X:0:l[o]=0===i?X:i===X?J:0;let c=!1;if(n.every(e=>e.every(e=>0!==e))){const t=ee(n,e.rows,e.cols);e.numbers.every((e,r)=>e.every((e,o)=>null==e||e===t[r]?.[o]))&&!function(e,t,r){const o=new ie((t+1)*(r+1));for(let n=0;n<t;n++){const t=e[n];if(t)for(let e=0;e<r;e++){const s=t[e];if(void 0===s||0===s)continue;const l=ce(n,s===J?e+1:e,r),i=ce(n+1,s===J?e:e+1,r);if(!o.union(l,i))return!0}}return!1}(n,e.rows,e.cols)&&(c=!0)}const a=function(e,t,r,o){const n=new Set,l=ee(e,r,o);for(let i=0;i<=r;i++)for(let c=0;c<=o;c++){const a=t[i]?.[c];if(null==a)continue;const u=l[i]?.[c]??0;u>a?n.add(s(i,c)):u+[{gr:i-1,gc:c-1},{gr:i-1,gc:c},{gr:i,gc:c-1},{gr:i,gc:c}].filter(({gr:t,gc:n})=>t>=0&&t<r&&n>=0&&n<o&&0===e[t]?.[n]).length<a&&n.add(s(i,c))}return n}(n,e.numbers,e.rows,e.cols),u=ae(n,e.rows,e.cols),d=te(n,e.numbers,e.rows,e.cols);return{...e,grid:n,solved:c,errorNodes:a,cycleCells:u,satisfiedNodes:d}}return e}});function ke(e,t){const{numbers:r,solution:o}=we(e,t);return{grid:Array.from({length:e},()=>new Array(t).fill(0)),numbers:r,solution:o,rows:g(e),cols:g(t),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function Ee(e,t,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,t))}px`,backgroundColor:r?k.data.red:k.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:V.SHADOWS.LINE,transition:E.transition,pointerEvents:"none"}}const Re=(e,r,o)=>(n,l)=>{const i=r.grid[n]?.[l],c=s(n,l),a=r.cycleCells.has(c),u=e(c),d=[{v:r.numbers[n]?.[l],p:s(n,l)},{v:r.numbers[n]?.[l+1],p:s(n,l+1)},{v:r.numbers[n+1]?.[l],p:s(n+1,l)},{v:r.numbers[n+1]?.[l+1],p:s(n+1,l+1)}].map(({v:e,p:t})=>{if(null==e)return"-";const o=r.errorNodes.has(t)?"Error":r.satisfiedNodes.has(t)?"Ok":"Pending";return`${String(e)} (${o})`});return{...u,"aria-label":`Cell ${String(n+1)}, ${String(l+1)}. Clues: ${d.join(", ")}. ${0===i?"Empty":i===J?"Forward Slash":"Backward Slash"}${a?", Loop Error":""}`,sx:{...u.sx,cursor:"pointer",border:`1px solid ${k.border.subtle}`,position:"relative","&:hover":{backgroundColor:k.interactive.hover}},children:t.jsxs(w,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===J&&t.jsx(w,{sx:Ee("-45deg",o,a)}),i===X&&t.jsx(w,{sx:Ee("45deg",o,a)})]})}};function Ie(){const o=c("sm"),[n,l]=r.useState(!1),[i,d]=e.useReducer(e=>!e,!1),f=e.useRef(null),p=e.useRef({rows:0,cols:0}),g=e.useCallback((e,t,r)=>{if(n)return;const o=`${U.STATE}-${String(t)}x${String(r)}`,s={...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]};localStorage.setItem(o,JSON.stringify(s))},[n]),{generating:E,requestGeneration:R,handleNextAsync:I,prefetch:T,cancelGeneration:M}=Se({getInitialState:ke,dispatchRef:f,dimsRef:p,onStaleResult:g}),{rows:N,cols:O,state:G,dispatch:A,size:z,controlsProps:$}=m({...xe(o),reducer:Ce,getInitialState:(e,t)=>ke(e,t),onNext:I,isSolved:e=>e.solved,persistence:{enabled:!n,serialize:e=>({...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}),deserialize:e=>{const t=e;return{...t,errorNodes:new Set(t.errorNodes),cycleCells:new Set(t.cycleCells),satisfiedNodes:new Set(t.satisfiedNodes)}}}});f.current=A,p.current={rows:N,cols:O};const{ghostMoves:H,boardSx:B,handleGhostMove:P,handleGhostCopy:L,handleGhostClear:W,handleGhostClose:q,handleBoxClick:F,handleOpenCalculator:K}=function({isGhostMode:t,setIsGhostMode:r,state:o,rows:n,cols:l,storageKey:i,toggleInfo:c}){const[a,u]=e.useState(new Map);h({storageKey:i,rows:n,cols:l,state:a,onRestore:e=>{u(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const d=e.useRef("");e.useEffect(()=>{const e=JSON.stringify(o.numbers);d.current&&d.current!==e&&u(new Map),d.current=e},[o.numbers,o.rows,o.cols]);const f=e.useCallback((e,t)=>{u(r=>{const o=new Map(r);return void 0===t?o.delete(e):o.set(e,t),o})},[]),p=e.useCallback(()=>{const e=new Map;o.grid.forEach((t,r)=>{t.forEach((t,o)=>{0!==t&&e.set(s(r,o),t)})}),u(e)},[o.grid]),g=e.useCallback(()=>{u(new Map)},[]),m=e.useCallback(()=>{r(!1)},[r]),x=e.useCallback(e=>{e.stopPropagation()},[]);return{ghostMoves:a,boardSx:e.useMemo(()=>t?{padding:{xs:0,sm:0}}:void 0,[t]),handleGhostMove:f,handleGhostCopy:p,handleGhostClear:g,handleGhostClose:m,handleBoxClick:x,handleOpenCalculator:e.useCallback(()=>{c(),r(!0)},[c,r])}}({isGhostMode:n,setIsGhostMode:l,state:G,rows:N,cols:O,storageKey:U.GHOST_MOVES,toggleInfo:d}),J=e.useRef(`${String(N)},${String(O)}`);e.useEffect(()=>{const e=`${String(N)},${String(O)}`;if(e!==J.current){if(J.current=e,!n){const e=`${U.STATE}-${String(N)}x${String(O)}`,t=localStorage.getItem(e);if(t)try{if(!JSON.parse(t).solved)return void M()}catch{}}R(N,O)}},[N,O,R,M,n]),e.useEffect(()=>{G.solved&&!n&&T(N,O)},[G.solved,n,N,O,T]);const{getDragProps:X}=a({onToggle:(e,t,r)=>{A({type:"toggle",row:v(e),col:v(t),reverse:r})},checkEnabled:()=>!G.solved,touchTimeout:u.timing.touchHoldDelay}),Y=.4*z,Q=x(Re,X,[G,z]),Z=e.useMemo(()=>((e,r)=>(o,n)=>{const l=e.numbers[o]?.[n],i=s(o,n),c=e.errorNodes.has(i),a=e.satisfiedNodes.has(i);return{sx:{pointerEvents:"none"},children:t.jsx(w,{sx:{borderRadius:"50%",backgroundColor:c?k.data.red:k.surface.background,border:null==l?"none":`2px solid ${c?k.data.red:a?"transparent":k.border.subtle}`,fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:c?V.COLORS.WHITE:a?k.interactive.disabledText:k.text.primary,boxShadow:a&&!c?"none":V.SHADOWS.HINT,zIndex:5,opacity:null==l?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:c?"scale(1.1)":"scale(1)",width:`${String(r)}rem`,height:`${String(r)}rem`},children:l??""})}})(G,Y),[G,Y]),ee=e.useMemo(()=>({px:o?"1rem":"2rem",pt:o?"1rem":"2rem"}),[o]),te=t.jsx(y,{...$,onRefresh:I,disabled:E,onOpenInfo:d,hidden:n}),re=N!==G.rows||O!==G.cols,ne=t.jsx(fe,{isGhostMode:n,generating:E,dimensionsMismatch:re,rows:N,cols:O,state:G,size:z,ghostMoves:H,onGhostMove:P,onGhostCopy:L,onGhostClear:W,onGhostClose:q,overlayProps:Z,cellProps:Q});return t.jsxs(b,{title:j.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",paddingBottom:{xs:"120px",md:"150px"},controls:te,contentSx:ee,showTrophy:!n&&G.solved,onReset:I,boardSize:z,iconSizeRatio:_,boardSx:B,onClick:n?q:void 0,children:[t.jsx(w,{onClick:F,children:ne}),i&&t.jsx(S,{open:i,toggleOpen:d,titles:he,instructions:pe,instructionsFooter:t.jsx(w,{sx:{display:"flex",px:2,ml:{xs:5,sm:4},pt:{xs:0,sm:3},mt:{xs:-2,sm:0}},children:t.jsx(C,{variant:"outlined",startIcon:t.jsx(D,{}),onClick:K,sx:{borderColor:k.border.subtle,color:k.text.secondary},children:"Open Calculator"})}),exampleContent:t.jsx(oe,{size:5}),cardSx:ge,contentSxOverride:me})]})}export{Ie as default};
