import{r as t,j as r}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-oL42Vl-U.js";import{a as n}from"./index-D3hFZ0cl.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(t,r)=>{const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(t)}return e},c=(t,r,e,n,o=!1)=>{const a=[],{row:i,col:l}=t;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([t,i])=>{if(void 0!==t&&void 0!==i&&t>=0&&t<e&&i>=0&&i<n&&r[t]?.[i]?.visited===o){const e=r[t][i];a.push(e)}}),a},u=(t,r)=>{const e=t.row-r.row,n=t.col-r.col;1===e?(t.walls.top=!1,r.walls.bottom=!1):-1===e?(t.walls.bottom=!1,r.walls.top=!1):1===n?(t.walls.left=!1,r.walls.right=!1):-1===n&&(t.walls.right=!1,r.walls.left=!1)};const f={backtracker:function(t,r,e){const n=[],o=t[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,t,r,e,!1);if(a.length>0){const t=a[Math.floor(Math.random()*a.length)];t&&(u(o,t),t.visited=!0,n.push(t))}else n.pop()}},prims:function(t,r,e){const n=t[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,t,r,e,!1).map(t=>({parent:n,cell:t}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,t,r,e,!1).forEach(t=>{o.push({parent:l,cell:t})})}}}};const d=15,h=60;function p(){const c=t.useRef(null),u=t.useRef(null),[p,m]=t.useState(null),[g,w]=t.useState("start"),[y]=t.useState("backtracker"),x=t.useRef({player:{x:0,y:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start"}),{height:v,width:b}=o(),C=a("sm"),k=v-(C?56:80),M=t.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[E,S]=t.useState({active:!1,originConfig:null,currentConfig:null}),j=t.useCallback(()=>{const t=function(t,r,e="backtracker"){const n=s(t,r);return(0,f[e])(n,t,r),{grid:n,rows:t,cols:r,start:[0,0],end:[t-1,r-1]}}(d,d,y);m(t),x.current.player={x:t.start[1]*h+30,y:t.start[0]*h+30,rotation:0},x.current.goal={x:t.end[1]*h+30,y:t.end[0]*h+30,rotation:0},x.current.gameState="playing",w("playing")},[y]);t.useEffect(()=>{j()},[j]),t.useEffect(()=>{if(!p||"playing"!==g||!c.current)return;const t=c.current,r=t.getContext("2d",{alpha:!0});if(!r)return;let e;const o={},a=t=>{o[t.key.toLowerCase()]=!0},i=t=>{o[t.key.toLowerCase()]=!1};window.addEventListener("keydown",a),window.addEventListener("keyup",i);const l=a=>{e=requestAnimationFrame(l);const i=(o.d||o.arrowright?1:0)-(o.a||o.arrowleft?1:0),s=(o.s||o.arrowdown?1:0)-(o.w||o.arrowup?1:0);let c=0,u=0;M.current.isDown&&(c=Math.max(-1,Math.min(1,(M.current.currentX-M.current.startX)/80)),u=Math.max(-1,Math.min(1,(M.current.currentY-M.current.startY)/80)));const f=i+c,m=s+u;if(0!==f||0!==m){const t=Math.atan2(m,f),r=Math.min(1,Math.sqrt(f*f+m*m)),e=Math.cos(t)*r*4.5,n=Math.sin(t)*r*4.5,o=x.current.player.x+e,a=x.current.player.y+n,i=(t,r)=>{const e=Math.floor(t/h),n=Math.floor(r/h);if(n<0||n>=d||e<0||e>=d)return!1;const o=p.grid[n]?.[e];if(!o)return!1;const a=e*h,i=(e+1)*h,l=n*h,s=(n+1)*h;return!(o.walls.left&&t-14<a)&&(!(o.walls.right&&t+14>i)&&(!(o.walls.top&&r-14<l)&&!(o.walls.bottom&&r+14>s)))};i(o,x.current.player.y)&&(x.current.player.x=o),i(x.current.player.x,a)&&(x.current.player.y=a),x.current.player.rotation+=.15*r}x.current.camera.x+=.1*(x.current.player.x-x.current.camera.x),x.current.camera.y+=.1*(x.current.player.y-x.current.camera.y);Math.sqrt(Math.pow(x.current.player.x-x.current.goal.x,2)+Math.pow(x.current.player.y-x.current.goal.y,2))<30&&"playing"===x.current.gameState&&(x.current.gameState="won",w("won"),setTimeout(()=>{j()},1500));const g=window.devicePixelRatio||1;t.width=b*g,t.height=k*g,r.scale(g,g),r.clearRect(0,0,b,k),r.save(),r.translate(b/2-x.current.camera.x,k/2-x.current.camera.y);const y=30,v=x.current.camera.x-b/2,E=x.current.camera.x+b/2,S=x.current.camera.y-k/2,X=x.current.camera.y+k/2;r.beginPath(),r.strokeStyle="rgba(56, 139, 253, 0.05)",r.lineWidth=1;for(let t=Math.floor(v/y)*y;t<=E;t+=y)r.moveTo(t,S),r.lineTo(t,X);for(let t=Math.floor(S/y)*y;t<=X;t+=y)r.moveTo(v,t),r.lineTo(E,t);r.stroke(),r.strokeStyle="hsl(0, 0%, 60%)",r.lineWidth=4,r.lineCap="round",r.shadowColor="hsl(0, 0%, 60%)",r.shadowBlur=C?3:5,p.grid.forEach((t,e)=>{t.forEach((t,n)=>{const o=n*h,a=e*h;r.beginPath(),t.walls.top&&(r.moveTo(o,a),r.lineTo(o+h,a)),t.walls.left&&(r.moveTo(o,a),r.lineTo(o,a+h)),14===n&&t.walls.right&&(r.moveTo(o+h,a),r.lineTo(o+h,a+h)),14===e&&t.walls.bottom&&(r.moveTo(o,a+h),r.lineTo(o+h,a+h)),r.stroke()})}),r.shadowBlur=0;const Y=x.current.goal;Y.rotation+=.02,r.save(),r.translate(Y.x,Y.y),r.rotate(Y.rotation),r.fillStyle=n.primary.main,r.shadowColor=n.primary.main,r.shadowBlur=15,r.beginPath(),r.rect(-10,-10,20,20),r.fill(),r.strokeStyle="rgba(255, 255, 255, 0.4)",r.lineWidth=2,r.stroke(),r.restore();const T=x.current.player;r.save(),r.translate(T.x,T.y);const L=r.createRadialGradient(0,0,0,0,0,24);L.addColorStop(0,n.data.amber),L.addColorStop(1,"transparent"),r.fillStyle=L,r.globalAlpha=.5+.2*Math.sin(.005*a),r.beginPath(),r.arc(0,0,24,0,2*Math.PI),r.fill(),r.globalAlpha=1,r.fillStyle=n.data.amber,r.beginPath(),r.arc(0,0,12,0,2*Math.PI),r.fill(),r.restore(),r.restore()};return requestAnimationFrame(l),()=>{cancelAnimationFrame(e),window.removeEventListener("keydown",a),window.removeEventListener("keyup",i)}},[p,g,b,k,C,j]);const X=t=>{M.current.isDown&&(M.current.currentX=t.clientX,M.current.currentY=t.clientY,S(r=>{if(!r.originConfig)return r;const e=t.clientX-r.originConfig.x,n=t.clientY-r.originConfig.y,o=Math.sqrt(e*e+n*n);let a=t.clientX,i=t.clientY;if(o>50){const t=50/o;a=r.originConfig.x+e*t,i=r.originConfig.y+n*t}return{...r,currentConfig:{x:a,y:i}}}))},Y=()=>{M.current.isDown=!1,S({active:!1,originConfig:null,currentConfig:null})};return t.useEffect(()=>(window.addEventListener("pointermove",X),window.addEventListener("pointerup",Y),()=>{window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",Y)}),[]),t.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),r.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[r.jsx(e,{showHome:!0}),r.jsx(l,{ref:u,onPointerDown:t=>{"playing"===g&&(M.current.isDown=!0,M.current.startX=t.clientX,M.current.startY=t.clientY,M.current.currentX=t.clientX,M.current.currentY=t.clientY,S({active:!0,originConfig:{x:t.clientX,y:t.clientY},currentConfig:{x:t.clientX,y:t.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:r.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),E.active&&E.originConfig&&E.currentConfig&&r.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[r.jsx(l,{sx:{position:"absolute",left:E.originConfig.x,top:E.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),r.jsx(l,{sx:{position:"absolute",left:E.currentConfig.x,top:E.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{p as default};
