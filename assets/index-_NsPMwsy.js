import{r as e,j as r}from"./vendor_react-WaSaIrII.js";import{g as o,a as t,u as s,C as n,G as a}from"./CustomGrid-ipL6Fhnd.js";import{d as i,a as l,C as c,e as u,f,L as d}from"./index-BcrO04Ee.js";import{u as h,G as m}from"./gameConfig-CQ15qQC4.js";import{G as p}from"./GlobalHeader-CD6trsEU.js";import{u as b,a as y}from"./useTimer-DNifX3C9.js";import{F as g}from"./vendor_mui_icons-ygjA6J88.js";import{G as w}from"./vendor_mui_core-3PJY_Tg4.js";function x(e){return Math.floor(Math.random()*e)}function k(e,r){const o={};for(const t in e){const s=e[t];s+r>0?o[t]=s+r:s<0&&(o[t]=s)}return o}function j(e,r,o){const t=r*o,s=x(t);let n=x(t);return s===n&&(n=++n%t),{...e,rows:r,cols:o,head:s,board:{[s]:e.length,[n]:-1}}}function v(e){let{board:r,length:o,head:s,velocity:n,buffer:a}=e;const{rows:i,cols:l}=e,c=i*l;if(r=k(r,-1),s=t(s,n,i,l),s in r){const e=r[s];r[s]=o,e>0?r=k(r,-e):(r=k(r,1),r=function(e,r){let o=x(e);for(;o in r;)++o>=e&&(o=0);return{...r,[o]:-1}}(c,r)),o=r[s]}else r[s]=o;if(a.length){const[e,...r]=a;a=r,n+e&&(n=e)}return{...e,length:o,board:r,head:s,velocity:n,buffer:a}}function C(e,r){switch(r.type){case"resize":{const{rows:o,cols:t}=r.payload;return j(e,o,t)}case"steer":{const{payload:t}=r,s=o(t.key);let{buffer:n}=e;return s&&(n=[...n,s]),{...e,buffer:n}}case"move":return v(e);default:return e}}function S(){const{create:o}=b(0),{create:k}=y(),v=s("sm"),{height:S,width:z}=h(),M=m.snake.initialLength,_=v?m.gridSizes.mobile:m.gridSizes.desktop,[G,P]=e.useState(!1),E=e.useRef(!1),[H,R]=e.useState(!1),{rows:A,cols:D}=e.useMemo(()=>{const e=v?d.headerHeight.xs:d.headerHeight.md,r=S-e,o=_*a.calculation.pixelMultiplier;return{rows:Math.floor(r/o),cols:Math.floor(z/o)}},[_,S,z,v]),L=e.useMemo(()=>({velocity:m.snake.initialVelocity,buffer:[],length:M,rows:0,cols:0,head:0,board:{}}),[M]),[B,F]=e.useReducer(C,j(L,A,D)),I=e.useCallback(e=>()=>{const r=m.controls.arrowPrefix+e;F({type:"steer",payload:{key:r}})},[]),T=e.useCallback(e=>{const{clientX:r,clientY:o}=e,t=r-z/2,s=o-S/2,n=B.buffer.length>0?B.buffer[B.buffer.length-1]:B.velocity;let a="";a=2===Math.abs(n)?t>0?"right":"left":s>0?"down":"up";const i=m.controls.arrowPrefix+a;F({type:"steer",payload:{key:i}})},[F,B.velocity,B.buffer,z,S]),U=e.useCallback((e,o)=>{const s=e*D+o,n=B.board;let i="inherit";s in n&&(i=n[s]>0?l.primary.main:l.primary.dark);const c=t(s,-2,A,D),u=t(s,2,A,D),f=t(s,-1,A,D),d=t(s,1,A,D),h=n[c]>0,m=n[u]>0,p=n[f]>0,b=n[d]>0,y=_/a.cellSize.divisor+"rem";if("inherit"===i)return{backgroundColor:i};if(-1===n[s])return{backgroundColor:"transparent",children:r.jsx(g,{sx:{color:i,fontSize:.7*_+"rem"}})};const w=[0,0,0,0];h||p||(w[0]=1),h||b||(w[1]=1),m||b||(w[2]=1),m||p||(w[3]=1);const x=w.map(e=>e?y:"0").join(" ");return{backgroundColor:i,boxShadow:`0 0 1.25rem ${i.replace("hsl","hsla").replace(")",", 0.25)")}`,borderRadius:x}},[B,A,D,_]);return e.useEffect(()=>{o({repeat:()=>{const e="wasd"[x(4)];F({type:"move"}),x(2)&&E.current&&F({type:"steer",payload:{key:e}})},speed:100}),k(e=>F({type:"steer",payload:e}))},[o,k]),e.useEffect(()=>{E.current=G},[G]),e.useEffect(()=>{F({type:"resize",payload:{rows:A,cols:D}})},[A,D]),e.useEffect(()=>{document.title=i.snake},[]),r.jsxs(w,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:l.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[r.jsx(p,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),r.jsx(w,{flex:1,onPointerDown:T,sx:{...c.flexCenter,zIndex:1},children:r.jsx(n,{size:_,rows:A,cols:D,space:0,cellProps:(e,r)=>({...U(e,r),transition:!1})})}),r.jsx(u,{handler:I,onAutoPlay:()=>P(!G),autoPlayEnabled:G,hide:H,children:r.jsx(f,{show:H,setShow:R,handler:I})})]})}export{S as default};
