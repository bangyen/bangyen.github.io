import{r as e,a as o,j as t}from"./vendor_react-WaSaIrII.js";import{d as r,a as s,C as n,e as i,f as a,L as l}from"./index-2Mg8ft3S.js";import{g as c,a as f,u,G as d,C as h}from"./CustomGrid-D2B2dSLn.js";import{G as m}from"./gameConfig-nraIanc0.js";import{G as p}from"./GlobalHeader-CSMIpn6M.js";import{u as g,a as b}from"./useTimer-DHwl40cy.js";import{u as v}from"./useWindow-BCvkQ8_7.js";import{F as w}from"./vendor_mui_icons-kUp0AcNR.js";import{G as y,k}from"./vendor_mui_core-D4-4kcvK.js";function S(e){return Math.floor(Math.random()*e)}function x(e,o){const t={};for(const r in e){const s=e[r];void 0!==s&&(s+o>0?t[r]=s+o:s<0&&(t[r]=s))}return t}function j(e,o,t){const r=o*t,s=S(r);let n=S(r);return s===n&&(n=++n%r),{...e,rows:o,cols:t,head:s,board:{[s]:e.length??5,[n]:-1}}}function M(e){let{board:o,length:t,head:r,velocity:s,buffer:n}=e;if(void 0===t)return e;const{rows:i,cols:a}=e,l=i*a;o=x(o,-1);const c=f(r,s,i,a);if(o[c]&&o[c]>0){const e=[-2,2,-1,1],t=[];for(const n of e){if(n===-s||n===s)continue;const e=f(r,n,i,a);(void 0===o[e]||o[e]<0)&&t.push(n)}if(t.length>0){const e=t[Math.floor(Math.random()*t.length)];void 0!==e&&(s=e)}}if(r=f(r,s,i,a),r in o){const e=o[r];o[r]=t,void 0!==e&&(e>0?o=x(o,-e):(o=x(o,1),o=function(e,o){let t=S(e);for(;t in o;)++t>=e&&(t=0);return{...o,[t]:-1}}(l,o))),t=o[r]}else o[r]=t;if(n.length){const[e,...o]=n;n=o,void 0!==e&&s+e&&(s=e)}return{...e,length:t,board:o,head:r,velocity:s,buffer:n}}function _(e,o){switch(o.type){case"resize":{const{rows:t,cols:r}=o.payload;return j(e,t,r)}case"steer":{const{payload:t}=o,r=c(t.key);let{buffer:s}=e;if(["NorthWest","NorthEast","SouthWest","SouthEast"].includes(t.key)){const o=t.key,r=-2,n=2,i=-1,a=1;let l=0,c=0;"NorthWest"===o?(l=r,c=i):"NorthEast"===o?(l=r,c=a):"SouthWest"===o?(l=n,c=i):"SouthEast"===o&&(l=n,c=a);const f=s.length>0?s[s.length-1]??e.velocity:e.velocity;2===Math.abs(f)?(f===l||f===-l)&&(s=[...s,c,l]):(f===c||f===-c)&&(s=[...s,l,c]),0===f&&(s=[...s,l])}else r&&(s=[...s,r]);return{...e,buffer:s}}case"move":return M(e);default:return e}}const C=100,E=.7,I="2s",W={TERMINAL_DIVISOR:2.5,GLOW_SIZE:"1.25rem",GLOW_OPACITY:.25},G=k`
  0% { transform: scale(0.8) rotate(0deg); }
  50% { transform: scale(1.1) rotate(180deg); }
  100% { transform: scale(0.8) rotate(360deg); }
`;function A(){const{create:c}=g(0),{create:k}=b(),S=u("sm"),{height:x,width:M}=v(),A=m.snake.initialLength,L=S?m.gridSizes.mobile:m.gridSizes.desktop,{rows:z,cols:N}=e.useMemo(()=>{const e=S?l.headerHeight.xs:l.headerHeight.md,o=x-e,t=L*d.calculation.pixelMultiplier;return{rows:Math.floor(o/t),cols:Math.floor(M/t)}},[L,x,M,S]),O=e.useMemo(()=>({velocity:m.snake.initialVelocity,buffer:[],length:A,rows:0,cols:0,head:0,board:{}}),[A]),[$,R]=e.useReducer(_,j(O,z,N)),D=e.useCallback(e=>{const{clientX:o,clientY:t}=e,r=o-M/2,s=t-x/2,n=$.buffer.length>0?$.buffer[$.buffer.length-1]??$.velocity:$.velocity;let i="";i=2===Math.abs(n)?r>0?"right":"left":s>0?"down":"up";const a=m.controls.arrowPrefix+i;R({type:"steer",payload:{key:a}})},[R,$.velocity,$.buffer,M,x]),[H,P]=o.useState(!1),T=e.useCallback(e=>()=>{R({type:"steer",payload:{key:{up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight","up-left":"NorthWest","up-right":"NorthEast","down-left":"SouthWest","down-right":"SouthEast"}[e]??""}})},[R]),V=e.useCallback((e,o)=>{const r=e*N+o,n=$.board;let i="inherit";if(r in n){const e=n[r];void 0!==e&&(i=e>0?s.primary.main:s.primary.dark)}const a=f(r,-2,z,N),l=f(r,2,z,N),c=f(r,-1,z,N),u=f(r,1,z,N),h=n[r],m=e=>{const o=n[e];return void 0!==o&&-1!==o&&(void 0!==h&&1===Math.abs(o-h))},p=m(a),g=m(l),b=m(c),v=m(u),y=h===$.length||1===h,k=`${(L/d.cellSize.divisor).toString()}rem`,S=`${(L/W.TERMINAL_DIVISOR).toString()}rem`;if("inherit"===i)return{backgroundColor:i};if(-1===h)return{backgroundColor:"transparent",children:t.jsx(w,{sx:{color:i,fontSize:`${(L*E).toString()}rem`,animation:`${G} ${I} infinite ease-in-out`}})};const x=[0,0,0,0];p||b||(x[0]=1),p||v||(x[1]=1),g||v||(x[2]=1),g||b||(x[3]=1);const j=x.map(e=>e?y?S:k:"0").join(" ");return{backgroundColor:i,boxShadow:`0 0 ${W.GLOW_SIZE} ${i.replace("hsl","hsla").replace(")",`, ${String(W.GLOW_OPACITY)})`)}`,borderRadius:j}},[$,z,N,L]);return e.useEffect(()=>{c({repeat:()=>{R({type:"move"})},speed:C}),k(e=>{R({type:"steer",payload:e})})},[c,k]),e.useEffect(()=>{R({type:"resize",payload:{rows:z,cols:N}})},[z,N,R]),e.useEffect(()=>{document.title=r.snake},[]),t.jsxs(y,{container:!0,minHeight:"100vh",flexDirection:"column",position:"relative",sx:{background:s.surface.background,overflow:"hidden",overscrollBehavior:"none",touchAction:"none"},children:[t.jsx(p,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Snake_(video_game_genre)"}),t.jsx(y,{flex:1,onPointerDown:D,sx:{...n.flexCenter,zIndex:1},children:t.jsx(h,{size:L,rows:z,cols:N,space:0,cellProps:(e,o)=>({...V(e,o),transition:!1})})}),t.jsx(i,{children:t.jsx(a,{show:H,setShow:P,handler:T,diagonals:!0})})]})}export{A as default};
