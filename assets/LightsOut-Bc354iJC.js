import{r as t,j as e,a as o}from"./vendor_react-WaSaIrII.js";import{a as n,T as s,d as r,e as i,g as l,L as c}from"./index-D31RdmOB.js";import{C as a,u,c as f}from"./CustomGrid-Bs5mSJQO.js";import{B as d,G as x,d as p,h,I as m,e as g}from"./vendor_mui_core-B7mxGf-Q.js";import{u as j,G as y}from"./gameConfig-Bl_NC4gL.js";import{G as b}from"./GlassCard-BzmlbKjr.js";import{i as w,C as k,j as C,k as v,l as z,R as I,N as S,m as P,I as A}from"./vendor_mui_icons-kIEf1gUT.js";import{G as R}from"./GlobalHeader-gcSuQhwQ.js";function B(t){const{frontProps:o,backProps:n,size:s,rows:r,cols:i}=t;return e.jsxs(d,{sx:{display:"grid",placeItems:"center"},children:[e.jsx(d,{sx:{gridArea:"1/1"},children:e.jsx(a,{space:0,size:s,rows:r-1,cols:i-1,cellProps:n})}),e.jsx(d,{sx:{gridArea:"1/1",zIndex:1},children:e.jsx(a,{space:0,size:s,rows:r,cols:i,cellProps:o})})]})}function D(e,o){const n=t.useCallback((t,n)=>{const s=e(t,n);return{front:s?o.primary:o.secondary,back:s?o.secondary:o.primary}},[e,o]),s=t.useCallback((t,o)=>function(t,e,o){const n=o(t,e),s={},r=n===o(t-1,e),i=n===o(t+1,e),l=n===o(t,e-1),c=n===o(t,e+1);return(r||l)&&(s.borderTopLeftRadius=0),(r||c)&&(s.borderTopRightRadius=0),(i||l)&&(s.borderBottomLeftRadius=0),(i||c)&&(s.borderBottomRightRadius=0),s}(t,o,e),[e]),r=t.useCallback((t,n)=>{const s=function(t,e,o){const n=o(t,e),s=o(t,e+1),r=o(t+1,e),i=o(t+1,e+1);let l=!0;const c=Number(n)+Number(s)+Number(r)+Number(i);return n&&i||!(c<3)||(l=!1),l}(t,n,e);return s?o.primary:o.secondary},[e,o]);return{getColor:n,getBorder:s,getFiller:r}}function W(e,o){const{grid:n,rows:s,cols:r}=e;return D(t.useCallback((t,e)=>t<0||e<0||t>=s||e>=r?-1:n[t][e],[n,s,r]),o)}function E(t,e){return[...Array(t)].map(()=>Array(e).fill(0))}function H(t,e,o){const n=o[0].length,s=o.length,r=o.map(t=>[...t]);return r[t][e]^=1,t>0&&(r[t-1][e]^=1),t<s-1&&(r[t+1][e]^=1),e>0&&(r[t][e-1]^=1),e<n-1&&(r[t][e+1]^=1),r}function T(t,e){let o=E(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){Math.random()>.5&&(o=H(n,t,o))}return o}const _={};function F(t){const e=t.length,o=t[0].length;for(let s=0;s<e-1;s++)for(let e=0;e<o;e++)if(1===t[s][e])return[{row:s+1,col:e}];const n=t[e-1];if(n.some(t=>1===t)){const t=function(t,e,o){const n=`${t},${e}`;if(!_[n]){const o={},s=1<<e;for(let n=0;n<s;n++){let s=E(t,e);const r=[];for(let t=0;t<e;t++)n>>t&1&&(s=H(0,t,s),r.push(t));for(let o=0;o<t-1;o++)for(let t=0;t<e;t++)1===s[o][t]&&(s=H(o+1,t,s));const i=s[t-1].join("");o[i]||(o[i]=r)}_[n]=o}const s=o.join("");return _[n][s]||null}(e,o,n);if(t&&t.length>0)return t.map(t=>({row:0,col:t}))}return null}function G(t,e){const{type:o,row:n,col:s,moves:r}=e;let{grid:i,score:l,rows:c,cols:a,auto:u}=t;switch(o){case"auto":u=!u;break;case"adjacent":if(void 0!==n&&void 0!==s){i=H(n,s,i);const t=i.flatMap(t=>t);(!t.includes(1)||!t.includes(0))&&(i=T(c,a),l+=1)}break;case"multi_adjacent":if(r){r.forEach(t=>{i=H(t.row,t.col,i)});const t=i.flatMap(t=>t);(!t.includes(1)||!t.includes(0))&&(i=T(c,a),l+=1)}break;case"random":case"randomize":i=T(c,a),u=!1;break;case"resize":{const{newRows:t,newCols:o}=e;void 0!==t&&void 0!==o&&(c=t,a=o,i=T(c,a),u=!1);break}case"reset":i=E(c,a),l=0,u=!1}return{grid:i,score:l,rows:c,cols:a,auto:u}}function M(t){let e=0;for(;t;)t&=t-1,e++;return e}function N(t,e){const o=t.length,n=[];for(let s=0;s<o;s++){const r=t[s];let i=0;for(let t=0;t<o;t++){i<<=1,i+=1&M(r&e[t])}n.push(i)}return n}function L(t){const e=Array(t).fill(1);for(let o=0;o<t;o++)e[o]<<=t-o-1;return e}function O(t,e){let o=L(t.length);for(let n=0;n<e;n++)o=N(o,t);return o}function Y(t,e){const o=t.length,n=[];for(let s=0;s<o;s++){const o=t[s]^e[s];n.push(o)}return n}function U(t,e){const o=t.length,n=[...Array(o).keys()].sort((e,o)=>t[o]-t[e]);return[n.map(e=>t[e]),n.map(t=>e[t])]}function $(t,e,o){const n=function(t){const e=[7<<t-2];for(let o=1;o<t;o++){const t=e[o-1]>>1;e.push(t)}return e[0]-=2**t,e}(o),s=function(t,e){const o=t.length;let n=Array(o).fill(0),s=0;for(;e;)1&e&&(n=Y(n,O(t,s))),e>>=1,s++;return n}(n,function(t){const e=[0,1];for(let o=1;o<t;o++){const t=e[o],n=e[o-1],s=t<<1;e.push(s^n)}return e[t]}(e+1)),r=function(t){const e=t.length;let o=t,n=L(e);for(let s=0;s<e;s++){const t=1<<e-s-1;[o,n]=U(o,n);for(let r=0;r<e;r++){const e=o[r];r!==s&&e&t&&(o[r]^=o[s],n[r]^=n[s])}}return n}(s),i=parseInt(t.join(""),2);return r.map(t=>1&M(t&i))}function q(t,e){const o=[...t];let n=t.at(-1);if(!n)return o;for(let s=1;s<e;s++)for(let t=0;t<e;t++){if(!n[s-1][t])continue;const e=H(s,t,n);o.push(e),n=e}return o}function J(t,e){const o=t.at(-1);if(!o)return t;const n=[...t];for(;n.length<e;)n.push([...o]);return n}function K(t,e){let o=E(e,e);for(const x of t){o=H(Math.floor(x/e),x%e,o)}const n=q([o],e),s=n.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const r=s.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:l}=function(t,e){const o=Array(e).fill(0),n=[o],s=[o],r=[...o];for(let i=0;i<e;i++){if(!t[i])continue;r[i]=1;const o=[...r],l=$(o,e,e);n.push(o),s.push(l)}return{input:n,output:s}}(r,e),c=n.length+i.length-1,a=l.at(-1);if(!a)return{boardStates:[],inputStates:[],outputStates:[]};let u=[...s];for(let x=0;x<c-n.length;x++)n.push([...s]);for(let x=0;x<c-i.length;x++)i.unshift([...i[0]]);for(let x=0;x<c-l.length;x++)l.unshift([...l[0]]);for(let x=0;x<e;x++)a[x]&&(u=H(0,x,u),n.push([...u]));const f=q(n,e),d=f.length;return{boardStates:f,inputStates:J(i,d),outputStates:J(l,d)}}function Q({getColor:t,getBorder:e}){return(o,n)=>{const{front:s}=t(o,n);return{backgroundColor:s,style:e(o,n),transition:"all 200ms ease"}}}function V(e,o,n){return D(t.useCallback((t,n)=>0!==t||n<0||n>=o?-1:e[n],[e,o]),n)}function X({start:o=[],dims:s=3,size:r,palette:i,getFrontProps:l,getBackProps:c}){const[u,f]=t.useState(0);t.useEffect(()=>{const t=setInterval(()=>{f(t=>t+1)},2e3);return()=>clearInterval(t)},[]);const h=K(o,s),m=r,{boardStates:g,inputStates:j,outputStates:y}=h,b=u%j.length,w=W({grid:g[b],rows:s,cols:s},i),k=l(w),C=c(w),v=V(j[b],s,i),z=V(y[b],s,i),I=Q(v),S=Q(z);return e.jsx(x,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:e.jsxs(x,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%"},children:[e.jsx(x,{size:6,sx:{display:"flex",justifyContent:"center"},children:e.jsx(B,{size:m,rows:s,cols:s,frontProps:k,backProps:C})}),e.jsxs(x,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{mb:2,textAlign:"center"},children:[e.jsx(p,{variant:"subtitle2",sx:{mb:1,color:n.text.secondary},children:"Input"}),e.jsx(a,{rows:1,cols:s,size:m,cellProps:I,space:0})]}),e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(a,{rows:1,cols:s,size:m,cellProps:S,space:0}),e.jsx(p,{variant:"subtitle2",sx:{mt:1,color:n.text.secondary},children:"Result"})]})]})]})})}const Z=({children:t})=>e.jsx(p,{variant:"h5",sx:{color:n.text.primary,fontWeight:s.fontWeight.bold,textAlign:"left",fontSize:s.fontSize.h2},children:t}),tt=({Icon:t,title:o,text:r})=>e.jsxs(d,{sx:{px:2},children:[e.jsxs(p,{variant:"h6",sx:{color:n.text.primary,fontWeight:s.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:s.fontSize.subheading},children:[e.jsx(t,{sx:{mr:2,color:n.primary.main,fontSize:"1.75rem"}}),o]}),e.jsx(p,{variant:"body1",sx:{color:n.text.secondary,lineHeight:1.6,fontSize:s.fontSize.body,ml:6},children:r})]}),et=["Chasing Lights","How It Works","Calculator"],ot=b;function nt(o){const{rows:s,cols:r,size:i,open:l,palette:c,toggleOpen:f,getFrontProps:x,getBackProps:j}=o,y=u("md"),[b,A]=t.useState(0),[R,B]=t.useState(Array(r).fill(0));t.useEffect(()=>{B(Array(r).fill(0))},[r,c]);const D=$(R,s,r),W=V(R,r,c),E=V(D,r,c),H=function(t,o){const{getColor:n,getBorder:s}=t;return(t,r)=>{const{front:i,back:l}=n(t,r);return{backgroundColor:i,style:s(t,r),onClick:o(r),sx:{"&:hover":{cursor:"pointer",color:l},transition:"all 200ms ease"},color:i,children:e.jsx(w,{})}}}(W,t=>e=>{e.stopPropagation();const o=[...R];o[t]^=1,B(o)}),T=Q(E);return e.jsxs(h,{open:l,onClick:f,sx:{zIndex:9999,backgroundColor:t=>"dark"===t.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)"},children:[e.jsxs(ot,{onClick:t=>t.stopPropagation(),sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[e.jsxs(d,{sx:{flex:1,overflowY:"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsx(Z,{children:et[b]}),e.jsx(m,{onClick:()=>{f()},size:"small",sx:{color:n.text.secondary},children:e.jsx(k,{})})]}),0===b&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[e.jsx(tt,{Icon:C,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),e.jsx(tt,{Icon:v,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),e.jsx(tt,{Icon:z,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===b&&e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(X,{dims:3,size:.7*i,start:[1,3,8],palette:c,getFrontProps:x,getBackProps:j})})}),2===b&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:n.text.primary,fontWeight:"bold"},children:["Input"," ",e.jsx(d,{component:"span",sx:{color:n.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),e.jsx(a,{space:0,rows:1,cols:r,size:i*(y?.9:.8),cellProps:H})]}),e.jsxs(d,{children:[e.jsxs(p,{variant:"subtitle2",sx:{mb:1,color:n.text.primary,fontWeight:"bold"},children:["Solution"," ",e.jsx(d,{component:"span",sx:{color:n.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),e.jsx(a,{space:0,rows:1,cols:r,size:i*(y?.9:.8),cellProps:T})]}),e.jsx(d,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(g,{variant:"outlined",size:"small",startIcon:e.jsx(I,{}),onClick:()=>{B(Array(r).fill(0))},sx:{borderColor:n.border.subtle,color:n.text.secondary},children:"Clear Pattern"})})]})})]}),e.jsxs(d,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(g,{onClick:()=>{b>0&&A(b-1)},disabled:0===b,startIcon:e.jsx(S,{}),sx:{visibility:0===b?"hidden":"visible",color:n.text.primary},children:"Back"}),e.jsx(d,{sx:{display:"flex",gap:1},children:[0,1,2].map(t=>e.jsx(d,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:b===t?n.primary.main:n.interactive.disabled,transition:"background-color 0.3s"}},t))}),e.jsx(g,{onClick:()=>{b<2?A(b+1):f()},disabled:2===b,endIcon:e.jsx(P,{}),sx:{visibility:2===b?"hidden":"visible",color:n.text.primary},children:"Next"})]})]}),e.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})}function st(t,o){const{getColor:n,getBorder:s}=t;return(t,r)=>{const i=s(t,r),{front:l,back:c}=n(t,r);return{onClick:()=>((t,e)=>{o({type:"adjacent",row:t,col:e})})(t,r),children:e.jsx(w,{}),backgroundColor:l,color:l,style:i,sx:{"&:hover":{cursor:"pointer",color:c}}}}}function rt(t){return(e,o)=>({backgroundColor:t.getFiller(e,o)})}function it(t){const e=st(t,()=>{});return(t,o)=>({...e(t,o),onClick:void 0,sx:void 0})}function lt(){const{height:s,width:a}=j(),p=u("sm"),h=p?y.gridSizes.mobile:y.gridSizes.desktop;let{rows:m,cols:g}=t.useMemo(()=>{const t=p?c.headerHeight.xs:c.headerHeight.md;return f(h,s-t,Math.min(a,1300))},[h,s,a,p]);m-=1,g-=1,p&&(m-=2);const b={grid:E(m,g),score:0,rows:m,cols:g,auto:!1},[w,k]=t.useReducer(G,b),[C,v]=t.useReducer(t=>!t,!1),z=t.useMemo(()=>({primary:n.primary.main,secondary:n.primary.dark}),[]);t.useEffect(()=>{document.title=r.lightsOut},[]),t.useEffect(()=>{k({type:"resize",newRows:m,newCols:g})},[m,g]);const[I,S]=o.useState([]);t.useEffect(()=>{if(!w.auto)return void(I.length>0&&S([]));const t=setTimeout(()=>{if(I.length>0){const[t,...e]=I;k({type:"adjacent",row:t.row,col:t.col}),S(e)}else{const t=F(w.grid);t&&t.length>0?1===t.length?k({type:"adjacent",row:t[0].row,col:t[0].col}):S(t):k({type:"auto"})}},300);return()=>clearTimeout(t)},[w.auto,w.grid,I]);const P=W(w,z),D=st(P,t=>k(t)),H=rt(P);return e.jsxs(x,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,position:"relative"},children:[e.jsx(R,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),e.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",paddingTop:6},children:e.jsx(B,{size:h,rows:m,cols:g,frontProps:D,backProps:H})}),e.jsx(i,{handler:()=>()=>{},onAutoPlay:()=>k({type:"auto"}),autoPlayEnabled:w.auto,children:e.jsx(l,{title:"Info",Icon:A,onClick:v})}),e.jsx(nt,{rows:m,cols:g,size:h,open:C,palette:z,toggleOpen:v,getFrontProps:it,getBackProps:rt})]})}export{lt as default};
