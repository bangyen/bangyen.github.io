import{j as e,r as n,a as r}from"./vendor_react-De-BR_RD.js";import{B as t,l as o,g as s,b as l,d as i,G as a,u as c,m as u,T as d,n as f,L as p,o as g,e as h,c as m,a as y,h as x,f as b,i as S,j as v,k as w}from"./useBaseGame-Cv1_Phwl.js";import{T as C}from"./PageLayout-KJ0_iW8W.js";import{d as A,s as j,k,T as I,B as E}from"./vendor_mui_core-BZzmbb18.js";import{c as N,D as M,d as R,e as T,P as z,f as O,g as P,N as $,h as L,T as D,i as B,j as H}from"./vendor_mui_icons-CM8DnMhM.js";import{C as _,L as W,A as G,S as Y,F as q,t as U,P as V}from"./index-DESZw3Fl.js";import{E as F,u as K}from"./lazyNamed-CsAudFt5.js";import{E as J}from"./ErrorState-DCBC8Kpq.js";const X=n.createContext(void 0);function Q({children:n,value:r}){return e.jsx(X.Provider,{value:r,children:n})}function Z(){const{onCopy:r,onClear:t,onClose:o,onApply:s}=function(){const e=n.useContext(X);if(void 0===e)throw new Error("useAnalysisContext must be used within an AnalysisProvider");return e}();return e.jsxs(A,{sx:{display:"flex",justifyContent:"center",gap:2,pointerEvents:"auto",zIndex:W.zIndex.base+5,width:"100%",paddingBottom:2,position:"absolute",top:"calc(100% + 32px)",left:0},children:[e.jsx(C,{title:"Copy Board",Icon:N,onClick:r,sx:{backgroundColor:_.interactive.selected,color:_.primary.main,"&:hover":{backgroundColor:_.interactive.focus}}}),e.jsx(C,{title:"Clear Analysis",Icon:M,onClick:t,sx:{backgroundColor:"rgba(255, 68, 68, 0.1)",color:_.data.red,"&:hover":{backgroundColor:"rgba(255, 68, 68, 0.2)"}}}),e.jsx(C,{title:"Apply to Game",Icon:R,onClick:s,sx:{backgroundColor:"rgba(76, 175, 80, 0.1)",color:_.data.green,"&:hover":{backgroundColor:"rgba(76, 175, 80, 0.2)"}}}),e.jsx(C,{title:"Close Analysis",Icon:T,onClick:o,sx:{backgroundColor:"rgba(255, 193, 7, 0.1)",color:_.data.amber,"&:hover":{backgroundColor:"rgba(255, 193, 7, 0.2)"}}})]})}function ee(e){return{numberSize:.4*e}}const ne=100,re=1e3,te=100,oe=.8,se={...o("slant"),ANALYSIS_MOVES:"slant-analysis-moves"},le=0,ie=8,ae=5,ce={COLORS:{WHITE:"#fff"},SHADOWS:{LINE:t.SHADOW,HINT:"0 4px 8px rgba(0,0,0,0.1)"},ANALYSIS:{BG_SUBTLE:"var(--slant-analysis-bg-subtle)",BG_HOVER:"var(--slant-analysis-bg-hover)",DASHED_BORDER:"var(--slant-analysis-dashed-border)",HINT_BG:"var(--slant-analysis-hint-bg)",HINT_BORDER:"var(--slant-analysis-hint-border)",HINT_TEXT:"var(--slant-analysis-hint-text)"},ANIMATIONS:{POP_IN:"\n            @keyframes slant-pop-in {\n                0% { transform: var(--slant-base-transform) scale(0.5); opacity: 0; }\n                70% { transform: var(--slant-base-transform) scale(1.1); opacity: 1; }\n                100% { transform: var(--slant-base-transform) scale(1); opacity: 1; }\n            }\n        ",POP_IN_STYLE:"slant-pop-in 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards"}},ue=1,de=2,fe=r.memo(function({value:n,color:r,size:t}){const o=`${String(Math.max(2,t))}px`;return e.jsxs(A,{sx:{width:"100%",height:"100%",position:"relative"},children:[n===ue&&e.jsx(A,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:Y.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(-45deg)",transform:"var(--slant-base-transform)",boxShadow:ce.SHADOWS.LINE,transition:G.transition,animation:ce.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}),n===de&&e.jsx(A,{sx:{position:"absolute",width:"115%",height:o,backgroundColor:r,borderRadius:Y.borderRadius.full,top:"50%",left:"50%","--slant-base-transform":"translate(-50%, -50%) rotate(45deg)",transform:"var(--slant-base-transform)",boxShadow:ce.SHADOWS.LINE,transition:G.transition,animation:ce.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}})]})}),pe=r.memo(function({r:n,c:r,value:t,source:o,isConflict:s,isCycle:l,size:i,pos:a,getDragProps:c}){const u=c(a);let d=_.text.primary;return s?d=_.data.red:l?d="user"===o?_.data.red:_.data.orange:"user"===o?d=_.primary.main:"propagated"===o&&(d=_.data.green),e.jsx(A,{"data-pos":a,"data-type":"cell",...u,sx:{...u.sx,cursor:"pointer",outline:"none",border:`2px solid ${_.border.subtle}`,position:"relative",width:"100%",height:"100%",boxSizing:"border-box",borderRadius:"inherit",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:ce.ANALYSIS.BG_SUBTLE,transition:"background-color 0.2s, outline 0.2s, box-shadow 0.2s","&:hover":{backgroundColor:ce.ANALYSIS.BG_HOVER},"&:focus-visible":{outline:`3px solid ${_.primary.main}`,outlineOffset:"-3px",backgroundColor:ce.ANALYSIS.BG_HOVER,boxShadow:`inset 0 0 15px ${_.interactive.focus}`}},children:e.jsx(fe,{value:t,color:d,size:i})})}),ge=r.memo(function({value:n,hasConflict:r,isSatisfied:t,numberSize:o}){return e.jsx(A,{sx:{width:`${String(o)}rem`,height:`${String(o)}rem`,borderRadius:"50%",backgroundColor:r?_.data.red:ce.ANALYSIS.HINT_BG,border:null==n?"none":`2px solid ${r?_.data.red:t?"transparent":ce.ANALYSIS.HINT_BORDER}`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:`${String(.5*o)}rem`,fontWeight:"800",color:r?ce.COLORS.WHITE:t?_.interactive.disabledText:ce.ANALYSIS.HINT_TEXT,boxShadow:t&&!r?"none":ce.SHADOWS.HINT,opacity:null==n?0:t?.6:1,zIndex:5,position:"relative",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)"},children:n??""})}),he=r.memo(function({r:n,c:r,value:t,hasConflict:o,isSatisfied:l,numberSize:i}){return e.jsx("div",{"data-pos":s(n,r),"data-type":"hint",style:{pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%"},children:e.jsx(ge,{value:t,hasConflict:o,isSatisfied:l,numberSize:i})})});function me({size:n,rows:r,cols:t,cellProps:o,renderCell:s,overlayProps:i,renderOverlay:a}){return e.jsx(l,{size:n,layers:[{rows:r,cols:t,cellProps:o,renderCell:s},{rows:r+1,cols:t+1,cellProps:i,renderCell:a,layerSx:{pointerEvents:"none"},decorative:!0}],space:.125})}class ye{constructor(e){this.parent=Array.from({length:e},(e,n)=>n)}find(e){const n=this.parent[e];if(void 0===n)throw new Error(`DSU: Index ${String(e)} out of bounds`);n!==e&&(this.parent[e]=this.find(n));const r=this.parent[e];if(void 0===r)throw new Error(`DSU: Parent of ${String(e)} became undefined`);return r}union(e,n){const r=this.find(e),t=this.find(n);return r!==t&&(this.parent[r]=t,!0)}connected(e,n){return this.find(e)===this.find(n)}}function xe(e,n,r){return e*(r+1)+n}function be(e,n,r){const t=new Map,o=new Set;for(let s=0;s<n;s++)for(let n=0;n<r;n++){const o=e[s]?.[n];if(!o||0===o)continue;const l=xe(s,o===ue?n+1:n,r),i=xe(s+1,o===ue?n:n+1,r);t.has(l)||t.set(l,[]),t.has(i)||t.set(i,[]),t.get(l)?.push({node:i,r:s,c:n}),t.get(i)?.push({node:l,r:s,c:n})}const l=new Set,i=new Set,a=[],c=(e,n)=>{l.add(e),i.add(e);const r=t.get(e)??[];for(const{node:t,r:u,c:d}of r)if(t!==n)if(i.has(t)){o.add(s(u,d));for(let e=a.length-1;e>=0;e--){const n=a[e];if(!n)break;if(o.add(s(n.r,n.c)),n.u===t||n.v===t)break}}else l.has(t)||(a.push({r:u,c:d,u:e,v:t}),c(t,e),a.pop());i.delete(e)};for(const s of t.keys())l.has(s)||c(s,-1);return o}function Se({rows:e,cols:r,numbers:t,userMoves:o}){const[l,i]=n.useState(new Map),[a,c]=n.useState([]),[u,d]=n.useState(new Set),f=n.useRef(null),[p,g]=n.useState("probing");n.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/solverWorker-COVc7Vrp.js",import.meta.url),{type:"module"});f.current=n;const r=setTimeout(()=>{e||(g("broken"),f.current=null,n.terminate())},2e3);return n.onmessage=n=>{if(e)return;const t=n.data;"RESULT"===t.type&&g(e=>{if("probing"===e)return clearTimeout(r),"healthy";const{gridState:n,conflicts:o,cycleCells:s}=t.payload;return i(n),c(o),d(s),e})},n.onerror=()=>{clearTimeout(r),g("broken"),f.current=null,n.terminate()},n.postMessage({type:"SOLVE",payload:{rows:2,cols:2,numbers:[[null,null,null],[null,null,null],[null,null,null]],userMoves:new Map}}),()=>{e=!0,clearTimeout(r),n.terminate()}},[]),n.useEffect(()=>{if("healthy"===p&&f.current)f.current.postMessage({type:"SOLVE",payload:{rows:e,cols:r,numbers:t,userMoves:o}});else if("broken"===p){const n=function(e,n,r,t){const o=new Map,l=[],i=[];t.forEach((e,n)=>{o.set(n,{state:e,source:"user"});const[r,t]=n.split(",").map(Number);void 0!==r&&void 0!==t&&l.push({r:r,c:t})});const a=(r,t)=>{if(r<0||r>=e||t<0||t>=n)return 0;const l=s(r,t);return o.get(l)?.state??0},c=(e,n,r,t)=>{const a=s(e,n),c=o.get(a);c?c.state!==r&&i.push({type:"cell",r:e,c:n}):(o.set(a,{state:r,source:t}),l.push({r:e,c:n}))},u=(r,t)=>[{r:r-1,c:t-1,required:de},{r:r-1,c:t,required:ue},{r:r,c:t-1,required:ue},{r:r,c:t,required:de}].filter(r=>r.r>=0&&r.r<e&&r.c>=0&&r.c<n);let d=0;for(;d<l.length;){const e=l[d++];if(!e)break;const{r:n,c:t}=e,f=[{r:n,c:t},{r:n,c:t+1},{r:n+1,c:t},{r:n+1,c:t+1}];for(const l of f){const e=r[l.r]?.[l.c];if(null==e)continue;const d=u(l.r,l.c);let f=0;const p=[];for(const n of d){const e=a(n.r,n.c);0===e?p.push(n):e===n.required&&f++}if(f>e)i.push({type:"node",r:l.r,c:l.c});else if(f+p.length<e)i.push({type:"node",r:l.r,c:l.c});else if("user"===o.get(s(n,t))?.source)if(f===e&&p.length>0)for(const n of p){const e=n.required===ue?de:ue;c(n.r,n.c,e,"propagated")}else if(f+p.length===e&&p.length>0)for(const n of p)c(n.r,n.c,n.required,"propagated")}}const f=Array.from({length:e},()=>new Array(n).fill(0));for(const[s,g]of o.entries()){const[e,n]=s.split(",").map(Number);void 0!==e&&void 0!==n&&f[e]&&(f[e][n]=g.state)}const p=be(f,e,n);return{gridState:o,conflicts:i,cycleCells:p}}(e,r,t,o);i(n.gridState),c(n.conflicts),d(n.cycleCells)}},[o,t,e,r,p]);const h=n.useMemo(()=>new Set(a.filter(e=>"cell"===e.type).map(e=>s(e.r,e.c))),[a]),m=n.useMemo(()=>new Set(a.filter(e=>"node"===e.type).map(e=>s(e.r,e.c))),[a]);return{gridState:l,conflicts:a,cycleCells:u,conflictSet:h,nodeConflictSet:m}}function ve({rows:e,cols:r,numbers:t,size:o,initialMoves:l,onMove:u,onApply:d}){const f=l,{getDragProps:p}=i({onToggle:(e,n,r,t,o)=>{const l=s(e,n);if(!o)return void u(l,t);const i=function(e,n){return n?e===ue?de:e===de?void 0:ue:e===de?ue:e===ue?void 0:de}(f.get(l),r);return u(l,i),i},touchTimeout:a.timing.touchHoldDelay,checkEnabled:()=>!0}),{handleKeyDown:g}=c({rows:e,cols:r}),h=n.useCallback(e=>{const n=p(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),g(e)}}},[p,g]),{gridState:m,cycleCells:y,conflictSet:x,nodeConflictSet:b}=Se({rows:e,cols:r,numbers:t,userMoves:f}),{numberSize:S}=ee(o),v=n.useCallback(()=>{d&&d(function(e){const n=new Map;return e.forEach((e,r)=>{0!==e.state&&n.set(r,e.state)}),n}(m))},[d,m]);return{gridState:m,conflictSet:x,cycleCells:y,nodeConflictSet:b,numberSize:S,getEnhancedDragProps:h,handleApply:v}}const we=k`
    0% { transform: scale(0.95); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
`,Ce=j(A)(()=>({animation:`${we} 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)`}));function Ae({rows:n,cols:r,numbers:o,size:l,initialMoves:i,onMove:a,onCopy:c,onClear:u,onClose:d,onApply:f}){const{gridState:p,conflictSet:g,cycleCells:h,nodeConflictSet:m,numberSize:y,getEnhancedDragProps:x,handleApply:b}=ve({rows:n,cols:r,numbers:o,size:l,initialMoves:i,onMove:a,onApply:f});return e.jsx(Q,{value:{onCopy:c,onClear:u,onClose:d,onApply:b},children:e.jsxs(Ce,{sx:{position:"relative",userSelect:"none"},onContextMenu:e=>{e.preventDefault()},children:[e.jsx(A,{sx:{position:"relative",border:`2px dashed ${ce.ANALYSIS.DASHED_BORDER}`,borderRadius:t.BORDER_RADIUS},children:e.jsx(me,{size:l,rows:n,cols:r,renderCell:(n,r)=>{const t=s(n,r),o=p.get(t);return e.jsx(pe,{r:n,c:r,value:o?.state??0,source:o?.source,isConflict:g.has(t),isCycle:h.has(t),size:l,pos:t,getDragProps:x})},renderOverlay:(t,l)=>{const i=o[t]?.[l]??null,a=m.has(s(t,l)),c=function(e,n,r,t,o,l){if(null==r)return!1;let i=0,a=0;const c=[{r:e-1,c:n-1,required:de},{r:e-1,c:n,required:ue},{r:e,c:n-1,required:ue},{r:e,c:n,required:de}];for(const u of c)if(u.r>=0&&u.r<o&&u.c>=0&&u.c<l){const e=t.get(s(u.r,u.c));e&&0!==e.state&&(a++,e.state===u.required&&i++)}return i===r&&a>0}(t,l,i,p,n,r);return e.jsx(he,{r:t,c:l,value:i,hasConflict:a,isSatisfied:c,numberSize:y})}})}),e.jsx(Z,{})]})})}function je({size:r,rows:t,cols:o}){const s=n.useCallback(()=>({sx:{backgroundColor:"var(--border)"}}),[]),i=n.useCallback(()=>({}),[]);return e.jsx(A,{sx:{"@keyframes pulse":{"0%, 100%":{opacity:.4},"50%":{opacity:.15}},animation:"pulse 1.4s ease-in-out infinite"},children:e.jsx(l,{size:r,layers:[{rows:t,cols:o,cellProps:s},{rows:t+1,cols:o+1,cellProps:i,layerSx:{pointerEvents:"none"},decorative:!0}]})})}function ke({isAnalysisMode:n,generating:r,dimensionsMismatch:t,rows:o,cols:s,state:l,size:i,analysis:a,cellProps:c,overlayProps:d}){return n?e.jsx(F,{fallback:e.jsx(J,{message:"Analysis mode encountered an error. Close and reopen to continue."}),children:e.jsx(Ae,{rows:o,cols:s,numbers:l.numbers,size:i,initialMoves:a.moves,onMove:a.onMove,onCopy:a.onCopy,onClear:a.onClear,onClose:a.onClose,onApply:a.onApply})}):r||t?e.jsx(je,{size:i,rows:o,cols:s}):e.jsx(F,{FallbackComponent:q,fallbackProps:{title:u.errors.boardTitle,resetLabel:u.errors.boardReset},children:e.jsx(Ce,{children:e.jsx(me,{size:i,rows:o,cols:s,cellProps:c,overlayProps:d})})})}const Ie=[{title:"Corner 0",description:'A "0" in a corner forces the line to point away from that corner.',rows:3,cols:3,numbers:[[0,null,null],[null,null,null],[null,null,null]],grid:[[ue,0],[0,0]]},{title:"Corner 1",description:'A "1" in a corner forces the line to connect directly to that corner.',rows:3,cols:3,numbers:[[1,null,null],[null,null,null],[null,null,null]],grid:[[de,0],[0,0]]},{title:"Edge 0",description:'A "0" on the edge forces all surrounding lines to point away from it.',rows:3,cols:3,numbers:[[null,0,null],[null,null,null],[null,null,null]],grid:[[de,ue],[0,0]]},{title:"Edge 1",description:'A "1" on the edge forces the two surrounding lines into the same orientation.',rows:3,cols:3,numbers:[[null,1,null],[null,null,null],[null,null,null]],grid:[[ue,ue],[0,0]]},{title:"Edge 2",description:'A "2" on the edge forces both surrounding lines to connect to it.',rows:3,cols:3,numbers:[[null,2,null],[null,null,null],[null,null,null]],grid:[[ue,de],[0,0]]},{title:"Middle 4",description:'A "4" must catch lines from all four surrounding cells.',rows:3,cols:3,numbers:[[null,null,null],[null,4,null],[null,null,null]],grid:[[de,ue],[ue,de]]}];function Ee(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:_.text.primary,borderRadius:"99px",top:"50%",left:"50%",transform:`translate(-50%, -50%) rotate(${e})`,boxShadow:ce.SHADOWS.LINE,pointerEvents:"none"}}function Ne(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{border:`2px solid ${_.border.subtle}`,position:"relative",backgroundColor:ce.ANALYSIS.BG_SUBTLE},children:e.jsxs(A,{sx:{width:"100%",height:"100%",position:"relative"},children:[s===ue&&e.jsx(A,{sx:Ee("-45deg",r)}),s===de&&e.jsx(A,{sx:Ee("45deg",r)})]})}}}function Me(n,r){return(t,o)=>{const s=n[t]?.[o];return{sx:{pointerEvents:"none"},children:e.jsx(A,{sx:{borderRadius:"50%",backgroundColor:_.surface.background,border:null==s?"none":`2px solid ${_.border.subtle}`,fontSize:`${String(.5*r)}rem`,fontWeight:"800",color:_.text.primary,boxShadow:null==s?"none":ce.SHADOWS.HINT,zIndex:5,opacity:null==s?0:1,display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0.05rem",lineHeight:1,width:`${String(r)}rem`,height:`${String(r)}rem`},children:s??""})}}}function Re({children:n,sx:r={}}){return e.jsx(A,{component:"span",sx:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"1.5em",height:"1.5em",borderRadius:"50%",backgroundColor:_.surface.background,border:`1px solid ${_.border.subtle}`,fontSize:"0.85em",fontWeight:"bold",mx:.4,verticalAlign:"middle",lineHeight:1,pt:"0.05em",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",position:"relative",top:"-0.1em",...r},children:n})}function Te({text:n}){const r=n.split(/"(\d+)"/g);return e.jsx(I,{variant:"body2",sx:{color:_.text.secondary},children:r.map((n,r)=>r%2==1?e.jsx(Re,{children:n},`${String(r)}-${n}`):n)})}const ze={display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:4,width:"100%",py:2,pr:4},Oe={display:"flex",flexDirection:"row",alignItems:"center",gap:0,width:"100%"},Pe={width:"180px",display:"flex",justifyContent:"center",flexShrink:0},$e={display:"flex",flexDirection:"column",gap:1,flex:1,minWidth:0};function Le(){const{numberSize:n}=ee(3);return e.jsx(A,{sx:ze,children:Ie.map(r=>e.jsxs(A,{sx:Oe,children:[e.jsx(A,{sx:Pe,children:e.jsx(me,{size:3,rows:r.rows-1,cols:r.cols-1,cellProps:Ne(r.grid,3),overlayProps:Me(r.numbers,n)})}),e.jsxs(A,{sx:$e,children:[e.jsx(I,{variant:"subtitle1",sx:{fontWeight:"bold",color:_.text.primary},children:r.title}),e.jsx(Te,{text:r.description})]})]},r.title))})}const De=[[de,ue,de],[ue,ue,de],[de,ue,de]],Be=[[1,0,2,null],[null,null,null,1],[2,null,null,null],[null,2,0,1]],He=[[0,0],[0,1],[0,2],[1,2],[2,2],[2,1],[2,0],[1,0],[1,1]];function _e(e,n,r){const t=Array.from({length:n+1},()=>new Array(r+1).fill(0));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const r=n[e];if(r===ue){const n=t[o];if(n){const r=n[e+1];void 0!==r&&(n[e+1]=r+1)}const r=t[o+1];if(r){const n=r[e];void 0!==n&&(r[e]=n+1)}}else if(r===de){const n=t[o];if(n){const r=n[e];void 0!==r&&(n[e]=r+1)}const r=t[o+1];if(r){const n=r[e+1];void 0!==n&&(r[e+1]=n+1)}}}}return t}function We(e,n,r,t){const o=new Set,l=_e(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;if((l[i]?.[a]??0)===c){let n=!1;const l=[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}];for(const{gr:o,gc:s}of l)if(o>=0&&o<r&&s>=0&&s<t&&0!==e[o]?.[s]){n=!0;break}n&&o.add(s(i,a))}}return o}function Ge(e,n){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:_.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:ce.SHADOWS.LINE,transition:G.transition,animation:ce.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const Ye=j(A)(({theme:e})=>({display:"flex",flexDirection:"column",[e.breakpoints.up("sm")]:{flexDirection:"row",gap:e.spacing(4)},justifyContent:"center",alignItems:"center",gap:e.spacing(2),width:"100%",flex:1})),qe=j(A)(({theme:e})=>({display:"grid",gridTemplateColumns:"repeat(2, 1fr)",[e.breakpoints.up("sm")]:{gridTemplateColumns:"1fr",marginTop:0,width:"auto",maxWidth:"none"},gap:e.spacing(1.5),justifyContent:"center",justifyItems:"center",alignItems:"center",marginTop:e.spacing(2),width:"100%",maxWidth:"320px"})),Ue=j(E)(({theme:e})=>({borderColor:_.border.subtle,color:_.text.secondary,width:"140px",[e.breakpoints.up("sm")]:{width:"180px"},paddingLeft:e.spacing(1),paddingRight:e.spacing(1),"& .MuiButton-startIcon":{marginRight:e.spacing(.5),[e.breakpoints.up("sm")]:{marginRight:e.spacing(1)}}}));function Ve({size:r,handleOpenAnalysis:t}){const o=n.useMemo(()=>function(){const e=[],n=Array.from({length:3},()=>new Array(3).fill(0));e.push(n);let r=n.map(e=>[...e]);for(const[t,o]of He){r=r.map(e=>[...e]);const n=De[t]?.[o];if(void 0!==n){const e=r[t];e&&(e[o]=n)}e.push(r)}return e}(),[]),[i,a]=n.useState(0),[c,u]=n.useState(!0);n.useEffect(()=>{if(!c)return;const e=setInterval(()=>{a(e=>(e+1)%o.length)},1500);return()=>{clearInterval(e)}},[o.length,c]);const f=n.useMemo(()=>o[i]??o[0]??[],[o,i]),p=i>0&&i<=He.length?(()=>{const e=He[i-1];return e?s(e[0],e[1]):null})():null,g=n.useMemo(()=>We(f,Be,3,3),[f]),h=.4*r,m=i>=He.length&&f.every(e=>e.every(e=>0!==e)),y=n.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l)===t;return{sx:{border:`2px solid ${_.border.subtle}`,position:"relative",transition:G.transition,backgroundColor:ce.ANALYSIS.BG_SUBTLE,...a?{backgroundColor:_.interactive.hover}:{}},children:e.jsxs(A,{sx:{width:"100%",height:"100%",position:"relative"},children:[i===ue&&e.jsx(A,{sx:Ge("-45deg",r)}),i===de&&e.jsx(A,{sx:Ge("45deg",r)})]})}}}(f,r,p),[f,r,p]),x=n.useMemo(()=>function(n,r,t){return(o,l)=>{const i=n[o]?.[l],a=s(o,l),c=r.has(a);return{sx:{pointerEvents:"none"},children:e.jsx(A,{sx:{borderRadius:"50%",backgroundColor:_.surface.background,border:null==i?"none":`2px solid ${c?"transparent":_.border.subtle}`,fontSize:`${String(.5*t)}rem`,fontWeight:"800",color:c?_.interactive.disabledText:_.text.primary,boxShadow:c?"none":ce.SHADOWS.HINT,zIndex:5,opacity:null==i?0:1,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",transform:c?"scale(0.95)":"scale(1)",paddingTop:"0.05rem",lineHeight:1,width:`${String(t)}rem`,height:`${String(t)}rem`},children:i??""})}}}(Be,g,h),[g,h]);return e.jsxs(Ye,{children:[e.jsxs(A,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx("style",{children:ce.ANIMATIONS.POP_IN}),e.jsx(l,{size:r,layers:[{rows:3,cols:3,cellProps:y},{rows:4,cols:4,cellProps:x,layerSx:{pointerEvents:"none"},decorative:!0}],space:.125}),e.jsx(d,{show:m&&c,sizeVariant:"small",showLabel:!1})]}),e.jsxs(qe,{children:[e.jsx(Ue,{variant:"outlined",startIcon:c?e.jsx(z,{}):e.jsx(O,{}),onClick:()=>{u(e=>!e)},children:c?"Pause":"Play"}),e.jsx(Ue,{variant:"outlined",startIcon:e.jsx(P,{}),onClick:t,children:"Analysis"}),e.jsx(Ue,{variant:"outlined",startIcon:e.jsx($,{}),onClick:()=>{u(!1),a(e=>(e-1+o.length)%o.length)},children:"Step Back"}),e.jsx(Ue,{variant:"outlined",startIcon:e.jsx(L,{}),onClick:()=>{u(!1),a(e=>(e+1)%o.length)},children:"Step Next"})]})]})}const Fe={display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",color:"primary.main",fontSize:"1em",borderRadius:1,px:.6,lineHeight:1,verticalAlign:"baseline"},Ke=["Slant Rules","Example","Common Patterns"],Je=[{Icon:D,title:"Fill with Slashes",text:e.jsxs(e.Fragment,{children:["Place a forward"," ",e.jsx(A,{component:"span",sx:Fe,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"9",x2:"9",y2:"1"})})})," ","or backward"," ",e.jsx(A,{component:"span",sx:Fe,children:e.jsx("svg",{viewBox:"0 0 10 10",style:{width:"0.8em",height:"0.8em",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"},children:e.jsx("line",{x1:"1",y1:"1",x2:"9",y2:"9"})})})," ","slash in every cell of the grid."]})},{Icon:B,title:"Match the Numbers",text:"Each number at a corner tells how many slashes touch that point."},{Icon:H,title:"No Loops",text:"Slashes must never form a closed loop â€” every path stays open."}],Xe={height:{xs:"660px",sm:"525px"},minHeight:{xs:"660px",sm:"525px"}},Qe=e=>[...U(f()),e<2?{overflowY:"hidden"}:{}];function Ze(e){return{storageKey:"slant",grid:{defaultSize:ae,maxSize:ie,gridPadding:{x:e?48:80,y:120},widthLimit:re,cellSizeReference:4},board:{boardPadding:e=>({x:e?48:80,y:ne}),...e?{boardSizeFactor:.92}:{},maxCellSize:te,rowOffset:1,colOffset:1}}}function en({open:n,toggleOpen:r,handleOpenAnalysis:t}){const o=K("sm");return e.jsx(p,{open:n,toggleOpen:r,titles:Ke,instructions:Je,exampleContent:e.jsx(Ve,{size:o?4:4.5,handleOpenAnalysis:t}),cardSx:Xe,contentSxOverride:Qe,persistenceKey:"slant_info_step",extraSteps:[e.jsx(Le,{},"patterns")]})}function nn(e,n){return`${se.STATE}-${String(e)}x${String(n)}`}function rn(e){return{...e,errorNodes:[...e.errorNodes],cycleCells:[...e.cycleCells],satisfiedNodes:[...e.satisfiedNodes]}}function tn({rows:e,cols:r,isAnalysisMode:t,requestGeneration:o,cancelGeneration:s}){const l=n.useRef(`${String(e)},${String(r)}`);n.useEffect(()=>{const n=`${String(e)},${String(r)}`;n!==l.current&&(l.current=n,t||!function(e,n){const r=nn(e,n),t=localStorage.getItem(r);if(!t)return!1;try{const e=JSON.parse(t);return"object"==typeof e&&null!==e&&!1===e.solved}catch{return!1}}(e,r)?o(e,r):s())},[e,r,o,s,t])}function on(e,n,r,t){return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:e,cols:n,solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function sn({getInitialState:e,dispatchRef:r,dimsRef:t,onStaleResult:o}){const[s,l]=n.useState(!1),i=n.useRef(null),a=n.useRef("probing"),c=n.useRef(0),u=n.useRef(0),d=n.useRef(null),f=n.useRef(0),p=n.useRef(o);p.current=o;const g=n.useRef(!1),h=n.useRef(null),m=n.useRef(!1),y=n.useCallback(()=>{if(h.current){const e=h.current;p.current?.(e,e.rows,e.cols)}g.current=!1,h.current=null,m.current=!1},[]),x=n.useCallback((n,t)=>{r.current?.({type:"hydrate",state:e(n,t)}),l(!1)},[r,e]),b=n.useCallback((e,n)=>{y(),l(!0),null!==d.current&&clearTimeout(d.current),cancelAnimationFrame(u.current),d.current=setTimeout(()=>{d.current=null;const r=++c.current;"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:e,cols:n}})):u.current=requestAnimationFrame(()=>{c.current===r&&x(e,n)})},250)},[x,y]),S=n.useCallback((n,r)=>{g.current||(g.current=!0,h.current=null,m.current=!1,"healthy"===a.current&&i.current?(f.current++,i.current.postMessage({type:"GENERATE",payload:{rows:n,cols:r}})):requestAnimationFrame(()=>{g.current&&(h.current=e(n,r))}))},[e]),v=n.useCallback(()=>{null!==d.current&&(clearTimeout(d.current),d.current=null),cancelAnimationFrame(u.current),y(),l(!1)},[y]),w=n.useCallback(()=>{if(h.current){const e=h.current;return h.current=null,r.current?.({type:"hydrate",state:e}),y(),void l(!1)}if(g.current)return m.current=!0,void l(!0);b(t.current.rows,t.current.cols)},[b,t,r,y]);return n.useEffect(()=>{let e=!1;const n=new Worker(new URL("/assets/generationWorker-BGel4s87.js",import.meta.url),{type:"module"});i.current=n;const o=setTimeout(()=>{e||"probing"!==a.current||(a.current="broken",f.current=0,i.current=null,n.terminate())},2e3);return n.onmessage=s=>{if(!e){if("ERROR"===s.data.type)return clearTimeout(o),a.current="broken",f.current=0,i.current=null,void n.terminate();if("RESULT"===s.data.type){if("probing"===a.current)return clearTimeout(o),void(a.current="healthy");f.current--;const{rows:e,cols:n,numbers:i,solution:c}=s.data.payload,u=t.current;if(e!==u.rows||n!==u.cols)return p.current?.(on(e,n,i,c),e,n),void(f.current<=0&&l(!1));if(f.current>0)return;const d=on(e,n,i,c);if(g.current)return h.current=d,void(m.current&&(r.current?.({type:"hydrate",state:d}),g.current=!1,h.current=null,m.current=!1,l(!1)));r.current?.({type:"hydrate",state:d}),l(!1)}}},n.onerror=()=>{clearTimeout(o),a.current="broken",f.current=0,i.current=null,n.terminate()},n.postMessage({type:"GENERATE",payload:{rows:3,cols:3}}),()=>{e=!0,clearTimeout(o),null!==d.current&&clearTimeout(d.current),n.terminate()}},[r,t]),{generating:s,requestGeneration:b,handleNextAsync:w,prefetch:S,cancelGeneration:v}}function ln(e,n,r){return{position:"absolute",width:"115%",height:`${String(Math.max(2,n))}px`,backgroundColor:r?_.data.red:_.text.primary,borderRadius:"99px",top:"50%",left:"50%","--slant-base-transform":`translate(-50%, -50%) rotate(${e})`,transform:"var(--slant-base-transform)",boxShadow:ce.SHADOWS.LINE,transition:G.transition,animation:ce.ANIMATIONS.POP_IN_STYLE,pointerEvents:"none"}}const an={border:`2px solid ${_.border.subtle}`,position:"relative",backgroundColor:ce.ANALYSIS.BG_SUBTLE},cn={width:"100%",height:"100%",position:"relative"},un={pointerEvents:"none"},dn={cursor:"pointer",outline:"none","&:hover":{backgroundColor:_.interactive.hover},"&:focus-visible":{outline:`3px solid ${_.primary.main}`,outlineOffset:"-3px",backgroundColor:_.interactive.hover,boxShadow:`inset 0 0 15px ${_.interactive.focus}`}};function fn(e){const{numberSize:n,hasError:r,isSatisfied:t,isVisible:o}=e;return{borderRadius:"50%",backgroundColor:r?_.data.red:_.surface.background,border:o?`2px solid ${r?_.data.red:t?"transparent":_.border.subtle}`:"none",fontSize:`${String(.5*n)}rem`,fontWeight:"800",color:r?ce.COLORS.WHITE:t?_.interactive.disabledText:_.text.primary,boxShadow:t&&!r?"none":ce.SHADOWS.HINT,zIndex:5,opacity:o?1:0,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s cubic-bezier(0.4, 0, 0.2, 1)",userSelect:"none",WebkitUserSelect:"none",paddingTop:"0.05rem",lineHeight:1,transform:r?"scale(1.15)":t?"scale(0.95)":"scale(1)",width:`${String(n)}rem`,height:`${String(n)}rem`}}const pn=(n,r,t)=>{const o=function(n,r){return(t,o)=>{const l=n.grid[t]?.[o],i=s(t,o),a=n.cycleCells.has(i),c=[{v:n.numbers[t]?.[o],p:s(t,o)},{v:n.numbers[t]?.[o+1],p:s(t,o+1)},{v:n.numbers[t+1]?.[o],p:s(t+1,o)},{v:n.numbers[t+1]?.[o+1],p:s(t+1,o+1)}].map(({v:e,p:r})=>{if(null==e)return"-";const t=n.errorNodes.has(r)?"Error":n.satisfiedNodes.has(r)?"Ok":"Pending";return`${String(e)} (${t})`});return{"aria-label":`Cell ${String(t+1)}, ${String(o+1)}. Clues: ${c.join(", ")}. ${0===l?"Empty":l===ue?"Forward Slash":"Backward Slash"}${a?", Loop Error":""}`,sx:an,children:e.jsxs(A,{sx:cn,children:[l===ue&&e.jsx(A,{sx:ln("-45deg",r,a)}),l===de&&e.jsx(A,{sx:ln("45deg",r,a)})]})}}}(r,t);return(e,r)=>{const t=o(e,r),l=s(e,r),i=n(l);return{...i,...t,sx:{...i.sx,...t.sx,...dn}}}};function gn({state:r,size:t,getDragProps:o}){const l=.4*t,i=h(pn,o,[r,t]),a=n.useMemo(()=>((n,r)=>(t,o)=>{const l=n.numbers[t]?.[o],i=s(t,o),a=n.errorNodes.has(i),c=n.satisfiedNodes.has(i);return{sx:un,children:e.jsx(A,{sx:fn({numberSize:r,hasError:a,isSatisfied:c,isVisible:null!=l}),children:l??""})}})(r,l),[r,l]);return{cellProps:i,overlayProps:a}}function hn({game:{state:e,rows:r,cols:t,size:o,mobile:s,isAnalysisMode:l,generating:i},analysis:{analysisMoves:a,handleAnalysisMove:c,handleAnalysisCopy:u,handleAnalysisClear:d,handleAnalysisClose:f,handleAnalysisApply:p,handleBoxClick:g,handleOpenAnalysis:h,boardSx:m},info:{infoOpen:y,toggleInfo:x},getDragProps:b}){const{cellProps:S,overlayProps:v}=gn({state:e,size:o,getDragProps:b}),w=n.useMemo(()=>(e=>({px:e?"1rem":"2rem",pt:e?"1rem":"2rem"}))(s),[s]);return{boardProps:{isAnalysisMode:l,generating:i,dimensionsMismatch:r!==e.rows||t!==e.cols,rows:r,cols:t,state:e,size:o,analysis:{moves:a,onMove:c,onCopy:u,onClear:d,onClose:f,onApply:p},cellProps:S,overlayProps:v},layoutProps:{boardSx:m,contentSx:w,iconSizeRatio:oe},infoProps:{open:y,toggleOpen:x,handleOpenAnalysis:h,handleBoxClick:g}}}function mn(e,n,r,t,o,s){const l=e[r];if(!l)return!1;l[t]=o;const i=xe(r,o===ue?t+1:t,s),a=xe(r+1,o===ue?t:t+1,s);return!n.connected(i,a)&&(n.union(i,a),!0)}function yn(e,n,r){const t=Array.from({length:n},()=>new Array(r).fill(0)),o=new ye((n+1)*(r+1)),s=function(e,n,r,t,o){let s=!0;for(;s;){s=!1;for(let l=0;l<=r;l++)for(let i=0;i<=t;i++){const a=n[l]?.[i];if(null==a)continue;const c=[{gr:l-1,gc:i-1,pt:de},{gr:l-1,gc:i,pt:ue},{gr:l,gc:i-1,pt:ue},{gr:l,gc:i,pt:de}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let u=0;const d=[];for(const n of c){const r=e[n.gr]?.[n.gc];0===r?d.push(n):r===n.pt&&u++}if(u>a)return"contradiction";if(u+d.length<a)return"contradiction";if(u===a&&d.length>0){for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!mn(e,o,n,r,l===ue?de:ue,t))return"contradiction";s=!0}}else if(u+d.length===a&&d.length>0)for(const{gr:n,gc:r,pt:l}of d)if(0===e[n]?.[r]){if(!mn(e,o,n,r,l,t))return"contradiction";s=!0}}if(!s){for(let n=0;n<r;n++)for(let r=0;r<t;r++){const l=e[n];if(0!==l?.[r])continue;const i=xe(n,r+1,t),a=xe(n+1,r,t),c=o.connected(i,a),u=xe(n,r,t),d=xe(n+1,r+1,t),f=o.connected(u,d);if(c&&f)return"contradiction";c?(l[r]=de,s=!0,o.union(u,d)):f&&(l[r]=ue,s=!0,o.union(i,a))}if(!s)for(let l=0;l<r;l++)for(let i=0;i<t;i++){const a=e[l];if(0!==a?.[i])continue;let c=!1,u=!1;const d=[{nr:l,nc:i,touchedBy:de},{nr:l,nc:i+1,touchedBy:ue},{nr:l+1,nc:i,touchedBy:ue},{nr:l+1,nc:i+1,touchedBy:de}];for(const{nr:o,nc:s,touchedBy:l}of d){const i=n[o]?.[s];if(null==i)continue;const a=[{gr:o-1,gc:s-1,pt:de},{gr:o-1,gc:s,pt:ue},{gr:o,gc:s-1,pt:ue},{gr:o,gc:s,pt:de}].filter(({gr:e,gc:n})=>e>=0&&e<r&&n>=0&&n<t);let d=0,f=0;for(const n of a){const r=e[n.gr]?.[n.gc];0===r?f++:r===n.pt&&d++}l===ue?(d+1>i&&(c=!0),d+(f-1)<i&&(u=!0)):(d+1>i&&(u=!0),d+(f-1)<i&&(c=!0))}if(c&&u)return"contradiction";if(c){if(!mn(e,o,l,i,de,t))return"contradiction";s=!0}else if(u){if(!mn(e,o,l,i,ue,t))return"contradiction";s=!0}}}}return e.every(e=>e.every(e=>0!==e))?"solved":"stuck"}(t,e,n,r,o);return"contradiction"!==s&&("solved"===s&&function(e,n,r,t){const o=_e(e,r,t);for(let s=0;s<=r;s++)for(let e=0;e<=t;e++){const r=n[s]?.[e];if(null!=r&&o[s]?.[e]!==r)return!1}return!0}(t,e,n,r))}function xn(e,n){let r=[],t=!1;for(let s=0;s<50&&!t;s++){r=Array.from({length:e},()=>new Array(n).fill(0));const o=new ye((e+1)*(n+1)),s=[];for(let r=0;r<e;r++)for(let e=0;e<n;e++)s.push({r:r,c:e});for(let e=s.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1)),r=s[e],t=s[n];r&&t&&(s[e]=t,s[n]=r)}let l=!1;for(const{r:e,c:t}of s){const s=xe(e,t+1,n),i=xe(e+1,t,n),a=o.connected(s,i),c=xe(e,t,n),u=xe(e+1,t+1,n),d=o.connected(c,u);if(a&&d){l=!0;break}const f=r[e];f&&(a?(f[t]=de,o.union(c,u)):d||Math.random()<.5?(f[t]=ue,o.union(s,i)):(f[t]=de,o.union(c,u)))}l||(t=!0)}t||(r=Array.from({length:e},(e,r)=>new Array(n).fill(r%2==0?ue:de)));const o=function(e,n,r,t){const o=e.map(e=>[...e]),s=[];for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)s.push({r:a,c:e});for(let a=s.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1)),n=s[a],r=s[e];n&&r&&(s[a]=r,s[e]=n)}const l=Math.floor((n+1)*(r+1)*t);let i=0;for(let a=0;a<=n;a++)for(let e=0;e<=r;e++)null!==o[a]?.[e]&&i++;for(const{r:a,c:c}of s){if(i<=l)break;const e=o[a];if(!e)continue;const t=e[c];null!=t&&(e[c]=null,yn(o,n,r)?i--:e[c]=t)}return o}(_e(r,e,n).map(e=>e.map(e=>e)),e,n,le);return{numbers:o,solution:r}}const bn=m({getInitialState:vn,customHandler:(e,n)=>{if("reset"===n.type)return{...e,grid:Array.from({length:e.rows},()=>new Array(e.cols).fill(0)),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set};if("applyAnalysis"===n.type){if(!n.moves)return e;const r=Array.from({length:e.rows},()=>new Array(e.cols).fill(0));return n.moves.forEach((e,n)=>{const[t,o]=n.split(",").map(Number);if(void 0!==t&&void 0!==o){const n=r[t];void 0!==n&&(n[o]=e)}}),{...e,...Sn(r,e.numbers,e.rows,e.cols),grid:r}}if("toggle"!==n.type)return null;if(e.solved)return e;const{row:r,col:t}=n;if(void 0===r||void 0===t)return e;const o=e.grid.map(e=>[...e]),s=o[r];if(!s)return e;const l=s[t];return void 0===l?e:(n.reverse?s[t]=0===l?ue:l===ue?de:0:s[t]=0===l?de:l===de?ue:0,{...e,...Sn(o,e.numbers,e.rows,e.cols),grid:o})}});function Sn(e,n,r,t){let o=!1;if(e.every(e=>e.every(e=>0!==e))){const s=_e(e,r,t);n.every((e,n)=>e.every((e,r)=>null==e||e===s[n]?.[r]))&&!function(e,n,r){const t=new ye((n+1)*(r+1));for(let o=0;o<n;o++){const n=e[o];if(n)for(let e=0;e<r;e++){const s=n[e];if(void 0===s||0===s)continue;const l=xe(o,s===ue?e+1:e,r),i=xe(o+1,s===ue?e:e+1,r);if(!t.union(l,i))return!0}}return!1}(e,r,t)&&(o=!0)}const l=function(e,n,r,t){const o=new Set,l=_e(e,r,t);for(let i=0;i<=r;i++)for(let a=0;a<=t;a++){const c=n[i]?.[a];if(null==c)continue;const u=l[i]?.[a]??0;u>c?o.add(s(i,a)):u+[{gr:i-1,gc:a-1},{gr:i-1,gc:a},{gr:i,gc:a-1},{gr:i,gc:a}].filter(({gr:n,gc:o})=>n>=0&&n<r&&o>=0&&o<t&&0===e[n]?.[o]).length<c&&o.add(s(i,a))}return o}(e,n,r,t);return{solved:o,errorNodes:l,cycleCells:be(e,r,t),satisfiedNodes:We(e,n,r,t)}}function vn(e,n){const{numbers:r,solution:t}=xn(e,n);return{grid:Array.from({length:e},()=>new Array(n).fill(0)),numbers:r,solution:t,rows:y(e),cols:y(n),solved:!1,errorNodes:new Set,cycleCells:new Set,satisfiedNodes:new Set}}function wn(){const e=K("sm"),[t,o]=r.useState(!1),{isOpen:l,toggle:u}=x(),d=n.useRef(null),f=n.useRef({rows:0,cols:0}),p=n.useCallback((e,n,r)=>{t||function(e,n,r){const t=nn(n,r);try{localStorage.setItem(t,JSON.stringify(rn(e)))}catch{}}(e,n,r)},[t]),{generating:h,requestGeneration:m,handleNextAsync:y,prefetch:v,cancelGeneration:w}=sn({getInitialState:vn,dispatchRef:d,dimsRef:f,onStaleResult:p}),{rows:C,cols:A,state:j,dispatch:k,size:I,controlsProps:E}=b({...Ze(e),logic:{reducer:bn,getInitialState:(e,n)=>vn(e,n),onNext:y,isSolved:e=>e.solved,manualResize:!0,persistence:{enabled:!t,serialize:rn,deserialize:e=>{if(!function(e){if("object"!=typeof e||null===e)return!1;const n=e;return Array.isArray(n.grid)&&Array.isArray(n.numbers)&&Array.isArray(n.solution)&&"number"==typeof n.rows&&"number"==typeof n.cols&&"boolean"==typeof n.solved&&Array.isArray(n.errorNodes)&&Array.isArray(n.cycleCells)&&Array.isArray(n.satisfiedNodes)}(e))throw new Error(`Corrupt Slant state in localStorage: expected a valid SavedSlantState object but received ${JSON.stringify(e).slice(0,100)}`);return function(e){return{...e,errorNodes:new Set(e.errorNodes),cycleCells:new Set(e.cycleCells),satisfiedNodes:new Set(e.satisfiedNodes)}}(e)}}}});d.current=k,f.current={rows:C,cols:A};const{analysisMoves:N,boardSx:M,handleAnalysisMove:R,handleAnalysisCopy:T,handleAnalysisClear:z,handleAnalysisClose:O,handleAnalysisApply:P,handleBoxClick:$,handleOpenAnalysis:L}=function({isAnalysisMode:e,setIsAnalysisMode:r,state:t,rows:o,cols:l,storageKey:i,toggleInfo:a,dispatch:c}){const[u,d]=n.useState(new Map);g({storageKey:i,rows:o,cols:l,state:u,onRestore:e=>{d(e)},serialize:e=>[...e.entries()],deserialize:e=>new Map(e)});const f=n.useRef("");n.useEffect(()=>{const e=JSON.stringify(t.numbers);f.current&&f.current!==e&&d(new Map),f.current=e},[t.numbers,t.rows,t.cols]);const p=n.useCallback((e,n)=>{d(r=>{const t=new Map(r);return void 0===n?t.delete(e):t.set(e,n),t})},[]),h=n.useCallback(()=>{const e=new Map;t.grid.forEach((n,r)=>{n.forEach((n,t)=>{0!==n&&e.set(s(r,t),n)})}),d(e)},[t.grid]),m=n.useCallback(()=>{d(new Map)},[]),y=n.useCallback(()=>{r(!1)},[r]),x=n.useCallback(e=>{c({type:"applyAnalysis",moves:e??u}),y()},[c,u,y]),b=n.useCallback(e=>{e.stopPropagation()},[]),S=n.useMemo(()=>e?{padding:{xs:0,sm:0},border:"none"}:void 0,[e]),v=n.useCallback(()=>{a(),r(!0)},[a,r]);return{analysisMoves:u,boardSx:S,handleAnalysisMove:p,handleAnalysisCopy:h,handleAnalysisClear:m,handleAnalysisClose:y,handleAnalysisApply:x,handleBoxClick:b,handleOpenAnalysis:v}}({isAnalysisMode:t,setIsAnalysisMode:o,state:j,rows:C,cols:A,storageKey:se.ANALYSIS_MOVES,toggleInfo:u,dispatch:k});tn({rows:C,cols:A,isAnalysisMode:t,requestGeneration:m,cancelGeneration:w}),n.useEffect(()=>{j.solved&&!t&&v(C,A)},[j.solved,t,C,A,v]);const{handleKeyDown:D}=c({rows:C,cols:A}),{getDragProps:B}=i({onToggle:(e,n,r)=>{k({type:"toggle",row:S(e),col:S(n),reverse:r})},checkEnabled:()=>!j.solved,touchTimeout:a.timing.touchHoldDelay}),H=n.useCallback(e=>{const n=B(e);return{...n,onKeyDown:e=>{n.onKeyDown(e),D(e)}}},[B,D]);return{...hn({game:{state:j,rows:C,cols:A,size:I,mobile:e,isAnalysisMode:t,generating:h},analysis:{analysisMoves:N,handleAnalysisMove:R,handleAnalysisCopy:T,handleAnalysisClear:z,handleAnalysisClose:O,handleAnalysisApply:P,handleBoxClick:$,handleOpenAnalysis:L,boardSx:M},info:{infoOpen:l,toggleInfo:u},getDragProps:H}),contextValue:{rows:C,cols:A,state:j,dispatch:k,size:I,mobile:e,solved:j.solved,handleNext:y,controlsProps:E}}}function Cn(){const{boardProps:n,layoutProps:r,infoProps:t,contextValue:o}=wn();return e.jsxs(e.Fragment,{children:[e.jsxs(v,{title:V.slant,infoUrl:"https://en.wikipedia.org/wiki/Gokigen_Naname",onClick:n.isAnalysisMode?n.analysis.onClose:void 0,children:[e.jsx(v.Content,{paddingBottom:{xs:"120px",md:"150px"},sx:r.contentSx,children:e.jsxs(v.BoardContainer,{sx:r.boardSx,children:[e.jsx(A,{onClick:t.handleBoxClick,children:e.jsx(ke,{...n})}),e.jsx(d,{show:!n.isAnalysisMode&&n.state.solved})]})}),e.jsxs(w,{...o.controlsProps,onRefresh:o.handleNext,disabled:n.generating,hidden:n.isAnalysisMode,children:[e.jsx(w.Refresh,{}),e.jsx(w.ResizeMinus,{}),e.jsx(w.ResizePlus,{}),e.jsx(w.Info,{onClick:t.toggleOpen})]})]}),e.jsx(en,{...t})]})}export{Cn as Slant};
