import{r as t,j as e,a as o}from"./vendor_react-WaSaIrII.js";import{a as n,T as r,d as s,e as i,g as l,L as c}from"./index-BcrO04Ee.js";import{C as a,u,c as f}from"./CustomGrid-ipL6Fhnd.js";import{B as d,G as p,d as x,M as h,h as m,I as g,e as y}from"./vendor_mui_core-3PJY_Tg4.js";import{u as j,G as b}from"./gameConfig-CQ15qQC4.js";import{G as w}from"./GlassCard-ClAMXLZ_.js";import{i as k,E as C,C as z,j as v,k as I,l as S,R as $,N as P,m as A,M as R}from"./vendor_mui_icons-ygjA6J88.js";import{G as B}from"./GlobalHeader-CD6trsEU.js";function W(t){const{frontProps:o,backProps:n,size:r,rows:s,cols:i}=t;return e.jsxs(d,{sx:{display:"grid",placeItems:"center"},children:[e.jsx(d,{sx:{gridArea:"1/1"},children:e.jsx(a,{space:0,size:r,rows:s-1,cols:i-1,cellProps:n})}),e.jsx(d,{sx:{gridArea:"1/1",zIndex:1},children:e.jsx(a,{space:0,size:r,rows:s,cols:i,cellProps:o})})]})}function D(e,o){const n=t.useCallback((t,n)=>{const r=e(t,n);return{front:r?o.primary:o.secondary,back:r?o.secondary:o.primary}},[e,o]),r=t.useCallback((t,o)=>function(t,e,o){const n=o(t,e),r={},s=n===o(t-1,e),i=n===o(t+1,e),l=n===o(t,e-1),c=n===o(t,e+1);return(s||l)&&(r.borderTopLeftRadius=0),(s||c)&&(r.borderTopRightRadius=0),(i||l)&&(r.borderBottomLeftRadius=0),(i||c)&&(r.borderBottomRightRadius=0),r}(t,o,e),[e]),s=t.useCallback((t,n)=>{const r=function(t,e,o){const n=o(t,e),r=o(t,e+1),s=o(t+1,e),i=o(t+1,e+1);let l=!0;const c=Number(n)+Number(r)+Number(s)+Number(i);return n&&i||!(c<3)||(l=!1),l}(t,n,e);return r?o.primary:o.secondary},[e,o]);return{getColor:n,getBorder:r,getFiller:s}}function E(e,o){const{grid:n,rows:r,cols:s}=e;return D(t.useCallback((t,e)=>t<0||e<0||t>=r||e>=s?-1:n[t][e],[n,r,s]),o)}function H(t,e){return[...Array(t)].map(()=>Array(e).fill(0))}function T(t,e,o){const n=o[0].length,r=o.length,s=o.map(t=>[...t]);return s[t][e]^=1,t>0&&(s[t-1][e]^=1),t<r-1&&(s[t+1][e]^=1),e>0&&(s[t][e-1]^=1),e<n-1&&(s[t][e+1]^=1),s}function _(t){const e=t.flat();return!e.includes(1)||!e.includes(0)}function F(t,e){let o=H(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++){Math.random()>.5&&(o=T(n,t,o))}return o}const G={};function M(t){const e=t.length,o=t[0].length;for(let r=0;r<e-1;r++)for(let e=0;e<o;e++)if(1===t[r][e])return[{row:r+1,col:e}];const n=t[e-1];if(n.some(t=>1===t)){const t=function(t,e,o){const n=`${t},${e}`;if(!G[n]){const o={},r=1<<e;for(let n=0;n<r;n++){let r=H(t,e);const s=[];for(let t=0;t<e;t++)n>>t&1&&(r=T(0,t,r),s.push(t));for(let o=0;o<t-1;o++)for(let t=0;t<e;t++)1===r[o][t]&&(r=T(o+1,t,r));const i=r[t-1].join("");o[i]||(o[i]=s)}G[n]=o}const r=o.join("");return G[n][r]||null}(e,o,n);if(t&&t.length>0)return t.map(t=>({row:0,col:t}))}return null}function N(t,e){const{type:o,row:n,col:r,moves:s}=e;let{grid:i,score:l,rows:c,cols:a,auto:u}=t;switch(o){case"auto":u=!u;break;case"adjacent":void 0!==n&&void 0!==r&&(i=T(n,r,i),_(i)&&(i=F(c,a),l+=1));break;case"multi_adjacent":s&&(s.forEach(t=>{i=T(t.row,t.col,i)}),_(i)&&(i=F(c,a),l+=1));break;case"random":case"randomize":i=F(c,a),u=!1;break;case"resize":{const{newRows:t,newCols:o}=e;void 0!==t&&void 0!==o&&(c=t,a=o,i=F(c,a),u=!1);break}case"reset":i=H(c,a),l=0,u=!1}return{grid:i,score:l,rows:c,cols:a,auto:u}}function L(t){let e=0;for(;t;)t&=t-1,e++;return e}function O(t,e){const o=t.length,n=[];for(let r=0;r<o;r++){const s=t[r];let i=0;for(let t=0;t<o;t++){i<<=1,i+=1&L(s&e[t])}n.push(i)}return n}function Y(t){const e=Array(t).fill(1);for(let o=0;o<t;o++)e[o]<<=t-o-1;return e}function U(t,e){let o=Y(t.length);for(let n=0;n<e;n++)o=O(o,t);return o}function q(t,e){const o=t.length,n=[];for(let r=0;r<o;r++){const o=t[r]^e[r];n.push(o)}return n}function J(t,e){const o=t.length,n=[...Array(o).keys()].sort((e,o)=>t[o]-t[e]);return[n.map(e=>t[e]),n.map(t=>e[t])]}const K={};function Q(t,e,o){const n=`${e},${o}`;if(!K[n]){const t=function(t){const e=[7<<t-2];for(let o=1;o<t;o++){const t=e[o-1]>>1;e.push(t)}return e[0]-=2**t,e}(o),r=function(t,e){const o=t.length;let n=Array(o).fill(0),r=0;for(;e;)1&e&&(n=q(n,U(t,r))),e>>=1,r++;return n}(t,function(t){const e=[0,1];for(let o=1;o<t;o++){const t=e[o],n=e[o-1],r=t<<1;e.push(r^n)}return e[t]}(e+1));K[n]=function(t){const e=t.length;let o=t,n=Y(e);for(let r=0;r<e;r++){const t=1<<e-r-1;[o,n]=J(o,n);for(let s=0;s<e;s++){const e=o[s];s!==r&&e&t&&(o[s]^=o[r],n[s]^=n[r])}}return n}(r)}const r=K[n],s=parseInt(t.join(""),2);return r.map(t=>1&L(t&s))}function V(t,e){const o=[...t];let n=t.at(-1);if(!n)return o;for(let r=1;r<e;r++)for(let t=0;t<e;t++){if(!n[r-1][t])continue;const e=T(r,t,n);o.push(e),n=e}return o}function X(t,e){const o=t.at(-1);if(!o)return t;const n=[...t];for(;n.length<e;)n.push([...o]);return n}function Z(t,e){let o=H(e,e);for(const p of t){o=T(Math.floor(p/e),p%e,o)}const n=V([o],e),r=n.at(-1);if(!r)return{boardStates:[],inputStates:[],outputStates:[]};const s=r.at(-1);if(!s)return{boardStates:[],inputStates:[],outputStates:[]};const{input:i,output:l}=function(t,e){const o=Array(e).fill(0),n=[o],r=[o],s=[...o];for(let i=0;i<e;i++){if(!t[i])continue;s[i]=1;const o=[...s],l=Q(o,e,e);n.push(o),r.push(l)}return{input:n,output:r}}(s,e),c=n.length+i.length+1,a=l.at(-1);if(!a)return{boardStates:[],inputStates:[],outputStates:[]};let u=[...r];for(let p=0;p<c-n.length;p++)n.push([...r]);for(let p=0;p<c-i.length;p++)i.unshift([...i[0]]);for(let p=0;p<c-l.length;p++)l.unshift([...l[0]]);for(let p=0;p<e;p++)a[p]&&(u=T(0,p,u),n.push([...u]));const f=V(n,e),d=f.length;return{boardStates:f,inputStates:X(i,d),outputStates:X(l,d)}}function tt({getColor:t,getBorder:e}){return(o,n)=>{const{front:r}=t(o,n);return{backgroundColor:r,style:e(o,n),sx:{transition:"all 200ms ease"}}}}function et(e,o,n){return D(t.useCallback((t,n)=>0!==t||n<0||n>=o?-1:e[n],[e,o]),n)}function ot(t,o,n,r){return(s,i)=>{const l=function(t,e,o,n,r,s=1){const i=t.length,l={},c=100/i;for(let a=0;a<i;a++){const u=a*c,f=(a+1)*c;let d=r.secondary,p=!1,x="";const h=t[a],m=a+1<i?t[a+1]:null;if(h&&m){const t=T(e,o,h);p=!0;for(let e=0;e<n;e++)for(let o=0;o<n;o++)if(t[e][o]!==m[e][o]){p=!1;break}p&&(d=1===h[e][o]?r.secondary:r.primary,x=`"${a+1}"`)}p?(l[`${u}%`]={opacity:0,content:x,color:d,transform:"scale(0.5)"},l[`${u+c*(.1/s)}%`]={opacity:1,content:x,color:d,transform:"scale(1.2)"},l[`${u+c*(.2/s)}%`]={opacity:1,content:x,color:d,transform:"scale(1)"},l[f-c*(.1/s)+"%"]={opacity:1,content:x,color:d,transform:"scale(1)"},l[`${f}%`]={opacity:0,content:x,color:d,transform:"scale(0.5)"}):(l[`${u}%`]={opacity:0,content:'""',color:d,transform:"scale(0.5)"},l[`${f}%`]={opacity:0,content:'""',color:d,transform:"scale(0.5)"})}return l}(t,s,i,o,r),c=t.length,a=`${n}-icon-${s}-${i}`,u=`@keyframes ${a}`,f=`\n            ${a}\n            ${2*c}s\n            linear\n            infinite\n        `;return{children:e.jsx(d,{sx:{width:"100%",height:"100%",position:"relative","&::after":{content:'""',position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",[u]:l,animation:f}}})}}}function nt({start:o=[],dims:r=3,size:s,palette:i,getFrontProps:l,getBackProps:c}){const[u,f]=t.useState(0);t.useEffect(()=>{const t=setInterval(()=>{f(t=>t+1)},2e3);return()=>clearInterval(t)},[]);const h=Z(o,r),m=s,{boardStates:g,inputStates:y,outputStates:j}=h,b=u%y.length,w=b===y.length-1,k=E({grid:g[b],rows:r,cols:r},i),z=l(k),v=c(k),I=ot(g,r,"board",i),S=et(y[b],r,i),$=et(j[b],r,i),P=tt(S),A=tt($),R=function(t,o,n,r){return(o,s)=>{const i=t.length,l={},c=100/i;for(let e=0;e<i;e++){const o=e*c,n=(e+1)*c;let a=r.secondary,u=!1,f="";const d=t[e],p=e+1<i?t[e+1]:null;d&&p&&d[s]!==p[s]&&(u=!0,a=1===d[s]?r.secondary:r.primary,f=`"${e+1}"`),u?(l[`${o}%`]={opacity:0,content:f,color:a,transform:"scale(0.5)"},l[`${o+.05*c}%`]={opacity:1,content:f,color:a,transform:"scale(1.2)"},l[`${o+.1*c}%`]={opacity:1,content:f,color:a,transform:"scale(1)"},l[n-.05*c+"%"]={opacity:1,content:f,color:a,transform:"scale(1)"},l[`${n}%`]={opacity:0,content:f,color:a,transform:"scale(0.5)"}):(l[`${o}%`]={opacity:0,content:'""',color:a,transform:"scale(0.5)"},l[`${n}%`]={opacity:0,content:'""',color:a,transform:"scale(0.5)"})}const a=`${n}-icon-${o}-${s}`,u=`@keyframes ${a}`,f=`\n            ${a}\n            ${2*i}s\n            linear\n            infinite\n        `;return{children:e.jsx(d,{sx:{width:"100%",height:"100%",position:"relative","&::after":{content:'""',position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:{xs:"0.8rem",sm:"1.2rem"},fontWeight:"bold",filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.2))",[u]:l,animation:f}}})}}}(y,0,"input",i);return e.jsx(p,{container:!0,size:12,spacing:2,sx:{height:"100%"},children:e.jsxs(p,{container:!0,size:12,wrap:"nowrap",sx:{justifyContent:"center",alignItems:"center",flex:1,height:"100%"},children:[e.jsxs(p,{size:6,sx:{display:"flex",justifyContent:"center",position:"relative"},children:[e.jsx(W,{size:m,rows:r,cols:r,frontProps:(t,e)=>({...z(t,e),...I(t,e)}),backProps:v}),e.jsx(d,{sx:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",opacity:w?1:0,transform:w?"scale(1)":"scale(0.5)",transition:"all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",pointerEvents:"none",zIndex:2},children:e.jsx(C,{sx:{fontSize:{xs:"2.5rem",sm:"4rem"},color:n.primary.main,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.2))"}})})]}),e.jsxs(p,{container:!0,size:6,spacing:2,sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs(d,{sx:{mb:2,textAlign:"center"},children:[e.jsx(x,{variant:"subtitle2",sx:{mb:1,color:n.text.secondary},children:"Input"}),e.jsx(a,{rows:1,cols:r,size:m,cellProps:(t,e)=>({...P(t,e),...R(t,e)}),space:0})]}),e.jsxs(d,{sx:{textAlign:"center"},children:[e.jsx(a,{rows:1,cols:r,size:m,cellProps:A,space:0}),e.jsx(x,{variant:"subtitle2",sx:{mt:1,color:n.text.secondary},children:"Result"})]})]})]})})}const rt=({children:t})=>e.jsx(x,{variant:"h5",sx:{color:n.text.primary,fontWeight:r.fontWeight.bold,textAlign:"left",fontSize:r.fontSize.h2},children:t}),st=({Icon:t,title:o,text:s})=>e.jsxs(d,{sx:{px:2},children:[e.jsxs(x,{variant:"h6",sx:{color:n.text.primary,fontWeight:r.fontWeight.semibold,display:"flex",alignItems:"center",mb:1.5,fontSize:r.fontSize.subheading},children:[e.jsx(t,{sx:{mr:2,color:n.primary.main,fontSize:"1.75rem"}}),o]}),e.jsx(x,{variant:"body1",sx:{color:n.text.secondary,lineHeight:1.6,fontSize:r.fontSize.body,ml:6},children:s})]}),it=["Chasing Lights","How It Works","Calculator"],lt=w;function ct(o){const{rows:r,cols:s,size:i,open:l,palette:c,toggleOpen:f,getFrontProps:p,getBackProps:j}=o,b=u("md"),[w,C]=t.useState(0),[R,B]=t.useState(Array(s).fill(0));t.useEffect(()=>{B(Array(s).fill(0))},[s,c]);const W=Q(R,r,s),D=et(R,s,c),E=et(W,s,c),H=function(t,o){const{getColor:n,getBorder:r}=t;return(t,s)=>{const{front:i,back:l}=n(t,s);return{backgroundColor:i,style:r(t,s),onClick:o(s),sx:{"&:hover":{cursor:"pointer",color:l},transition:"all 200ms ease"},color:i,children:e.jsx(k,{})}}}(D,t=>e=>{e.stopPropagation();const o=[...R];o[t]^=1,B(o)}),T=tt(E),_=()=>{f()};return e.jsx(h,{open:l,onClose:_,slots:{backdrop:m},slotProps:{backdrop:{sx:{backgroundColor:t=>"dark"===t.palette.mode?"hsla(0, 0%, 3%, 0.85)":"hsla(0, 0%, 98%, 0.85)",backdropFilter:"blur(12px) saturate(180%)",transition:"all 0.3s ease-in-out !important"}}},sx:{zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(d,{sx:{outline:"none",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:[e.jsxs(lt,{onClick:t=>t.stopPropagation(),sx:{width:"100%",maxWidth:"1000px",height:{xs:"630px",sm:"495px"},minHeight:{xs:"630px",sm:"495px"},display:"flex",flexDirection:"column",p:0,overflow:"hidden",position:"relative",m:2},children:[e.jsxs(d,{sx:{flex:1,overflowY:"auto",p:{xs:2.5,md:3},display:"flex",flexDirection:"column"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,px:2},children:[e.jsx(rt,{children:it[w]}),e.jsx(g,{onClick:_,size:"small",sx:{color:n.text.secondary},children:e.jsx(z,{})})]}),0===w&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:4},children:[e.jsx(st,{Icon:v,title:"Chase to Bottom",text:"Turn off rows from top to bottom by clicking lights in each row to push them down."}),e.jsx(st,{Icon:I,title:"Use Calulator",text:"Enter the remaining lights pattern from the bottom row into the calculator on the last page."}),e.jsx(st,{Icon:S,title:"Chase Again",text:"Apply the solution pattern to the top row, then chase them down again to solve the puzzle."})]})}),1===w&&e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",animation:"fadeIn 0.3s ease"},children:e.jsx(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(nt,{dims:3,size:.7*i,start:[1,3,8],palette:c,getFrontProps:p,getBackProps:j})})}),2===w&&e.jsx(d,{sx:{animation:"fadeIn 0.3s ease",textAlign:"center",flex:1,display:"flex",flexDirection:"column"},children:e.jsxs(d,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center",gap:3},children:[e.jsxs(d,{children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:n.text.primary,fontWeight:"bold"},children:["Input"," ",e.jsx(d,{component:"span",sx:{color:n.text.secondary,fontWeight:"normal"},children:"(Bottom Row)"})]}),e.jsx(a,{space:0,rows:1,cols:s,size:i*(b?.9:.8),cellProps:H})]}),e.jsxs(d,{children:[e.jsxs(x,{variant:"subtitle2",sx:{mb:1,color:n.text.primary,fontWeight:"bold"},children:["Solution"," ",e.jsx(d,{component:"span",sx:{color:n.text.secondary,fontWeight:"normal"},children:"(Top Row)"})]}),e.jsx(a,{space:0,rows:1,cols:s,size:i*(b?.9:.8),cellProps:T})]}),e.jsx(d,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(y,{variant:"outlined",size:"small",startIcon:e.jsx($,{}),onClick:()=>{B(Array(s).fill(0))},sx:{borderColor:n.border.subtle,color:n.text.secondary},children:"Clear Pattern"})})]})})]}),e.jsxs(d,{sx:{p:2.5,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(y,{onClick:()=>{w>0&&C(w-1)},disabled:0===w,startIcon:e.jsx(P,{}),sx:{visibility:0===w?"hidden":"visible",color:n.text.primary},children:"Back"}),e.jsx(d,{sx:{display:"flex",gap:1},children:[0,1,2].map(t=>e.jsx(d,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:w===t?n.primary.main:n.interactive.disabled,transition:"background-color 0.3s"}},t))}),e.jsx(y,{onClick:()=>{w<2?C(w+1):f()},disabled:2===w,endIcon:e.jsx(A,{}),sx:{visibility:2===w?"hidden":"visible",color:n.text.primary},children:"Next"})]})]}),e.jsx("style",{children:"\n                    @keyframes fadeIn {\n                        from { opacity: 0; transform: translateY(10px); }\n                        to { opacity: 1; transform: translateY(0); }\n                    }\n                "})]})})}function at(t,o){const{getColor:n,getBorder:r}=t;return(t,s)=>{const i=r(t,s),{front:l,back:c}=n(t,s);return{onClick:()=>((t,e)=>{o({type:"adjacent",row:t,col:e})})(t,s),children:e.jsx(k,{}),backgroundColor:l,color:l,style:i,sx:{"&:hover":{cursor:"pointer",color:c}}}}}function ut(t){return(e,o)=>({backgroundColor:t.getFiller(e,o)})}function ft(t){const e=at(t,()=>{});return(t,o)=>({...e(t,o),onClick:void 0,sx:void 0})}function dt(){const{height:r,width:a}=j(),x=u("sm"),h=x?b.gridSizes.mobile:b.gridSizes.desktop;let{rows:m,cols:g}=t.useMemo(()=>{const t=x?c.headerHeight.xs:c.headerHeight.md;return f(h,r-t,Math.min(a,1300))},[h,r,a,x]);m-=1,g-=1,x&&(m-=2);const y={grid:H(m,g),score:0,rows:m,cols:g,auto:!1},[w,k]=t.useReducer(N,y),[C,z]=t.useReducer(t=>!t,!1),v=t.useMemo(()=>({primary:n.primary.main,secondary:n.primary.dark}),[]);t.useEffect(()=>{document.title=s.lightsOut},[]),t.useEffect(()=>{k({type:"resize",newRows:m,newCols:g})},[m,g]);const[I,S]=o.useState([]);t.useEffect(()=>{if(!w.auto)return void(I.length>0&&S([]));const t=setTimeout(()=>{if(I.length>0){const[t,...e]=I;k({type:"adjacent",row:t.row,col:t.col}),S(e)}else{const t=M(w.grid);t&&t.length>0?1===t.length?k({type:"adjacent",row:t[0].row,col:t[0].col}):S(t):k({type:"auto"})}},300);return()=>clearTimeout(t)},[w.auto,w.grid,I]);const $=E(w,v),P=at($,t=>k(t)),A=ut($);return e.jsxs(p,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,position:"relative"},children:[e.jsx(B,{showHome:!0,infoUrl:"https://en.wikipedia.org/wiki/Lights_Out_(game)"}),e.jsx(d,{sx:{flex:1,position:"relative",width:"100%",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",paddingTop:6},children:e.jsx(W,{size:h,rows:m,cols:g,frontProps:P,backProps:A})}),e.jsx(i,{handler:()=>()=>{},onAutoPlay:()=>k({type:"auto"}),autoPlayEnabled:w.auto,children:e.jsx(l,{title:"How to Play",Icon:R,onClick:z})}),e.jsx(ct,{rows:m,cols:g,size:h,open:C,palette:v,toggleOpen:z,getFrontProps:ft,getBackProps:ut})]})}export{dt as default};
