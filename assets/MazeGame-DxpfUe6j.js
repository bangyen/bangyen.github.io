import{r as t,j as r}from"./vendor_react-Dmhynvug.js";import{G as e}from"./GlobalHeader-Bn4_naXn.js";import{a as n}from"./index-CuKdA5ED.js";import{u as o}from"./useWindow-BBwwMb5V.js";import{u as a}from"./layout-CG8ipCwr.js";import{G as i,B as l}from"./vendor_mui_core-DlAVUGaJ.js";import"./vendor_mui_icons-QNRPY-R2.js";const s=(t,r)=>{const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push({row:n,col:e,visited:!1,walls:{top:!0,right:!0,bottom:!0,left:!0}});e.push(t)}return e},c=(t,r,e,n,o=!1)=>{const a=[],{row:i,col:l}=t;return[[i-1,l],[i+1,l],[i,l-1],[i,l+1]].forEach(([t,i])=>{if(void 0!==t&&void 0!==i&&t>=0&&t<e&&i>=0&&i<n&&r[t]?.[i]?.visited===o){const e=r[t][i];a.push(e)}}),a},u=(t,r)=>{const e=t.row-r.row,n=t.col-r.col;1===e?(t.walls.top=!1,r.walls.bottom=!1):-1===e?(t.walls.bottom=!1,r.walls.top=!1):1===n?(t.walls.left=!1,r.walls.right=!1):-1===n&&(t.walls.right=!1,r.walls.left=!1)};const d={backtracker:function(t,r,e){const n=[],o=t[0]?.[0];if(o)for(o.visited=!0,n.push(o);n.length>0;){const o=n[n.length-1];if(!o)break;const a=c(o,t,r,e,!1);if(a.length>0){const t=a[Math.floor(Math.random()*a.length)];t&&(u(o,t),t.visited=!0,n.push(t))}else n.pop()}},prims:function(t,r,e){const n=t[0]?.[0];if(!n)return;n.visited=!0;const o=c(n,t,r,e,!1).map(t=>({parent:n,cell:t}));for(;o.length>0;){const n=Math.floor(Math.random()*o.length),a=o[n];if(!a)continue;const{parent:i,cell:l}=a;if(o.splice(n,1),!l.visited){l.visited=!0,u(i,l);c(l,t,r,e,!1).forEach(t=>{o.push({parent:l,cell:t})})}}}};const g=21,f=100,h=12;function m(){const c=t.useRef(null),u=t.useRef(null),[m,p]=t.useState(null),[w,y]=t.useState("start"),[x]=t.useState("backtracker"),v=t.useRef({player:{x:0,y:0,rotation:0},goal:{x:0,y:0,rotation:0},camera:{x:0,y:0},gameState:"start",lastTime:0,trail:[]}),{height:b,width:C}=o(),k=a("sm"),T=b-(k?56:80),M=t.useRef({isDown:!1,startX:0,startY:0,currentX:0,currentY:0}),[S,E]=t.useState({active:!1,originConfig:null,currentConfig:null}),j=t.useCallback(()=>{const t=function(t,r,e="backtracker"){const n=s(t,r);return(0,d[e])(n,t,r),{grid:n,rows:t,cols:r,start:[0,0],end:[t-1,r-1]}}(g,g,x);p(t),v.current.player={x:t.start[1]*f+50,y:t.start[0]*f+50,rotation:0},v.current.goal={x:t.end[1]*f+50,y:t.end[0]*f+50,rotation:0},v.current.gameState="playing",v.current.lastTime=0,y("playing")},[x]);t.useEffect(()=>{j()},[j]),t.useEffect(()=>{if(!c.current)return;const t=c.current,r=window.devicePixelRatio||1;t.width=C*r,t.height=T*r;const e=t.getContext("2d");e&&e.scale(r,r)},[C,T]),t.useEffect(()=>{if(!m||"playing"!==w||!c.current)return;const t=c.current.getContext("2d",{alpha:!0});if(!t)return;let r;const e={},o=t=>{e[t.key.toLowerCase()]=!0},a=t=>{e[t.key.toLowerCase()]=!1};window.addEventListener("keydown",o),window.addEventListener("keyup",a);const i=o=>{r=requestAnimationFrame(i);const a=v.current.lastTime?(o-v.current.lastTime)/16.67:1;v.current.lastTime=o;const l=6*a,s=(e.d||e.arrowright?1:0)-(e.a||e.arrowleft?1:0),c=(e.s||e.arrowdown?1:0)-(e.w||e.arrowup?1:0);let u=0,d=0;M.current.isDown&&(u=Math.max(-1,Math.min(1,(M.current.currentX-M.current.startX)/80)),d=Math.max(-1,Math.min(1,(M.current.currentY-M.current.startY)/80)));const p=s+u,w=c+d;if(0!==p||0!==w){const t=Math.atan2(w,p),r=Math.min(1,Math.sqrt(p*p+w*w)),e=Math.cos(t)*r*l,n=Math.sin(t)*r*l,o=v.current.player.x+e,i=v.current.player.y+n,s=(t,r)=>{const e=Math.floor(t/f),n=Math.floor(r/f);if(n<0||n>=g||e<0||e>=g)return!1;const o=m.grid[n]?.[e];if(!o)return!1;const a=e*f,i=(e+1)*f,l=n*f,s=(n+1)*f;return!(o.walls.left&&t-14<a)&&(!(o.walls.right&&t+14>i)&&(!(o.walls.top&&r-14<l)&&!(o.walls.bottom&&r+14>s)))};s(o,v.current.player.y)&&(v.current.player.x=o),s(v.current.player.x,i)&&(v.current.player.y=i),v.current.player.rotation+=.15*r*a,v.current.trail.push({x:v.current.player.x,y:v.current.player.y})}const x=v.current.trail;x.length>(0!==p||0!==w?15:0)&&x.shift();const b=1-Math.pow(.9,a);v.current.camera.x+=(v.current.player.x-v.current.camera.x)*b,v.current.camera.y+=(v.current.player.y-v.current.camera.y)*b;Math.sqrt(Math.pow(v.current.player.x-v.current.goal.x,2)+Math.pow(v.current.player.y-v.current.goal.y,2))<30&&"playing"===v.current.gameState&&(v.current.gameState="won",y("won"),setTimeout(()=>{j()},1500)),t.clearRect(0,0,C,T),t.save(),t.translate(C/2-v.current.camera.x,T/2-v.current.camera.y);const k=50,S=v.current.camera.x-C/2,E=v.current.camera.x+C/2,X=v.current.camera.y-T/2,Y=v.current.camera.y+T/2;t.beginPath(),t.strokeStyle=n.primary.main,t.globalAlpha=.03,t.lineWidth=1;for(let r=Math.floor(S/k)*k;r<=E;r+=k)t.moveTo(r,X),t.lineTo(r,Y);for(let r=Math.floor(X/k)*k;r<=Y;r+=k)t.moveTo(S,r),t.lineTo(E,r);t.stroke(),t.globalAlpha=1,t.strokeStyle=n.primary.main,t.lineWidth=4,t.lineCap="round",t.shadowColor=n.primary.main,t.shadowBlur=0;const P=12;t.beginPath();for(let r=0;r<=g;r++)for(let e=0;e<=g;e++){const n=e*f,o=r*f,a=r>0&&(e<g?m.grid[r-1]?.[e]?.walls.left??!1:m.grid[r-1]?.[e-1]?.walls.right??!1),i=r<g&&(e<g?m.grid[r]?.[e]?.walls.left??!1:m.grid[r]?.[e-1]?.walls.right??!1),l=e>0&&(r<g?m.grid[r]?.[e-1]?.walls.top??!1:m.grid[r-1]?.[e-1]?.walls.bottom??!1),s=e<g&&(r<g?m.grid[r]?.[e]?.walls.top??!1:m.grid[r-1]?.[e]?.walls.bottom??!1),c=(a?1:0)+(i?1:0)+(l?1:0)+(s?1:0);if(2===c&&(a&&s&&!i&&!l?(t.moveTo(n,o-P),t.arcTo(n,o,n+P,o,P)):s&&i&&!l&&!a?(t.moveTo(n+P,o),t.arcTo(n,o,n,o+P,P)):i&&l&&!a&&!s?(t.moveTo(n,o+P),t.arcTo(n,o,n-P,o,P)):l&&a&&!s&&!i&&(t.moveTo(n-P,o),t.arcTo(n,o,n,o-P,P))),i){const a=2===c&&(l||s)?o+P:o,i=r+1,u=i<g&&(e<g?m.grid[i]?.[e]?.walls.left??!1:m.grid[i]?.[e-1]?.walls.right??!1),d=e>0&&(i<g?m.grid[i]?.[e-1]?.walls.top??!1:m.grid[i-1]?.[e-1]?.walls.bottom??!1),h=e<g&&(i<g?m.grid[i]?.[e]?.walls.top??!1:m.grid[i-1]?.[e]?.walls.bottom??!1),p=2===1+(u?1:0)+(d?1:0)+(h?1:0)&&(d||h)?(r+1)*f-P:(r+1)*f;t.moveTo(n,a),t.lineTo(n,p)}if(s){const l=2===c&&(a||i)?n+P:n,s=e+1,u=r>0&&(s<g?m.grid[r-1]?.[s]?.walls.left??!1:m.grid[r-1]?.[s-1]?.walls.right??!1),d=r<g&&(s<g?m.grid[r]?.[s]?.walls.left??!1:m.grid[r]?.[s-1]?.walls.right??!1),h=s<g&&(r<g?m.grid[r]?.[s]?.walls.top??!1:m.grid[r-1]?.[s]?.walls.bottom??!1),p=s*f-(2===1+(u?1:0)+(d?1:0)+(h?1:0)&&(u||d)?P:0);t.moveTo(l,o),t.lineTo(p,o)}}t.stroke(),t.shadowBlur=0;const A=v.current.goal;A.rotation+=.02*a,t.save(),t.translate(A.x,A.y),t.rotate(A.rotation),t.fillStyle=n.data.green,t.shadowColor=n.data.green,t.shadowBlur=0,t.beginPath(),t.rect(-10,-10,20,20),t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.lineWidth=2,t.stroke(),t.restore();const L=v.current.trail,R=L.length;if(R>2){t.save(),t.beginPath(),t.strokeStyle=n.data.amber,t.lineWidth=h,t.lineCap="round",t.lineJoin="round";const r=L[0];if(r){t.moveTo(r.x,r.y);for(let r=1;r<R-1;r++){const e=L[r],n=L[r+1];if(e&&n){const o=(e.x+n.x)/2,a=(e.y+n.y)/2;t.globalAlpha=r/R*.15,t.quadraticCurveTo(e.x,e.y,o,a),t.stroke(),t.beginPath(),t.moveTo(o,a)}}}t.restore()}else if(R>1){const r=L[0],e=L[1];r&&e&&(t.save(),t.beginPath(),t.strokeStyle=n.data.amber,t.lineWidth=h,t.lineCap="round",t.globalAlpha=.15,t.moveTo(r.x,r.y),t.lineTo(e.x,e.y),t.stroke(),t.restore())}const D=v.current.player;t.save(),t.translate(D.x,D.y);const q=t.createRadialGradient(0,0,0,0,0,24);q.addColorStop(0,n.data.amber),q.addColorStop(1,"transparent"),t.fillStyle=q,t.globalAlpha=.2+.1*Math.sin(.005*o),t.beginPath(),t.arc(0,0,24,0,2*Math.PI),t.fill(),t.globalAlpha=1,t.fillStyle=n.data.amber,t.beginPath(),t.arc(0,0,h,0,2*Math.PI),t.fill(),t.restore(),t.restore()};return requestAnimationFrame(i),()=>{cancelAnimationFrame(r),window.removeEventListener("keydown",o),window.removeEventListener("keyup",a)}},[m,w,C,T,k,j]);const X=t=>{M.current.isDown&&(M.current.currentX=t.clientX,M.current.currentY=t.clientY,E(r=>{if(!r.originConfig)return r;const e=t.clientX-r.originConfig.x,n=t.clientY-r.originConfig.y,o=Math.sqrt(e*e+n*n);let a=t.clientX,i=t.clientY;if(o>50){const t=50/o;a=r.originConfig.x+e*t,i=r.originConfig.y+n*t}return{...r,currentConfig:{x:a,y:i}}}))},Y=()=>{M.current.isDown=!1,E({active:!1,originConfig:null,currentConfig:null})};return t.useEffect(()=>(window.addEventListener("pointermove",X),window.addEventListener("pointerup",Y),()=>{window.removeEventListener("pointermove",X),window.removeEventListener("pointerup",Y)}),[]),t.useEffect(()=>{document.title="2D Maze | Bangyen"},[]),r.jsxs(i,{container:!0,minHeight:"100vh",flexDirection:"column",sx:{background:n.surface.background,overflow:"hidden"},children:[r.jsx(e,{showHome:!0}),r.jsx(l,{ref:u,onPointerDown:t=>{"playing"===w&&(M.current.isDown=!0,M.current.startX=t.clientX,M.current.startY=t.clientY,M.current.currentX=t.clientX,M.current.currentY=t.clientY,E({active:!0,originConfig:{x:t.clientX,y:t.clientY},currentConfig:{x:t.clientX,y:t.clientY}}))},sx:{flex:1,position:"relative",touchAction:"none",backgroundColor:"transparent"},children:r.jsx("canvas",{ref:c,style:{display:"block",width:"100%",height:"100%"}})}),S.active&&S.originConfig&&S.currentConfig&&r.jsxs(l,{sx:{position:"absolute",left:0,top:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:20},children:[r.jsx(l,{sx:{position:"absolute",left:S.originConfig.x,top:S.originConfig.y,width:100,height:100,transform:"translate(-50%, -50%)",borderRadius:"50%",border:`2px solid ${n.primary.main}`,opacity:.3,background:`radial-gradient(circle, ${n.primary.main} 0%, transparent 70%)`}}),r.jsx(l,{sx:{position:"absolute",left:S.currentConfig.x,top:S.currentConfig.y,width:40,height:40,transform:"translate(-50%, -50%)",borderRadius:"50%",background:n.primary.main,boxShadow:`0 0 15px ${n.primary.main}`,opacity:.8}})]})]})}export{m as default};
